<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gelişmiş Güvenlik Test - Zuhal Müzik</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: #5a6fd8;
        }
        .btn-danger {
            background: #ff6b6b;
        }
        .btn-success {
            background: #51cf66;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .warning {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border: 1px solid #ffeaa7;
        }
        .success {
            background: #d1ecf1;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border: 1px solid #bee5eb;
        }
        .security-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .security-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        .security-card h3 {
            margin-bottom: 15px;
            color: #495057;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .feature-list li:before {
            content: "✅ ";
            color: #51cf66;
            font-weight: bold;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔐 Gelişmiş Güvenlik Sistemi Test Sayfası</h1>
        
        <div class="success">
            <h3>🎉 Yeni Gelişmiş Güvenlik Özellikleri Aktif!</h3>
            <p>Artık daha güvenli bir giriş sisteminiz var. Aşağıdaki özellikler test edilebilir:</p>
        </div>

        <div class="security-grid">
            <div class="security-card">
                <h3>🔐 PIN Kodu Sistemi</h3>
                <ul class="feature-list">
                    <li>6 haneli PIN kodu</li>
                    <li>User/Admin grupları</li>
                    <li>3 yanlış deneme kilitleme</li>
                    <li>30 dakika oturum süresi</li>
                </ul>
                <div class="code-block">
Kullanıcı PIN'leri:
• 123456 - Kullanıcı
• 111111 - Test User

Yönetici PIN'leri:
• 654321 - Yönetici (2FA aktif)
• 999999 - Admin (2FA aktif)
                </div>
            </div>

            <div class="security-card">
                <h3>🏢 Odoo Entegrasyonu</h3>
                <ul class="feature-list">
                    <li>Odoo kullanıcı adı/şifre</li>
                    <li>API token authentication</li>
                    <li>Güvenli server bağlantısı</li>
                    <li>Session management</li>
                </ul>
                <div class="code-block">
Test Odoo Server:
URL: https://demo.odoo.com
Username: demo
Password: demo
                </div>
            </div>

            <div class="security-card">
                <h3>🔒 İkili Doğrulama (2FA)</h3>
                <ul class="feature-list">
                    <li>Google Authenticator uyumlu</li>
                    <li>Gerçek TOTP algoritması</li>
                    <li>QR kod ile kurulum</li>
                    <li>Yedek kodlar</li>
                </ul>
                <div class="code-block">
TOTP Secret: JBSWY3DPEHPK3PXP
QR Code: otpauth://totp/ZuhalMuzik:...
                </div>
            </div>

            <div class="security-card">
                <h3>🛡️ Gelişmiş Güvenlik</h3>
                <ul class="feature-list">
                    <li>IP adresi kontrolü</li>
                    <li>Cihaz fingerprinting</li>
                    <li>Şifreli veri saklama</li>
                    <li>Otomatik güvenlik uyarıları</li>
                </ul>
                <div class="code-block">
Device Fingerprint: SHA256 hash
IP Tracking: API integration
Encryption: AES-256
                </div>
            </div>

            <div class="security-card">
                <h3>👥 Kullanıcı Yönetimi</h3>
                <ul class="feature-list">
                    <li>Kullanıcı ekleme/çıkarma</li>
                    <li>Rol bazlı yetkilendirme</li>
                    <li>Güvenilir cihaz yönetimi</li>
                    <li>Oturum geçmişi</li>
                </ul>
                <div class="code-block">
Admin Yetkileri:
• Kullanıcı ekleme/silme
• Güvenlik ayarları
• Sistem yönetimi
                </div>
            </div>

            <div class="security-card">
                <h3>📊 Güvenlik İzleme</h3>
                <ul class="feature-list">
                    <li>Giriş logları</li>
                    <li>Güvenlik olayları</li>
                    <li>Anomali tespiti</li>
                    <li>Gerçek zamanlı uyarılar</li>
                </ul>
                <div class="code-block">
Monitoring Features:
• Login attempts tracking
• Device fingerprint changes
• IP address monitoring
• Session timeout alerts
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>🧪 Test Senaryoları</h2>
            
            <h3>1. PIN Kodu Testi</h3>
            <p>Farklı PIN kodları ile giriş yapmayı deneyin:</p>
            <ul>
                <li>Doğru PIN ile giriş</li>
                <li>Yanlış PIN ile giriş (3 kez sonra kilitleme)</li>
                <li>Admin PIN ile ikili doğrulama</li>
            </ul>

            <h3>2. Odoo Entegrasyon Testi</h3>
            <p>Odoo demo server'ı ile bağlantı testi:</p>
            <ul>
                <li>Geçerli Odoo bilgileri ile giriş</li>
                <li>Geçersiz bilgiler ile giriş</li>
                <li>Server bağlantı hataları</li>
            </ul>

            <h3>3. Güvenlik Testi</h3>
            <p>Güvenlik özelliklerini test edin:</p>
            <ul>
                <li>Farklı IP'den giriş denemesi</li>
                <li>Cihaz fingerprint değişikliği</li>
                <li>Oturum süresi kontrolü</li>
                <li>Şifreli veri doğrulaması</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>🚀 Test Linkleri</h2>
            
            <a href="auth.html" class="btn">🔐 Basit PIN Sistemi</a>
            <a href="auth-advanced.html" class="btn btn-success">🔒 Gelişmiş Güvenlik Sistemi</a>
            <a href="index.html" class="btn">📊 Ana Dashboard</a>
            
            <div style="margin-top: 20px;">
                <button onclick="clearAllData()" class="btn btn-danger">🗑️ Tüm Verileri Temizle</button>
                <button onclick="showSecurityStatus()" class="btn">📊 Güvenlik Durumu</button>
                <button onclick="testEncryption()" class="btn">🔐 Şifreleme Testi</button>
            </div>
        </div>

        <div class="warning">
            <h3>⚠️ Güvenlik Notları</h3>
            <ul>
                <li><strong>Odoo Entegrasyonu:</strong> Demo server kullanılıyor, gerçek sunucunuzda API ayarlarını yapın</li>
                <li><strong>2FA:</strong> Google Authenticator uygulaması gerekli</li>
                <li><strong>IP Kontrolü:</strong> Farklı IP'lerden giriş uyarı verecek</li>
                <li><strong>Şifreleme:</strong> Tüm veriler AES-256 ile şifreleniyor</li>
                <li><strong>Session:</strong> 30 dakika sonra otomatik sona eriyor</li>
            </ul>
        </div>

        <div class="info">
            <h3>💡 Test İpuçları</h3>
            <ol>
                <li>Önce <strong>auth-advanced.html</strong> ile gelişmiş sistemi test edin</li>
                <li>PIN kodu yerine Odoo giriş seçeneğini deneyin</li>
                <li>Admin PIN ile ikili doğrulamayı test edin</li>
                <li>Güvenlik butonuna tıklayarak detayları görün</li>
                <li>Farklı tarayıcıdan giriş yaparak IP uyarısını test edin</li>
                <li>Tarayıcı geliştirici araçlarından localStorage'ı kontrol edin</li>
            </ol>
        </div>
    </div>

    <script>
        // Tüm verileri temizle
        function clearAllData() {
            if (confirm('Tüm güvenlik verilerini temizlemek istediğinizden emin misiniz?')) {
                localStorage.clear();
                alert('✅ Tüm veriler temizlendi. Sayfa yenilenecek.');
                location.reload();
            }
        }

        // Güvenlik durumunu göster
        function showSecurityStatus() {
            const session = localStorage.getItem('session');
            const trustedDevices = localStorage.getItem('trustedDevices');
            
            let status = '🔍 Güvenlik Durumu:\n\n';
            
            if (session) {
                status += '✅ Aktif oturum var\n';
                try {
                    const key = 'zuhal-muzik-secret-key-2024';
                    const bytes = CryptoJS.AES.decrypt(session, key);
                    const sessionData = JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
                    
                    const timeLeft = Math.max(0, 30 * 60 * 1000 - (Date.now() - sessionData.loginTime));
                    const minutesLeft = Math.floor(timeLeft / (60 * 1000));
                    
                    status += `• Kullanıcı: ${sessionData.user.name}\n`;
                    status += `• Rol: ${sessionData.user.role}\n`;
                    status += `• 2FA: ${sessionData.user.twoFactorEnabled ? 'Aktif' : 'Pasif'}\n`;
                    status += `• Kalan süre: ${minutesLeft} dakika\n`;
                    status += `• IP: ${sessionData.ipAddress || 'Bilinmiyor'}\n`;
                } catch (error) {
                    status += '❌ Session verisi bozuk\n';
                }
            } else {
                status += '❌ Aktif oturum yok\n';
            }
            
            if (trustedDevices) {
                const devices = JSON.parse(trustedDevices);
                status += `\n📱 Güvenilir Cihazlar: ${devices.length}\n`;
                devices.forEach((device, index) => {
                    status += `• Cihaz ${index + 1}: ${device.ipAddress} (${new Date(device.trustedAt).toLocaleDateString()})\n`;
                });
            } else {
                status += '\n📱 Güvenilir cihaz yok\n';
            }
            
            alert(status);
        }

        // Şifreleme testi
        function testEncryption() {
            const testData = 'Test verisi - Zuhal Müzik Güvenlik Testi';
            const key = 'zuhal-muzik-secret-key-2024';
            
            try {
                const encrypted = CryptoJS.AES.encrypt(testData, key).toString();
                const decrypted = CryptoJS.AES.decrypt(encrypted, key).toString(CryptoJS.enc.Utf8);
                
                if (decrypted === testData) {
                    alert('✅ Şifreleme sistemi çalışıyor!\n\nOrijinal: ' + testData + '\nŞifrelenmiş: ' + encrypted.substring(0, 50) + '...\nÇözülmüş: ' + decrypted);
                } else {
                    alert('❌ Şifreleme sistemi hatası!');
                }
            } catch (error) {
                alert('❌ Şifreleme testi başarısız: ' + error.message);
            }
        }

        // Sayfa yüklendiğinde güvenlik durumunu kontrol et
        document.addEventListener('DOMContentLoaded', function() {
            const session = localStorage.getItem('session');
            if (session) {
                document.body.insertAdjacentHTML('afterbegin', `
                    <div style="background: #d4edda; color: #155724; padding: 10px; text-align: center; border-bottom: 1px solid #c3e6cb;">
                        ✅ Gelişmiş güvenlik sistemi aktif - Oturum mevcut
                    </div>
                `);
            } else {
                document.body.insertAdjacentHTML('afterbegin', `
                    <div style="background: #f8d7da; color: #721c24; padding: 10px; text-align: center; border-bottom: 1px solid #f5c6cb;">
                        ❌ Oturum bulunamadı - Giriş yapmanız gerekiyor
                    </div>
                `);
            }
        });
    </script>
</body>
</html>
