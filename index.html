<!DOCTYPE html><html lang="tr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Zuhal MÃ¼zik Raporlama</title><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script><script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script><script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script><script src="performance-optimizer.js"></script><script src="ai-analyzer-enhanced.js"></script><script src="time-analysis-enhanced.js"></script><script>(()=>{var e=sessionStorage.getItem("isLoggedIn"),o=sessionStorage.getItem("username");"true"===e&&o||(window.location.href="login.html")})()</script><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);min-height:100vh;padding:20px}.container{max-width:1400px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden}.header{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:30px;text-align:center;position:relative}.header h1{font-size:2.5em;margin-bottom:10px}.header p{font-size:1.2em;opacity:.9}.user-info{position:absolute;top:20px;right:30px;display:flex;align-items:center;gap:15px;background:rgba(255,255,255,.2);padding:10px 20px;border-radius:25px;backdrop-filter:blur(10px)}.user-name{font-size:14px;font-weight:500}.logout-btn{background:rgba(255,255,255,.3);border:1px solid rgba(255,255,255,.5);color:#fff;padding:6px 16px;border-radius:15px;cursor:pointer;font-size:13px;font-weight:500;transition:all .3s ease}.logout-btn:hover{background:rgba(255,255,255,.4);transform:translateY(-1px)}.info-box{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;padding:30px;background:#f8f9fa;border-bottom:1px solid #dee2e6}.info-card{background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1)}.info-card h3{font-size:.9em;color:#6c757d;margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px}.info-card p{font-size:1.5em;color:#212529;font-weight:600}.search-section{padding:30px;background:#fff;border-bottom:1px solid #dee2e6}.search-box{display:flex;gap:10px;max-width:800px;margin:0 auto}.search-box input{flex:1;padding:15px 20px;font-size:1.1em;border:2px solid #dee2e6;border-radius:10px;outline:0;transition:all .3s}.search-box input:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}.search-box button{padding:15px 30px;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;border:none;border-radius:10px;font-size:1.1em;font-weight:600;cursor:pointer;transition:transform .2s}.search-box button:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,.3)}.filters-section{padding:30px;background:#f8f9fa;border-bottom:1px solid #dee2e6}.filters-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}.filter-group label{display:block;font-size:.9em;font-weight:600;color:#495057;margin-bottom:5px}.filter-group select{width:100%;padding:10px;border:2px solid #dee2e6;border-radius:8px;font-size:1em;outline:0;transition:all .3s;min-height:42px}.filter-group select[multiple]{display:none}.filter-search-box{position:relative;margin-bottom:8px}.filter-search-input{width:100%;padding:8px 30px 8px 10px;border:1px solid #ddd;border-radius:5px;font-size:.9em;box-sizing:border-box}.filter-search-input:focus{outline:0;border-color:#667eea}.filter-search-clear{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:0 0;border:none;color:#999;cursor:pointer;font-size:1.2em;padding:0;width:20px;height:20px;display:none}.filter-search-clear:hover{color:#333}.checkbox-container{max-height:200px;overflow-y:auto;border:2px solid #dee2e6;border-radius:8px;padding:10px;background:#fff}.checkbox-item{display:flex;align-items:center;padding:8px;cursor:pointer;border-radius:5px;transition:background .2s}.checkbox-item.hidden{display:none}.checkbox-item:hover{background:#f8f9fa}.checkbox-item input[type=checkbox]{width:18px;height:18px;margin-right:10px;cursor:pointer;accent-color:#667eea}.checkbox-item label{cursor:pointer;flex:1;margin:0;font-size:.95em}.filter-group select:focus{border-color:#667eea}.selected-count{font-size:.85em;color:#667eea;margin-top:3px;font-weight:600}.filter-buttons{display:flex;gap:10px;justify-content:flex-end}.filter-buttons button{padding:10px 20px;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .3s}.btn-apply{background:#28a745;color:#fff}.btn-reset{background:#6c757d;color:#fff}.btn-apply:hover{background:#218838}.btn-reset:hover{background:#5a6268}.content{padding:30px}.summary-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}.summary-card{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:25px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,.2)}.summary-card h3{font-size:.9em;opacity:.9;margin-bottom:10px}.summary-card p{font-size:2em;font-weight:700}.table-wrapper{overflow-x:auto;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1)}.data-table{width:100%;border-collapse:collapse;background:#fff;min-width:1200px}.data-table thead{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;position:sticky;top:0;z-index:10}.data-table th{padding:15px 10px;text-align:left;font-weight:600;cursor:pointer;user-select:none;white-space:nowrap;font-size:.9em}.data-table th:hover{background:rgba(255,255,255,.1)}.data-table td{padding:10px;border-bottom:1px solid #dee2e6;font-size:.9em;max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.data-table td:hover{overflow:visible;white-space:normal;word-wrap:break-word;position:relative;z-index:5;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.15)}.data-table tbody tr:hover{background:#f8f9fa}.data-table td.numeric{text-align:right;font-family:'Courier New',monospace}.loading{text-align:center;padding:50px;font-size:1.2em;color:#6c757d}.error{text-align:center;padding:50px;color:#dc3545;font-size:1.2em}.status-badge{display:inline-block;padding:5px 10px;border-radius:5px;font-size:.85em;font-weight:600}.status-success{background:#d4edda;color:#155724}.status-warning{background:#fff3cd;color:#856404}.status-error{background:#f8d7da;color:#721c24}.tabs{display:flex;background:#f8f9fa;border-bottom:2px solid #dee2e6;padding:0 30px}.tab{padding:15px 30px;cursor:pointer;border:none;background:0 0;font-size:1.1em;font-weight:600;color:#6c757d;transition:all .3s;border-bottom:3px solid transparent}.tab:hover{color:#667eea;background:rgba(102,126,234,.1)}.tab.active{color:#667eea;border-bottom-color:#667eea;background:#fff}.tab-content{display:none}.tab-content.active{display:block}.voice-btn{padding:15px 20px;background:linear-gradient(135deg,#f093fb 0,#f5576c 100%);color:#fff;border:none;border-radius:10px;font-size:1.5em;cursor:pointer;transition:all .3s}.voice-btn:hover{transform:scale(1.1);box-shadow:0 5px 15px rgba(245,87,108,.4)}.voice-btn.listening{animation:pulse 1.5s infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}.target-section{background:#f8f9fa;padding:30px;border-radius:15px;margin-bottom:30px}.target-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-top:20px}.target-card{background:#fff;padding:25px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,.1)}.target-card h3{font-size:1.2em;color:#495057;margin-bottom:15px}.target-input{width:100%;padding:12px;border:2px solid #dee2e6;border-radius:8px;font-size:1.1em;margin-bottom:15px}.progress-bar{width:100%;height:30px;background:#e9ecef;border-radius:15px;overflow:hidden;margin:15px 0}.progress-fill{height:100%;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);transition:width .5s ease;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600}.target-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:15px}.target-stat{background:#f8f9fa;padding:10px;border-radius:8px;text-align:center}.target-stat label{font-size:.85em;color:#6c757d;display:block;margin-bottom:5px}.target-stat value{font-size:1.3em;font-weight:700;color:#212529}.customer-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:30px}.customer-card{background:#fff;padding:20px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,.1);transition:transform .3s}.customer-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.15)}.customer-rank{display:inline-block;width:40px;height:40px;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;border-radius:50%;text-align:center;line-height:40px;font-weight:700;font-size:1.2em;margin-right:15px}.chart-container{position:relative;height:400px;margin:30px 0}.export-btn{padding:12px 25px;background:linear-gradient(135deg,#11998e 0,#38ef7d 100%);color:#fff;border:none;border-radius:10px;font-size:1em;font-weight:600;cursor:pointer;transition:all .3s;margin-left:10px}.export-btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(17,153,142,.3)}.analysis-panel{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:30px;border-radius:15px;margin:30px 0;box-shadow:0 10px 30px rgba(0,0,0,.2)}.analysis-section{background:rgba(255,255,255,.1);padding:20px;border-radius:10px;margin:15px 0;backdrop-filter:blur(10px)}.analysis-section h3{margin:0 0 15px 0;font-size:1.3em;display:flex;align-items:center;gap:10px}.insight-item{background:rgba(255,255,255,.15);padding:15px;border-radius:8px;margin:10px 0;border-left:4px solid}.insight-positive{border-left-color:#38ef7d}.insight-negative{border-left-color:#f5576c}.insight-neutral{border-left-color:gold}.insight-icon{font-size:1.5em;margin-right:10px}.recommendation{background:rgba(255,255,255,.2);padding:15px;border-radius:8px;margin:10px 0;display:flex;align-items:start;gap:15px}.recommendation-icon{font-size:2em;flex-shrink:0}.metric-highlight{display:inline-block;background:rgba(255,255,255,.3);padding:3px 10px;border-radius:5px;font-weight:700;margin:0 5px}@media (max-width:768px){body{padding:10px}.container{border-radius:10px}.header h1{font-size:1.5em;margin-bottom:5px}.header p{font-size:.9em}.header{padding:20px 15px}.info-cards{grid-template-columns:1fr;gap:10px;padding:15px}.info-card{padding:15px}.info-card h3{font-size:.9em}.info-card p{font-size:1.2em}.tabs{overflow-x:auto;overflow-y:hidden;white-space:nowrap;-webkit-overflow-scrolling:touch;padding:10px 5px;gap:5px;scrollbar-width:thin}.tabs::-webkit-scrollbar{height:4px}.tabs::-webkit-scrollbar-thumb{background:#667eea;border-radius:2px}.tab{display:inline-block;padding:12px 20px;font-size:.85em;min-width:auto;white-space:nowrap}.content{padding:15px}.content h2{font-size:1.3em;margin-bottom:15px}.content h3{font-size:1.1em;margin-bottom:10px}.summary-cards{grid-template-columns:1fr;gap:10px}.summary-card{padding:15px}.summary-card h3{font-size:.9em}.summary-card p{font-size:1.3em}.filters{grid-template-columns:1fr;gap:15px}.filter-group{padding:12px}.filter-group label{font-size:.9em}.filter-group input,.filter-group select{font-size:.9em;padding:10px}.multi-select-dropdown{max-height:200px}.checkbox-item{padding:10px 8px}.checkbox-item label{font-size:.9em}.search-section{padding:15px}.search-box input{font-size:.9em;padding:12px}.search-box button{padding:12px 20px;font-size:.9em}button{padding:12px 20px;font-size:.9em;min-height:44px}.chart-container{min-height:250px;padding:15px;margin-bottom:20px}.chart-container h3{font-size:1em;margin-bottom:10px}.content>div[style*=grid-template-columns]{grid-template-columns:1fr!important;gap:15px!important}table{font-size:.85em;display:block;overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch}table tbody,table thead,table tr{display:table;width:100%;table-layout:fixed}table td,table th{padding:8px!important;min-width:80px}.customer-card{margin-bottom:15px}.customer-grid{grid-template-columns:1fr!important;gap:15px!important}.target-section{padding:15px}.target-input-group{grid-template-columns:1fr!important;gap:15px}.target-input-group input{font-size:.9em;padding:10px}.progress-item{margin-bottom:15px}.analysis-panel{padding:20px 15px}.analysis-section{margin:15px 0}.insight-item{padding:12px;margin:8px 0;font-size:.9em}.recommendation{padding:12px;margin:10px 0;font-size:.9em}#cityAnalysisContainer,#customerProfileContainer,#customerProfileMainContainer,#productResultsContainer,#salespersonProfileContainer{padding:10px}div[style*="grid-template-columns: repeat(auto-fit"]{grid-template-columns:1fr!important}input[type=number],input[type=text],select,textarea{font-size:16px!important}.tabs{position:sticky;top:0;z-index:100;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.1)}#voiceButton{width:44px;height:44px;padding:10px}button[onclick*=exportToExcel]{width:100%;margin-top:10px}#debugPanel{font-size:.8em;padding:10px}table::after{content:"â† KaydÄ±rÄ±n â†’";display:block;text-align:center;padding:10px;background:#f8f9fa;color:#6c757d;font-size:.85em;border-top:1px solid #dee2e6}table.scrolled::after{display:none}.content>*{margin-bottom:20px}.swal2-popup{width:90%!important;font-size:.9em!important}}@media (min-width:769px) and (max-width:1024px){.container{max-width:100%}.tabs{overflow-x:auto;white-space:nowrap}.tab{font-size:.9em;padding:12px 20px}.content{padding:20px}.filters{grid-template-columns:repeat(2,1fr)}div[style*="grid-template-columns: repeat(auto-fit"]{grid-template-columns:repeat(2,1fr)!important}}@media (max-width:768px) and (orientation:landscape){.header h1{font-size:1.3em}.chart-container{min-height:200px}.summary-cards{grid-template-columns:repeat(2,1fr)}}</style></head><body><div id="loadingScreen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);z-index:9999;display:flex;flex-direction:column;justify-content:center;align-items:center;color:#fff"><div style="text-align:center"><div id="loadingIcon" style="font-size:4em;margin-bottom:20px;animation:pulse 2s infinite">ğŸ“Š</div><h1 style="margin:0 0 10px 0;font-size:2.5em;animation:fadeInUp 1s ease">Zuhal MÃ¼zik Raporlama</h1><p style="margin:0 0 30px 0;font-size:1.2em;opacity:.9;animation:fadeInUp 1s ease .2s both">HoÅŸ Geldiniz! Veriler yÃ¼kleniyor...</p><div style="width:400px;height:8px;background:rgba(255,255,255,.3);border-radius:4px;margin:0 auto 15px;overflow:hidden;animation:fadeInUp 1s ease .4s both"><div id="progressBar" style="width:0%;height:100%;background:linear-gradient(90deg,#4ade80 0,#22c55e 100%);border-radius:4px;transition:width .3s ease;position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,transparent 0,rgba(255,255,255,.3) 50%,transparent 100%);animation:shimmer 2s infinite"></div></div></div><div id="progressText" style="font-size:1.1em;font-weight:600;margin-bottom:20px;animation:fadeInUp 1s ease .6s both">0%</div><div id="loadingSteps" style="font-size:.9em;opacity:.8;animation:fadeInUp 1s ease .8s both"><div id="step1" style="margin-bottom:8px;transition:all .3s ease">ğŸ”„ Sayfa baÅŸlatÄ±lÄ±yor...</div><div id="step2" style="display:none;margin-bottom:8px;transition:all .3s ease">ğŸ“Š Veri dosyalarÄ± yÃ¼kleniyor...</div><div id="step3" style="display:none;margin-bottom:8px;transition:all .3s ease">ğŸ¯ Hedefler yÃ¼kleniyor...</div><div id="step4" style="display:none;margin-bottom:8px;transition:all .3s ease">âœ… HazÄ±rlanÄ±yor...</div></div></div></div><style>@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}#loadingScreen .loading-step{opacity:.5;transition:opacity .3s ease}#loadingScreen .loading-step.active{opacity:1;color:#4ade80}</style><div class="container" style="display:none" id="mainContainer"><div class="header"><h1>ğŸ“Š Zuhal MÃ¼zik Raporlama</h1><p>MÃ¼zik EnstrÃ¼man SektÃ¶rÃ¼</p><div class="user-info"><span class="user-name" id="currentUserName">KullanÄ±cÄ±</span> <button class="logout-btn" onclick="logout()">ğŸšª Ã‡Ä±kÄ±ÅŸ</button></div></div><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);padding:25px;border-radius:15px;margin-bottom:20px;box-shadow:0 10px 30px rgba(102,126,234,.3)"><h3 style="color:#fff;margin:0 0 15px 0;font-size:1.3em">ğŸ¢ SatÄ±ÅŸ KanalÄ± Filtresi</h3><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px"><label style="background:rgba(255,255,255,.15);padding:12px 15px;border-radius:10px;cursor:pointer;display:flex;align-items:center;transition:all .3s;color:#fff;font-weight:500" onmouseover='this.style.background="rgba(255,255,255,0.25)"' onmouseout='this.style.background="rgba(255,255,255,0.15)"'><input type="checkbox" id="channelAll" checked="checked" onchange='handleChannelFilter("channelAll")' style="margin-right:10px;width:18px;height:18px;cursor:pointer"> <span>âœ¨ TÃ¼mÃ¼ (19 Kanal)</span></label> <label style="background:rgba(255,255,255,.15);padding:12px 15px;border-radius:10px;cursor:pointer;display:flex;align-items:center;transition:all .3s;color:#fff;font-weight:500" onmouseover='this.style.background="rgba(255,255,255,0.25)"' onmouseout='this.style.background="rgba(255,255,255,0.15)"'><input type="checkbox" id="channelRetail" onchange='handleChannelFilter("channelRetail")' style="margin-right:10px;width:18px;height:18px;cursor:pointer"> <span>ğŸª Perakende (14)</span></label> <label style="background:rgba(255,255,255,.15);padding:12px 15px;border-radius:10px;cursor:pointer;display:flex;align-items:center;transition:all .3s;color:#fff;font-weight:500" onmouseover='this.style.background="rgba(255,255,255,0.25)"' onmouseout='this.style.background="rgba(255,255,255,0.15)"'><input type="checkbox" id="channelWholesale" onchange='handleChannelFilter("channelWholesale")' style="margin-right:10px;width:18px;height:18px;cursor:pointer"> <span>ğŸ“¦ Toptan SatÄ±ÅŸ</span></label> <label style="background:rgba(255,255,255,.15);padding:12px 15px;border-radius:10px;cursor:pointer;display:flex;align-items:center;transition:all .3s;color:#fff;font-weight:500" onmouseover='this.style.background="rgba(255,255,255,0.25)"' onmouseout='this.style.background="rgba(255,255,255,0.15)"'><input type="checkbox" id="channelOnline" onchange='handleChannelFilter("channelOnline")' style="margin-right:10px;width:18px;height:18px;cursor:pointer"> <span>ğŸŒ Online SatÄ±ÅŸ</span></label> <label style="background:rgba(255,255,255,.15);padding:12px 15px;border-radius:10px;cursor:pointer;display:flex;align-items:center;transition:all .3s;color:#fff;font-weight:500" onmouseover='this.style.background="rgba(255,255,255,0.25)"' onmouseout='this.style.background="rgba(255,255,255,0.15)"'><input type="checkbox" id="channelCorporate" onchange='handleChannelFilter("channelCorporate")' style="margin-right:10px;width:18px;height:18px;cursor:pointer"> <span>ğŸ¢ Kurumsal SatÄ±ÅŸ</span></label> <label style="background:rgba(255,255,255,.15);padding:12px 15px;border-radius:10px;cursor:pointer;display:flex;align-items:center;transition:all .3s;color:#fff;font-weight:500" onmouseover='this.style.background="rgba(255,255,255,0.25)"' onmouseout='this.style.background="rgba(255,255,255,0.15)"'><input type="checkbox" id="channelCentral" onchange='handleChannelFilter("channelCentral")' style="margin-right:10px;width:18px;height:18px;cursor:pointer"> <span>ğŸ›ï¸ Merkezi SatÄ±ÅŸ</span></label></div><div id="channelFilterInfo" style="margin-top:12px;padding:10px 15px;background:rgba(255,255,255,.2);border-radius:8px;color:#fff;font-size:.9em;text-align:center">ğŸ“Š Aktif: TÃ¼m Kanallar</div></div><div id="channelLoadingSpinner" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:9999;justify-content:center;align-items:center"><div style="text-align:center"><div style="width:80px;height:80px;border:8px solid rgba(255,255,255,.2);border-top:8px solid #667eea;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 20px"></div><div style="color:#fff;font-size:1.3em;font-weight:700" id="channelLoadingText">ğŸ”„ Filtreleniyor...</div><div style="color:rgba(255,255,255,.7);font-size:.9em;margin-top:10px">LÃ¼tfen bekleyin</div></div></div><style>@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}</style><div class="info-box"><div class="info-card"><h3>ğŸ“Š Veri Durumu</h3><p id="dataStatus">Yukleniyor...</p></div><div class="info-card"><h3>Son Guncelleme</h3><p id="lastUpdate">-</p></div><div class="info-card"><h3>Toplam Kayit</h3><p id="totalRecords">-</p></div><div class="info-card"><h3>Toplam USD (KDV HariÃ§)</h3><p id="totalUSD">-</p></div><div class="info-card"><h3>ğŸ“… GÃ¼nlÃ¼k Ortalama</h3><p id="dailyAverage">-</p></div><div class="info-card"><h3>ğŸ›’ Sepet OrtalamasÄ±</h3><p id="basketAverage">-</p></div></div><div class="tabs"><button class="tab active" onclick='switchTab("dashboard")'>ğŸ  Dashboard</button> <button class="tab" onclick='switchTab("targets")'>ğŸ¯ Hedef Takip</button> <button class="tab" onclick='switchTab("customers")'>ğŸ‘¥ MÃ¼ÅŸteri Analizi</button> <button class="tab" onclick='switchTab("salesperson")'>ğŸ‘¨â€ğŸ’¼ SatÄ±ÅŸ Temsilcisi</button> <button class="tab" onclick='switchTab("store")'>ğŸª MaÄŸaza Analizi</button> <button class="tab" onclick='switchTab("city")'>ğŸŒ Åehir Analizi</button> <button class="tab" onclick='switchTab("stock")'>ğŸ“¦ Stok DaÄŸÄ±lÄ±m</button> <button class="tab" onclick='switchTab("time")'>â° Zaman Analizi</button> <button class="tab" onclick='switchTab("product")'>ğŸ¸ ÃœrÃ¼n, Marka ve Kategori Analizi</button></div><div id="dashboardTab" class="tab-content active"><div class="content"><h2 style="margin-bottom:30px;text-align:center">ğŸ  Zuhal MÃ¼zik - Genel Dashboard</h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-bottom:40px"><div class="summary-card" style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:20px"><h3 style="font-size:.95em;margin-bottom:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">ğŸ’° Toplam SatÄ±ÅŸ</h3><p id="dashTotalSales" style="color:#fff;font-size:1.6em;font-weight:700;margin:10px 0;word-break:break-all">$0</p><small style="opacity:.9;font-size:.85em">KDV HariÃ§ - TÃ¼m zamanlar</small></div><div class="summary-card" style="background:linear-gradient(135deg,#f093fb 0,#f5576c 100%);color:#fff;padding:20px"><h3 style="font-size:.95em;margin-bottom:10px">ğŸ“¦ Toplam ÃœrÃ¼n</h3><p id="dashTotalQty" style="color:#fff;font-size:1.6em;font-weight:700;margin:10px 0">0</p><small style="opacity:.9;font-size:.85em">SatÄ±lan Ã¼rÃ¼n adedi</small></div><div class="summary-card" style="background:linear-gradient(135deg,#4facfe 0,#00f2fe 100%);color:#fff;padding:20px"><h3 style="font-size:.95em;margin-bottom:10px">ğŸ‘¥ MÃ¼ÅŸteri</h3><p id="dashTotalCustomers" style="color:#fff;font-size:1.6em;font-weight:700;margin:10px 0">0</p><small style="opacity:.9;font-size:.85em">Aktif mÃ¼ÅŸteri sayÄ±sÄ±</small></div><div class="summary-card" style="background:linear-gradient(135deg,#43e97b 0,#38f9d7 100%);color:#fff;padding:20px"><h3 style="font-size:.95em;margin-bottom:10px">ğŸ¸ FarklÄ± ÃœrÃ¼n</h3><p id="dashTotalProducts" style="color:#fff;font-size:1.6em;font-weight:700;margin:10px 0">0</p><small style="opacity:.9;font-size:.85em">ÃœrÃ¼n Ã§eÅŸidi</small></div><div class="summary-card" style="background:linear-gradient(135deg,#fa709a 0,#fee140 100%);color:#fff;padding:20px"><h3 style="font-size:.95em;margin-bottom:10px">ğŸª MaÄŸaza</h3><p id="dashTotalStores" style="color:#fff;font-size:1.6em;font-weight:700;margin:10px 0">0</p><small style="opacity:.9;font-size:.85em">Aktif maÄŸaza sayÄ±sÄ±</small></div><div class="summary-card" style="background:linear-gradient(135deg,#30cfd0 0,#330867 100%);color:#fff;padding:20px"><h3 style="font-size:.95em;margin-bottom:10px">ğŸ‘¨â€ğŸ’¼ Temsilci</h3><p id="dashTotalSalespeople" style="color:#fff;font-size:1.6em;font-weight:700;margin:10px 0">0</p><small style="opacity:.9;font-size:.85em">Aktif temsilci sayÄ±sÄ±</small></div><div class="summary-card" style="background:linear-gradient(135deg,#ffa751 0,#ffe259 100%);color:#fff;padding:20px"><h3 style="font-size:.95em;margin-bottom:10px">ğŸ“… GÃ¼nlÃ¼k Ortalama</h3><p id="dashDailyAverage" style="color:#fff;font-size:1.6em;font-weight:700;margin:10px 0">$0</p><small style="opacity:.9;font-size:.85em">GÃ¼nlÃ¼k ortalama satÄ±ÅŸ</small></div><div class="summary-card" style="background:linear-gradient(135deg,#a8edea 0,#fed6e3 100%);color:#fff;padding:20px"><h3 style="font-size:.95em;margin-bottom:10px">ğŸ›’ Sepet OrtalamasÄ±</h3><p id="dashBasketAverage" style="color:#fff;font-size:1.6em;font-weight:700;margin:10px 0">$0</p><small style="opacity:.9;font-size:.85em">Ortalama iÅŸlem tutarÄ±</small></div></div><div style="background:#fff;padding:30px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);margin-bottom:40px"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px"><h3 style="margin:0">ğŸ“Š YÄ±llÄ±k SatÄ±ÅŸ KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3><div style="display:flex;gap:10px"><button id="dashYearlyMetricSales" onclick='changeDashYearlyMetric("sales")' style="padding:8px 20px;border:2px solid #667eea;background:#667eea;color:#fff;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s">ğŸ’° SatÄ±ÅŸ (USD)</button> <button id="dashYearlyMetricQty" onclick='changeDashYearlyMetric("qty")' style="padding:8px 20px;border:2px solid #667eea;background:#fff;color:#667eea;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s">ğŸ“¦ Miktar</button></div></div><canvas id="dashYearlyChart" style="max-height:400px"></canvas></div><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:30px;margin-bottom:40px"><div style="background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);height:580px"><h3 style="margin-bottom:20px">ğŸ† Top 10 MaÄŸaza (TÃ¼m Zamanlar)</h3><canvas id="dashTopStoresChart" style="height:500px;max-height:500px"></canvas></div><div style="background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);height:580px"><h3 style="margin-bottom:20px">â­ Top 10 SatÄ±ÅŸ Temsilcisi (TÃ¼m Zamanlar)</h3><canvas id="dashTopSalespeopleChart" style="height:500px;max-height:500px"></canvas></div><div style="background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);height:580px"><h3 style="margin-bottom:20px">ğŸ·ï¸ Top 10 Marka (TÃ¼m Zamanlar)</h3><canvas id="dashTopBrandsChart" style="height:500px;max-height:500px"></canvas></div><div style="background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);height:580px"><h3 style="margin-bottom:20px">ğŸ“‚ Top 10 Kategori (TÃ¼m Zamanlar)</h3><canvas id="dashTopCategoriesChart" style="height:500px;max-height:500px"></canvas></div><div style="background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);height:580px"><h3 style="margin-bottom:20px">ğŸŒ Top 10 Åehir (TÃ¼m Zamanlar)</h3><canvas id="dashTopCitiesChart" style="height:500px;max-height:500px"></canvas></div><div style="background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);height:580px"><h3 style="margin-bottom:20px">ğŸ¸ Top 10 ÃœrÃ¼n (TÃ¼m Zamanlar)</h3><canvas id="dashTopProductsChart" style="height:500px;max-height:500px"></canvas></div></div><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);padding:30px;border-radius:15px;margin-bottom:40px"><h3 style="color:#fff;margin-bottom:20px">ğŸ¤– AI Dashboard Analizi</h3><div id="dashAIAnalysis" style="background:#fff;padding:20px;border-radius:10px;line-height:1.8"></div></div></div></div><div id="targetsTab" class="tab-content"><div class="content"><h2 style="margin-bottom:30px">ğŸ¯ Hedef Takip Sistemi</h2><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);padding:30px;border-radius:15px;margin-bottom:30px"><h3 style="color:#fff;margin:0 0 20px 0">ğŸ“… DÃ¶nem SeÃ§in</h3><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;max-width:600px"><div><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">YÄ±l</label> <select id="targetFilterYear" class="target-input" onchange="loadAllStoresTargets()" style="width:100%"><option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option></select></div><div><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">Ay (Opsiyonel)</label> <select id="targetFilterMonth" class="target-input" onchange="loadAllStoresTargets()" style="width:100%"><option value="">TÃ¼m YÄ±l</option><option value="01">Ocak</option><option value="02">Åubat</option><option value="03">Mart</option><option value="04">Nisan</option><option value="05">MayÄ±s</option><option value="06">Haziran</option><option value="07">Temmuz</option><option value="08">AÄŸustos</option><option value="09">EylÃ¼l</option><option value="10">Ekim</option><option value="11">KasÄ±m</option><option value="12">AralÄ±k</option></select></div></div><p style="color:#fff;opacity:.9;margin-top:15px;font-size:.95em">ğŸ’¡ Ä°pucu: Sadece yÄ±l seÃ§erseniz yÄ±llÄ±k hedefler, yÄ±l + ay seÃ§erseniz aylÄ±k hedefler gÃ¶sterilir</p></div><div id="allStoresTargetsContainer"></div></div></div><div id="customersTab" class="tab-content"><div class="content"><h2 style="margin-bottom:20px">ğŸ‘¥ MÃ¼ÅŸteri Analizi</h2><div class="summary-cards"><div class="summary-card"><h3>Toplam MÃ¼ÅŸteri</h3><p id="totalCustomers">0</p></div><div class="summary-card"><h3>Aktif MÃ¼ÅŸteri (Son 90 GÃ¼n)</h3><p id="activeCustomers">0</p></div><div class="summary-card"><h3>Ortalama SipariÅŸ</h3><p id="avgOrderValue">$0</p></div><div class="summary-card"><h3>En YÃ¼ksek SipariÅŸ</h3><p id="maxOrderValue">$0</p></div></div><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);padding:30px;border-radius:15px;margin:30px 0"><h3 style="color:#fff;margin:0 0 20px 0">ğŸ” MÃ¼ÅŸteri Arama</h3><div style="display:flex;gap:10px;max-width:600px"><div style="position:relative;flex:1"><input type="text" id="customerSearchInputMain" placeholder="MÃ¼ÅŸteri adÄ± yazÄ±n... (Ã¶rn: Ahmet YÄ±lmaz)" style="width:100%;padding:15px 60px 15px 15px;font-size:1em;border:2px solid #fff;border-radius:10px;outline:0" onkeyup='"Enter"===event.key&&searchCustomerProfileMain()'> <button onclick="searchCustomerProfileMain()" style="position:absolute;right:5px;top:50%;transform:translateY(-50%);background:#fff;color:#667eea;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:700">ğŸ” Ara</button></div><button onclick="clearCustomerSearchMain()" style="background:rgba(255,255,255,.2);border:2px solid #fff;color:#fff;padding:15px 20px;border-radius:10px;cursor:pointer;font-weight:700;transition:all .3s" onmouseover='this.style.background="rgba(255,255,255,0.3)"' onmouseout='this.style.background="rgba(255,255,255,0.2)"'>ğŸ—‘ï¸ Temizle</button></div><p style="color:#fff;opacity:.9;margin-top:10px;font-size:.9em">ğŸ’¡ MÃ¼ÅŸteri adÄ±nÄ±n bir kÄ±smÄ±nÄ± yazmak yeterli</p></div><div id="customerProfileMainContainer" style="display:none;margin-bottom:40px"><div style="background:linear-gradient(135deg,#38ef7d 0,#11998e 100%);color:#fff;padding:30px;border-radius:15px;margin-bottom:30px"><h3 style="margin:0 0 15px 0;font-size:1.8em">ğŸ‘¤ <span id="customerNameMain">-</span></h3><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px"><div><div style="opacity:.8;font-size:.85em">ğŸŒ Åehir</div><div style="font-size:1.1em;font-weight:700" id="customerCityMain">-</div></div><div><div style="opacity:.8;font-size:.85em">ğŸ·ï¸ Etiketler</div><div style="font-size:.95em;font-weight:700" id="customerTagsMain">-</div></div><div><div style="opacity:.8;font-size:.85em">ğŸ’° Toplam AlÄ±ÅŸveriÅŸ</div><div style="font-size:1.3em;font-weight:700" id="customerTotalSalesMain">$0</div></div><div><div style="opacity:.8;font-size:.85em">ğŸ“¦ Toplam Adet</div><div style="font-size:1.3em;font-weight:700" id="customerTotalQtyMain">0</div></div><div><div style="opacity:.8;font-size:.85em">ğŸ›’ Ä°ÅŸlem SayÄ±sÄ±</div><div style="font-size:1.3em;font-weight:700" id="customerTransactionCountMain">0</div></div><div><div style="opacity:.8;font-size:.85em">ğŸ“Š Ortalama Sepet</div><div style="font-size:1.3em;font-weight:700" id="customerAvgBasketMain">$0</div></div></div></div><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px;margin-bottom:30px"><div class="chart-container"><h3 style="text-align:center;margin-bottom:15px">ğŸ·ï¸ En Ã‡ok Tercih EttiÄŸi Markalar</h3><canvas id="customerBrandChartMain"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:15px">ğŸ“‚ En Ã‡ok AldÄ±ÄŸÄ± Kategoriler</h3><canvas id="customerCategoryChartMain"></canvas></div></div><div style="margin-top:30px"><h3 style="margin-bottom:15px">ğŸ›ï¸ Son AlÄ±ÅŸveriÅŸler (Son 20)</h3><div id="customerPurchaseHistoryMain" style="overflow-x:auto"></div></div><div id="customerAIAnalysisPanelMain" style="margin:40px 0;display:none"><h3 style="margin-bottom:20px">ğŸ¤– AI MÃ¼ÅŸteri Analizi, Yorum ve Ã–neriler</h3><div id="customerAIAnalysisContentMain"></div></div></div><div id="topCustomersSection"><h3 style="margin:30px 0 20px 0">ğŸ† Top 30 MÃ¼ÅŸteri</h3><div class="customer-grid" id="topCustomersGrid"></div></div><div id="customerChartsSection" style="margin-top:30px"><div class="chart-container" style="margin-bottom:30px"><h3 style="text-align:center;margin-bottom:20px">ğŸ“Š YÄ±llÄ±k MÃ¼ÅŸteri Trendi</h3><canvas id="customerTrendChart" style="max-height:400px"></canvas></div><div class="chart-container" style="max-width:600px;margin:0 auto"><h3 style="text-align:center;margin-bottom:20px">ğŸŒ MÃ¼ÅŸteri DaÄŸÄ±lÄ±mÄ± (Åehir)</h3><canvas id="customerCityChart"></canvas></div></div></div></div><div id="timeTab" class="tab-content"><div class="content"><h2 style="margin-bottom:20px">â° Zaman Analizi</h2><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);padding:20px;border-radius:15px;margin-bottom:30px"><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px"><div><label style="display:block;margin-bottom:8px;color:#fff;font-weight:600">ğŸ“ Kategori</label> <select id="timeCategory1Filter" onchange="analyzeTime()" style="width:100%;padding:10px;border:none;border-radius:8px;font-size:1em"><option value="">TÃ¼m Kategoriler</option></select></div><div style="display:flex;align-items:end"><button onclick="clearTimeFilters()" style="width:100%;padding:10px 20px;background:rgba(255,255,255,.2);color:#fff;border:2px solid #fff;border-radius:8px;cursor:pointer;font-weight:700;font-size:1em">ğŸ”„ Temizle</button></div></div></div><div class="summary-cards"><div class="summary-card"><h3>En YoÄŸun Saat</h3><p id="peakHour">-</p></div><div class="summary-card"><h3>En YoÄŸun GÃ¼n</h3><p id="peakDay">-</p></div><div class="summary-card"><h3>Mesai Saati SatÄ±ÅŸ</h3><p id="workHoursSales">-</p></div><div class="summary-card"><h3>Hafta Sonu SatÄ±ÅŸ</h3><p id="weekendSales">-</p></div></div><div id="timeInsightsPanel" style="display:none"></div><div class="chart-container" style="margin:30px 0"><h3 style="text-align:center;margin-bottom:20px">ğŸ“Š Saatlik YoÄŸunluk (24 Saat)</h3><canvas id="hourlyChart"></canvas></div><div class="chart-container" style="margin:30px 0"><h3 style="text-align:center;margin-bottom:20px">ğŸ“… AylÄ±k Trend</h3><canvas id="monthlyTrendChart"></canvas></div><div class="chart-container" style="margin:30px 0"><h3 style="text-align:center;margin-bottom:20px">ğŸ“Š YÄ±llÄ±k Trend</h3><canvas id="yearlyTrendChart"></canvas></div><div style="margin:30px 0"><h3 style="text-align:center;margin-bottom:20px">ğŸª MaÄŸaza BazÄ±nda Saat KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3><div style="margin-bottom:20px;text-align:center"><label>MaÄŸaza SeÃ§:</label> <select id="storeTimeFilter" onchange="renderStoreTimeChart()" style="padding:8px;border-radius:5px;border:1px solid #ddd"><option value="">TÃ¼m MaÄŸazalar</option></select></div><div class="chart-container"><canvas id="storeTimeChart"></canvas></div></div><div style="margin:30px 0"><h3 style="text-align:center;margin-bottom:20px">ğŸ“¦ Kategori BazÄ±nda Saat Analizi</h3><div style="margin-bottom:20px;text-align:center"><label>Kategori SeÃ§:</label> <select id="categoryTimeFilter" onchange="renderCategoryTimeChart()" style="padding:8px;border-radius:5px;border:1px solid #ddd"><option value="">TÃ¼m Kategoriler</option></select></div><div class="chart-container"><canvas id="categoryTimeChart"></canvas></div></div><div style="margin:30px 0"><h3 style="text-align:center;margin-bottom:20px">ğŸ‘¤ SatÄ±ÅŸ Temsilcisi BazÄ±nda Saat Analizi</h3><div style="margin-bottom:20px;text-align:center"><label>Temsilci SeÃ§:</label> <select id="salesPersonTimeFilter" onchange="renderSalesPersonTimeChart()" style="padding:8px;border-radius:5px;border:1px solid #ddd"><option value="">TÃ¼m Temsilciler</option></select></div><div class="chart-container"><canvas id="salesPersonTimeChart"></canvas></div></div></div></div><div id="productTab" class="tab-content"><div class="content"><h2 style="margin-bottom:20px">ğŸ¸ ÃœrÃ¼n, Marka ve Kategori Analizi</h2><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);padding:30px;border-radius:15px;margin-bottom:30px"><h3 style="color:#fff;margin-bottom:20px;text-align:center">ğŸ” ÃœrÃ¼n, Marka veya Kategori Ara</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;max-width:1000px;margin:0 auto 20px"><div style="grid-column:1/-1"><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">ğŸ” ÃœrÃ¼n/Marka Ara</label><div style="display:flex;gap:10px"><input type="text" id="productSearchInput" placeholder="Ã–rnek: KDP120R, Roland, Fender..." style="flex:1;padding:12px;border:none;border-radius:8px;font-size:1em" onkeypress='"Enter"===event.key&&searchProduct()'> <button onclick="searchProduct()" style="padding:12px 30px;background:#38ef7d;color:#fff;border:none;border-radius:8px;font-size:1em;font-weight:700;cursor:pointer">ğŸ” Ara</button></div></div><div style="position:relative"><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">ğŸ“ Kategori Ara</label> <input type="text" id="productCategorySearch" placeholder="Kategori adÄ± yazÄ±n..." style="width:100%;padding:12px;border:none;border-radius:8px;font-size:1em" oninput="filterProductCategories()" onfocus="showProductCategoryDropdown()" onblur="setTimeout(()=>hideProductCategoryDropdown(),200)"><div id="productCategoryDropdown" style="display:none;position:absolute;top:100%;left:0;right:0;background:#fff;border-radius:8px;max-height:300px;overflow-y:auto;box-shadow:0 4px 12px rgba(0,0,0,.2);z-index:1000;margin-top:5px"></div></div><div style="margin-bottom:15px"><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">ğŸª MaÄŸaza (Opsiyonel)</label> <select id="productStoreFilter" style="width:100%;padding:12px;border:none;border-radius:8px;font-size:1em"><option value="">TÃ¼m MaÄŸazalar</option></select></div><div style="display:flex;gap:10px;align-items:end"><div style="flex:1"><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">ğŸ“… BaÅŸlangÄ±Ã§ Tarihi</label> <input type="date" id="productDateStart" style="width:100%;padding:12px;border:none;border-radius:8px;font-size:1em"></div><div style="flex:1"><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">ğŸ“… BitiÅŸ Tarihi</label> <input type="date" id="productDateEnd" style="width:100%;padding:12px;border:none;border-radius:8px;font-size:1em"></div><div><button onclick="clearProductDateFilters()" style="padding:12px 20px;background:rgba(255,255,255,.2);color:#fff;border:2px solid #fff;border-radius:8px;cursor:pointer;font-size:1em;white-space:nowrap">ğŸ”„ Temizle</button></div></div></div><p style="text-align:center;margin-top:15px;color:#fff;font-size:.95em;opacity:.9">ğŸ’¡ <strong>Ä°pucu:</strong> Tarih aralÄ±ÄŸÄ± seÃ§mek zorunlu deÄŸil, istenirse tÃ¼m dÃ¶nem veya belirli tarih aralÄ±ÄŸÄ± iÃ§in analiz yapabilirsiniz</p></div><div id="productResultsContainer" style="display:none"><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px"><div class="summary-card"><h3>Toplam SatÄ±ÅŸ (KDV HariÃ§)</h3><p id="productTotalSales">$0</p></div><div class="summary-card"><h3>Toplam Adet</h3><p id="productTotalQty">0</p></div><div class="summary-card"><h3>FarklÄ± ÃœrÃ¼n</h3><p id="productUniqueCount">0</p></div><div class="summary-card"><h3>Sepet OrtalamasÄ±</h3><p id="productAvgPrice">$0</p></div></div><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));gap:30px"><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸª En Ã‡ok Satan MaÄŸazalar</h3><canvas id="productStoreChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸŒ En Ã‡ok SatÄ±lan Ä°ller</h3><canvas id="productCityChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ‘¤ En Ã‡ok Satan Temsilciler</h3><canvas id="productSalesPersonChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ“ˆ AylÄ±k SatÄ±ÅŸ Trendi</h3><canvas id="productMonthlyChart"></canvas></div></div><div id="productAIAnalysisPanel" style="margin:40px 0;display:none"><h3 style="margin-bottom:20px">ğŸ¤– AI Analiz, Yorum ve Ã–neriler</h3><div id="productAIAnalysisContent"></div></div><div style="margin-top:40px"><h3 style="margin-bottom:20px">ğŸ“‹ DetaylÄ± ÃœrÃ¼n Listesi</h3><div id="productDetailTable" style="overflow-x:auto"></div></div></div><div id="productNoResults" style="display:none;text-align:center;padding:60px;background:#f8f9fa;border-radius:15px"><div style="font-size:4em;margin-bottom:20px">ğŸ”</div><h3 style="color:#6c757d;margin-bottom:10px">SonuÃ§ BulunamadÄ±</h3><p style="color:#adb5bd">LÃ¼tfen farklÄ± bir Ã¼rÃ¼n veya marka adÄ± deneyin</p></div></div></div><div id="customerSearchTab" class="tab-content"><div class="content"><h2 style="margin-bottom:30px">ğŸ” MÃ¼ÅŸteri Arama ve Analizi</h2><div style="max-width:800px;margin:0 auto 40px"><div style="position:relative"><input type="text" id="customerSearchInput" placeholder="MÃ¼ÅŸteri adÄ± yazÄ±n veya virgÃ¼lle ayÄ±rarak Ã§oklu arama yapÄ±n..." style="width:100%;padding:20px 60px 20px 20px;font-size:1.1em;border:2px solid #667eea;border-radius:15px;outline:0" oninput="showCustomerSuggestions(this.value)" onkeydown="handleCustomerKeydown(event)" onfocus="showCustomerSuggestions(this.value)"> <button onclick="searchCustomerProfile()" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;border:none;padding:12px 25px;border-radius:10px;cursor:pointer;font-size:1em">ğŸ” Ara</button><div id="customerSuggestions" style="position:absolute;top:100%;left:0;right:0;background:#fff;border:2px solid #667eea;border-top:none;border-radius:0 0 15px 15px;max-height:300px;overflow-y:auto;display:none;z-index:1000;box-shadow:0 4px 6px rgba(0,0,0,.1)"></div></div><div id="selectedCustomersContainer" style="display:none;margin-top:15px"><div style="background:#f8f9fa;padding:15px;border-radius:10px;border:2px dashed #667eea"><div style="font-weight:600;color:#667eea;margin-bottom:10px">âœ… SeÃ§ili MÃ¼ÅŸteriler (En fazla 3):</div><div id="selectedCustomersTags" style="display:flex;flex-wrap:wrap;gap:10px"></div></div></div><p style="text-align:center;color:#6c757d;margin-top:10px;font-size:.9em">ğŸ’¡ Ä°pucu: Listeden tÄ±klayarak veya virgÃ¼l ile ayÄ±rarak birden fazla mÃ¼ÅŸteri seÃ§ebilir, karÅŸÄ±laÅŸtÄ±rabilirsiniz</p></div><div id="customerProfileContainer" style="display:none"><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:40px;border-radius:20px;margin-bottom:30px"><h2 style="margin:0 0 20px 0;font-size:2em">ğŸ‘¤ <span id="customerName">-</span></h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px"><div><div style="opacity:.8;font-size:.9em">ğŸŒ Åehir</div><div style="font-size:1.3em;font-weight:700" id="customerCity">-</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ·ï¸ Etiketler</div><div style="font-size:1.1em;font-weight:700" id="customerTags">-</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ’° Toplam AlÄ±ÅŸveriÅŸ</div><div style="font-size:1.5em;font-weight:700" id="customerTotalSales">$0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ“¦ Toplam Adet</div><div style="font-size:1.5em;font-weight:700" id="customerTotalQty">0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ›’ Ä°ÅŸlem SayÄ±sÄ±</div><div style="font-size:1.5em;font-weight:700" id="customerTransactionCount">0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ“Š Ortalama Sepet</div><div style="font-size:1.5em;font-weight:700" id="customerAvgBasket">$0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ“… Ä°lk AlÄ±ÅŸveriÅŸ</div><div style="font-size:1.1em;font-weight:700" id="customerFirstPurchase">-</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ“… Son AlÄ±ÅŸveriÅŸ</div><div style="font-size:1.1em;font-weight:700" id="customerLastPurchase">-</div></div></div></div><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));gap:30px;margin-bottom:30px"><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ·ï¸ En Ã‡ok Tercih EttiÄŸi Markalar</h3><canvas id="customerBrandChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ“‚ En Ã‡ok AldÄ±ÄŸÄ± Kategoriler</h3><canvas id="customerCategoryChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸª AlÄ±ÅŸveriÅŸ YaptÄ±ÄŸÄ± MaÄŸazalar</h3><canvas id="customerStoreChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ“ˆ AylÄ±k AlÄ±ÅŸveriÅŸ Trendi</h3><canvas id="customerMonthlyTrendChart"></canvas></div></div><div id="customerAIAnalysisPanel" style="margin:40px 0"><h3 style="margin-bottom:20px">ğŸ¤– AI MÃ¼ÅŸteri Analizi ve Ã–neriler</h3><div id="customerAIAnalysisContent"></div></div><div style="margin-top:40px"><h3 style="margin-bottom:20px">ğŸ›ï¸ SatÄ±n Alma GeÃ§miÅŸi</h3><div id="customerPurchaseHistory" style="overflow-x:auto"></div></div></div><div id="customerSearchNoResults" style="display:none;text-align:center;padding:60px;background:#f8f9fa;border-radius:15px"><div style="font-size:4em;margin-bottom:20px">ğŸ”</div><h3 style="color:#6c757d;margin-bottom:10px">MÃ¼ÅŸteri BulunamadÄ±</h3><p style="color:#adb5bd">LÃ¼tfen farklÄ± bir mÃ¼ÅŸteri adÄ± deneyin</p></div></div></div><div id="salespersonTab" class="tab-content"><div class="content"><h2 style="margin-bottom:30px">ğŸ‘¨â€ğŸ’¼ SatÄ±ÅŸ Temsilcisi Performans Analizi</h2><div class="filters-section" style="margin-bottom:30px"><div class="filters-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px"><div class="filter-group"><label>YÄ±l <span class="selected-count" id="countSalespersonYear"></span></label><div class="filter-search-box"><input type="text" class="filter-search-input" placeholder="ğŸ” Ara..." oninput='filterCheckboxes("filterSalespersonYear",this.value)'></div><div class="checkbox-container" id="filterSalespersonYear"></div></div><div class="filter-group"><label>Ay <span class="selected-count" id="countSalespersonMonth"></span></label><div class="filter-search-box"><input type="text" class="filter-search-input" placeholder="ğŸ” Ara..." oninput='filterCheckboxes("filterSalespersonMonth",this.value)'></div><div class="checkbox-container" id="filterSalespersonMonth"></div></div><div class="filter-group"><label>GÃ¼n <span class="selected-count" id="countSalespersonDay"></span></label><div class="filter-search-box"><input type="text" class="filter-search-input" placeholder="ğŸ” Ara..." oninput='filterCheckboxes("filterSalespersonDay",this.value)'></div><div class="checkbox-container" id="filterSalespersonDay"></div></div></div><div style="text-align:center;margin-top:20px"><button onclick="clearSalespersonFilters()" style="background:#6c757d;color:#fff;border:none;padding:12px 30px;border-radius:10px;cursor:pointer;font-weight:600;transition:all .3s">ğŸ”„ Filtreleri Temizle</button></div></div><div style="max-width:800px;margin:0 auto 40px"><div id="selectedSalespersonsContainer" style="display:none;margin-bottom:15px;padding:15px;background:#f8f9fa;border-radius:10px"><div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap"><span style="font-weight:600;color:#667eea">SeÃ§ili Temsilciler:</span><div id="selectedSalespersonsTags" style="display:flex;gap:8px;flex-wrap:wrap"></div></div></div><div style="position:relative"><input type="text" id="salespersonSearchInput" placeholder="SatÄ±ÅŸ temsilcisi adÄ± yazÄ±n... (Ã¶rn: Mustafa KÄ±lÄ±Ã§, Kaan Poyraz)" style="width:100%;padding:20px 60px 20px 20px;font-size:1.1em;border:2px solid #667eea;border-radius:15px;outline:0" oninput="showSalespersonSuggestions(this.value)" onkeydown="handleSalespersonKeydown(event)" onfocus="showSalespersonSuggestions(this.value)"> <button onclick="searchSalespersonProfile()" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;border:none;padding:12px 25px;border-radius:10px;cursor:pointer;font-size:1em">ğŸ” Ara</button><div id="salespersonSuggestions" style="position:absolute;top:100%;left:0;right:0;background:#fff;border:2px solid #667eea;border-top:none;border-radius:0 0 15px 15px;max-height:300px;overflow-y:auto;display:none;z-index:1000;box-shadow:0 4px 6px rgba(0,0,0,.1)"></div></div><p style="text-align:center;color:#6c757d;margin-top:10px;font-size:.9em">ğŸ’¡ Ä°pucu: Birden fazla temsilci seÃ§erek karÅŸÄ±laÅŸtÄ±rmalÄ± analiz yapabilirsiniz! (En fazla 3 temsilci)</p></div><div id="salespersonProfileContainer" style="display:none"><div id="singleSalespersonView" style="display:none"><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:40px;border-radius:20px;margin-bottom:30px"><h2 style="margin:0 0 20px 0;font-size:2em">ğŸ‘¨â€ğŸ’¼ <span id="salespersonName">-</span></h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px"><div><div style="opacity:.8;font-size:.9em">ğŸ’° Toplam SatÄ±ÅŸ (KDV HariÃ§)</div><div style="font-size:1.5em;font-weight:700" id="salespersonTotalSales">$0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ“¦ Toplam Adet</div><div style="font-size:1.5em;font-weight:700" id="salespersonTotalQty">0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ›’ Fatura SayÄ±sÄ±</div><div style="font-size:1.5em;font-weight:700" id="salespersonInvoiceCount">0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ“Š GÃ¼nlÃ¼k Ort. SatÄ±ÅŸ</div><div style="font-size:1.5em;font-weight:700" id="salespersonAvgTransaction">$0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ›’ Sepet OrtalamasÄ±</div><div style="font-size:1.5em;font-weight:700" id="salespersonAvgBasket">$0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ‘¥ FarklÄ± MÃ¼ÅŸteri</div><div style="font-size:1.5em;font-weight:700" id="salespersonUniqueCustomers">0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ¯ FarklÄ± ÃœrÃ¼n</div><div style="font-size:1.5em;font-weight:700" id="salespersonUniqueProducts">0</div></div></div></div></div><div id="multipleSalespersonsView" style="display:none"><h2 style="margin:0 0 30px 0;font-size:2em;text-align:center">ğŸ“Š SatÄ±ÅŸ Temsilcileri KarÅŸÄ±laÅŸtÄ±rmalÄ± Analiz</h2><div style="overflow-x:auto;margin-bottom:40px"><div id="salespersonComparisonTable"></div></div><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));gap:30px;margin-bottom:30px"><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ’° Toplam SatÄ±ÅŸ KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3><canvas id="comparisonSalesChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ“¦ ÃœrÃ¼n Adet KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3><canvas id="comparisonQtyChart"></canvas></div></div></div><div id="salespersonBrandCategorySection" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));gap:30px;margin-bottom:30px"><div class="chart-container"><h3 id="salespersonBrandChartTitle" style="text-align:center;margin-bottom:20px">ğŸ·ï¸ En Ã‡ok SattÄ±ÄŸÄ± Markalar (Top 10)</h3><canvas id="salespersonBrandChart"></canvas></div><div class="chart-container"><h3 id="salespersonCategoryChartTitle" style="text-align:center;margin-bottom:20px">ğŸ“‚ En Ã‡ok SattÄ±ÄŸÄ± Kategoriler</h3><canvas id="salespersonCategoryChart"></canvas></div></div><div id="salespersonMonthlySection" style="margin-bottom:40px"><div class="chart-container" style="height:400px"><h3 style="text-align:center;margin-bottom:20px">ğŸ“ˆ AylÄ±k Performans Trendi (YÄ±l KarÅŸÄ±laÅŸtÄ±rmalÄ±)</h3><canvas id="salespersonMonthlyChart"></canvas></div></div><div id="salespersonTopProductsSection" style="margin-bottom:40px"><h3 style="margin-bottom:20px">ğŸ¯ En Ã‡ok SattÄ±ÄŸÄ± ÃœrÃ¼nler (Top 20)</h3><div id="salespersonTopProductsTable" style="overflow-x:auto"></div></div><div id="salespersonBottomProductsSection" style="margin-bottom:40px"><h3 style="margin-bottom:20px">âš ï¸ En Az SattÄ±ÄŸÄ± ÃœrÃ¼nler (Bottom 10)</h3><div id="salespersonBottomProductsTable" style="overflow-x:auto"></div></div><div id="salespersonAIAnalysisPanel" style="margin:40px 0"><h3 style="margin-bottom:20px">ğŸ¤– AI Performans Analizi ve Ã–neriler</h3><div id="salespersonAIAnalysisContent"></div></div></div><div id="salespersonSearchNoResults" style="display:none;text-align:center;padding:60px;background:#f8f9fa;border-radius:15px"><div style="font-size:4em;margin-bottom:20px">ğŸ”</div><h3 style="color:#6c757d;margin-bottom:10px">SatÄ±ÅŸ Temsilcisi BulunamadÄ±</h3><p style="color:#adb5bd">LÃ¼tfen farklÄ± bir isim deneyin</p></div></div></div><div id="storeTab" class="tab-content"><div class="content"><h2 style="margin-bottom:30px">ğŸª MaÄŸaza Performans Analizi</h2><div class="filters-section" style="margin-bottom:30px"><div class="filters-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px"><div class="filter-group"><label>YÄ±l <span class="selected-count" id="countStoreYear"></span></label><div class="filter-search-box"><input type="text" class="filter-search-input" placeholder="ğŸ” Ara..." oninput='filterCheckboxes("filterStoreYear",this.value)'></div><div class="checkbox-container" id="filterStoreYear"></div></div><div class="filter-group"><label>Ay <span class="selected-count" id="countStoreMonth"></span></label><div class="filter-search-box"><input type="text" class="filter-search-input" placeholder="ğŸ” Ara..." oninput='filterCheckboxes("filterStoreMonth",this.value)'></div><div class="checkbox-container" id="filterStoreMonth"></div></div><div class="filter-group"><label>GÃ¼n <span class="selected-count" id="countStoreDay"></span></label><div class="filter-search-box"><input type="text" class="filter-search-input" placeholder="ğŸ” Ara..." oninput='filterCheckboxes("filterStoreDay",this.value)'></div><div class="checkbox-container" id="filterStoreDay"></div></div></div><div style="text-align:center;margin-top:20px"><button onclick="clearStoreFilters()" style="background:#6c757d;color:#fff;border:none;padding:12px 30px;border-radius:10px;cursor:pointer;font-weight:600;transition:all .3s">ğŸ”„ Filtreleri Temizle</button></div></div><div style="max-width:800px;margin:0 auto 40px"><div id="selectedStoresContainer" style="display:none;margin-bottom:15px;padding:15px;background:#f8f9fa;border-radius:10px"><div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap"><span style="font-weight:600;color:#667eea">SeÃ§ili MaÄŸazalar:</span><div id="selectedStoresTags" style="display:flex;gap:8px;flex-wrap:wrap"></div></div></div><div style="position:relative"><input type="text" id="storeSearchInput" placeholder="MaÄŸaza adÄ± yazÄ±n... (Ã¶rn: Toptan, Akasya)" style="width:100%;padding:20px 60px 20px 20px;font-size:1.1em;border:2px solid #667eea;border-radius:15px;outline:0" oninput="showStoreSuggestions(this.value)" onkeydown="handleStoreKeydown(event)" onfocus="showStoreSuggestions(this.value)"> <button onclick="searchStoreProfile()" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;border:none;padding:12px 25px;border-radius:10px;cursor:pointer;font-size:1em">ğŸ” Ara</button><div id="storeSuggestions" style="position:absolute;top:100%;left:0;right:0;background:#fff;border:2px solid #667eea;border-top:none;border-radius:0 0 15px 15px;max-height:300px;overflow-y:auto;display:none;z-index:1000;box-shadow:0 4px 6px rgba(0,0,0,.1)"></div></div><p style="text-align:center;color:#6c757d;margin-top:10px;font-size:.9em">ğŸ’¡ Ä°pucu: Birden fazla maÄŸaza seÃ§erek karÅŸÄ±laÅŸtÄ±rmalÄ± analiz yapabilirsiniz! (En fazla 3 maÄŸaza)</p></div><div id="storeProfileContainer" style="display:none"><div id="multipleStoresView" style="display:none"><h2 style="margin-bottom:30px;text-align:center">ğŸª MaÄŸaza KarÅŸÄ±laÅŸtÄ±rma Analizi</h2><div id="storeComparisonTableContainer" style="margin-bottom:40px;overflow-x:auto"></div><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));gap:30px;margin-bottom:30px"><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ“Š Toplam SatÄ±ÅŸ KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3><canvas id="comparisonStoreSalesChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ“¦ Toplam Adet KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3><canvas id="comparisonStoreQtyChart"></canvas></div></div><div id="storeComparisonCategorySection" style="margin:40px 0"><h3 style="text-align:center;margin-bottom:30px">ğŸ“‚ MaÄŸaza BazÄ±nda Kategori KarÅŸÄ±laÅŸtÄ±rmasÄ± (Kategori 1)</h3><div id="storeCategoryComparisonTableContainer" style="margin-bottom:40px;overflow-x:auto"></div><div id="storeComparisonCategoryCharts" style="display:none"></div></div><div id="multipleStoresAIPanel" style="margin:40px 0"><div id="multipleStoresAIContent"></div></div></div><div id="singleStoreView" style="display:none"><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:40px;border-radius:20px;margin-bottom:30px"><h2 style="margin:0 0 20px 0;font-size:2em">ğŸª <span id="storeName">-</span></h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px"><div><div style="opacity:.8;font-size:.9em">ğŸ’° Toplam SatÄ±ÅŸ (KDV HariÃ§)</div><div style="font-size:1.5em;font-weight:700" id="storeTotalSales">$0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ“¦ Toplam Adet</div><div style="font-size:1.5em;font-weight:700" id="storeTotalQty">0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ›’ Fatura SayÄ±sÄ±</div><div style="font-size:1.5em;font-weight:700" id="storeInvoiceCount">0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ“Š GÃ¼nlÃ¼k Ort. SatÄ±ÅŸ</div><div style="font-size:1.5em;font-weight:700" id="storeAvgTransaction">$0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ›’ Sepet OrtalamasÄ±</div><div style="font-size:1.5em;font-weight:700" id="storeAvgBasket">$0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ‘¥ FarklÄ± MÃ¼ÅŸteri</div><div style="font-size:1.5em;font-weight:700" id="storeUniqueCustomers">0</div></div><div><div style="opacity:.8;font-size:.9em">ğŸ¯ FarklÄ± ÃœrÃ¼n</div><div style="font-size:1.5em;font-weight:700" id="storeUniqueProducts">0</div></div></div></div><div id="storeBrandCategorySection" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));gap:30px;margin-bottom:30px"><div class="chart-container"><h3 id="storeBrandChartTitle" style="text-align:center;margin-bottom:20px">ğŸ·ï¸ En Ã‡ok Satan Markalar (Top 10)</h3><canvas id="storeBrandChart"></canvas></div><div class="chart-container"><h3 id="storeCategoryChartTitle" style="text-align:center;margin-bottom:20px">ğŸ“‚ En Ã‡ok Satan Kategoriler</h3><canvas id="storeCategoryChart"></canvas></div><div class="chart-container"><h3 id="storeSalespersonChartTitle" style="text-align:center;margin-bottom:20px">ğŸ‘¨â€ğŸ’¼ SatÄ±ÅŸ Temsilcileri</h3><canvas id="storeSalespersonChart"></canvas></div><div class="chart-container"><h3 id="storeMonthlyChartTitle" style="text-align:center;margin-bottom:20px">ğŸ“ˆ AylÄ±k Performans Trendi</h3><canvas id="storeMonthlyChart"></canvas></div></div><div id="storeTopProductsSection" style="margin-bottom:40px"><h3 style="margin-bottom:20px">ğŸ¯ En Ã‡ok Satan ÃœrÃ¼nler (Top 20)</h3><div id="storeTopProductsTable" style="overflow-x:auto"></div></div><div id="storeAIAnalysisPanel" style="margin:40px 0"><h3 style="margin-bottom:20px">ğŸ¤– AI Performans Analizi ve Ã–neriler</h3><div id="storeAIAnalysisContent"></div></div><div id="storeFullSalespersonSection" style="margin:40px 0"><h3 style="margin-bottom:20px">ğŸ‘¥ TÃ¼m SatÄ±ÅŸ Temsilcileri DetaylÄ± Performans Listesi</h3><div id="storeFullSalespersonTable" style="overflow-x:auto"></div></div></div><div id="storeSearchNoResults" style="display:none;text-align:center;padding:60px;background:#f8f9fa;border-radius:15px"><div style="font-size:4em;margin-bottom:20px">ğŸ”</div><h3 style="color:#6c757d;margin-bottom:10px">MaÄŸaza BulunamadÄ±</h3><p style="color:#adb5bd">LÃ¼tfen farklÄ± bir isim deneyin</p></div></div></div></div><div id="cityTab" class="tab-content"><div class="content"><h2 style="margin-bottom:30px">ğŸŒ Åehir BazlÄ± SatÄ±ÅŸ Analizi</h2><div style="background:#e3f2fd;border-left:4px solid #2196f3;padding:15px;margin-bottom:20px;border-radius:5px"><p style="margin:0;color:#1565c0;font-size:.95em">ğŸ’¡ <strong>Ä°pucu:</strong> Tarih aralÄ±ÄŸÄ± seÃ§mek zorunlu deÄŸil, istenirse tÃ¼m dÃ¶nem veya belirli tarih aralÄ±ÄŸÄ± iÃ§in analiz yapabilirsiniz.</p></div><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);padding:30px;border-radius:15px;margin-bottom:40px"><div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr auto;gap:20px;align-items:end"><div><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">ğŸ“ Åehir SeÃ§in</label> <select id="citySelect" onchange="handleCityChange()" style="width:100%;padding:15px;font-size:1.1em;border:none;border-radius:10px;outline:0"><option value="">-- Åehir SeÃ§in --</option></select></div><div><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">ğŸ˜ï¸ Ä°lÃ§e SeÃ§in <small style="opacity:.8">(Opsiyonel)</small></label> <select id="districtSelect" onchange="analyzeCityPerformance()" style="width:100%;padding:15px;font-size:1.1em;border:none;border-radius:10px;outline:0" disabled="disabled"><option value="">-- Ã–nce Åehir SeÃ§in --</option></select></div><div><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">ğŸ“… BaÅŸlangÄ±Ã§ Tarihi</label> <input type="date" id="cityDateStart" onchange="analyzeCityPerformance()" style="width:100%;padding:15px;border:none;border-radius:10px;font-size:1em"></div><div><label style="color:#fff;display:block;margin-bottom:8px;font-weight:600">ğŸ“… BitiÅŸ Tarihi</label> <input type="date" id="cityDateEnd" onchange="analyzeCityPerformance()" style="width:100%;padding:15px;border:none;border-radius:10px;font-size:1em"></div><div><button onclick="clearCityFilters()" style="padding:15px 30px;background:#fff;color:#667eea;border:none;border-radius:10px;font-weight:600;cursor:pointer;white-space:nowrap">ğŸ—‘ï¸ Temizle</button></div></div></div><div id="cityAnalysisContainer" style="display:none"><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-bottom:30px"><div class="summary-card"><h3 style="font-size:1em;margin-bottom:10px">ğŸ’° Toplam SatÄ±ÅŸ (KDV HariÃ§)</h3><p id="cityTotalSales" style="font-size:1.8em;font-weight:700">$0</p></div><div class="summary-card"><h3 style="font-size:1em;margin-bottom:10px">ğŸ“¦ Toplam Adet</h3><p id="cityTotalQty" style="font-size:1.8em;font-weight:700">0</p></div><div class="summary-card"><h3 style="font-size:1em;margin-bottom:10px">ğŸ‘¥ MÃ¼ÅŸteri SayÄ±sÄ±</h3><p id="cityCustomerCount" style="font-size:1.8em;font-weight:700">0</p></div><div class="summary-card"><h3 style="font-size:1em;margin-bottom:10px">ğŸ“Š Ortalama Sepet</h3><p id="cityAvgBasket" style="font-size:1.8em;font-weight:700">$0</p></div><div class="summary-card" style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff"><h3 style="font-size:1em;margin-bottom:10px;color:#fff">ğŸ™ï¸ NÃ¼fus (2024)</h3><p id="cityPopulation" style="font-size:1.8em;font-weight:700;color:#fff">-</p></div><div class="summary-card" style="background:linear-gradient(135deg,#f093fb 0,#f5576c 100%);color:#fff"><h3 style="font-size:1em;margin-bottom:10px;color:#fff">ğŸ‘¤ KiÅŸi BaÅŸÄ± SatÄ±ÅŸ</h3><p id="cityPerCapitaSales" style="font-size:1.8em;font-weight:700;color:#fff">$0</p><small style="opacity:.9;font-size:.85em">Toplam SatÄ±ÅŸ / NÃ¼fus</small></div><div class="summary-card" style="background:linear-gradient(135deg,#38ef7d 0,#11998e 100%);color:#fff;grid-column:span 1"><h3 style="font-size:.95em;margin-bottom:10px">ğŸ‘¤ Top 5 Temsilci</h3><div id="cityTopSalespersons" style="color:#fff;font-size:.85em;line-height:1.6;max-height:120px;overflow-y:auto"></div></div><div class="summary-card" style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;grid-column:span 1"><h3 style="font-size:.95em;margin-bottom:10px">ğŸª Top 5 MaÄŸaza</h3><div id="cityTopStores" style="color:#fff;font-size:.85em;line-height:1.6;max-height:120px;overflow-y:auto"></div></div></div><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));gap:30px;margin-bottom:30px"><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ·ï¸ En Ã‡ok SatÄ±lan Markalar</h3><canvas id="cityBrandChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ¸ En Ã‡ok SatÄ±lan ÃœrÃ¼nler</h3><canvas id="cityProductChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ“‚ En Ã‡ok SatÄ±lan Kategoriler</h3><canvas id="cityCategoryChart"></canvas></div><div class="chart-container"><h3 style="text-align:center;margin-bottom:20px">ğŸ“ˆ AylÄ±k Performans Trendi (YÄ±l KarÅŸÄ±laÅŸtÄ±rmalÄ±)</h3><canvas id="cityYearlyChart"></canvas></div></div><div id="cityAIAnalysisPanel" style="margin:40px 0"><h3 style="margin-bottom:20px">ğŸ¤– AI Åehir Analizi ve Ã–neriler</h3><div id="cityAIAnalysisContent"></div></div></div></div></div><div id="stockTab" class="tab-content"><div class="content"><h2 style="margin-bottom:30px">ğŸ“¦ Stok DaÄŸÄ±lÄ±m Analizi</h2><div style="max-width:1000px;margin:0 auto 30px"><div style="background:linear-gradient(135deg,#667eea 0,#764ba2 100%);padding:20px;border-radius:15px;color:#fff"><h3 style="margin-bottom:15px">ğŸ“… Tarih AralÄ±ÄŸÄ± Filtresi (Opsiyonel)</h3><div style="display:grid;grid-template-columns:1fr 1fr auto;gap:15px;align-items:end"><div><label style="display:block;margin-bottom:5px;font-size:.9em;opacity:.9">BaÅŸlangÄ±Ã§ Tarihi:</label> <input type="date" id="stockDateStart" style="width:100%;padding:10px;border:none;border-radius:8px;font-size:1em"></div><div><label style="display:block;margin-bottom:5px;font-size:.9em;opacity:.9">BitiÅŸ Tarihi:</label> <input type="date" id="stockDateEnd" style="width:100%;padding:10px;border:none;border-radius:8px;font-size:1em"></div><div><button onclick="clearStockDateFilters()" style="padding:10px 20px;background:rgba(255,255,255,.2);color:#fff;border:2px solid #fff;border-radius:8px;cursor:pointer;font-size:1em">ğŸ”„ Temizle</button></div></div><p style="margin-top:10px;font-size:.85em;opacity:.8">ğŸ’¡ Tarih seÃ§mezseniz tÃ¼m satÄ±ÅŸ verileri kullanÄ±lÄ±r</p></div></div><div style="max-width:1000px;margin:0 auto"><div style="display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:40px"><div style="background:#f8f9fa;padding:30px;border-radius:15px"><h3 style="margin-bottom:20px">ğŸ“„ Excel ile Toplu YÃ¼kleme</h3><p style="color:#6c757d;margin-bottom:15px">Excel formatÄ±: <strong>ÃœrÃ¼n Kodu | Stok MiktarÄ±</strong></p><input type="file" id="stockExcelInput" accept=".xlsx,.xls" style="display:none" onchange="handleStockExcelUpload(event)"> <button onclick='document.getElementById("stockExcelInput").click()' style="width:100%;padding:15px;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;border:none;border-radius:10px;cursor:pointer;font-size:1.1em">ğŸ“‚ Excel DosyasÄ± SeÃ§</button><p style="color:#6c757d;margin-top:10px;font-size:.9em">Max 5 MB, .xlsx veya .xls</p></div><div style="background:#f8f9fa;padding:30px;border-radius:15px"><h3 style="margin-bottom:20px">âœï¸ Manuel GiriÅŸ</h3><div style="margin-bottom:15px"><label style="display:block;margin-bottom:5px;font-weight:700">ÃœrÃ¼n Kodu:</label> <input type="text" id="manualProductCode" placeholder="Ã¶rn: KDP120R" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px"></div><div style="margin-bottom:15px"><label style="display:block;margin-bottom:5px;font-weight:700">Stok MiktarÄ±:</label> <input type="number" id="manualStockQty" placeholder="Ã¶rn: 25" min="0" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px"></div><button onclick="addManualStock()" style="width:100%;padding:15px;background:linear-gradient(135deg,#38ef7d 0,#11998e 100%);color:#fff;border:none;border-radius:10px;cursor:pointer;font-size:1.1em">â• Stok Ekle</button></div></div><div id="stockListContainer" style="display:none;margin-bottom:40px"><h3 style="margin-bottom:20px">ğŸ“‹ Mevcut Stok Listesi</h3><div id="stockListTable" style="overflow-x:auto"></div><div style="margin-top:20px;text-align:center"><button onclick="analyzeStockDistribution()" style="padding:15px 40px;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;border:none;border-radius:10px;cursor:pointer;font-size:1.1em;margin-right:10px">ğŸ¤– AI DaÄŸÄ±lÄ±m Ã–nerisi Al</button> <button onclick="clearStockList()" style="padding:15px 40px;background:#dc3545;color:#fff;border:none;border-radius:10px;cursor:pointer;font-size:1.1em">ğŸ—‘ï¸ Listeyi Temizle</button></div></div><div id="stockDistributionResults" style="display:none"><h3 style="margin-bottom:20px">ğŸ¤– AI Stok DaÄŸÄ±lÄ±m Ã–nerileri</h3><div id="stockDistributionContent"></div></div></div></div></div></div><script>function logout(){confirm("Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinizden emin misiniz?")&&(sessionStorage.clear(),window.location.href="login.html")}window.addEventListener("DOMContentLoaded",function(){var e=sessionStorage.getItem("username");e&&(document.getElementById("currentUserName").textContent=e.charAt(0).toUpperCase()+e.slice(1))});let allData=[],filteredData=[],baseData=[],metadata=null,loadedYears=new Set,inventoryData=null,inventoryCharts={},activeChannels={all:!0,retail:!1,wholesale:!1,online:!1,corporate:!1,central:!1},dataLoadProgress={pageInit:!1,dataFiles:!1,targets:!1,ready:!1};function isDiscountProduct(e){e=(e.product||"").toLowerCase();return e.includes("[disc]")||e.includes("indirim")||e.includes("discount")||e.includes("toplam tutarda indirim")}function applyDiscountLogic(e){return isDiscountProduct(e)?{...e,usd_amount:-Math.abs(parseFloat(e.usd_amount||0)),quantity:Math.abs(parseFloat(e.quantity||0)),_isDiscount:!0}:e}let STORE_WORKING_HOURS={"TÃ¼nel":{openHour:10,closeHour:20,closedDays:[0]},"Ä°zmir":{openHour:10,closeHour:20,closedDays:[0]},Antalya:{openHour:10,closeHour:20,closedDays:[0]},"KÄ±zÄ±lay":{openHour:10,closeHour:20,closedDays:[0]},default:{openHour:10,closeHour:22,closedDays:[]}};function getStoreWorkingHours(e){var t,a,r=e.replace(/\[.*?\]\s*/g,"").trim();for([t,a]of Object.entries(STORE_WORKING_HOURS))if("default"!==t&&r.toLowerCase().includes(t.toLowerCase()))return a;return STORE_WORKING_HOURS.default}function isWithinWorkingHours(e){var t=getStoreWorkingHours(e.store||""),a=e.create_hour,e=e.day_of_week;if(null!=e&&t.closedDays.includes((e+1)%7))return!1;return null==a||!(a<t.openHour||a>=t.closeHour)}async function loadMetadata(){try{var e=(new Date).getTime(),t=await fetch("data-metadata.json?v="+e,{cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(t.ok)return metadata=await t.json(),console.log("âœ… Metadata yÃ¼klendi:",metadata),metadata;throw new Error("Metadata yÃ¼klenemedi")}catch(e){return console.error("âŒ Metadata hatasÄ±:",e),null}}async function loadYearData(a){if(loadedYears.has(a))return console.log(`â­ï¸ ${a} zaten yÃ¼klÃ¼, atlanÄ±yor...`),null;loadedYears.add(a);try{console.log(`ğŸ“¦ ${a} yÃ¼kleniyor...`);var e=(new Date).getTime(),r=await fetch(`data-${a}.json.gz?v=`+e,{cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!r.ok)throw new Error(a+" verisi bulunamadÄ±");var n=await r.arrayBuffer();let t;if("undefined"!=typeof DecompressionStream)try{var o=new Blob([n]),i=new DecompressionStream("gzip"),l=o.stream().pipeThrough(i);t=await new Response(l).text()}catch(e){console.warn("DecompressionStream baÅŸarÄ±sÄ±z, pako kullanÄ±lÄ±yor:",e);var s=new Uint8Array(n),d=pako.inflate(s);t=(new TextDecoder).decode(d)}else{if("undefined"==typeof pako)throw new Error("GZIP aÃ§ma kÃ¼tÃ¼phanesi yÃ¼klenmedi. LÃ¼tfen sayfayÄ± yenileyin.");var c=new Uint8Array(n),m=pako.inflate(c);t=(new TextDecoder).decode(m)}var g=JSON.parse(t);return console.log(`âœ… ${a} yÃ¼klendi: ${g.details?.length||0} kayÄ±t`),g}catch(e){throw console.error(`âŒ ${a} yÃ¼kleme hatasÄ±:`,e),e}}let centralTargets={yearly:{},monthly:{}};async function loadCentralTargets(){try{console.log("ğŸ¯ Merkezi hedefler yÃ¼kleniyor...");var e=await fetch("targets.json?"+Date.now());return e.ok?(centralTargets=await e.json(),console.log("âœ… Merkezi hedefler yÃ¼klendi:",centralTargets),dataLoadProgress.targets=!0,checkLoadingComplete(),!0):(console.warn("âš ï¸ targets.json yÃ¼klenemedi, varsayÄ±lan hedefler kullanÄ±lacak"),!1)}catch(e){return console.error("âŒ Hedef yÃ¼kleme hatasÄ±:",e),!1}}function applyChannelFilter(){console.log("ğŸ¢ applyChannelFilter baÅŸladÄ±"),console.log("ğŸ“Š activeChannels:",activeChannels),console.log("ğŸ“Š baseData uzunluk:",baseData.length);var e=document.getElementById("channelLoadingSpinner"),t=document.getElementById("channelLoadingText");e.style.display="flex";let a={retail:"ğŸª Perakende",wholesale:"ğŸ“¦ Toptan SatÄ±ÅŸ",online:"ğŸŒ Online SatÄ±ÅŸ",corporate:"ğŸ¢ Kurumsal SatÄ±ÅŸ",central:"ğŸ›ï¸ Merkezi SatÄ±ÅŸ"},r="TÃ¼m Kanallar";activeChannels.all||(e=Object.keys(activeChannels).filter(e=>activeChannels[e]&&"all"!==e),r=e.map(e=>a[e]).join(" + ")),t.textContent=`ğŸ”„ ${r} verileri yÃ¼kleniyor...`,setTimeout(()=>{var e,t;activeChannels.all?(allData=[...baseData],console.log("âœ… TÃ¼mÃ¼ seÃ§ili, allData uzunluk:",allData.length),document.getElementById("channelFilterInfo").textContent="ğŸ“Š Aktif: TÃ¼m Kanallar (19)"):(e=[],activeChannels.retail&&(allData=baseData.filter(e=>e.store&&e.store.toLowerCase().includes("perakende")),e.push("Perakende")),activeChannels.wholesale&&(t=baseData.filter(e=>e.store&&e.store.toLowerCase().includes("toptan")),allData=activeChannels.retail?[...allData,...t]:t,e.push("Toptan")),activeChannels.online&&(t=baseData.filter(e=>e.store&&e.store.toLowerCase().includes("online")),allData=activeChannels.retail||activeChannels.wholesale?[...allData,...t]:t,e.push("Online")),activeChannels.corporate&&(t=baseData.filter(e=>e.store&&e.store.toLowerCase().includes("kurumsal")),allData=activeChannels.retail||activeChannels.wholesale||activeChannels.online?[...allData,...t]:t,e.push("Kurumsal")),activeChannels.central&&(t=baseData.filter(e=>e.store&&e.store.toLowerCase().includes("merkezi")),allData=activeChannels.retail||activeChannels.wholesale||activeChannels.online||activeChannels.corporate?[...allData,...t]:t,e.push("Merkezi")),document.getElementById("channelFilterInfo").textContent=`ğŸ“Š Aktif: ${e.join(" + ")} (${allData.length.toLocaleString("tr-TR")} kayÄ±t)`),filteredData=[...allData],updateAfterChannelFilter()},100)}function updateAfterChannelFilter(){document.getElementById("totalRecords").textContent=allData.length.toLocaleString("tr-TR");var e=allData.reduce((e,t)=>e+(parseFloat(t.usd_amount)||0),0),t=(document.getElementById("totalUSD").textContent="$"+e.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}),[...new Set(allData.map(e=>e.date))]),t=0<t.length?e/t.length:0,t=(document.getElementById("dailyAverage").textContent="$"+t.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}),0<allData.length?e/allData.length:0);document.getElementById("basketAverage").textContent="$"+t.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}),populateFilters(),updateSummary(),loadDashboard(),analyzeCustomers(),loadAllStoresTargets(),setTimeout(()=>{document.getElementById("channelLoadingSpinner").style.display="none"},500)}async function loadData(){try{dataLoadProgress.dataFiles=!0,checkLoadingComplete(),document.getElementById("dataStatus").innerHTML='<span class="status-badge" style="background:#ffc107;color:#000;">â³ YÃ¼kleniyor...</span>';var a=document.getElementById("tableContainer");if(a&&(a.innerHTML='<div style="text-align:center;padding:50px;font-size:1.2em;">â³ Veriler yÃ¼kleniyor, lÃ¼tfen bekleyin...</div>'),loadCentralTargets(),!(metadata=await loadMetadata())||!metadata.years||0===metadata.years.length)throw new Error("GeÃ§erli yÄ±l verisi bulunamadÄ±");let e=metadata.years[metadata.years.length-1];var r=(await loadYearData(e)).details||[],n=r.filter(e=>isDiscountProduct(e));allData=r.map(e=>applyDiscountLogic(e)),baseData=[...allData],filteredData=[...allData],console.log(`ğŸ’° ${n.length} indirim Ã¼rÃ¼nÃ¼ negatif deÄŸer olarak iÅŸlendi (toplam kayÄ±t: ${r.length})`),document.getElementById("dataStatus").innerHTML=`<span class="status-badge status-success">âœ… ${e}</span>`,document.getElementById("lastUpdate").textContent=metadata.last_update||"-",document.getElementById("totalRecords").textContent=allData.length.toLocaleString("tr-TR");let t=0;allData&&Array.isArray(allData)&&(t=allData.reduce((e,t)=>e+(parseFloat(t.usd_amount)||0),0)),document.getElementById("totalUSD").textContent="$"+t.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2});var o=[...new Set(allData.map(e=>e.date))],i=0<o.length?t/o.length:0,l=(document.getElementById("dailyAverage").textContent="$"+i.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}),0<allData.length?t/allData.length:0);document.getElementById("basketAverage").textContent="$"+l.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}),populateFilters(),updateSummary(),renderTable(),populateSalespersonYearFilter(),populateStoreYearFilter(),initializeProductFilters(),loadDashboard(),setTimeout(()=>loadRemainingYears(e),2e3)}catch(e){console.error("Error loading data:",e),document.getElementById("dataStatus").innerHTML='<span class="status-badge status-error">âŒ Hata</span>';a=document.getElementById("tableContainer");a&&(a.innerHTML='<div class="error">âŒ Veri yÃ¼klenirken hata oluÅŸtu!<br><small>'+e.message+"</small></div>")}}async function loadRemainingYears(e){if(metadata&&metadata.years){console.log("ğŸ“¦ DiÄŸer yÄ±llar arka planda yÃ¼kleniyor...");for(var t of metadata.years)if(t!==e&&!loadedYears.has(t))try{var a,r,n,o,i,l,s,d,c=await loadYearData(t);c&&c.details&&Array.isArray(c.details)&&(r=(a=c.details).filter(e=>isDiscountProduct(e)).length,n=a.map(e=>applyDiscountLogic(e)),allData=[...allData,...n],baseData=[...allData],filteredData=[...allData],console.log(`ğŸ’° ${t}: ${r} indirim Ã¼rÃ¼nÃ¼ negatif deÄŸer olarak iÅŸlendi (toplam: ${a.length})`),populateFilters(),updateSummary(),populateSalespersonYearFilter(),populateStoreYearFilter(),o=Array.from(loadedYears).sort().join(", "),document.getElementById("dataStatus").innerHTML=`<span class="status-badge status-success">âœ… ${o}</span>`,document.getElementById("totalRecords").textContent=allData.length.toLocaleString("tr-TR"),i=allData.reduce((e,t)=>e+(parseFloat(t.usd_amount)||0),0),document.getElementById("totalUSD").textContent="$"+i.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}),s=0<(l=[...new Set(allData.map(e=>e.date))]).length?i/l.length:0,document.getElementById("dailyAverage").textContent="$"+s.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}),d=0<allData.length?i/allData.length:0,document.getElementById("basketAverage").textContent="$"+d.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}))}catch(e){console.error(`âš ï¸ ${t} yÃ¼klenemedi:`,e)}console.log("âœ… TÃ¼m yÄ±llar yÃ¼klendi!");var m=metadata.years.sort().join(", ");document.getElementById("dataStatus").innerHTML=`<span class="status-badge status-success">âœ… TÃ¼m YÄ±llar (${m})</span>`,dataLoadProgress.ready=!0,checkLoadingComplete()}}async function loadInventoryData(){console.log("ğŸ“¦ Envanter verileri yÃ¼kleniyor..."),document.getElementById("inventoryLoading").style.display="block",document.getElementById("inventoryContent").style.display="none";try{var e=await fetch("inventory.json.gz");if(!e.ok)throw new Error(`HTTP ${e.status}: `+e.statusText);var t=await e.arrayBuffer(),a=pako.ungzip(new Uint8Array(t),{to:"string"}),r=JSON.parse(a);if(r.inventory&&Array.isArray(r.inventory))inventoryData=r.inventory,console.log(`âœ… Envanter verileri yÃ¼klendi: ${inventoryData.length} kayÄ±t`),console.log("ğŸ“Š Toplam miktar: "+r.total_quantity),console.log("ğŸ’° Toplam deÄŸer: $"+r.total_value);else{if(!Array.isArray(r))throw new Error("Beklenmeyen veri formatÄ±: inventory array bulunamadÄ±");inventoryData=r,console.log(`âœ… Envanter verileri yÃ¼klendi: ${inventoryData.length} kayÄ±t`)}renderInventoryDashboard()}catch(e){console.error("âŒ Envanter verileri yÃ¼klenemedi:",e),document.getElementById("inventoryLoading").innerHTML=`
                    <div style="text-align: center; padding: 60px;">
                        <div style="font-size: 4em; margin-bottom: 20px;">âš ï¸</div>
                        <h3 style="color: #f5576c;">Envanter verileri yÃ¼klenemedi</h3>
                        <p style="color: #666; margin-top: 15px;">Hata: ${e.message}</p>
                        <button onclick="loadInventoryData()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em;">
                            ğŸ”„ Tekrar Dene
                        </button>
                    </div>
                `}}function renderInventoryDashboard(){inventoryData&&0!==inventoryData.length?(console.log("ğŸ“Š Envanter dashboard oluÅŸturuluyor..."),document.getElementById("inventoryLoading").style.display="none",document.getElementById("inventoryContent").style.display="block",filterStockAnalysis(),console.log("âœ… Envanter dashboard oluÅŸturuldu!")):console.warn("âš ï¸ Envanter verisi yok!")}function filterStockAnalysis(){if(inventoryData&&0!==inventoryData.length&&allData&&0!==allData.length){console.log("ğŸ” Stok analizi filtreleniyor...");let a=(document.getElementById("stockSearchBrand")?.value||"").toLowerCase().trim(),r=(document.getElementById("stockSearchProduct")?.value||"").toLowerCase().trim(),n=(document.getElementById("stockSearchCat2")?.value||"").toLowerCase().trim(),o=(document.getElementById("stockSearchCat3")?.value||"").toLowerCase().trim(),i=(document.getElementById("stockSearchCat4")?.value||"").toLowerCase().trim();var e=inventoryData.filter(e=>{var t;return!(a&&!(e.brand||"").toLowerCase().includes(a)||(t=e.product_name||e.product||"",r&&!t.toLowerCase().includes(r))||(t=e.category||"",n&&!t.toLowerCase().includes(n))||o&&!t.toLowerCase().includes(o)||i&&!t.toLowerCase().includes(i))});console.log(`ğŸ“¦ FiltrelenmiÅŸ envanter: ${e.length} Ã¼rÃ¼n`);let l={},s=(e.forEach(e=>{var t=e.location||"Bilinmeyen",a=e.product_name||e.product||"",r=e.brand||"",n=(l[t]||(l[t]={}),r+"_"+a);l[t][n]||(l[t][n]={brand:r,product:a,stock:0,sales:0,salesQty:0}),l[t][n].stock+=parseFloat(e.quantity)||0}),new Date);s.setMonth(s.getMonth()-12),allData.forEach(e=>{var t,a;new Date(e.date)<s||(t=e.store||"Bilinmeyen",a=(e.brand||"")+"_"+(e.product||""),l[t]&&l[t][a]&&(l[t][a].sales+=parseFloat(e.usd_amount)||0,l[t][a].salesQty+=parseFloat(e.quantity)||0))}),Object.keys(l).forEach(a=>{Object.keys(l[a]).forEach(e=>{var e=l[a][e],t=e.salesQty/12,t=Math.ceil(2*t*1.2),t=(e.recommendedStock=t,Math.max(0,t-e.stock));e.recommendedPurchase=Math.ceil(t)})}),renderStockAnalysisTable(l)}else console.warn("âš ï¸ Envanter veya satÄ±ÅŸ verisi yok!"),document.getElementById("stockAnalysisTableContainer").innerHTML='<p style="text-align: center; color: #f5576c; padding: 40px;">âš ï¸ Veri henÃ¼z yÃ¼klenmedi. LÃ¼tfen bekleyin...</p>'}function renderStockAnalysisTable(e){var t=document.getElementById("stockAnalysisTableContainer");if(t){let a="";Object.entries(e).sort((e,t)=>e[0].localeCompare(t[0])).forEach(([e,t])=>{t=Object.values(t);0!==t.length&&(a+=`
                    <div style="margin-bottom: 40px;">
                        <h4 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            ğŸª ${e} <span style="opacity: 0.8; font-size: 0.9em;">(${t.length} Ã¼rÃ¼n)</span>
                        </h4>
                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <thead>
                                <tr style="background: #f8f9fa; text-align: left;">
                                    <th style="padding: 12px; border-bottom: 2px solid #dee2e6;">Marka</th>
                                    <th style="padding: 12px; border-bottom: 2px solid #dee2e6;">ÃœrÃ¼n</th>
                                    <th style="padding: 12px; border-bottom: 2px solid #dee2e6; text-align: right;">ğŸ“¦ Stok</th>
                                    <th style="padding: 12px; border-bottom: 2px solid #dee2e6; text-align: right;">ğŸ“Š SatÄ±ÅŸ (12 Ay)</th>
                                    <th style="padding: 12px; border-bottom: 2px solid #dee2e6; text-align: right;">ğŸ¤– Ã–nerilen Stok</th>
                                    <th style="padding: 12px; border-bottom: 2px solid #dee2e6; text-align: right;">ğŸ›’ Ã–nerilen SatÄ±n Alma</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${t.map(e=>`
                                        <tr style="${e.stock>=e.recommendedStock?"background: #d4edda;":e.stock<.5*e.recommendedStock?"background: #f8d7da;":""}">
                                            <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">${e.brand||"-"}</td>
                                            <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">${e.product||"-"}</td>
                                            <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold;">${e.stock.toFixed(0)}</td>
                                            <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">${e.salesQty.toFixed(0)} adet</td>
                                            <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right; color: #667eea; font-weight: bold;">${e.recommendedStock}</td>
                                            <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right; ${0<e.recommendedPurchase?"color: #f5576c; font-weight: bold;":"color: #38ef7d;"}">${0<e.recommendedPurchase?e.recommendedPurchase:"âœ“ Yeterli"}</td>
                                        </tr>
                                    `).join("")}
                            </tbody>
                        </table>
                    </div>
                `)}),""===a&&(a='<p style="text-align: center; color: #666; padding: 40px;">Filtre kriterlerine uygun Ã¼rÃ¼n bulunamadÄ±.</p>'),t.innerHTML=a,console.log("âœ… Stok analiz tablosu oluÅŸturuldu!")}}function clearStockFilters(){document.getElementById("stockSearchBrand").value="",document.getElementById("stockSearchProduct").value="",document.getElementById("stockSearchCat2").value="",document.getElementById("stockSearchCat3").value="",document.getElementById("stockSearchCat4").value="",filterStockAnalysis(),console.log("ğŸ—‘ï¸ Stok filtreleri temizlendi")}function renderInventoryCharts(){let a={};inventoryData.forEach(e=>{var t=e.brand||"DiÄŸer";a[t]||(a[t]=0),a[t]+=parseFloat(e.value)||0});var e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10);let r={};inventoryData.forEach(e=>{var t=e.category||"DiÄŸer";r[t]||(r[t]=0),r[t]+=parseFloat(e.value)||0});var t=Object.entries(r).sort((e,t)=>t[1]-e[1]).slice(0,10);let n={};inventoryData.forEach(e=>{var t=e.location||"DiÄŸer";n[t]||(n[t]=0),n[t]+=parseFloat(e.value)||0});var o=Object.entries(n).sort((e,t)=>t[1]-e[1]).slice(0,10),i=[...inventoryData].sort((e,t)=>(parseFloat(t.value)||0)-(parseFloat(e.value)||0)).slice(0,10),l=(inventoryCharts.brand&&inventoryCharts.brand.destroy(),document.getElementById("invBrandChart")),l=(l&&(inventoryCharts.brand=new Chart(l,{type:"bar",data:{labels:e.map(e=>e[0]),datasets:[{label:"Stok DeÄŸeri ($)",data:e.map(e=>e[1]),backgroundColor:"#667eea"}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}}}})),inventoryCharts.category&&inventoryCharts.category.destroy(),document.getElementById("invCategoryChart")),e=(l&&(inventoryCharts.category=new Chart(l,{type:"doughnut",data:{labels:t.map(e=>e[0]),datasets:[{data:t.map(e=>e[1]),backgroundColor:["#667eea","#f093fb","#4facfe","#43e97b","#fa709a","#fee140","#30cfd0","#a8edea","#ffa751","#f5576c"]}]},options:{responsive:!0,maintainAspectRatio:!0}})),inventoryCharts.location&&inventoryCharts.location.destroy(),document.getElementById("invLocationChart")),l=(e&&(inventoryCharts.location=new Chart(e,{type:"bar",data:{labels:o.map(e=>e[0]),datasets:[{label:"Stok DeÄŸeri ($)",data:o.map(e=>e[1]),backgroundColor:"#f093fb"}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}}}})),inventoryCharts.topValue&&inventoryCharts.topValue.destroy(),document.getElementById("invTopValueChart"));l&&(inventoryCharts.topValue=new Chart(l,{type:"horizontalBar",data:{labels:i.map(e=>(e.product||"Bilinmeyen").substring(0,30)),datasets:[{label:"DeÄŸer ($)",data:i.map(e=>parseFloat(e.value)||0),backgroundColor:"#43e97b"}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}}}}))}function renderInventoryTable(){var e,t=document.getElementById("inventoryTableBody");t&&(e=inventoryData.slice(0,100),t.innerHTML=e.map(e=>`
                <tr>
                    <td>${e.product||"-"}</td>
                    <td>${e.brand||"-"}</td>
                    <td>${e.category||"-"}</td>
                    <td>${e.location||"-"}</td>
                    <td style="text-align: right;">${(parseFloat(e.quantity)||0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                    <td style="text-align: right;">$${(parseFloat(e.value)||0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                </tr>
            `).join(""),console.log(`âœ… Envanter tablosu oluÅŸturuldu: ${e.length} kayÄ±t`))}function filterInventoryTable(){if(inventoryData&&0!==inventoryData.length){let t=document.getElementById("inventorySearch").value.toLowerCase();var e,a,r;t.trim()?(e=inventoryData.filter(e=>e.product&&e.product.toLowerCase().includes(t)||e.brand&&e.brand.toLowerCase().includes(t)||e.category&&e.category.toLowerCase().includes(t)||e.location&&e.location.toLowerCase().includes(t)),(a=document.getElementById("inventoryTableBody"))&&(r=e.slice(0,100),a.innerHTML=r.map(e=>`
                <tr>
                    <td>${e.product||"-"}</td>
                    <td>${e.brand||"-"}</td>
                    <td>${e.category||"-"}</td>
                    <td>${e.location||"-"}</td>
                    <td style="text-align: right;">${(parseFloat(e.quantity)||0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                    <td style="text-align: right;">$${(parseFloat(e.value)||0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                </tr>
            `).join(""),console.log(`ğŸ” Arama sonucu: ${e.length} kayÄ±t bulundu, ${r.length} gÃ¶steriliyor`))):renderInventoryTable()}}function populateFilters(){let t=new Set,a=new Set,r=new Set,n=new Set;new Set;let o=new Set,i=new Set,l=new Set,s=new Set,d=new Set,c=new Set;allData.forEach(e=>{e.brand&&t.add(e.brand),e.category_2&&a.add(e.category_2),e.category_3&&r.add(e.category_3),e.category_4&&n.add(e.category_4),e.sales_person&&o.add(e.sales_person),e.store&&i.add(e.store),e.city&&l.add(e.city),e.date&&3<=(e=e.date.split("-")).length&&(s.add(e[0]),d.add(e[1]),c.add(e[2]))}),populateMultiSelect("filterBrand",Array.from(t).sort(),"countBrand"),populateMultiSelect("filterCategory1",Array.from(a).sort(),"countCategory1"),populateMultiSelect("filterCategory2",Array.from(r).sort(),"countCategory2"),populateMultiSelect("filterCategory3",Array.from(n).sort(),"countCategory3"),populateMultiSelect("filterSalesPerson",Array.from(o).sort(),"countSalesPerson"),populateMultiSelect("filterStore",Array.from(i).sort(),"countStore"),populateMultiSelect("filterCity",Array.from(l).sort(),"countCity"),populateMultiSelect("filterYear",Array.from(s).sort().reverse(),"countYear"),populateMultiSelect("filterMonth",Array.from(d).sort(),"countMonth"),populateMultiSelect("filterDay",Array.from(c).sort(),"countDay")}function populateMultiSelect(o,e,i){let l=document.getElementById(o);if(l){let n=Array.from(l.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value);l.innerHTML="",e.forEach(e=>{var t=document.createElement("div"),a=(t.className="checkbox-item",document.createElement("input")),r=(a.type="checkbox",a.value=e,a.id=o+"_"+e.replace(/\s+/g,"_"),a.checked=n.includes(e),document.createElement("label"));r.htmlFor=a.id,r.textContent=e,a.addEventListener("change",()=>updateSelectionCount(o,i)),t.appendChild(a),t.appendChild(r),l.appendChild(t)}),updateSelectionCount(o,i)}}function updateSelectionCount(e,t){var e=document.getElementById(e);e&&(e=e.querySelectorAll('input[type="checkbox"]:checked').length,t=document.getElementById(t))&&(t.textContent=0<e?`(${e} seÃ§ili)`:"")}function getSelectedValues(e){e=document.getElementById(e);return e?Array.from(e.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value):[]}function filterCheckboxes(e,t){e=document.getElementById(e);if(e){let a=t.toLowerCase().trim();e.querySelectorAll(".checkbox-item").forEach(e=>{var t=e.querySelector("label");t&&(t=t.textContent.toLowerCase(),""===a||t.includes(a)?e.classList.remove("hidden"):e.classList.add("hidden"))})}}function applyFilters(){let r=getSelectedValues("filterBrand"),n=getSelectedValues("filterCategory1"),t=getSelectedValues("filterCategory2"),a=getSelectedValues("filterCategory3"),o=getSelectedValues("filterSalesPerson"),i=getSelectedValues("filterStore"),l=getSelectedValues("filterCity"),s=getSelectedValues("filterYear"),d=getSelectedValues("filterMonth"),c=getSelectedValues("filterDay");console.log("ğŸ” Ã‡oklu Filtreler:",{brands:r.length,cat1s:n.length,cat2s:t.length,cat3s:a.length,salesPersons:o.length,stores:i.length,cities:l.length,years:s.length,months:d.length,days:c.length}),filteredData=allData.filter(e=>{if(0<r.length&&!r.includes(e.brand))return!1;if(0<n.length&&!n.includes(e.category_2))return!1;if(0<t.length&&!t.includes(e.category_3))return!1;if(0<a.length&&!a.includes(e.category_4))return!1;if(0<o.length&&!o.includes(e.sales_person))return!1;if(0<i.length){let t=(e.store||"").toLowerCase();if(!i.some(e=>t.includes(e.toLowerCase())))return!1}if(0<l.length&&!l.includes(e.city))return!1;if(0<s.length||0<d.length||0<c.length){if(!e.date)return!1;e=e.date.split("-");if(e.length<3)return!1;if(0<s.length&&!s.includes(e[0]))return!1;if(0<d.length&&!d.includes(e[1]))return!1;if(0<c.length&&!c.includes(e[2]))return!1}return!0}),console.log(`Filtreleme sonucu: ${filteredData.length} kayit`);var e=document.getElementById("debugPanel"),m=document.getElementById("debugInfo");if(0<filteredData.length){var g=filteredData.reduce((e,t)=>e+(parseFloat(t.usd_amount)||0),0),u=filteredData.reduce((e,t)=>e+(parseFloat(t.quantity)||0),0),p=new Set(filteredData.map(e=>e.store)).size;let t={};filteredData.forEach(e=>{e=e.date||"Bilinmeyen";t[e]=(t[e]||0)+1});var y=Object.entries(t).sort((e,t)=>t[1]-e[1]).slice(0,5);let a=`<strong>Toplam Kayit:</strong> ${allData.length.toLocaleString("tr-TR")}<br>`;a=(a=(a=(a+=`<strong>Filtrelenmis Kayit:</strong> ${filteredData.length.toLocaleString("tr-TR")}<br>`)+`<strong>Toplam USD:</strong> $${g.toLocaleString("tr-TR",{minimumFractionDigits:2})}<br>`)+`<strong>Toplam Miktar:</strong> ${u.toLocaleString("tr-TR",{minimumFractionDigits:2})}<br>`)+`<strong>Benzersiz Magaza:</strong> ${p}<br><br>`+"<strong>Aktif Filtreler:</strong><br>",0<i.length&&(a+=`- Magaza: ${i.join(", ")}<br>`),0<s.length&&(a+=`- Yil: ${s.join(", ")}<br>`),0<d.length&&(a+=`- Ay: ${d.join(", ")}<br>`),0<c.length&&(a+=`- Gun: ${c.join(", ")}<br>`),0<r.length&&(a+=`- Marka: ${r.join(", ")}<br>`),0<n.length&&(a+=`- Kategori 1: ${n.join(", ")}<br>`),a+="<br><strong>En Cok Kayit Olan 5 Gun:</strong><br>",y.forEach(([e,t])=>{a+=`- ${e}: ${t} kayit<br>`}),a+="<br><strong>Ornek Kayitlar (ilk 3):</strong><br>";for(let e=0;e<Math.min(3,filteredData.length);e++)a=(a=(a+=`<br>${e+1}. Tarih: ${filteredData[e].date} | Magaza: ${filteredData[e].store}<br>`)+`   USD: $${parseFloat(filteredData[e].usd_amount).toFixed(2)} | Miktar: ${filteredData[e].quantity}<br>`)+`   Musteri: ${filteredData[e].partner}<br>`;m.innerHTML=a,e.style.display="block"}updateSummary(),renderTable()}function resetFilters(){["filterBrand","filterCategory1","filterCategory2","filterCategory3","filterCategory4","filterSalesPerson","filterStore","filterCity","filterYear","filterMonth","filterDay"].forEach(e=>{e=document.getElementById(e);e&&e.querySelectorAll('input[type="checkbox"]').forEach(e=>e.checked=!1)}),["countBrand","countCategory1","countCategory2","countCategory3","countCategory4","countSalesPerson","countStore","countCity","countYear","countMonth","countDay"].forEach(e=>{e=document.getElementById(e);e&&(e.textContent="")}),document.getElementById("smartSearch").value="",document.getElementById("debugPanel").style.display="none",document.getElementById("aiAnalysisPanel").style.display="none",filteredData=[...allData],updateSummary(),renderTable()}function applySmartSearch(){var e=document.getElementById("smartSearch").value.trim();(e?(console.log("ğŸ¤– AI AGENT BAÅLATILIYOR..."),console.log("ğŸ“ Sorgu:",e),resetFilters(),e=analyzeQueryWithAI(e),console.log("ğŸ§  AI Analiz Sonucu:",e),applyAIFilters(e),filteredData=filterDataWithAI(allData,e),console.log(`âœ… AI Agent Sonucu: ${filteredData.length} kayÄ±t bulundu`),"basic"!==e.queryType?performAdvancedAnalysis(e,filteredData):showAIInterpretation(e,filteredData.length),updateSummary(),renderTable):resetFilters)()}function analyzeQueryWithAI(e){let n=e.toLowerCase(),o={intent:"search",queryType:"basic",entities:{stores:[],brands:[],categories:[],cities:[],salesPersons:[],products:[],dateRange:null,years:[],months:[],keywords:[]},question:{type:null,subject:null,object:null,action:null},confidence:0,interpretation:"",needsGPT:!1};var a,t=e.match(/(.+?)\s+(en\s+Ã§ok|en\s+fazla)?\s*hangi\s+(Ã¼rÃ¼n|marka|kategori|model).*?(sattÄ±|satmÄ±ÅŸ|satÄ±yor)/i),t=(t&&(o.queryType="person_analysis",o.question.type="who_sold_what",o.question.subject=t[1].trim(),o.question.object=t[3],o.question.action="sattÄ±",o.intent="analyze",console.log("ğŸ¯ Tespit: KiÅŸi analizi -",o.question.subject,"hangi",o.question.object,"sattÄ±?")),e.match(/(.+?)\s+(en\s+Ã§ok|en\s+fazla)?\s*hangi\s+(marka|model|kategori|Ã¼rÃ¼n).*?(aldÄ±|almÄ±ÅŸ|alÄ±yor|satÄ±n\s+aldÄ±)/i)),t=(t&&(o.queryType="city_analysis",o.question.type="city_bought_what",o.question.subject=t[1].trim(),o.question.object=t[3],o.question.action="aldÄ±",o.intent="analyze",console.log("ğŸ¯ Tespit: Åehir/MÃ¼ÅŸteri analizi -",o.question.subject,"hangi",o.question.object,"aldÄ±?")),e.match(/hangi\s+(maÄŸaza|ÅŸehir|yer).*?(satmalÄ±|satmalÄ±yÄ±m|satmak|konumlandÄ±r|daha\s+Ã§ok\s+sat)/i)&&(o.queryType="product_recommendation",o.question.type="where_to_sell",o.question.action="satmalÄ±",o.intent="recommendation",o.needsGPT=!0,console.log("ğŸ¯ Tespit: ÃœrÃ¼n konumlandÄ±rma Ã¶nerisi")),e.match(/(.+?)\s+iÃ§in\s+en\s+iyi\s+(maÄŸaza|ÅŸehir|yer|kategori)/i)),t=(t&&(o.queryType="product_recommendation",o.question.type="best_for",o.question.subject=t[1].trim(),o.question.object=t[2],o.intent="recommendation",console.log("ğŸ¯ Tespit: En iyi yer Ã¶nerisi -",o.question.subject,"iÃ§in")),e.match(/hangi\s+(Ã¼rÃ¼n|marka|kategori).*?(ÅŸehir|maÄŸaza|yer).*?(popÃ¼ler|Ã§ok\s+sat|baÅŸarÄ±lÄ±)/i)),r=(t&&(o.queryType="city_analysis",o.question.type="what_popular_where",o.question.object=t[1],o.intent="analyze",console.log("ğŸ¯ Tespit: PopÃ¼lerlik analizi")),[...new Set(allData.map(e=>e.store).filter(Boolean))]);r.forEach(e=>{var t=e.toLowerCase();(n.includes(t)||t.includes(n)||fuzzyMatch(n,t))&&o.entities.stores.push(e)});for(let[e,t]of Object.entries({aka:"akasya",kadi:"kadÄ±kÃ¶y","kadÄ±":"kadÄ±kÃ¶y",beylik:"beylikdÃ¼zÃ¼",beyl:"beylikdÃ¼zÃ¼"}))n.includes(e)&&(a=r.filter(e=>e.toLowerCase().includes(t)),o.entities.stores.push(...a));[...new Set(allData.map(e=>e.brand).filter(Boolean))].forEach(e=>{n.includes(e.toLowerCase())&&o.entities.brands.push(e)});let i=new Set;allData.forEach(e=>{[e.category_1,e.category_2,e.category_3,e.category_4].forEach(e=>{e&&i.add(e)})}),Array.from(i).forEach(e=>{n.includes(e.toLowerCase())&&o.entities.categories.push(e)});var l;for(let[t,e]of Object.entries({gitar:["gitar","guitar"],piyano:["piyano","piano"],davul:["davul","drum","bateri"],keman:["keman","violin"],saz:["saz","baÄŸlama"],aksesu:["aksesuar","aksesuarlar"]}))e.some(e=>n.includes(e))&&(l=Array.from(i).filter(e=>e.toLowerCase().includes(t)),o.entities.categories.push(...l));var s;for(s of[/son\s+(\d+)\s+(gÃ¼n|gun)/i,/son\s+(\d+)\s+(ay)/i,/son\s+(\d+)\s+(hafta)/i,/geÃ§en\s+(\d+)\s+(gÃ¼n|gun|ay|hafta)/i,/gecen\s+(\d+)\s+(gÃ¼n|gun|ay|hafta)/i]){var d=e.match(s);if(d){var c=parseInt(d[1]),d=d[2].toLowerCase(),m=new Date;d.includes("ay")?m.setMonth(m.getMonth()-c):d.includes("hafta")?m.setDate(m.getDate()-7*c):m.setDate(m.getDate()-c),o.entities.dateRange={from:m.toISOString().split("T")[0],to:(new Date).toISOString().split("T")[0],description:`Son ${c} `+d};break}}var g,u;for([g,u]of Object.entries({ocak:"01",january:"01",jan:"01","ÅŸubat":"02",subat:"02",february:"02",feb:"02",mart:"03",march:"03",mar:"03",nisan:"04",april:"04",apr:"04","mayÄ±s":"05",mayis:"05",may:"05",haziran:"06",june:"06",jun:"06",temmuz:"07",july:"07",jul:"07","aÄŸustos":"08",agustos:"08",august:"08",aug:"08","eylÃ¼l":"09",eylul:"09",september:"09",sep:"09",ekim:"10",october:"10",oct:"10","kasÄ±m":"11",kasim:"11",november:"11",nov:"11","aralÄ±k":"12",aralik:"12",december:"12",dec:"12"}))n.includes(g)&&o.entities.months.push(u);t=e.match(/\b(202[0-9])\b/g);t&&o.entities.years.push(...t),[...new Set(allData.map(e=>e.city).filter(Boolean))].forEach(e=>{n.includes(e.toLowerCase())&&o.entities.cities.push(e)});[...new Set(allData.map(e=>e.sales_person).filter(Boolean))].forEach(e=>{var t=e.toLowerCase(),a=n.split(/\s+/);let r=t.split(/\s+/);(a.some(t=>r.some(e=>e.includes(t)||t.includes(e)))||n.includes(t))&&o.entities.salesPersons.push(e)});var p,y=[...new Set(allData.map(e=>e.product).filter(Boolean))];for(let[t,e]of Object.entries({gitar:["gitar","guitar","elektro gitar","akustik gitar"],piyano:["piyano","piano","dijital piyano","akustik piyano"],davul:["davul","drum","bateri","davul seti"],keman:["keman","violin"],saz:["saz","baÄŸlama"],amfi:["amfi","amplifier","amplifikatÃ¶r"]}))e.some(e=>n.includes(e))&&(p=y.filter(e=>e.toLowerCase().includes(t)),o.entities.products.push(...p.slice(0,5)));let h=["ve","veya","ile","iÃ§in","son","gÃ¼n","gun","ay","yÄ±l","yil","toplam","kaÃ§","kac","ne","kadar","gÃ¶ster","goster","bul","ara"];t=e.toLowerCase().split(/\s+/).filter(e=>2<e.length&&!h.includes(e)&&!/^\d+$/.test(e));o.entities.keywords=t;let b=0;0<o.entities.stores.length&&(b+=30),0<o.entities.brands.length&&(b+=25),0<o.entities.categories.length&&(b+=20),(o.entities.dateRange||0<o.entities.years.length||0<o.entities.months.length)&&(b+=15),0<o.entities.keywords.length&&(b+=10),o.confidence=Math.min(b,100);t=[];return 0<o.entities.stores.length&&t.push("MaÄŸaza: "+o.entities.stores.join(", ")),0<o.entities.brands.length&&t.push("Marka: "+o.entities.brands.join(", ")),0<o.entities.categories.length&&t.push("Kategori: "+o.entities.categories.join(", ")),o.entities.dateRange?t.push("Tarih: "+o.entities.dateRange.description):0<o.entities.years.length&&t.push("YÄ±l: "+o.entities.years.join(", ")),0<o.entities.months.length&&t.push("Ay: "+o.entities.months.join(", ")),0<o.entities.keywords.length&&t.push("Anahtar: "+o.entities.keywords.join(", ")),o.interpretation=0<t.length?t.join(" | "):"Genel arama",o}function fuzzyMatch(e,t){e=e.split(/\s+/);let a=t.toLowerCase();return e.some(e=>!(e.length<3)&&(a.includes(e)||levenshteinDistance(e,a)<3))}function levenshteinDistance(a,r){var n=[];for(let e=0;e<=r.length;e++)n[e]=[e];for(let e=0;e<=a.length;e++)n[0][e]=e;for(let t=1;t<=r.length;t++)for(let e=1;e<=a.length;e++)r.charAt(t-1)===a.charAt(e-1)?n[t][e]=n[t-1][e-1]:n[t][e]=Math.min(n[t-1][e-1]+1,n[t][e-1]+1,n[t-1][e]+1);return n[r.length][a.length]}function applyAIFilters(a){var e;0<a.entities.stores.length&&(e=document.getElementById("filterStore"))&&(e.querySelectorAll('input[type="checkbox"]').forEach(t=>{a.entities.stores.some(e=>t.value.toLowerCase().includes(e.toLowerCase()))&&(t.checked=!0)}),updateSelectionCount("filterStore","countStore")),0<a.entities.brands.length&&(e=document.getElementById("filterBrand"))&&(e.querySelectorAll('input[type="checkbox"]').forEach(e=>{a.entities.brands.includes(e.value)&&(e.checked=!0)}),updateSelectionCount("filterBrand","countBrand")),0<a.entities.years.length&&(e=document.getElementById("filterYear"))&&(e.querySelectorAll('input[type="checkbox"]').forEach(e=>{a.entities.years.includes(e.value)&&(e.checked=!0)}),updateSelectionCount("filterYear","countYear")),0<a.entities.months.length&&(e=document.getElementById("filterMonth"))&&(e.querySelectorAll('input[type="checkbox"]').forEach(e=>{a.entities.months.includes(e.value)&&(e.checked=!0)}),updateSelectionCount("filterMonth","countMonth"))}function filterDataWithAI(e,r){return e.filter(a=>{if(0<r.entities.stores.length){let t=(a.store||"").toLowerCase();if(!r.entities.stores.some(e=>t.includes(e.toLowerCase())))return!1}if(0<r.entities.brands.length&&!r.entities.brands.includes(a.brand))return!1;if(0<r.entities.categories.length){let e=[a.category_1,a.category_2,a.category_3,a.category_4].filter(Boolean).map(e=>e.toLowerCase());if(!r.entities.categories.some(t=>e.some(e=>e.includes(t.toLowerCase())||t.toLowerCase().includes(e))))return!1}if(r.entities.dateRange&&(!a.date||a.date<r.entities.dateRange.from))return!1;if(0<r.entities.years.length&&a.date){var e=a.date.split("-")[0];if(!r.entities.years.includes(e))return!1}if(0<r.entities.months.length&&a.date){e=a.date.split("-")[1];if(!r.entities.months.includes(e))return!1}if(0<r.entities.cities.length&&!r.entities.cities.includes(a.city))return!1;if(0<r.entities.salesPersons.length&&!r.entities.salesPersons.includes(a.sales_person))return!1;if(0<r.entities.keywords.length){let t=[a.partner,a.product,a.brand,a.category_1,a.category_2,a.category_3,a.category_4,a.sales_person,a.store,a.city].filter(Boolean).join(" ").toLowerCase();if(!r.entities.keywords.some(e=>t.includes(e)))return!1}return!0})}function showAIInterpretation(e,t){var a=document.getElementById("debugPanel"),r=document.getElementById("debugInfo");let n='<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px;">';n=(n=(n=(n+='<h4 style="margin: 0 0 10px 0; color: white;">ğŸ¤– AI Agent Analizi</h4>')+`<p style="margin: 5px 0; font-size: 0.95em;"><strong>AnladÄ±ÄŸÄ±m:</strong> ${e.interpretation}</p>`)+`<p style="margin: 5px 0; font-size: 0.9em;">ğŸ“Š GÃ¼venilirlik: ${e.confidence}% | ğŸ¯ SonuÃ§: ${t} kayÄ±t</p>`)+"</div><strong>ğŸ” Tespit Edilen VarlÄ±klar:</strong><br>",0<e.entities.stores.length&&(n+=`ğŸª MaÄŸazalar: ${e.entities.stores.join(", ")}<br>`),0<e.entities.brands.length&&(n+=`ğŸ·ï¸ Markalar: ${e.entities.brands.join(", ")}<br>`),0<e.entities.categories.length&&(n+=`ğŸ“‚ Kategoriler: ${e.entities.categories.join(", ")}<br>`),e.entities.dateRange&&(n+=`ğŸ“… Tarih: ${e.entities.dateRange.description}<br>`),0<e.entities.years.length&&(n+=`ğŸ“† YÄ±l: ${e.entities.years.join(", ")}<br>`),0<e.entities.months.length&&(n+=`ğŸ“† Ay: ${e.entities.months.join(", ")}<br>`),0<e.entities.cities.length&&(n+=`ğŸŒ Åehir: ${e.entities.cities.join(", ")}<br>`),0<e.entities.salesPersons.length&&(n+=`ğŸ‘¤ SatÄ±ÅŸ Tem.: ${e.entities.salesPersons.join(", ")}<br>`),0<e.entities.keywords.length&&(n+=`ğŸ”‘ Anahtar Kelimeler: ${e.entities.keywords.join(", ")}<br>`),r.innerHTML=n,a.style.display="block"}function performAdvancedAnalysis(a,n){console.log("ğŸ¯ GeliÅŸmiÅŸ analiz baÅŸlatÄ±lÄ±yor:",a.queryType);var e=document.getElementById("debugPanel"),t=document.getElementById("debugInfo");let o='<div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 10px;">';if(o+='<h3 style="margin: 0 0 15px 0; color: white;">ğŸ¤– GeliÅŸmiÅŸ AI Analizi</h3>',"person_analysis"===a.queryType){let t=a.question.subject,r=a.question.object;var i=n.filter(e=>e.sales_person&&e.sales_person.toLowerCase().includes(t.toLowerCase()));if(0===i.length)o+=`<p>âš ï¸ "${t}" adlÄ± satÄ±ÅŸ temsilcisi bulunamadÄ±.</p>`;else{let a={};i.forEach(e=>{let t;"Ã¼rÃ¼n"===r?t=e.product:"marka"===r?t=e.brand:"kategori"===r?t=e.category_1:"model"===r&&(t=e.product),t&&(a[t]||(a[t]={sales:0,count:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].count+=1)});var l=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,5);o=(o=(o=(o+=`<p style="font-size: 1.1em; margin-bottom: 15px;">ğŸ“Š <strong>${t}</strong> analizi:</p>`)+`<p>ğŸ’° Toplam SatÄ±ÅŸ: <strong>$${i.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</strong></p>`)+`<p>ğŸ“¦ Toplam Ä°ÅŸlem: <strong>${i.length}</strong></p>`+'<hr style="border: 1px solid rgba(255,255,255,0.3); margin: 15px 0;">')+`<p style="font-size: 1.05em; margin-bottom: 10px;">ğŸ† En Ã‡ok SattÄ±ÄŸÄ± ${r.charAt(0).toUpperCase()+r.slice(1)}ler:</p>`,l.forEach((e,t)=>{o=(o=(o+='<div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 5px; margin: 8px 0;">')+`<strong>${t+1}. ${e[0]}</strong><br>`)+`ğŸ’° SatÄ±ÅŸ: $${e[1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})} | ğŸ“¦ Adet: `+e[1].count+"</div>"}),o=(o+='<hr style="border: 1px solid rgba(255,255,255,0.3); margin: 15px 0;">')+`<p style="font-size: 1em;">ğŸ’¡ <strong>Ã–neri:</strong> ${t}, <strong>${l[0][0]}</strong> konusunda uzman. Bu ${r}'e odaklanmalÄ± ve stok takibi yapmalÄ±.</p>`}}else if("city_analysis"===a.queryType){let t=a.question.subject,r=a.question.object,e=n.filter(e=>e.city&&e.city.toLowerCase().includes(t.toLowerCase()));if(0===(e=0===e.length?n.filter(e=>e.partner&&e.partner.toLowerCase().includes(t.toLowerCase())):e).length)o+=`<p>âš ï¸ "${t}" iÃ§in veri bulunamadÄ±.</p>`;else{let a={};e.forEach(e=>{let t;"marka"===r?t=e.brand:"model"===r?t=e.product:"kategori"===r?t=e.category_1:"Ã¼rÃ¼n"===r&&(t=e.product),t&&(a[t]||(a[t]={sales:0,count:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].count+=1)});i=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,5);o=(o=(o=(o+=`<p style="font-size: 1.1em; margin-bottom: 15px;">ğŸ“Š <strong>${t}</strong> analizi:</p>`)+`<p>ğŸ’° Toplam SatÄ±ÅŸ: <strong>$${e.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</strong></p>`)+`<p>ğŸ“¦ Toplam Ä°ÅŸlem: <strong>${e.length}</strong></p>`+'<hr style="border: 1px solid rgba(255,255,255,0.3); margin: 15px 0;">')+`<p style="font-size: 1.05em; margin-bottom: 10px;">ğŸ† En Ã‡ok Tercih Edilen ${r.charAt(0).toUpperCase()+r.slice(1)}ler:</p>`,i.forEach((e,t)=>{o=(o=(o+='<div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 5px; margin: 8px 0;">')+`<strong>${t+1}. ${e[0]}</strong><br>`)+`ğŸ’° SatÄ±ÅŸ: $${e[1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})} | ğŸ“¦ Adet: `+e[1].count+"</div>"}),o=(o+='<hr style="border: 1px solid rgba(255,255,255,0.3); margin: 15px 0;">')+`<p style="font-size: 1em;">ğŸ’¡ <strong>Ã–neri:</strong> ${t}'da <strong>${i[0][0]}</strong> en popÃ¼ler. Bu ${r} iÃ§in stok artÄ±rÄ±lmalÄ±.</p>`}}else if("product_recommendation"===a.queryType){o+='<p style="font-size: 1.1em; margin-bottom: 15px;">ğŸ¯ ÃœrÃ¼n KonumlandÄ±rma Ã–nerisi</p>';let r={};n.forEach(e=>{var t=e.store||"Bilinmiyor",a=e.category_1||"Bilinmiyor";r[t]||(r[t]={sales:0,count:0,categories:{}}),r[t].sales+=parseFloat(e.usd_amount||0),r[t].count+=1,r[t].categories[a]||(r[t].categories[a]=0),r[t].categories[a]+=parseFloat(e.usd_amount||0)});l=Object.entries(r).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3);o+="<p>ğŸ“Š MaÄŸaza Performans Analizi:</p>",l.forEach((e,t)=>{var a=e[0],e=e[1],r=Object.entries(e.categories).sort((e,t)=>t[1]-e[1])[0];o=(o=(o=(o=o+'<div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 5px; margin: 10px 0;">'+`<strong>${t+1}. ${a}</strong><br>`)+`ğŸ’° Toplam SatÄ±ÅŸ: $${e.sales.toLocaleString("tr-TR",{minimumFractionDigits:2})}<br>`)+`ğŸ“¦ Ä°ÅŸlem SayÄ±sÄ±: ${e.count}<br>`)+"ğŸ† En GÃ¼Ã§lÃ¼ Kategori: "+r[0]+"</div>"}),o=(o=(o=o+'<hr style="border: 1px solid rgba(255,255,255,0.3); margin: 15px 0;">'+'<p style="font-size: 1em;">ğŸ’¡ <strong>Ã–neri:</strong></p>')+`<p>â€¢ <strong>${l[0][0]}</strong> en yÃ¼ksek satÄ±ÅŸ performansÄ±na sahip.</p>`+"<p>â€¢ Yeni Ã¼rÃ¼n iÃ§in bu maÄŸazayÄ± tercih edin.</p>")+`<p>â€¢ Ã–zellikle <strong>${Object.entries(l[0][1].categories).sort((e,t)=>t[1]-e[1])[0][0]}</strong> kategorisinde gÃ¼Ã§lÃ¼.</p>`,a.needsGPT&&(o+='<hr style="border: 1px solid rgba(255,255,255,0.3); margin: 15px 0;"><p style="font-size: 0.9em; opacity: 0.9;">ğŸ¤– <em>Daha detaylÄ± analiz iÃ§in GPT-4 kullanÄ±labilir. (Ä°steÄŸe baÄŸlÄ±)</em></p>')}o+="</div>",t.innerHTML=o,e.style.display="block"}function updateSummary(){console.log("updateSummary - Filtrelenmis veri sayisi:",filteredData.length);var e=filteredData.reduce((e,t)=>e+(parseFloat(t.usd_amount)||0),0),t=filteredData.reduce((e,t)=>e+(parseFloat(t.quantity)||0),0),a=new Set(filteredData.map(e=>e.partner)).size,r=new Set(filteredData.map(e=>e.product)).size,n=(console.log("Ozet:",{totalUSD:e,totalQty:t,uniquePartners:a,uniqueProducts:r}),document.getElementById("summaryUSD")),o=document.getElementById("summaryQuantity"),i=document.getElementById("summaryPartners"),l=document.getElementById("summaryProducts");n&&(n.textContent="$"+e.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})),o&&(o.textContent=t.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})),i&&(i.textContent=a.toLocaleString("tr-TR")),l&&(l.textContent=r.toLocaleString("tr-TR")),0<filteredData.length&&performAIAnalysis()}window.handleChannelFilter=function(e){console.log("ğŸ”„ handleChannelFilter Ã§aÄŸrÄ±ldÄ±, tÄ±klanan:",e),console.log("ğŸ“Š baseData boyutu:",baseData.length),console.log("ğŸ“Š allData boyutu:",allData.length);var t=document.getElementById("channelAll").checked,a=document.getElementById("channelRetail").checked,r=document.getElementById("channelWholesale").checked,n=document.getElementById("channelOnline").checked,o=document.getElementById("channelCorporate").checked,i=document.getElementById("channelCentral").checked;console.log("âœ… Checkbox durumlarÄ±:",{channelAll:t,channelRetail:a,channelWholesale:r,channelOnline:n,channelCorporate:o,channelCentral:i}),"channelAll"===e&&t?(document.getElementById("channelRetail").checked=!1,document.getElementById("channelWholesale").checked=!1,document.getElementById("channelOnline").checked=!1,document.getElementById("channelCorporate").checked=!1,document.getElementById("channelCentral").checked=!1,activeChannels={all:!0,retail:!1,wholesale:!1,online:!1,corporate:!1,central:!1}):"channelAll"!==e&&(a||r||n||o||i)?(document.getElementById("channelAll").checked=!1,activeChannels={all:!1,retail:a,wholesale:r,online:n,corporate:o,central:i}):(t||a||r||n||o||i)&&("channelAll"!==e||t)||(document.getElementById("channelAll").checked=!0,activeChannels={all:!0,retail:!1,wholesale:!1,online:!1,corporate:!1,central:!1}),applyChannelFilter()};let topCategoryChart=null,topBrandChart=null,topProductChart=null,topSalesPersonChart=null;function renderTable(){var s=document.getElementById("tableContainer");if(s)if(0===filteredData.length)s.innerHTML='<div class="loading">âš ï¸ Filtreye uygun veri bulunamadi.</div>';else{let a={},r={},n={},o={},e=(filteredData.forEach(e=>{var t=e.category_1||"Bilinmiyor",t=(a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0),e.brand||"Bilinmiyor"),t=(r[t]||(r[t]=0),r[t]+=parseFloat(e.usd_amount||0),e.product||"Bilinmiyor"),t=(n[t]||(n[t]=0),n[t]+=parseFloat(e.usd_amount||0),e.sales_person||"Bilinmiyor");o[t]||(o[t]=0),o[t]+=parseFloat(e.usd_amount||0)}),Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10)),t=Object.entries(r).sort((e,t)=>t[1]-e[1]).slice(0,10),i=Object.entries(n).sort((e,t)=>t[1]-e[1]).slice(0,10),l=Object.entries(o).sort((e,t)=>t[1]-e[1]).slice(0,10);s.innerHTML=`
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 30px; margin-top: 30px;">
                    <div class="chart-container">
                        <h3 style="text-align: center; margin-bottom: 20px;">ğŸ† En BaÅŸarÄ±lÄ± Kategoriler</h3>
                        <canvas id="topCategoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 style="text-align: center; margin-bottom: 20px;">ğŸ·ï¸ En Ã‡ok Satan Markalar</h3>
                        <canvas id="topBrandChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 style="text-align: center; margin-bottom: 20px;">â­ En Ã‡ok Satan ÃœrÃ¼nler</h3>
                        <canvas id="topProductChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 style="text-align: center; margin-bottom: 20px;">ğŸ‘¤ En BaÅŸarÄ±lÄ± SatÄ±ÅŸ Temsilcileri</h3>
                        <canvas id="topSalesPersonChart"></canvas>
                    </div>
                </div>
            `,setTimeout(()=>{renderTopCategoryChart(e),renderTopBrandChart(t),renderTopProductChart(i),renderTopSalesPersonChart(l)},100)}}function renderTopCategoryChart(e){var t=document.getElementById("topCategoryChart");t&&(topCategoryChart&&topCategoryChart.destroy(),topCategoryChart=new Chart(t,{type:"bar",data:{labels:e.map(e=>e[0]),datasets:[{label:"SatÄ±ÅŸ ($ - KDV HariÃ§)",data:e.map(e=>e[1]),backgroundColor:"rgba(102, 126, 234, 0.8)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function renderTopBrandChart(e){var t=document.getElementById("topBrandChart");t&&(topBrandChart&&topBrandChart.destroy(),topBrandChart=new Chart(t,{type:"bar",data:{labels:e.map(e=>e[0]),datasets:[{label:"SatÄ±ÅŸ ($ - KDV HariÃ§)",data:e.map(e=>e[1]),backgroundColor:"rgba(56, 239, 125, 0.8)",borderColor:"rgba(56, 239, 125, 1)",borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function renderTopProductChart(t){var e=document.getElementById("topProductChart");e&&(topProductChart&&topProductChart.destroy(),topProductChart=new Chart(e,{type:"bar",data:{labels:t.map(e=>e[0].substring(0,30)+(30<e[0].length?"...":"")),datasets:[{label:"SatÄ±ÅŸ ($ - KDV HariÃ§)",data:t.map(e=>e[1]),backgroundColor:"rgba(245, 87, 108, 0.8)",borderColor:"rgba(245, 87, 108, 1)",borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(e){return t[e[0].dataIndex][0]}}}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function renderTopSalesPersonChart(e){var t=document.getElementById("topSalesPersonChart");t&&(topSalesPersonChart&&topSalesPersonChart.destroy(),topSalesPersonChart=new Chart(t,{type:"bar",data:{labels:e.map(e=>e[0]),datasets:[{label:"SatÄ±ÅŸ ($ - KDV HariÃ§)",data:e.map(e=>e[1]),backgroundColor:"rgba(240, 147, 251, 0.8)",borderColor:"rgba(240, 147, 251, 1)",borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function switchTab(e){console.log("ğŸ”„ switchTab Ã§aÄŸrÄ±ldÄ±:",e);document.querySelectorAll(".tab-content").forEach(e=>{e.classList.remove("active")});var t=document.querySelectorAll(".tab"),a=(t.forEach(e=>{e.classList.remove("active")}),document.getElementById(e+"Tab")),a=(console.log("ğŸ” Aranan tab ID:",e+"Tab","| Bulundu mu?",a?"EVET":"HAYIR"),a?(a.classList.add("active"),console.log("âœ… Tab aktif edildi:",e+"Tab")):console.error("âŒ Tab bulunamadÄ±:",e+"Tab"),{dashboard:0,targets:1,customers:2,salesperson:3,store:4,city:5,stock:6,time:7,product:8});void 0!==a[e]&&t[a[e]].classList.add("active"),"dashboard"===e?loadDashboard():"targets"===e?loadAllStoresTargets():"customers"===e?analyzeCustomers():"time"===e?analyzeTime():"city"===e?(console.log("ğŸŒ Åehir analizi sekmesi aÃ§Ä±lÄ±yor..."),console.log("ğŸ“Š allData durumu:",allData?allData.length+" kayÄ±t":"HenÃ¼z yÃ¼klenmedi"),allData&&0<allData.length?populateCitySelect():(console.warn("âš ï¸ Veriler henÃ¼z yÃ¼klenmedi, ÅŸehir listesi doldurulamÄ±yor"),setTimeout(()=>{allData&&0<allData.length&&(console.log("ğŸ”„ Veri yÃ¼klendi, ÅŸehir listesi yeniden dolduruluyor..."),populateCitySelect())},2e3))):"stock"===e&&(console.log("ğŸ“¦ Stok daÄŸÄ±lÄ±m sekmesi aÃ§Ä±lÄ±yor..."),inventoryData?console.log("âœ… Envanter verileri zaten yÃ¼klÃ¼"):(console.log("ğŸ”„ Envanter verileri lazy loading ile yÃ¼kleniyor..."),loadInventoryData()))}function exportToExcel(){var e,t;0===filteredData.length?alert("âš ï¸ DÄ±ÅŸa aktarÄ±lacak veri yok!"):(console.log("ğŸ“¥ Excel export baÅŸlatÄ±lÄ±yor..."),t=filteredData.map(e=>({"Ä°ÅŸ OrtaÄŸÄ±":e.partner||"","ÃœrÃ¼n":e.product||"",Marka:e.brand||"","Kategori 1":e.category_2||"","Kategori 2":e.category_3||"","Kategori 3":e.category_4||"","SatÄ±ÅŸ Temsilcisi":e.sales_person||"","MaÄŸaza":e.store||"","Åehir":e.city||"",Tarih:e.date||"",Miktar:parseFloat(e.quantity||0),"USD (KDV HariÃ§)":parseFloat(e.usd_amount||0)})),e={"Ä°ÅŸ OrtaÄŸÄ±":"TOPLAM","ÃœrÃ¼n":"",Marka:"","Kategori 1":"","Kategori 2":"","Kategori 3":"","SatÄ±ÅŸ Temsilcisi":"","MaÄŸaza":"","Åehir":"",Tarih:"",Miktar:filteredData.reduce((e,t)=>e+parseFloat(t.quantity||0),0),"USD (KDV HariÃ§)":filteredData.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0)},t.push(e),e=XLSX.utils.book_new(),(t=XLSX.utils.json_to_sheet(t))["!cols"]=[{wch:30},{wch:40},{wch:15},{wch:20},{wch:20},{wch:20},{wch:20},{wch:30},{wch:15},{wch:12},{wch:12},{wch:18}],XLSX.utils.book_append_sheet(e,t,"SatÄ±ÅŸ Verileri"),t=`Satis_Analizi_${(new Date).toISOString().split("T")[0]}.xlsx`,XLSX.writeFile(e,t),console.log("âœ… Excel dosyasÄ± indirildi: "+t),alert(`âœ… ${filteredData.length} kayÄ±t Excel'e aktarÄ±ldÄ±!
Dosya: `+t))}let recognition=null,isListening=!1;function startVoiceSearch(){if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){var t=window.SpeechRecognition||window.webkitSpeechRecognition;if(isListening)recognition&&recognition.stop();else{(recognition=new t).lang="tr-TR",recognition.continuous=!1,recognition.interimResults=!1;let e=document.getElementById("voiceBtn");recognition.onstart=()=>{isListening=!0,e.classList.add("listening"),e.textContent="ğŸ™ï¸",console.log("ğŸ¤ Dinleniyor...")},recognition.onresult=e=>{e=e.results[0][0].transcript;console.log("ğŸ—£ï¸ AlgÄ±lanan:",e),document.getElementById("smartSearch").value=e,applySmartSearch()},recognition.onerror=e=>{console.error("âŒ Ses tanÄ±ma hatasÄ±:",e.error),"no-speech"===e.error?alert("âš ï¸ Ses algÄ±lanamadÄ±. LÃ¼tfen tekrar deneyin."):"not-allowed"===e.error&&alert("âš ï¸ Mikrofon izni verilmedi. LÃ¼tfen tarayÄ±cÄ± ayarlarÄ±ndan mikrofon izni verin.")},recognition.onend=()=>{isListening=!1,e.classList.remove("listening"),e.textContent="ğŸ¤",console.log("ğŸ¤ Dinleme bitti")},recognition.start()}}else alert("âš ï¸ TarayÄ±cÄ±nÄ±z ses tanÄ±ma Ã¶zelliÄŸini desteklemiyor!\nChrome veya Edge kullanÄ±n.")}let targetChart=null;function saveYearlyTarget(){var a=document.getElementById("targetYear").value,r=document.getElementById("targetYearStore").value,n=parseFloat(document.getElementById("yearlyTarget").value)||0;if(console.log("ğŸ’¾ saveYearlyTarget Ã§aÄŸrÄ±ldÄ±:",{year:a,store:r,target:n}),n<=0)alert("âš ï¸ LÃ¼tfen geÃ§erli bir hedef girin!");else{let e=JSON.parse(localStorage.getItem("yearlyTargets")||"{}"),t=(console.log("ğŸ“‚ Mevcut localStorage:",e),!1);for(var[o,i]of Object.entries(e))if("number"==typeof i){t=!0,console.warn("âš ï¸ Eski localStorage formatÄ± tespit edildi! Otomatik temizleniyor...");break}if(t){var l,s,d={};for([l,s]of Object.entries(e))"number"==typeof s?(d[l]={"TÃœM MAÄAZALAR":s},console.log(`ğŸ”„ ${l} yÄ±lÄ± formatÄ± gÃ¼ncellendi:`,s,"â†’",d[l])):d[l]=s;e=d,localStorage.setItem("yearlyTargets",JSON.stringify(e)),console.log("âœ… Eski format temizlendi ve yeni formata dÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼!")}e[a]||(e[a]={}),e[a][r]=n,localStorage.setItem("yearlyTargets",JSON.stringify(e)),console.log("âœ… localStorage'a kaydedildi:",e),console.log("ğŸ” Kontrol: localStorage.getItem:",localStorage.getItem("yearlyTargets")),calculateTargets(),alert(`âœ… ${a} yÄ±lÄ± ${"TÃœM MAÄAZALAR"===r?"TÃ¼m MaÄŸazalar":r} hedefi kaydedildi: $`+n.toLocaleString("tr-TR",{minimumFractionDigits:2}))}}function loadAllStoresTargets(){let d=document.getElementById("targetFilterYear").value,c=document.getElementById("targetFilterMonth").value||"";var e=document.getElementById("allStoresTargetsContainer");console.log("ğŸ“Š TÃ¼m maÄŸazalar hedef listesi yÃ¼kleniyor:",{year:d,month:c,monthType:typeof c,monthLength:c.length});let t=new Set;allData.forEach(e=>{e.store&&"Analitik"!==e.store&&!e.store.toLowerCase().includes("eÄŸitim")&&t.add(e.store)});var a=Array.from(t).sort().map(t=>{var e=t.replace(/^\[\d+\]\s*/,"");let a=0;function r(e,t){if(e){if(e[t])return t;var a,r=t.toLowerCase();for(a of Object.keys(e)){var n=a.toLowerCase();if(n.includes(r)||r.includes(n))return a}}return null}c?0===(a=centralTargets.monthly&&centralTargets.monthly[d]&&(o=r(centralTargets.monthly[d],e))&&centralTargets.monthly[d][o]&&centralTargets.monthly[d][o][c]?centralTargets.monthly[d][o][c]:a)&&(o=JSON.parse(localStorage.getItem("monthlyTargets")||"{}"))[d]&&(n=r(o[d],e))&&o[d][n][c]&&(a=o[d][n][c]):0===(a=centralTargets.yearly&&centralTargets.yearly[d]&&(o=r(centralTargets.yearly[d],e))?centralTargets.yearly[d][o]:a)&&(n=JSON.parse(localStorage.getItem("yearlyTargets")||"{}"))[d]&&(o=r(n[d],e))&&(a=n[d][o]);var e=allData.filter(e=>e.store===t&&!!e.date&&(c?e.date.startsWith(d+"-"+c):e.date.startsWith(d))).reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),n=0<a?e/a*100:0,o=a-e,i=new Date;let l=0;var s=0<(l=c?(s=new Date(d,parseInt(c),0),Math.max(0,Math.ceil((s-i)/864e5))):(s=new Date(d,11,31),Math.max(0,Math.ceil((s-i)/864e5))))?o/l:0;return{name:t,target:a,achieved:e,percentage:n,remaining:o,daysLeft:l,dailyRequired:s}}),r=a.filter(e=>0<e.target),n=a.filter(e=>0===e.target),o=(r.sort((e,t)=>t.percentage-e.percentage),n.sort((e,t)=>e.name.localeCompare(t.name,"tr")),[...r,...n]);console.log(`ğŸ“Š Toplam ${a.length} maÄŸaza, ${r.length} hedefli, ${n.length} hedefsiz`);let i='<div style="margin-bottom: 20px; text-align: center;">';i=(i=(i=(i+='<h3 style="margin: 0; font-size: 1.5em;">')+(c?d+" - "+["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"][parseInt(c)-1]+" DÃ¶nemi":d+" YÄ±lÄ±")+" MaÄŸaza Hedef DurumlarÄ±</h3>")+'<p style="color: #6c757d; margin-top: 5px;">Toplam '+o.length+" maÄŸaza</p>")+'</div><div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">',o.forEach(t=>{if(0===t.target)i=(i=(i=(i=(i+='<div class="storeCard" style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%); border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); color: white; opacity: 0.7;">')+'<h3 style="margin: 0 0 15px 0; font-size: 1.5em; color: white;">'+t.name+"</h3>")+'<div style="text-align: center; padding: 40px 0;"><div style="font-size: 3em; margin-bottom: 10px;">ğŸ“Š</div>')+'<div style="font-size: 1.1em; opacity: 0.9; margin-bottom: 10px;">Hedef TanÄ±mlanmamÄ±ÅŸ</div><div style="font-size: 1.3em; font-weight: 600; margin-top: 15px;">')+"GerÃ§ekleÅŸme: $"+t.achieved.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})+"</div></div></div>";else{var a,r,n=130<=(n=t.percentage)?"#10b981":100<=n?"#22c55e":85<=n?"#f59e0b":"#ef4444";let e="";e=130<=t.percentage?(e=(e=(e=(e=(e=(e=(e=(e=(e='<div style="text-align: center; margin-bottom: 20px;">')+'<div style="font-size: 3em; font-weight: bold; margin-bottom: 5px;">'+t.percentage.toFixed(1)+'%</div><div style="font-size: 0.9em; opacity: 0.9;">GerÃ§ekleÅŸme</div>')+'</div><div style="text-align: center; font-size: 1.8em; margin: 20px 0;">ğŸ† TÃ¼m Hedefler TamamlandÄ±!</div>')+'<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-top: 15px;"><div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">ğŸ“Š GerÃ§ekleÅŸen</div>')+'<div style="font-size: 1.5em; font-weight: bold;">$'+t.achieved.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})+"</div>")+'</div><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; font-size: 0.9em;">')+'<div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px;"><div style="opacity: 0.9; margin-bottom: 3px;">ğŸ¯ %100 Hedef</div>')+'<div style="font-weight: bold;">$'+t.target.toLocaleString("tr-TR",{minimumFractionDigits:2})+"</div></div>")+'<div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px;"><div style="opacity: 0.9; margin-bottom: 3px;">ğŸ† %130 Hedef</div>')+'<div style="font-weight: bold;">$'+(1.3*t.target).toLocaleString("tr-TR",{minimumFractionDigits:2})+"</div></div></div>":100<=t.percentage?(a=1.3*t.target-t.achieved,r=0<t.daysLeft?a/t.daysLeft:0,(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e='<div style="text-align: center; margin-bottom: 20px;">')+'<div style="font-size: 3em; font-weight: bold; margin-bottom: 5px;">'+t.percentage.toFixed(1)+'%</div><div style="font-size: 0.9em; opacity: 0.9;">GerÃ§ekleÅŸme</div>')+'</div><div style="text-align: center; font-size: 1.5em; margin: 15px 0; font-weight: bold;">âœ… Hedef GerÃ§ekleÅŸti!</div>')+'<div style="font-size: 0.95em; opacity: 0.95; margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.15); border-radius: 10px;"><div style="margin-bottom: 8px;">ğŸ¯ <strong>%130 Hedefi iÃ§in:</strong></div>')+'<div style="margin-bottom: 5px;">ğŸ“Š GerÃ§ekleÅŸen: <strong>$'+t.achieved.toLocaleString("tr-TR",{minimumFractionDigits:2})+"</strong></div>")+'<div style="margin-bottom: 5px;">ğŸ“ˆ Kalan: <strong>$'+a.toLocaleString("tr-TR",{minimumFractionDigits:2})+"</strong></div>")+'<div style="margin-bottom: 5px;">ğŸ“… Kalan GÃ¼n: <strong>'+t.daysLeft+"</strong></div>")+"<div>ğŸ’° GÃ¼nlÃ¼k Gerekli: <strong>$"+r.toLocaleString("tr-TR",{minimumFractionDigits:2})+"</strong></div>")+'</div><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">')+'<div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 10px;"><div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ğŸ¯ %100 Hedef</div>')+'<div style="font-size: 1.1em; font-weight: bold;">$'+t.target.toLocaleString("tr-TR",{minimumFractionDigits:2})+"</div></div>")+'<div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 10px;"><div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ğŸ† %130 Hedef</div>')+'<div style="font-size: 1.1em; font-weight: bold;">$'+(1.3*t.target).toLocaleString("tr-TR",{minimumFractionDigits:2})+"</div></div></div>"):(e='<div style="text-align: center; margin-bottom: 20px;">',(e=(e=(e=(e=(e=(e=(e=(e+='<div style="font-size: 3em; font-weight: bold; margin-bottom: 5px;">'+t.percentage.toFixed(1)+"%</div>")+'<div style="font-size: 0.9em; opacity: 0.9;">GerÃ§ekleÅŸme</div></div>')+'<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: left;"><div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">ğŸ“Š GerÃ§ekleÅŸen</div>')+'<div style="font-size: 1.6em; font-weight: bold;">$'+t.achieved.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})+"</div>")+'</div><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">')+'<div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 10px;"><div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ğŸ¯ %100 Hedef</div>')+'<div style="font-size: 1.1em; font-weight: bold;">$'+t.target.toLocaleString("tr-TR",{minimumFractionDigits:2})+"</div></div>")+'<div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 10px;"><div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ğŸ† %130 Hedef</div>')+'<div style="font-size: 1.1em; font-weight: bold;">$'+(1.3*t.target).toLocaleString("tr-TR",{minimumFractionDigits:2})+"</div></div></div>"),i=(i=(i+='<div style="background: '+n+'; color: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">')+('<h3 style="margin: 0 0 20px 0; font-size: 1.3em; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px;">ğŸª '+t.name+"</h3>"))+e+"</div>"}}),i+="</div>",0===o.length&&(i=`
                    <div style="text-align: center; padding: 60px; background: #f8f9fa; border-radius: 15px;">
                        <div style="font-size: 4em; margin-bottom: 20px;">ğŸ“Š</div>
                        <h3 style="color: #6c757d; margin-bottom: 10px;">Hedef BulunamadÄ±</h3>
                        <p style="color: #adb5bd;">SeÃ§ili dÃ¶nem iÃ§in hiÃ§bir maÄŸazaya hedef tanÄ±mlanmamÄ±ÅŸ</p>
                    </div>
                `),console.log(`ğŸ“Š HTML oluÅŸturuldu, container bulundu: ${!!e}, HTML uzunluÄŸu: `+i.length),console.log("ğŸ“Š HTML baÅŸlangÄ±cÄ±:",i.substring(0,200));try{e.innerHTML=i,console.log("âœ… HTML container'a yazÄ±ldÄ±!")}catch(e){console.error("âŒ HTML yazma hatasÄ±:",e),console.log("âŒ HatalÄ± HTML:",i.substring(0,500))}}function loadYearlyTarget(){var t=document.getElementById("targetYear"),a=document.getElementById("targetYearStore");if(t&&a){var t=t.value,a=a.value,r=a.replace(/\[.*?\]\s*/g,"").replace(/^.*?\s-\s/,"").trim();let e=null;e||(n=JSON.parse(localStorage.getItem("yearlyTargets")||"{}")[t]||{},e=n[a]);var n={[a]:e},t=(console.log("ğŸ“Š loadYearlyTarget Ã§aÄŸrÄ±ldÄ±:",{year:t,store:a,cleanStoreName:r,yearlyTarget:e}),document.getElementById("yearlyTarget"));t.value="",n[a]?(t.value=n[a],console.log("âœ… YÄ±llÄ±k hedef yÃ¼klendi (Google Sheets):",n[a])):console.log("âš ï¸ Bu maÄŸaza iÃ§in kaydedilmiÅŸ hedef yok"),calculateTargets()}else console.log("â„¹ï¸ Eski hedef sistemi elementleri bulunamadÄ±, yeni sistem kullanÄ±lÄ±yor")}function saveMonthlyTarget(){var e,t=document.getElementById("targetYear").value,a=document.getElementById("targetMonth").value,r=document.getElementById("targetMonthStore").value,n=parseFloat(document.getElementById("monthlyTarget").value)||0;console.log("ğŸ’¾ saveMonthlyTarget Ã§aÄŸrÄ±ldÄ±:",{year:t,month:a,store:r,target:n}),n<=0?alert("âš ï¸ LÃ¼tfen geÃ§erli bir hedef girin!"):(e=JSON.parse(localStorage.getItem("monthlyTargets")||"{}"),console.log("ğŸ“‚ Mevcut aylÄ±k localStorage:",e),e[t]||(e[t]={}),e[t][r]||(e[t][r]={}),e[t][r][a]=n,localStorage.setItem("monthlyTargets",JSON.stringify(e)),console.log("âœ… AylÄ±k localStorage'a kaydedildi:",e),calculateTargets(),alert(`âœ… ${t} ${{"01":"Ocak","02":"Åubat","03":"Mart","04":"Nisan","05":"MayÄ±s","06":"Haziran","07":"Temmuz","08":"AÄŸustos","09":"EylÃ¼l",10:"Ekim",11:"KasÄ±m",12:"AralÄ±k"}[a]} ${"TÃœM MAÄAZALAR"===r?"TÃ¼m MaÄŸazalar":r} hedefi kaydedildi: $`+n.toLocaleString("tr-TR",{minimumFractionDigits:2})))}function loadMonthlyTarget(){var e,t,a=document.getElementById("targetYear"),r=document.getElementById("targetMonth"),n=document.getElementById("targetMonthStore");a&&r&&n?(a=a.value,r=r.value,(n=n.value).replace(/\[.*?\]\s*/g,"").replace(/^.*?\s-\s/,"").trim(),t=e=JSON.parse(localStorage.getItem("monthlyTargets")||"{}")[a]?.[n]?.[r],console.log("ğŸ“Š loadMonthlyTarget Ã§aÄŸrÄ±ldÄ±:",{year:a,month:r,store:n,localTarget:e}),(a=document.getElementById("monthlyTarget")).value="",t?(a.value=t,console.log("âœ… AylÄ±k hedef yÃ¼klendi (localStorage):",t)):console.log("âš ï¸ Bu maÄŸaza ve ay iÃ§in kaydedilmiÅŸ hedef yok"),calculateTargets()):console.log("â„¹ï¸ Eski hedef sistemi elementleri bulunamadÄ±, yeni sistem kullanÄ±lÄ±yor")}function calculateTargets(){populateTargetStoreDropdowns();let a=document.getElementById("targetYear").value,r=document.getElementById("targetMonth").value,n=document.getElementById("targetYearStore").value,o=document.getElementById("targetMonthStore").value;var e=parseFloat(document.getElementById("yearlyTarget").value)||0,t=parseFloat(document.getElementById("monthlyTarget").value)||0,i=allData.filter(e=>{var t;return!!e.date&&(t=e.date.startsWith(a),e="TÃœM MAÄAZALAR"===n||e.store===n,t)&&e}).reduce((e,t)=>e+parseFloat(t.usd_amount||0),0);0<e?(l=Math.max(0,e-i),e=i/e*100,d=new Date,s=new Date(a,11,31),d=0<(s=Math.max(0,Math.ceil((s-d)/864e5)))?l/s:0,document.getElementById("yearlyProgress").style.width=Math.min(100,e)+"%",document.getElementById("yearlyProgress").textContent=e.toFixed(1)+"%",document.getElementById("yearlyAchieved").textContent="$"+i.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("yearlyRemaining").textContent="$"+l.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("yearlyDaysLeft").textContent=s,document.getElementById("yearlyDailyRequired").textContent="$"+d.toLocaleString("tr-TR",{minimumFractionDigits:2})):(document.getElementById("yearlyProgress").style.width="0%",document.getElementById("yearlyProgress").textContent="0%",document.getElementById("yearlyAchieved").textContent="$"+i.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("yearlyRemaining").textContent="$0,00",document.getElementById("yearlyDaysLeft").textContent="-",document.getElementById("yearlyDailyRequired").textContent="$0,00");var l,s,d,e=allData.filter(e=>{var t;return!!e.date&&(t=(t=e.date.split("-"))[0]===a&&t[1]===r,e="TÃœM MAÄAZALAR"===o||e.store===o,t)&&e}).reduce((e,t)=>e+parseFloat(t.usd_amount||0),0);0<t?(l=Math.max(0,t-e),s=e/t*100,d=new Date,i=new Date(a,parseInt(r),0),i=0<(t=Math.max(0,Math.ceil((i-d)/864e5)))?l/t:0,document.getElementById("monthlyProgress").style.width=Math.min(100,s)+"%",document.getElementById("monthlyProgress").textContent=s.toFixed(1)+"%",document.getElementById("monthlyAchieved").textContent="$"+e.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("monthlyRemaining").textContent="$"+l.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("monthlyDaysLeft").textContent=t,document.getElementById("monthlyDailyRequired").textContent="$"+i.toLocaleString("tr-TR",{minimumFractionDigits:2})):(document.getElementById("monthlyProgress").style.width="0%",document.getElementById("monthlyProgress").textContent="0%",document.getElementById("monthlyAchieved").textContent="$"+e.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("monthlyRemaining").textContent="$0,00",document.getElementById("monthlyDaysLeft").textContent="-",document.getElementById("monthlyDailyRequired").textContent="$0,00"),renderTargetChart()}function renderTargetChart(){var e=document.getElementById("targetChart");if(e){var t=["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"];let r=document.getElementById("targetYear").value,n=document.getElementById("targetYearStore").value;var a=t.map((e,t)=>{let a=String(t+1).padStart(2,"0");return allData.filter(e=>{var t;return!!e.date&&(t=(t=e.date.split("-"))[0]===r&&t[1]===a,e="TÃœM MAÄAZALAR"===n||e.store===n,t)&&e}).reduce((e,t)=>e+parseFloat(t.usd_amount||0),0)});targetChart&&targetChart.destroy(),targetChart=new Chart(e,{type:"bar",data:{labels:t,datasets:[{label:"AylÄ±k SatÄ±ÅŸ (USD)",data:a,backgroundColor:"rgba(102, 126, 234, 0.8)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:r+" YÄ±lÄ± AylÄ±k SatÄ±ÅŸ PerformansÄ± "+("TÃœM MAÄAZALAR"!==n?"("+n+")":""),font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}let customerCityChart=null,customerTrendChart=null;function analyzeCustomers(){let a={};var e=new Date;let t=new Date(e.getTime()-7776e6);allData.forEach(e=>{var t=e.partner;t&&(a[t]||(a[t]={name:t,totalSales:0,orderCount:0,city:e.city||"Bilinmiyor",lastOrderDate:e.date||""}),a[t].totalSales+=parseFloat(e.usd_amount||0),a[t].orderCount+=1,e.date)&&e.date>a[t].lastOrderDate&&(a[t].lastOrderDate=e.date)});var e=Object.values(a).sort((e,t)=>t.totalSales-e.totalSales),r=e.length,n=e.filter(e=>!!e.lastOrderDate&&new Date(e.lastOrderDate)>=t).length,o=e.reduce((e,t)=>e+t.totalSales,0)/r,i=0<e.length?e[0].totalSales:0;document.getElementById("totalCustomers").textContent=r.toLocaleString("tr-TR"),document.getElementById("activeCustomers").textContent=n.toLocaleString("tr-TR"),document.getElementById("avgOrderValue").textContent="$"+o.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("maxOrderValue").textContent="$"+i.toLocaleString("tr-TR",{minimumFractionDigits:2}),renderTopCustomers(e.slice(0,30)),renderCustomerCityChart(e),renderCustomerTrendChart()}function renderTopCustomers(e){let r=document.getElementById("topCustomersGrid");r.innerHTML="",e.forEach((e,t)=>{var a=document.createElement("div");a.className="customer-card",a.innerHTML=`
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <span class="customer-rank">${t+1}</span>
                        <div style="flex: 1;">
                            <h4 style="margin: 0; font-size: 1.1em;">${e.name}</h4>
                            <p style="margin: 5px 0 0 0; color: #6c757d; font-size: 0.9em;">ğŸ“ ${e.city}</p>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                            <p style="margin: 0; font-size: 0.85em; color: #6c757d;">Toplam SatÄ±ÅŸ</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.2em; font-weight: 700; color: #667eea;">$${e.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                            <p style="margin: 0; font-size: 0.85em; color: #6c757d;">SipariÅŸ SayÄ±sÄ±</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.2em; font-weight: 700; color: #764ba2;">${e.orderCount}</p>
                        </div>
                    </div>
                `,r.appendChild(a)})}function renderCustomerCityChart(e){var a=document.getElementById("customerCityChart");if(a){let t={};e.forEach(e=>{e=e.city||"Bilinmiyor";t[e]=(t[e]||0)+1});e=Object.entries(t).sort((e,t)=>t[1]-e[1]).slice(0,10);customerCityChart&&customerCityChart.destroy(),customerCityChart=new Chart(a,{type:"doughnut",data:{labels:e.map(e=>e[0]),datasets:[{data:e.map(e=>e[1]),backgroundColor:["rgba(102, 126, 234, 0.8)","rgba(118, 75, 162, 0.8)","rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)","rgba(255, 206, 86, 0.8)","rgba(75, 192, 192, 0.8)","rgba(153, 102, 255, 0.8)","rgba(255, 159, 64, 0.8)","rgba(199, 199, 199, 0.8)","rgba(83, 102, 255, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"},datalabels:{color:"#fff",font:{weight:"bold",size:14},formatter:(e,t)=>(100*e/t.chart.data.datasets[0].data.reduce((e,t)=>e+t,0)).toFixed(1)+"%"}}},plugins:[ChartDataLabels]})}}function renderCustomerTrendChart(){var e=document.getElementById("customerTrendChart");if(e){console.log("ğŸ“Š YÄ±llÄ±k MÃ¼ÅŸteri Trendi oluÅŸturuluyor...");let a={},r=new Set;allData.forEach(e=>{var t;e.date&&e.partner&&(t=e.date.substring(0,4),r.add(t),a[t]||(a[t]=new Set),a[t].add(e.partner))});var t=Array.from(r).sort(),o=t.map(e=>a[e].size);console.log("ğŸ“Š YÄ±llar:",t),console.log("ğŸ“Š MÃ¼ÅŸteri sayÄ±larÄ±:",o),customerTrendChart&&customerTrendChart.destroy();let n=["rgba(102, 126, 234, 0.8)","rgba(250, 112, 154, 0.8)","rgba(56, 239, 125, 0.8)","rgba(255, 193, 7, 0.8)","rgba(245, 87, 108, 0.8)","rgba(72, 219, 251, 0.8)"];customerTrendChart=new Chart(e,{type:"bar",data:{labels:t,datasets:[{label:"Aktif MÃ¼ÅŸteri SayÄ±sÄ±",data:o,backgroundColor:t.map((e,t)=>n[t%n.length]),borderColor:t.map((e,t)=>n[t%n.length].replace("0.8","1")),borderWidth:2,borderRadius:10,barThickness:60}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:3,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return"MÃ¼ÅŸteri: "+e.parsed.y.toLocaleString("tr-TR")}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return e.toLocaleString("tr-TR")}}}},animation:{duration:1e3,easing:"easeInOutQuart"}},plugins:[ChartDataLabels]}),console.log("âœ… YÄ±llÄ±k MÃ¼ÅŸteri Trendi grafiÄŸi oluÅŸturuldu")}}function performAIAnalysis(){console.log("ğŸ¤– AI Analiz baÅŸlatÄ±lÄ±yor...");var e,t=document.getElementById("aiAnalysisPanel");t&&0!==filteredData.length&&(e=generateInsights(analyzeData(filteredData)),e=`
                <div class="analysis-panel">
                    <h2 style="margin: 0 0 20px 0; font-size: 2em;">ğŸ¤– AI Analiz & Ã–neriler</h2>
                    <p style="opacity: 0.9; margin-bottom: 20px;">Filtrelenen ${filteredData.length.toLocaleString("tr-TR")} kayÄ±t Ã¼zerinden yapÄ±lan akÄ±llÄ± analiz sonuÃ§larÄ±</p>
                    
                    ${0<e.positive.length?`
                    <div class="analysis-section">
                        <h3>âœ… Olumlu Tespitler</h3>
                        ${e.positive.map(e=>`
                            <div class="insight-item insight-positive">
                                <span class="insight-icon">âœ…</span>
                                <strong>${e.title}</strong><br>
                                ${e.description}
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<e.negative.length?`
                    <div class="analysis-section">
                        <h3>âš ï¸ Dikkat Edilmesi Gerekenler</h3>
                        ${e.negative.map(e=>`
                            <div class="insight-item insight-negative">
                                <span class="insight-icon">âš ï¸</span>
                                <strong>${e.title}</strong><br>
                                ${e.description}
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<e.neutral.length?`
                    <div class="analysis-section">
                        <h3>ğŸ’¡ Ã–nemli Bilgiler</h3>
                        ${e.neutral.map(e=>`
                            <div class="insight-item insight-neutral">
                                <span class="insight-icon">ğŸ’¡</span>
                                <strong>${e.title}</strong><br>
                                ${e.description}
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    <div class="analysis-section">
                        <h3>ğŸ¯ Aksiyon Ã–nerileri</h3>
                        ${e.recommendations.map(e=>`
                            <div class="recommendation">
                                <span class="recommendation-icon">${e.icon}</span>
                                <div>
                                    <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                    <p style="margin: 10px 0 0 0; opacity: 0.95;">${e.description}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `,t.innerHTML=e,t.style.display="block")}function analyzeData(e){var t=e.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),a=e.reduce((e,t)=>e+parseFloat(t.quantity||0),0),r=t/e.length;let n={},o=(e.forEach(e=>{var t=e.store||"Bilinmiyor";n[t]||(n[t]={sales:0,count:0,qty:0}),n[t].sales+=parseFloat(e.usd_amount||0),n[t].count+=1,n[t].qty+=parseFloat(e.quantity||0)}),{}),i=(e.forEach(e=>{var t=e.brand||"Bilinmiyor";o[t]||(o[t]={sales:0,count:0}),o[t].sales+=parseFloat(e.usd_amount||0),o[t].count+=1}),{}),l=(e.forEach(e=>{var t=e.category_1||"Bilinmiyor";i[t]||(i[t]={sales:0,count:0}),i[t].sales+=parseFloat(e.usd_amount||0),i[t].count+=1}),{}),s=(e.forEach(e=>{var t=e.partner||"Bilinmiyor";l[t]||(l[t]={sales:0,count:0}),l[t].sales+=parseFloat(e.usd_amount||0),l[t].count+=1}),{}),d=(e.forEach(e=>{var t=e.sales_person||"Bilinmiyor";s[t]||(s[t]={sales:0,count:0}),s[t].sales+=parseFloat(e.usd_amount||0),s[t].count+=1}),{});e.forEach(e=>{var t;e.date&&(t=e.date.substring(0,7),d[t]||(d[t]={sales:0,count:0}),d[t].sales+=parseFloat(e.usd_amount||0),d[t].count+=1)});var c=Object.entries(n).sort((e,t)=>t[1].sales-e[1].sales),m=Object.entries(o).sort((e,t)=>t[1].sales-e[1].sales),g=Object.entries(i).sort((e,t)=>t[1].sales-e[1].sales),u=Object.entries(l).sort((e,t)=>t[1].sales-e[1].sales),p=Object.entries(s).sort((e,t)=>t[1].sales-e[1].sales);return{totalUSD:t,totalQty:a,avgOrderValue:r,recordCount:e.length,storeData:n,brandData:o,categoryData:i,customerData:l,salesPersonData:s,dateData:d,topStores:c,topBrands:m,topCategories:g,topCustomers:u,topSalesPersons:p}}function generateInsights(r){var e,t,a={positive:[],negative:[],neutral:[],recommendations:[]},n=(0<r.topStores.length&&30<(e=((t=r.topStores[0])[1].sales/r.totalUSD*100).toFixed(1))&&a.positive.push({title:"En BaÅŸarÄ±lÄ± MaÄŸaza: "+t[0],description:`<span class="metric-highlight">$${t[1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</span> satÄ±ÅŸ ile toplam satÄ±ÅŸlarÄ±n <span class="metric-highlight">%${e}</span>'ini gerÃ§ekleÅŸtirmiÅŸ. MÃ¼kemmel performans! ğŸ‰`}),0<r.topBrands.length&&(t=r.topBrands[0],a.positive.push({title:"En Ã‡ok Satan Marka: "+t[0],description:`<span class="metric-highlight">${t[1].count}</span> adet satÄ±ÅŸ ile lider marka. Stok yÃ¶netimine dikkat edin.`})),100<r.avgOrderValue&&a.positive.push({title:"YÃ¼ksek Ortalama SipariÅŸ DeÄŸeri",description:`Ortalama sipariÅŸ deÄŸeri <span class="metric-highlight">$${r.avgOrderValue.toLocaleString("tr-TR",{minimumFractionDigits:2})}</span>. MÃ¼ÅŸteriler yÃ¼ksek deÄŸerli Ã¼rÃ¼nleri tercih ediyor.`}),1<r.topStores.length&&(e=r.topStores[0],t=r.topStores[1],50<(n=((e[1].sales-t[1].sales)/e[1].sales*100).toFixed(1)))&&a.negative.push({title:"MaÄŸazalar ArasÄ± Dengesizlik",description:`${e[0]} ile ${t[0]} arasÄ±nda <span class="metric-highlight">%${n}</span> fark var. DÃ¼ÅŸÃ¼k performanslÄ± maÄŸazalara destek gerekebilir.`}),0<r.topCustomers.length&&20<(t=((e=r.topCustomers[0])[1].sales/r.totalUSD*100).toFixed(1))&&a.negative.push({title:"Tek MÃ¼ÅŸteriye BaÄŸÄ±mlÄ±lÄ±k Riski",description:e[0]+` toplam satÄ±ÅŸlarÄ±n <span class="metric-highlight">%${t}</span>'ini oluÅŸturuyor. MÃ¼ÅŸteri portfÃ¶yÃ¼nÃ¼ Ã§eÅŸitlendirmeyi dÃ¼ÅŸÃ¼nÃ¼n.`}),r.recordCount<10&&a.negative.push({title:"DÃ¼ÅŸÃ¼k Veri Hacmi",description:`Sadece <span class="metric-highlight">${r.recordCount}</span> kayÄ±t analiz edildi. Daha geniÅŸ tarih aralÄ±ÄŸÄ± seÃ§erek daha saÄŸlÄ±klÄ± analiz yapabilirsiniz.`}),r.topCategories.filter(e=>!e[0].toLowerCase().includes("all")&&!e[0].toLowerCase().includes("analitik")&&!e[0].toLowerCase().includes("eÄŸitim")).slice(0,5)),n=(0<n.length&&(e=n.map((e,t)=>{var a=(e[1].sales/r.totalUSD*100).toFixed(1);return`${t+1}. <strong>${e[0]}</strong>: <span class="metric-highlight">${e[1].count}</span> adet, <span class="metric-highlight">%${a}</span>`}).join("<br>"),a.neutral.push({title:"ğŸ¸ En PopÃ¼ler Kategoriler (Ä°lk 5)",description:e})),0<r.topSalesPersons.length&&(t=r.topSalesPersons.slice(0,5).map((e,t)=>{var a=(e[1].sales/r.totalUSD*100).toFixed(1);return`${t+1}. <strong>${e[0]}</strong>: <span class="metric-highlight">$${e[1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</span> (<span class="metric-highlight">%${a}</span>)`}).join("<br>"),a.neutral.push({title:"ğŸ‘¤ En BaÅŸarÄ±lÄ± SatÄ±ÅŸ Temsilcileri (Ä°lk 5)",description:t})),Object.keys(r.customerData).length);return a.neutral.push({title:"MÃ¼ÅŸteri Ã‡eÅŸitliliÄŸi",description:`<span class="metric-highlight">${n}</span> farklÄ± mÃ¼ÅŸteri ile iÅŸlem yapÄ±lmÄ±ÅŸ.`}),a.recommendations.push({icon:"ğŸ¯",title:"Hedef Belirleme",description:`Mevcut performans: <span class="metric-highlight">$${r.totalUSD.toLocaleString("tr-TR",{minimumFractionDigits:2})}</span>. "Hedef Takip" sekmesinden aylÄ±k/yÄ±llÄ±k hedeflerinizi belirleyin ve ilerlemenizi takip edin.`}),1<r.topStores.length&&(e=r.topStores.slice(-2),a.recommendations.push({icon:"ğŸ“ˆ",title:"DÃ¼ÅŸÃ¼k PerformanslÄ± MaÄŸazalara OdaklanÄ±n",description:e.map(e=>e[0]).join(" ve ")+" maÄŸazalarÄ±nÄ±n performansÄ±nÄ± artÄ±rmak iÃ§in Ã¶zel kampanyalar dÃ¼zenleyin."})),0<r.topBrands.length&&(t=r.topBrands.slice(0,5).map((e,t)=>{var a=(e[1].sales/r.totalUSD*100).toFixed(1);return`${t+1}. <strong>${e[0]}</strong>: <span class="metric-highlight">${e[1].count}</span> adet, <span class="metric-highlight">%${a}</span>`}).join("<br>"),a.recommendations.push({icon:"ğŸ·ï¸",title:"Stok Optimizasyonu - En Ã‡ok Satan Markalar (Ä°lk 5)",description:t+"<br><br>Bu markalarÄ±n stok seviyelerini yakÄ±ndan takip edin."})),a.recommendations.push({icon:"ğŸ‘¥",title:"MÃ¼ÅŸteri Ä°liÅŸkileri",description:'"MÃ¼ÅŸteri Analizi" sekmesinden top mÃ¼ÅŸterilerinizi inceleyin ve Ã¶zel teklifler sunarak sadakati artÄ±rÄ±n.'}),r.avgOrderValue<50&&a.recommendations.push({icon:"ğŸ’°",title:"Ortalama SipariÅŸ DeÄŸerini ArtÄ±rÄ±n",description:`Mevcut ortalama: <span class="metric-highlight">$${r.avgOrderValue.toFixed(2)}</span>. Cross-selling ve up-selling stratejileri uygulayÄ±n.`}),a.recommendations.push({icon:"ğŸ“Š",title:"DÃ¼zenli Raporlama",description:`"Excel'e Aktar" Ã¶zelliÄŸini kullanarak haftalÄ±k/aylÄ±k raporlar oluÅŸturun ve trendleri takip edin.`}),a}let dashYearlyChartInstance=null,dashTopStoresChartInstance=null,dashTopSalespeopleChartInstance=null,dashTopBrandsChartInstance=null,dashTopCategoriesChartInstance=null,dashTopCitiesChartInstance=null,dashTopProductsChartInstance=null;function loadDashboard(){var e,t,a,r,n,o,i,l,s;console.log("ğŸ  Dashboard yÃ¼kleniyor..."),allData&&0!==allData.length?(e=allData.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),t=allData.reduce((e,t)=>e+parseFloat(t.quantity||0),0),a=new Set(allData.map(e=>e.partner).filter(Boolean)).size,r=new Set(allData.map(e=>e.product).filter(Boolean)).size,n=new Set(allData.map(e=>e.store).filter(Boolean)).size,o=new Set(allData.map(e=>e.sales_person).filter(Boolean)).size,l=0<(i=new Set(allData.map(e=>e.date).filter(Boolean)).size)?e/i:0,s=0<allData.length?e/allData.length:0,console.log("ğŸ“… Benzersiz GÃ¼n SayÄ±sÄ± (TÃ¼m Zamanlar):",i),console.log("ğŸ’° Toplam SatÄ±ÅŸ:",e.toLocaleString("tr-TR",{minimumFractionDigits:2})),console.log("ğŸ“¦ Toplam KayÄ±t:",allData.length.toLocaleString("tr-TR")),console.log("ğŸ“Š GÃ¼nlÃ¼k Ortalama:",l.toLocaleString("tr-TR",{minimumFractionDigits:2})),console.log("ğŸ›’ Sepet OrtalamasÄ±:",s.toLocaleString("tr-TR",{minimumFractionDigits:2})),document.getElementById("dashTotalSales").textContent="$"+e.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("dashTotalQty").textContent=t.toLocaleString("tr-TR",{minimumFractionDigits:0}),document.getElementById("dashTotalCustomers").textContent=a.toLocaleString("tr-TR"),document.getElementById("dashTotalProducts").textContent=r.toLocaleString("tr-TR"),document.getElementById("dashTotalStores").textContent=n.toLocaleString("tr-TR"),document.getElementById("dashTotalSalespeople").textContent=o.toLocaleString("tr-TR"),document.getElementById("dashDailyAverage").textContent="$"+l.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("dashBasketAverage").textContent="$"+s.toLocaleString("tr-TR",{minimumFractionDigits:2}),renderDashYearlyChart(),renderDashTopStoresChart(allData),renderDashTopSalespeopleChart(allData),renderDashTopBrandsChart(allData),renderDashTopCategoriesChart(allData),renderDashTopCitiesChart(allData),renderDashTopProductsChart(allData),performDashboardAIAnalysis()):console.warn("âš ï¸ Veri yok, dashboard yÃ¼klenemedi")}let dashYearlyMetricType="sales",dashYearlyDataCache=null;function changeDashYearlyMetric(e){dashYearlyMetricType=e;var t=document.getElementById("dashYearlyMetricSales"),a=document.getElementById("dashYearlyMetricQty");"sales"===e?(t.style.background="#667eea",t.style.color="white",a.style.background="white",a.style.color="#667eea"):(t.style.background="white",t.style.color="#667eea",a.style.background="#667eea",a.style.color="white"),renderDashYearlyChart()}function renderDashYearlyChart(){var e=document.getElementById("dashYearlyChart");if(e){let r={},n={},t=(allData.forEach(e=>{var t,a;e.date&&(t=e.date.substring(0,4),a=e.date.substring(5,7),r[t]||(r[t]={}),r[t][a]||(r[t][a]=0),r[t][a]+=parseFloat(e.usd_amount||0),n[t]||(n[t]={}),n[t][a]||(n[t][a]=0),n[t][a]+=parseFloat(e.quantity||0))}),new Set),o=(Object.values(r).forEach(e=>{Object.keys(e).forEach(e=>t.add(e))}),Array.from(t).sort()),i="sales"===dashYearlyMetricType?r:n,l=[],s=[{border:"rgba(102, 126, 234, 1)",bg:"rgba(102, 126, 234, 0.1)"},{border:"rgba(245, 87, 108, 1)",bg:"rgba(245, 87, 108, 0.1)"},{border:"rgba(56, 239, 125, 1)",bg:"rgba(56, 239, 125, 0.1)"},{border:"rgba(255, 206, 86, 1)",bg:"rgba(255, 206, 86, 0.1)"}],a=(Object.keys(i).sort().forEach((e,t)=>{let a=i[e];var r=o.map(e=>a[e]||0),t=s[t%s.length];l.push({label:""+e,data:r,borderColor:t.border,backgroundColor:t.bg,borderWidth:3,fill:!0,tension:.4})}),dashYearlyChartInstance&&dashYearlyChartInstance.destroy(),["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"]);var c=o.map(e=>a[parseInt(e)-1]);let d="sales"===dashYearlyMetricType;var m=d?"SatÄ±ÅŸ (USD - KDV HariÃ§)":"Miktar (Adet)",g=d?"rgba(102, 126, 234, 1)":"rgba(255, 159, 64, 1)";dashYearlyChartInstance=new Chart(e,{type:"line",data:{labels:c,datasets:l},options:{responsive:!0,maintainAspectRatio:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(e){return d?e.dataset.label+": $"+e.parsed.y.toLocaleString("tr-TR",{minimumFractionDigits:2}):e.dataset.label+": "+e.parsed.y.toLocaleString("tr-TR",{minimumFractionDigits:0})+" adet"}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:m,color:g,font:{weight:"bold",size:12}},ticks:{callback:function(e){return d?"$"+e.toLocaleString("tr-TR"):e.toLocaleString("tr-TR")+" adet"}}}}}})}}function renderDashTopStoresChart(e){var t=document.getElementById("dashTopStoresChart");if(t){let a={};e.forEach(e=>{var t=e.store||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10);let r=e.reduce((e,t)=>e+t[1],0);dashTopStoresChartInstance&&dashTopStoresChartInstance.destroy(),dashTopStoresChartInstance=new Chart(t,{type:"bar",data:{labels:e.map(e=>e[0]),datasets:[{label:"SatÄ±ÅŸ (USD)",data:e.map(e=>e[1]),backgroundColor:"rgba(250, 112, 154, 0.8)"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){var t=(e.parsed.x/r*100).toFixed(1);return"SatÄ±ÅŸ: $"+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2})+" ("+t+"%)"}}}},scales:{x:{ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}function renderDashTopSalespeopleChart(e){var t=document.getElementById("dashTopSalespeopleChart");if(t){let a={};e.forEach(e=>{var t=e.sales_person||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10);let r=e.reduce((e,t)=>e+t[1],0);dashTopSalespeopleChartInstance&&dashTopSalespeopleChartInstance.destroy(),dashTopSalespeopleChartInstance=new Chart(t,{type:"bar",data:{labels:e.map(e=>e[0]),datasets:[{label:"SatÄ±ÅŸ (USD)",data:e.map(e=>e[1]),backgroundColor:"rgba(67, 233, 123, 0.8)"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){var t=(e.parsed.x/r*100).toFixed(1);return"SatÄ±ÅŸ: $"+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2})+" ("+t+"%)"}}}},scales:{x:{ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}function renderDashTopBrandsChart(e){var t=document.getElementById("dashTopBrandsChart");if(t){let a={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10);dashTopBrandsChartInstance&&dashTopBrandsChartInstance.destroy(),dashTopBrandsChartInstance=new Chart(t,{type:"doughnut",data:{labels:e.map(e=>e[0]),datasets:[{data:e.map(e=>e[1]),backgroundColor:["rgba(102, 126, 234, 0.8)","rgba(118, 75, 162, 0.8)","rgba(240, 147, 251, 0.8)","rgba(245, 87, 108, 0.8)","rgba(79, 172, 254, 0.8)","rgba(67, 233, 123, 0.8)","rgba(56, 249, 215, 0.8)","rgba(250, 112, 154, 0.8)","rgba(254, 224, 101, 0.8)","rgba(0, 242, 254, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!0,position:"bottom"},tooltip:{callbacks:{label:function(e){return e.label+": $"+e.parsed.toLocaleString("tr-TR",{minimumFractionDigits:2})}}},datalabels:{color:"#fff",font:{weight:"bold",size:14},formatter:(e,t)=>(100*e/t.chart.data.datasets[0].data.reduce((e,t)=>e+t,0)).toFixed(1)+"%"}}},plugins:[ChartDataLabels]})}}function renderDashTopCategoriesChart(e){var t=document.getElementById("dashTopCategoriesChart");if(t){let a={};e.forEach(e=>{var t=e.category_1&&"all"!==e.category_1.toLowerCase()?e.category_1:e.category_2||e.category_3||"DiÄŸer";!t||"bilinmiyor"===t.toLowerCase()||t.toLowerCase().includes("analitik")||t.toLowerCase().includes("eÄŸitim")||(a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0))});e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10);dashTopCategoriesChartInstance&&dashTopCategoriesChartInstance.destroy(),dashTopCategoriesChartInstance=new Chart(t,{type:"doughnut",data:{labels:e.map(e=>e[0]),datasets:[{data:e.map(e=>e[1]),backgroundColor:["rgba(67, 233, 123, 0.8)","rgba(56, 249, 215, 0.8)","rgba(79, 172, 254, 0.8)","rgba(0, 242, 254, 0.8)","rgba(102, 126, 234, 0.8)","rgba(118, 75, 162, 0.8)","rgba(240, 147, 251, 0.8)","rgba(245, 87, 108, 0.8)","rgba(250, 112, 154, 0.8)","rgba(254, 224, 101, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!0,position:"bottom"},tooltip:{callbacks:{label:function(e){return e.label+": $"+e.parsed.toLocaleString("tr-TR",{minimumFractionDigits:2})}}},datalabels:{color:"#fff",font:{weight:"bold",size:14},formatter:(e,t)=>(100*e/t.chart.data.datasets[0].data.reduce((e,t)=>e+t,0)).toFixed(1)+"%"}}},plugins:[ChartDataLabels]})}}function renderDashTopCitiesChart(e){var t=document.getElementById("dashTopCitiesChart");if(t){let a={};e.forEach(e=>{var t=e.city||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10);let r=e.reduce((e,t)=>e+t[1],0);dashTopCitiesChartInstance&&dashTopCitiesChartInstance.destroy(),dashTopCitiesChartInstance=new Chart(t,{type:"bar",data:{labels:e.map(e=>e[0]),datasets:[{label:"SatÄ±ÅŸ (USD)",data:e.map(e=>e[1]),backgroundColor:"rgba(79, 172, 254, 0.8)"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){var t=(e.parsed.x/r*100).toFixed(1);return"SatÄ±ÅŸ: $"+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2})+" ("+t+"%)"}}}},scales:{x:{ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}function renderDashTopProductsChart(e){var n=document.getElementById("dashTopProductsChart");if(n){let a={},t=(e.forEach(e=>{var t=e.product||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)}),Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10)),r=t.reduce((e,t)=>e+t[1],0);dashTopProductsChartInstance&&dashTopProductsChartInstance.destroy();e=t.map(e=>{let t=e[0];return 35<(t=(t=(t=(t=t.replace(/^[\[\(]?[A-Z0-9']+[\]\)]?\s*/g,"")).replace(/\s+Dijital\s+Piyano/gi," Piyano")).replace(/\s+Kuyruklu\s+Piyano/gi," K.Piyano")).replace(/\s+M\/PEP\s+/gi," ")).length?t.substring(0,32)+"...":t});dashTopProductsChartInstance=new Chart(n,{type:"bar",data:{labels:e,datasets:[{label:"SatÄ±ÅŸ (USD)",data:t.map(e=>e[1]),backgroundColor:"rgba(240, 147, 251, 0.8)"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(e){return t[e[0].dataIndex][0]},label:function(e){var t=(e.parsed.x/r*100).toFixed(1);return"SatÄ±ÅŸ: $"+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2})+" ("+t+"%)"}}}},scales:{x:{ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}},y:{ticks:{autoSkip:!1,font:{size:11}}}}}})}}function performDashboardAIAnalysis(){console.log("ğŸ¤– GeliÅŸmiÅŸ AI Analiz baÅŸlatÄ±lÄ±yor...");let t=(new Date).getFullYear(),a=t-1;var e=allData.filter(e=>e.date&&e.date.startsWith(t.toString())),r=allData.filter(e=>e.date&&e.date.startsWith(a.toString())),n=allData.map(e=>e.date).filter(e=>e).sort(),n=n[n.length-1],o=n?n.substring(0,4):t,i=n?n.substring(5,7):"",l=["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"],i=(n?n.substring(8,10):"")+` ${i?l[parseInt(i)-1]:""} `+o;console.log("ğŸ“… Son veri gÃ¼ncelleme tarihi:",i);let s=e.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0);var o=r.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),d=new Date(t,0,1),n=new Date(n),n=Math.ceil((n-d)/864e5),d=365-n,c=0<n?s/n:0,m=o/365,g=0<m?(c-m)/m*100:0,u=365*c,p=0<o?(u-o)/o*100:0,R=Math.max(0,o-s),_=0<d?R/d:0,y=0<r.length?(s-o)/o*100:0;let h={},b={};e.forEach(e=>{var t=e.store||"Bilinmiyor";h[t]||(h[t]=0),h[t]+=parseFloat(e.usd_amount||0)}),r.forEach(e=>{var t=e.store||"Bilinmiyor";b[t]||(b[t]=0),b[t]+=parseFloat(e.usd_amount||0)});var f=Object.entries(h).sort((e,t)=>t[1]-e[1]),P=f.slice(0,10),v=f[f.length-1],f=f.map(([e,t])=>{var a=b[e]||0;return{store:e,sales:t,growth:0<a?(t-a)/a*100:0}}).sort((e,t)=>t.growth-e.growth),k=f[0],f=f[f.length-1];let S={},C={};e.forEach(e=>{var t=e.sales_person||"Bilinmiyor";S[t]||(S[t]=0),S[t]+=parseFloat(e.usd_amount||0)}),r.forEach(e=>{var t=e.sales_person||"Bilinmiyor";C[t]||(C[t]=0),C[t]+=parseFloat(e.usd_amount||0)});var x=Object.entries(S).sort((e,t)=>t[1]-e[1]);x.slice(0,10),x.map(([e,t])=>{var a=C[e]||0;return{sp:e,sales:t,growth:0<a?(t-a)/a*100:0}}).sort((e,t)=>t.growth-e.growth);let $={},T={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";$[t]||($[t]=0),$[t]+=parseFloat(e.usd_amount||0)}),r.forEach(e=>{var t=e.brand||"Bilinmiyor";T[t]||(T[t]=0),T[t]+=parseFloat(e.usd_amount||0)});var x=Object.entries($).sort((e,t)=>t[1]-e[1]),I=x.slice(0,10),j=I.reduce((e,t)=>e+t[1],0)/s*100,x=x.map(([e,t])=>{var a=T[e]||0;return{brand:e,sales:t,growth:0<a?(t-a)/a*100:0}}).sort((e,t)=>t.growth-e.growth),D=x[0],x=x[x.length-1];let E={},B={};e.forEach(e=>{var t=e.category_2||"Bilinmiyor";E[t]||(E[t]=0),E[t]+=parseFloat(e.usd_amount||0)}),r.forEach(e=>{var t=e.category_2||"Bilinmiyor";B[t]||(B[t]=0),B[t]+=parseFloat(e.usd_amount||0)});var w=Object.entries(E).sort((e,t)=>t[1]-e[1]),w=(w.slice(0,10),w.map(([e,t])=>{var a=B[e]||0;return{category:e,sales:t,growth:0<a?(t-a)/a*100:0}}).sort((e,t)=>t.growth-e.growth));w[0];let F={},q={},O={},H={};e.forEach(e=>{var t=e.date.substring(5,7),a=e.date.substring(8,10);F[t]||(F[t]=0,O[t]=new Set),F[t]+=parseFloat(e.usd_amount||0),O[t].add(a)}),r.forEach(e=>{var t=e.date.substring(5,7),a=e.date.substring(8,10);q[t]||(q[t]=0,H[t]=new Set),q[t]+=parseFloat(e.usd_amount||0),H[t].add(a)});var w=Object.keys(F).sort(),w=w[w.length-1],L=F[w]||0,K=q[w]||0,L=L/(O[w]?O[w].size:1),z=K/(H[w]?H[w].size:1),A=0<z?(L-z)/z*100:0,M=new Date,Y=M.getDate(),M=w===String(M.getMonth()+1).padStart(2,"0"),Y=M?(Y/30*100).toFixed(0):100,G=new Set(e.map(e=>e.partner)).size,e=new Set(e.map(e=>e.move_name)).size,e=s/e,V=s/G,r=new Set(r.map(e=>e.move_name)).size,r=0<r?o/r:0,U=0<r?(e-r)/r*100:0,l=l[parseInt(w)-1],w=(console.log("ğŸ“Š Veri gÃ¼ncelleme:",i),console.log(`â±ï¸ ${t}: ${n} gÃ¼n geÃ§ti, ${d} gÃ¼n kaldÄ±`),console.log("ğŸ“Š GÃ¼nlÃ¼k ortalama:",m.toFixed(0),"â†’",c.toFixed(0),`(${0<g?"+":""}${g.toFixed(1)}%)`),console.log("ğŸ¯ YÄ±l sonu tahmini:",u.toFixed(0),`(${0<p?"+":""}${p.toFixed(1)}%)`),console.log("ğŸ“ˆ Basit karÅŸÄ±laÅŸtÄ±rma (YANILTICI):",y.toFixed(1)+"%"),console.log("ğŸ“Š AylÄ±k ivme:",A.toFixed(1)+"%"),`
                <!-- Veri GÃ¼ncelleme Tarihi -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px; border-radius: 10px; margin-bottom: 20px; color: white; text-align: center;">
                    <strong>ğŸ“… Son Veri GÃ¼ncelleme:</strong> ${i} | <strong>ğŸµ MÃ¼zik EnstrÃ¼man SektÃ¶rÃ¼</strong>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>
                        <h4 style="margin-bottom: 15px; color: #38ef7d;">âœ… Olumlu Tespitler & GÃ¼Ã§lÃ¼ YÃ¶nler</h4>
                        <ul style="line-height: 2.2; margin: 0;">
                            ${0<g?`<li><strong>ğŸ“ˆ GÃ¼nlÃ¼k Ortalama Ä°vme:</strong> %${Math.abs(g).toFixed(1)} artÄ±ÅŸ<br><span style="font-size: 0.9em; color: #666;">ğŸ’µ ${a}: $${m.toLocaleString("tr-TR",{minimumFractionDigits:0})}/gÃ¼n â†’ ${t}: $${c.toLocaleString("tr-TR",{minimumFractionDigits:0})}/gÃ¼n<br>ğŸ¯ YÄ±l sonu tahmini: $${u.toLocaleString("tr-TR",{minimumFractionDigits:0})} (%${p.toFixed(1)} bÃ¼yÃ¼me)</span></li>`:""}
                            ${0<A?`<li><strong>ğŸ“Š ${l} AyÄ± Ä°vme (GÃ¼nlÃ¼k Ort.):</strong> %${Math.abs(A).toFixed(1)} artÄ±ÅŸ ${M?`<span style="color: #667eea;">(â±ï¸ Ay %${Y} tamamlandÄ±)</span>`:""}<br><span style="font-size: 0.9em; color: #666;">ğŸ“… ${a}: $${z.toLocaleString("tr-TR",{minimumFractionDigits:0})}/gÃ¼n â†’ ${t}: $${L.toLocaleString("tr-TR",{minimumFractionDigits:0})}/gÃ¼n</span></li>`:""}
                            ${0<U?`<li><strong>ğŸ›’ Sepet OrtalamasÄ± Ä°vmesi:</strong> %${Math.abs(U).toFixed(1)} artÄ±ÅŸ<br><span style="font-size: 0.9em; color: #666;">ğŸ’° ${a}: $${r.toLocaleString("tr-TR",{minimumFractionDigits:0})} â†’ ${t}: $${e.toLocaleString("tr-TR",{minimumFractionDigits:0})}</span></li>`:""}
                            ${k&&20<k.growth?`<li><strong>ğŸš€ En HÄ±zlÄ± BÃ¼yÃ¼yen MaÄŸaza:</strong> ${k.store} (%${k.growth.toFixed(1)} ivme)<br><span style="font-size: 0.9em; color: #666;">ğŸ¯ Best practice kaynak olarak kullanÄ±lmalÄ±</span></li>`:""}
                            ${D&&30<D.growth?`<li><strong>ğŸ·ï¸ En HÄ±zlÄ± BÃ¼yÃ¼yen Marka:</strong> ${D.brand} (%${D.growth.toFixed(1)} ivme)<br><span style="font-size: 0.9em; color: #666;">ğŸ’¡ Bu markaya yatÄ±rÄ±m artÄ±rÄ±lmalÄ±</span></li>`:""}
                            <li><strong>ğŸ·ï¸ Top 10 Marka PerformansÄ±:</strong><br>
                                ${I.map((e,t)=>`<span style="font-size: 0.9em;">${t+1}. ${e[0]}: $${e[1].toLocaleString("tr-TR",{minimumFractionDigits:0})} (%${(e[1]/s*100).toFixed(1)})</span>`).join("<br>")}
                                <br><span style="font-size: 0.9em; color: #666;">ğŸ¯ Top 10 marka toplam satÄ±ÅŸÄ±n %${j.toFixed(1)}'ini oluÅŸturuyor</span>
                            </li>
                            <li><strong>ğŸ‘¥ MÃ¼ÅŸteri Metrikleri:</strong><br>
                                <span style="font-size: 0.9em;">â€¢ ${G.toLocaleString("tr-TR")} aktif mÃ¼ÅŸteri<br>
                                â€¢ MÃ¼ÅŸteri baÅŸÄ± ortalama: $${V.toLocaleString("tr-TR",{minimumFractionDigits:0})}<br>
                                â€¢ Sepet ortalamasÄ±: $${e.toLocaleString("tr-TR",{minimumFractionDigits:2})}</span>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 15px; color: #f5576c;">âš ï¸ Dikkat NoktalarÄ± & Ä°yileÅŸtirme AlanlarÄ±</h4>
                        <ul style="line-height: 2.2; margin: 0;">
                            ${y<0?`<li><strong>â±ï¸ ${t} Durum Raporu (${n} gÃ¼n geÃ§ti, ${d} gÃ¼n kaldÄ±):</strong><br><span style="font-size: 0.9em; color: #666;">ğŸ’µ <strong>${a} TamamÄ±:</strong> $${o.toLocaleString("tr-TR",{minimumFractionDigits:0})}<br>ğŸ’µ <strong>${t} Åu An:</strong> $${s.toLocaleString("tr-TR",{minimumFractionDigits:0})} <span style="color: #f5576c;">(-%${Math.abs(y).toFixed(1)} - YANILTICI!)</span><br>ğŸ“Š <strong>GÃ¼nlÃ¼k Ortalama:</strong> ${a}: $${m.toLocaleString("tr-TR",{minimumFractionDigits:0})}/gÃ¼n â†’ ${t}: $${c.toLocaleString("tr-TR",{minimumFractionDigits:0})}/gÃ¼n <span style="${g<0?"color: #f5576c;":"color: #38ef7d;"}">(${0<g?"+":""}%${g.toFixed(1)})</span><br>ğŸ¯ <strong>YÄ±l Sonu Tahmini:</strong> $${u.toLocaleString("tr-TR",{minimumFractionDigits:0})} <span style="${p<0?"color: #f5576c;":"color: #38ef7d;"}">(${0<p?"+":""}%${p.toFixed(1)} vs ${a})</span><br>ğŸš¨ <strong>${a} seviyesini yakalamak iÃ§in kalan ${d} gÃ¼nde:</strong> $${R.toLocaleString("tr-TR",{minimumFractionDigits:0})} ciro gerekli ($${_.toLocaleString("tr-TR",{minimumFractionDigits:0})}/gÃ¼n vs mevcut $${c.toLocaleString("tr-TR",{minimumFractionDigits:0})}/gÃ¼n)</span></li>`:""}
                            ${A<0?`<li><strong>âš ï¸ ${l} AyÄ± Negatif Ä°vme:</strong> %${Math.abs(A).toFixed(1)} dÃ¼ÅŸÃ¼ÅŸ ${M?`<span style="color: #f5576c;">(â±ï¸ Ay %${Y} tamamlandÄ±)</span>`:""}<br><span style="font-size: 0.9em; color: #666;">ğŸ“… GÃ¼nlÃ¼k ort: $${z.toLocaleString("tr-TR",{minimumFractionDigits:0})} â†’ $${L.toLocaleString("tr-TR",{minimumFractionDigits:0})}<br>ğŸ’¡ Ay sonu tahmini: $${(30*L).toLocaleString("tr-TR",{minimumFractionDigits:0})} (vs ${a}: $${K.toLocaleString("tr-TR",{minimumFractionDigits:0})})</span></li>`:""}
                            ${U<0?`<li><strong>ğŸ›’ Sepet OrtalamasÄ± DÃ¼ÅŸÃ¼ÅŸÃ¼:</strong> %${Math.abs(U).toFixed(1)} azalÄ±ÅŸ<br><span style="font-size: 0.9em; color: #666;">âš ï¸ Cross-selling ve upselling stratejileri gÃ¼Ã§lendirilmeli</span></li>`:""}
                            ${f&&f.growth<-10?`<li><strong>ğŸ“Š En DÃ¼ÅŸÃ¼k Ä°vmeli MaÄŸaza:</strong> ${f.store} (%${f.growth.toFixed(1)})<br><span style="font-size: 0.9em; color: #666;">ğŸ¯ Acil mÃ¼dahale ve destek gerekli</span></li>`:""}
                            ${x&&x.growth<-20?`<li><strong>ğŸ·ï¸ DÃ¼ÅŸÃ¼ÅŸ YaÅŸayan Marka:</strong> ${x.brand} (%${x.growth.toFixed(1)})<br><span style="font-size: 0.9em; color: #666;">ğŸ’¡ ÃœrÃ¼n yelpazesi ve fiyatlandÄ±rma gÃ¶zden geÃ§irilmeli</span></li>`:""}
                            ${v?`<li><strong>ğŸ“ En DÃ¼ÅŸÃ¼k PerformanslÄ± MaÄŸaza:</strong> ${v[0]} ($${v[1].toLocaleString("tr-TR",{minimumFractionDigits:0})})<br><span style="font-size: 0.9em; color: #666;">Toplam satÄ±ÅŸÄ±n %${(v[1]/s*100).toFixed(2)}'i - Stratejik deÄŸerlendirme gerekli</span></li>`:""}
                            <li><strong>ğŸ¯ Marka Ã‡eÅŸitliliÄŸi:</strong> Top 10 marka satÄ±ÅŸlarÄ±n %${j.toFixed(1)}'ini oluÅŸturuyor ${70<j?'<span style="color: #f5576c;">(âš ï¸ Risk yÃ¼ksek!)</span>':'<span style="color: #38ef7d;">(âœ“ Dengeli)</span>'}<br><span style="font-size: 0.9em; color: #666;">ğŸ’¡ PortfÃ¶y Ã§eÅŸitliliÄŸi artÄ±rÄ±lmalÄ±</span></li>
                        </ul>
                    </div>
                </div>
                
                <hr style="margin: 25px 0; border: none; border-top: 2px solid #667eea;">
                <h4 style="margin-bottom: 15px; color: #667eea;">ğŸ’¡ Stratejik Ã–neriler & Aksiyon PlanÄ± (MÃ¼zik SektÃ¶rÃ¼ Ã–zel)</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #38ef7d;">
                        <strong>ğŸ¯ KÄ±sa Vadeli (1-3 ay)</strong>
                        <ul style="margin: 10px 0 0 0; line-height: 2; font-size: 0.95em;">
                            ${A<0?`<li><strong>ğŸš¨ ACÄ°L:</strong> ${l} ayÄ± dÃ¼ÅŸÃ¼ÅŸÃ¼ analizi - Stok, kampanya ve sezonsal faktÃ¶rleri inceleyin</li>`:""}
                            ${0<P.length?`<li><strong>ğŸ† Best Practice:</strong> ${P[0][0]} maÄŸazasÄ±nÄ±n baÅŸarÄ± faktÃ¶rlerini (vitrin dÃ¼zeni, mÃ¼ÅŸteri deneyimi, teÅŸhir teknikleri) diÄŸer maÄŸazalara aktarÄ±n</li>`:""}
                            <li><strong>ğŸ¸ ÃœrÃ¼n TeÅŸhiri:</strong> Gitarlar, klavyeler, davullar iÃ§in akustik test alanlarÄ± oluÅŸturun - deneyimsel satÄ±ÅŸ artÄ±ÅŸÄ± hedefleyin</li>
                            <li><strong>ğŸ›’ Sepet BÃ¼yÃ¼tme:</strong> Aksesuar paketleri (teller, kÄ±lÄ±flar, tuner) ile cross-selling - hedef: %20 sepet artÄ±ÅŸÄ±</li>
                            ${0<I.length?`<li><strong>ğŸ·ï¸ Kampanya:</strong> ${I[0][0]} iÃ§in "Yeni BaÅŸlayanlar Paketi" kampanyasÄ± dÃ¼zenleyin</li>`:""}
                            <li><strong>ğŸ“± Dijital:</strong> Online maÄŸazada canlÄ± Ã¼rÃ¼n demolarÄ± ve sanal deneme Ã¶zellikleri ekleyin</li>
                        </ul>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">
                        <strong>ğŸ“ˆ Orta Vadeli (3-6 ay)</strong>
                        <ul style="margin: 10px 0 0 0; line-height: 2; font-size: 0.95em;">
                            <li><strong>ğŸ‘¥ MÃ¼ÅŸteri Segmentasyonu:</strong> Profesyonel mÃ¼zisyenler, amatÃ¶rler ve yeni baÅŸlayanlar iÃ§in Ã¶zel hizmet paketleri</li>
                            <li><strong>ğŸ“ EÄŸitim ProgramÄ±:</strong> MaÄŸazalarda Ã¼cretsiz enstrÃ¼man tanÄ±tÄ±m ve deneme workshoplarÄ± (mÃ¼ÅŸteri baÄŸlÄ±lÄ±ÄŸÄ± %30+ artÄ±ÅŸ)</li>
                            <li><strong>ğŸ”§ Servis GeliÅŸtirme:</strong> EnstrÃ¼man bakÄ±m ve onarÄ±m servisleri ile satÄ±ÅŸ sonrasÄ± gelir kaynaÄŸÄ± oluÅŸturun</li>
                            <li><strong>ğŸ“¦ Stok Optimizasyonu:</strong> Sezonsal trendlere gÃ¶re (okul aÃ§Ä±lÄ±ÅŸÄ±, yÄ±lbaÅŸÄ±) stok planlamasÄ± yapÄ±n</li>
                            ${v?`<li><strong>ğŸ“Š MaÄŸaza Ä°yileÅŸtirme:</strong> ${v[0]} iÃ§in Ã¶zel destek programÄ± - Ã¼rÃ¼n karmasÄ± ve satÄ±ÅŸ ekibi eÄŸitimi</li>`:""}
                            <li><strong>ğŸŒ Online-Offline Entegrasyon:</strong> Click & Collect, maÄŸazadan deneme sonrasÄ± online sipariÅŸ sistemi</li>
                        </ul>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #fa7268;">
                        <strong>ğŸš€ Uzun Vadeli (6-12 ay)</strong>
                        <ul style="margin: 10px 0 0 0; line-height: 2; font-size: 0.95em;">
                            <li><strong>ğŸµ Topluluk OluÅŸturma:</strong> MÃ¼zisyen topluluÄŸu platformu - konserler, jamler, Ã¼rÃ¼n lansmanlarÄ± dÃ¼zenleyin</li>
                            <li><strong>ğŸ¤ B2B GeliÅŸtirme:</strong> MÃ¼zik okullarÄ±, kurslar ve tiyatrolar ile kurumsal anlaÅŸmalar yapÄ±n</li>
                            <li><strong>ğŸ’¼ Kiralama Servisi:</strong> Profesyonel ekipman kiralama servisi baÅŸlatÄ±n (pasif gelir kaynaÄŸÄ±)</li>
                            <li><strong>ğŸ“Š Data Analytics:</strong> MÃ¼ÅŸteri satÄ±n alma davranÄ±ÅŸlarÄ± analizi ile kiÅŸiselleÅŸtirilmiÅŸ Ã¶neriler geliÅŸtirin</li>
                            <li><strong>ğŸŒ Pazar GeniÅŸletme:</strong> Yeni maÄŸaza aÃ§Ä±lÄ±ÅŸlarÄ± iÃ§in potansiyel ÅŸehirleri analiz edin (${t} verilerine gÃ¶re)</li>
                            <li><strong>ğŸ¯ Hedef Belirleme:</strong> ${t+1} yÄ±lÄ± iÃ§in gerÃ§ekÃ§i bÃ¼yÃ¼me hedefleri belirleyin - Ã¶nerilen: %${0<y?(1.2*y).toFixed(0):"15"} bÃ¼yÃ¼me</li>
                        </ul>
                    </div>
                </div>
            `);document.getElementById("dashAIAnalysis").innerHTML=w}let hourlyChartInstance=null,monthlyTrendChartInstance=null,yearlyTrendChartInstance=null,storeTimeChartInstance=null,categoryTimeChartInstance=null,salesPersonTimeChartInstance=null;function analyzeTime(){console.log("â° Zaman analizi baÅŸlatÄ±lÄ±yor...");let t=document.getElementById("timeCategory1Filter")?.value||"";t?(filteredData=allData.filter(e=>e.category_2===t),console.log(`ğŸ“ Kategori filtresi: "${t}" - ${filteredData.length} kayÄ±t`)):filteredData=[...allData],updateTimeSummary(),renderHourlyChart(),renderMonthlyTrendChart(),renderYearlyTrendChart(),populateTimeFilters(),renderStoreTimeChart(),renderCategoryTimeChart(),renderSalesPersonTimeChart(),performTimeAIAnalysis()}function updateTimeSummary(){let r={},n={},o=0,i=0,e=(filteredData.forEach(e=>{var t=e.create_hour||0,a=e.day_of_week||0,e=parseFloat(e.usd_amount||0);r[t]||(r[t]=0),r[t]+=e,n[a]||(n[a]=0),n[a]+=e,9<=t&&t<18&&(o+=e),5!==a&&6!==a||(i+=e)}),0),t=0;for(var[a,l]of Object.entries(r))l>t&&(t=l,e=parseInt(a));var s,d;let c=0,m=0;for([s,d]of Object.entries(n))d>m&&(m=d,c=parseInt(s));document.getElementById("peakHour").textContent=`${String(e).padStart(2,"0")}:00-${String(e+1).padStart(2,"0")}:00`,document.getElementById("peakDay").textContent=["Pazartesi","SalÄ±","Ã‡arÅŸamba","PerÅŸembe","Cuma","Cumartesi","Pazar"][c],document.getElementById("workHoursSales").textContent="$"+o.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("weekendSales").textContent="$"+i.toLocaleString("tr-TR",{minimumFractionDigits:2})}function renderHourlyChart(){var e=document.getElementById("hourlyChart");if(e){let a=Array(24).fill(0),r=Array(24).fill(0);filteredData.forEach(e=>{var t=e.create_hour||0;a[t]+=parseFloat(e.usd_amount||0),r[t]+=1}),hourlyChartInstance&&hourlyChartInstance.destroy(),hourlyChartInstance=new Chart(e,{type:"bar",data:{labels:Array.from({length:24},(e,t)=>String(t).padStart(2,"0")+":00"),datasets:[{label:"SatÄ±ÅŸ ($ - KDV HariÃ§)",data:a,backgroundColor:a.map((e,t)=>e===Math.max(...a)?"rgba(245, 87, 108, 0.8)":9<=t&&t<18?"rgba(56, 239, 125, 0.6)":"rgba(102, 126, 234, 0.6)"),borderColor:"rgba(102, 126, 234, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(e){return`SatÄ±ÅŸ: $${e.parsed.y.toLocaleString("tr-TR")} (${r[e.dataIndex]} adet)`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}function renderMonthlyTrendChart(){var e=document.getElementById("monthlyTrendChart");if(e){let a={};filteredData.forEach(e=>{var t;e.date&&(t=e.date.substring(0,7),a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0))});var t=Object.keys(a).sort(),r=t.map(e=>{var[e,t]=e.split("-");return["Oca","Åub","Mar","Nis","May","Haz","Tem","AÄŸu","Eyl","Eki","Kas","Ara"][parseInt(t)-1]+" "+e}),t=t.map(e=>a[e]);monthlyTrendChartInstance&&monthlyTrendChartInstance.destroy(),monthlyTrendChartInstance=new Chart(e,{type:"bar",data:{labels:r,datasets:[{label:"AylÄ±k SatÄ±ÅŸ ($ - KDV HariÃ§)",data:t,backgroundColor:"rgba(102, 126, 234, 0.7)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(e){return"SatÄ±ÅŸ: $"+e.parsed.y.toLocaleString("tr-TR")}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"K"}}}}}})}}function renderYearlyTrendChart(){var e=document.getElementById("yearlyTrendChart");if(e){let a={};filteredData.forEach(e=>{var t;e.date&&(t=e.date.substring(0,4),a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0))});var t=Object.keys(a).sort(),r=t.map(e=>a[e]);yearlyTrendChartInstance&&yearlyTrendChartInstance.destroy(),yearlyTrendChartInstance=new Chart(e,{type:"bar",data:{labels:t,datasets:[{label:"YÄ±llÄ±k SatÄ±ÅŸ ($ - KDV HariÃ§)",data:r,backgroundColor:"rgba(118, 75, 162, 0.7)",borderColor:"rgba(118, 75, 162, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},tooltip:{callbacks:{label:function(e){return"SatÄ±ÅŸ: $"+e.parsed.y.toLocaleString("tr-TR")}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+(e/1e6).toFixed(1)+"M"}}}}}})}}function populateTimeFilters(){var e=[...new Set(allData.map(e=>e.category_2).filter(e=>e&&"all"!==e.toLowerCase()))].sort();let r=document.getElementById("timeCategory1Filter");if(r){let a=r.value;r.innerHTML='<option value="">TÃ¼m Kategoriler</option>',e.forEach(e=>{var t=e===a?"selected":"";r.innerHTML+=`<option value="${e}" ${t}>${e}</option>`})}e=[...new Set(filteredData.map(e=>e.store).filter(Boolean))];let t=document.getElementById("storeTimeFilter");t.innerHTML='<option value="">TÃ¼m MaÄŸazalar</option>',e.forEach(e=>{t.innerHTML+=`<option value="${e}">${e}</option>`});e=[...new Set(filteredData.map(e=>e.category_2).filter(e=>e&&"all"!==e.toLowerCase()))].sort();let a=document.getElementById("categoryTimeFilter");a.innerHTML='<option value="">TÃ¼m Kategoriler</option>',e.forEach(e=>{a.innerHTML+=`<option value="${e}">${e}</option>`});e=[...new Set(filteredData.map(e=>e.sales_person).filter(Boolean))];let n=document.getElementById("salesPersonTimeFilter");n.innerHTML='<option value="">TÃ¼m Temsilciler</option>',e.forEach(e=>{n.innerHTML+=`<option value="${e}">${e}</option>`})}function clearTimeFilters(){var e=document.getElementById("timeCategory1Filter");e&&(e.value=""),console.log("ğŸ”„ Zaman analizi filtreleri temizlendi"),analyzeTime()}function renderStoreTimeChart(){var e=document.getElementById("storeTimeChart");if(e){let t=document.getElementById("storeTimeFilter").value;var r=t?filteredData.filter(e=>e.store===t):filteredData;let a=Array(24).fill(0);r.forEach(e=>{var t=e.create_hour||0;a[t]+=parseFloat(e.usd_amount||0)}),storeTimeChartInstance&&storeTimeChartInstance.destroy(),storeTimeChartInstance=new Chart(e,{type:"bar",data:{labels:Array.from({length:24},(e,t)=>String(t).padStart(2,"0")+":00"),datasets:[{label:t||"TÃ¼m MaÄŸazalar",data:a,backgroundColor:"rgba(56, 239, 125, 0.6)",borderColor:"rgba(56, 239, 125, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}function renderCategoryTimeChart(){var e=document.getElementById("categoryTimeChart");if(e){let t=document.getElementById("categoryTimeFilter").value;var r=t?filteredData.filter(e=>e.category_2===t):filteredData;let a=Array(24).fill(0);r.forEach(e=>{var t=e.create_hour||0;a[t]+=parseFloat(e.usd_amount||0)}),categoryTimeChartInstance&&categoryTimeChartInstance.destroy(),categoryTimeChartInstance=new Chart(e,{type:"bar",data:{labels:Array.from({length:24},(e,t)=>String(t).padStart(2,"0")+":00"),datasets:[{label:t||"TÃ¼m Kategoriler",data:a,backgroundColor:"rgba(245, 87, 108, 0.6)",borderColor:"rgba(245, 87, 108, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}function renderSalesPersonTimeChart(){var e=document.getElementById("salesPersonTimeChart");if(e){let t=document.getElementById("salesPersonTimeFilter").value;var r=t?filteredData.filter(e=>e.sales_person===t):filteredData;let a=Array(24).fill(0);r.forEach(e=>{var t=e.create_hour||0;a[t]+=parseFloat(e.usd_amount||0)}),salesPersonTimeChartInstance&&salesPersonTimeChartInstance.destroy(),salesPersonTimeChartInstance=new Chart(e,{type:"bar",data:{labels:Array.from({length:24},(e,t)=>String(t).padStart(2,"0")+":00"),datasets:[{label:t||"TÃ¼m Temsilciler",data:a,backgroundColor:"rgba(240, 147, 251, 0.6)",borderColor:"rgba(240, 147, 251, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}function performTimeAIAnalysis(){console.log("ğŸ¤– Zaman AI analizi baÅŸlatÄ±lÄ±yor...");var g=document.getElementById("timeInsightsPanel");if(g&&0!==filteredData.length){let o={},i={},l={},s={};filteredData.forEach(e=>{var t=e.create_hour||0,a=e.day_of_week||0,r=e.store||"Bilinmiyor",n=e.category_1||"Bilinmiyor",e=parseFloat(e.usd_amount||0);o[t]||(o[t]={sales:0,count:0}),o[t].sales+=e,o[t].count+=1,i[a]||(i[a]={sales:0,count:0}),i[a].sales+=e,i[a].count+=1,l[r]||(l[r]={}),l[r][t]||(l[r][t]=0),l[r][t]+=e,s[n]||(s[n]={}),s[n][t]||(s[n][t]=0),s[n][t]+=e});var u,p,y={positive:[],negative:[],neutral:[],recommendations:[]};let e=0,t=0;for([u,p]of Object.entries(o))p.sales>t&&(t=p.sales,e=parseInt(u));y.positive.push({title:`En YoÄŸun Saat: ${String(e).padStart(2,"0")}:00-${String(e+1).padStart(2,"0")}:00`,description:`<span class="metric-highlight">$${t.toLocaleString("tr-TR",{minimumFractionDigits:2})}</span> satÄ±ÅŸ ile en yoÄŸun saat dilimi. Bu saatte personel sayÄ±sÄ±nÄ± artÄ±rÄ±n.`});var h,b,f,v,k=["Pazartesi","SalÄ±","Ã‡arÅŸamba","PerÅŸembe","Cuma","Cumartesi","Pazar"];let a=0,r=0,n=0,d=1/0;for([h,b]of Object.entries(i))b.sales>r&&(r=b.sales,a=parseInt(h)),b.sales<d&&(d=b.sales,n=parseInt(h));y.positive.push({title:"En YoÄŸun GÃ¼n: "+k[a],description:`<span class="metric-highlight">$${r.toLocaleString("tr-TR",{minimumFractionDigits:2})}</span> satÄ±ÅŸ ile haftanÄ±n en yoÄŸun gÃ¼nÃ¼.`}),2<r/d&&y.negative.push({title:"GÃ¼nler ArasÄ± BÃ¼yÃ¼k Fark",description:`${k[a]} ile ${k[n]} arasÄ±nda <span class="metric-highlight">${(100*(r/d-1)).toFixed(0)}%</span> fark var. ${k[n]} iÃ§in Ã¶zel kampanyalar dÃ¼ÅŸÃ¼nÃ¼n.`});let c=0,m=0;for([f,v]of Object.entries(o))9<=parseInt(f)&&parseInt(f)<18?c+=v.sales:m+=v.sales;var S=(c/(c+m)*100).toFixed(1),S=(y.neutral.push({title:"Mesai Saati DaÄŸÄ±lÄ±mÄ±",description:`SatÄ±ÅŸlarÄ±n <span class="metric-highlight">%${S}</span>'i mesai saatlerinde (09:00-18:00) gerÃ§ekleÅŸiyor.`}),y.recommendations.push({icon:"â°",title:"Personel PlanlamasÄ±",description:`${String(e).padStart(2,"0")}:00-${String(e+1).padStart(2,"0")}:00 saatleri arasÄ±nda personel sayÄ±sÄ±nÄ± artÄ±rÄ±n. Bu saatte satÄ±ÅŸlarÄ±n %${(t/Object.values(o).reduce((e,t)=>e+t.sales,0)*100).toFixed(1)}'i gerÃ§ekleÅŸiyor.`}),y.recommendations.push({icon:"ğŸ“…",title:"Kampanya ZamanlamasÄ±",description:`${k[n]} gÃ¼nleri iÃ§in Ã¶zel kampanyalar dÃ¼zenleyin. Mevcut satÄ±ÅŸlar ${k[a]}'ye gÃ¶re %${(100*(1-d/r)).toFixed(0)} daha dÃ¼ÅŸÃ¼k.`}),m>.3*c&&y.recommendations.push({icon:"ğŸŒ™",title:"Mesai DÄ±ÅŸÄ± Potansiyel",description:`Mesai dÄ±ÅŸÄ± satÄ±ÅŸlar toplam satÄ±ÅŸlarÄ±n %${(m/(c+m)*100).toFixed(1)}'ini oluÅŸturuyor. Online satÄ±ÅŸ kanallarÄ±nÄ± gÃ¼Ã§lendirin.`}),`
                <div class="analysis-panel" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h2 style="margin: 0 0 20px 0; font-size: 2em;">â° Zaman Analizi AI Ã–nerileri</h2>
                    <p style="opacity: 0.9; margin-bottom: 20px;">Filtrelenen ${filteredData.length.toLocaleString("tr-TR")} kayÄ±t Ã¼zerinden yapÄ±lan zaman analizi sonuÃ§larÄ±</p>
                    
                    ${0<y.positive.length?`
                    <div class="analysis-section">
                        <h3>âœ… Olumlu Tespitler</h3>
                        ${y.positive.map(e=>`
                            <div class="insight-item insight-positive">
                                <span class="insight-icon">âœ…</span>
                                <strong>${e.title}</strong><br>
                                ${e.description}
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<y.negative.length?`
                    <div class="analysis-section">
                        <h3>âš ï¸ Dikkat Edilmesi Gerekenler</h3>
                        ${y.negative.map(e=>`
                            <div class="insight-item insight-negative">
                                <span class="insight-icon">âš ï¸</span>
                                <strong>${e.title}</strong><br>
                                ${e.description}
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<y.neutral.length?`
                    <div class="analysis-section">
                        <h3>ğŸ’¡ Ã–nemli Bilgiler</h3>
                        ${y.neutral.map(e=>`
                            <div class="insight-item insight-neutral">
                                <span class="insight-icon">ğŸ’¡</span>
                                <strong>${e.title}</strong><br>
                                ${e.description}
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    <div class="analysis-section">
                        <h3>ğŸ¯ Aksiyon Ã–nerileri</h3>
                        ${y.recommendations.map(e=>`
                            <div class="recommendation">
                                <span class="recommendation-icon">${e.icon}</span>
                                <div>
                                    <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                    <p style="margin: 10px 0 0 0; opacity: 0.95;">${e.description}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `);g.innerHTML=S,g.style.display="block"}}loadData();let productStoreChartInstance=null,productCityChartInstance=null,productSalesPersonChartInstance=null,productMonthlyChartInstance=null,currentProductData=[],currentSortColumn="sales",currentSortDirection="desc",lastProductSearchData=null,lastSalespersonTopProductsData=null,currentSalespersonSortColumn="sales",currentSalespersonSortDirection="desc",lastCustomerPurchaseData=null,currentCustomerPurchaseSortColumn="date",currentCustomerPurchaseSortDirection="desc",allCategories=[],allCategoriesHierarchical=[];function initializeProductFilters(){let r=new Map,t=(allData.forEach(e=>{var t=[e.category_1||"",e.category_2||"",e.category_3||"",e.category_4||""].filter(e=>e&&e.trim());for(let e=1;e<=t.length;e++){var a=t.slice(0,e).join(" > ");a&&!r.has(a)&&r.set(a,{cat1:t[0]||"",cat2:t[1]||"",cat3:t[2]||"",cat4:t[3]||""})}}),allCategoriesHierarchical=Array.from(r.keys()).sort(),new Set),a=(allData.forEach(e=>{e.category_1&&t.add(e.category_1),e.category_2&&t.add(e.category_2),e.category_3&&t.add(e.category_3),e.category_4&&t.add(e.category_4)}),allCategories=Array.from(t).sort(),new Set),n=(allData.forEach(e=>{e.store&&"Analitik"!==e.store&&!e.store.toLowerCase().includes("eÄŸitim")&&a.add(e.store)}),document.getElementById("productStoreFilter"));n&&(n.innerHTML='<option value="">TÃ¼m MaÄŸazalar</option>',Array.from(a).sort().forEach(e=>{n.innerHTML+=`<option value="${e}">${e}</option>`}))}function showProductCategoryDropdown(){filterProductCategories(),document.getElementById("productCategoryDropdown").style.display="block"}function hideProductCategoryDropdown(){document.getElementById("productCategoryDropdown").style.display="none"}function filterProductCategories(){let t=document.getElementById("productCategorySearch").value.toLowerCase();var e=document.getElementById("productCategoryDropdown"),a=allCategoriesHierarchical.filter(e=>e.toLowerCase().includes(t));0===a.length?e.innerHTML='<div style="padding: 15px; text-align: center; color: #999;">SonuÃ§ bulunamadÄ±</div>':(e.innerHTML=a.slice(0,20).map(e=>{var t=e.split(" > ").map((e,t)=>{var a=["#667eea","#764ba2","#e74c3c","#f39c12"];return`<span style="color: ${a[t%a.length]}; font-weight: ${0===t?"bold":"normal"};">${e}</span>`}).join(' <span style="color: #999;">â€º</span> ');return`
                        <div onclick="selectProductCategory('${e.replace(/'/g,"\\'")}')" 
                             style="padding: 12px; cursor: pointer; border-bottom: 1px solid #eee; transition: all 0.2s;"
                             onmouseover="this.style.background='#f5f5f5'"
                             onmouseout="this.style.background='white'">
                            ğŸ“ ${t}
                        </div>
                    `}).join(""),20<a.length&&(e.innerHTML+='<div style="padding: 10px; text-align: center; color: #999; font-size: 0.9em;">+'+(a.length-20)+" daha...</div>")),e.style.display="block"}function selectProductCategory(e){document.getElementById("productCategorySearch").value=e,document.getElementById("productCategorySearch").setAttribute("data-selected-category",e),hideProductCategoryDropdown(),searchProduct()}function clearProductDateFilters(){document.getElementById("productDateStart").value="",document.getElementById("productDateEnd").value="",console.log("ğŸ”„ ÃœrÃ¼n tarih filtreleri temizlendi")}function searchProduct(){let c=document.getElementById("productSearchInput").value.trim(),m=document.getElementById("productCategorySearch").getAttribute("data-selected-category")||"",g=document.getElementById("productStoreFilter").value,u=document.getElementById("productDateStart").value,p=document.getElementById("productDateEnd").value;if(c||m){console.log("ğŸ” Arama kriteri:",{searchTerm:c,selectedCategory:m,selectedStore:g,dateStart:u,dateEnd:p});let d=c.toLowerCase();var e,t,a,r,n=allData.filter(e=>{var t=(e.product||"").toLowerCase(),a=(e.brand||"").toLowerCase(),r=(e.category_1||"").toLowerCase(),n=(e.category_2||"").toLowerCase(),o=(e.category_3||"").toLowerCase(),t=!c||t.includes(d)||a.includes(d);let i=!0,l=(m&&(a=m.toLowerCase(),i=m.includes(" > ")?[e.category_1,e.category_2,e.category_3,e.category_4].filter(e=>e&&e.trim()).join(" > ").toLowerCase().includes(a):r.includes(a)||n.includes(a)||o.includes(a)||(e.category_4||"").toLowerCase().includes(a)),!0),s=((u||p)&&(!e.date||(u&&e.date<u&&(l=!1),p&&e.date>p))&&(l=!1),!0);return g&&(s=(e.store||"").toLowerCase().includes(g.toLowerCase())),t&&i&&l&&s});console.log("ğŸ“Š Bulunan kayÄ±t sayÄ±sÄ±:",n.length),0===n.length?(document.getElementById("productResultsContainer").style.display="none",alert("âŒ Arama kriterlerine uygun sonuÃ§ bulunamadÄ±!")):(document.getElementById("productResultsContainer").style.display="block",document.getElementById("productNoResults").style.display="none",e=(lastProductSearchData=n).reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),t=n.reduce((e,t)=>e+parseFloat(t.quantity||0),0),a=new Set(n.map(e=>e.product)).size,r=e/Math.max(t,1),document.getElementById("productTotalSales").textContent="$"+e.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("productTotalQty").textContent=t.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("productUniqueCount").textContent=a,document.getElementById("productAvgPrice").textContent="$"+r.toLocaleString("tr-TR",{minimumFractionDigits:2}),renderProductStoreChart(n),renderProductCityChart(n),renderProductSalesPersonChart(n),renderProductMonthlyChart(n),renderProductDetailTable(n),performProductAIAnalysis(n))}else alert("âš ï¸ LÃ¼tfen bir Ã¼rÃ¼n/marka adÄ± girin veya kategori seÃ§in!")}function renderProductStoreChart(e){let a={};e.forEach(e=>{var t=e.store||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),r=e.map(e=>e[1].sales),e=e.map(e=>e[1].qty),n=document.getElementById("productStoreChart");n&&(productStoreChartInstance&&productStoreChartInstance.destroy(),productStoreChartInstance=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:r,backgroundColor:"rgba(102, 126, 234, 0.6)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2,yAxisID:"y"},{label:"Miktar",data:e,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:2,yAxisID:"y"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(e){var t=e.dataset.label||"";return"SatÄ±ÅŸ (USD)"===t?t+": $"+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2}):t+": "+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2})}}}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return e.toLocaleString("tr-TR")}}}}}}))}function renderProductCityChart(e){let a={};e.forEach(e=>{var t=e.city||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),r=e.map(e=>e[1].sales),e=e.map(e=>e[1].qty),n=document.getElementById("productCityChart");n&&(productCityChartInstance&&productCityChartInstance.destroy(),productCityChartInstance=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:r,backgroundColor:"rgba(56, 239, 125, 0.6)",borderColor:"rgba(56, 239, 125, 1)",borderWidth:2,yAxisID:"y"},{label:"Miktar",data:e,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:2,yAxisID:"y"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(e){var t=e.dataset.label||"";return"SatÄ±ÅŸ (USD)"===t?t+": $"+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2}):t+": "+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2})}}}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return e.toLocaleString("tr-TR")}}}}}}))}function renderProductSalesPersonChart(e){let a={};e.forEach(e=>{var t=e.sales_person||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),r=e.map(e=>e[1].sales),e=e.map(e=>e[1].qty),n=document.getElementById("productSalesPersonChart");n&&(productSalesPersonChartInstance&&productSalesPersonChartInstance.destroy(),productSalesPersonChartInstance=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:r,backgroundColor:"rgba(245, 87, 108, 0.6)",borderColor:"rgba(245, 87, 108, 1)",borderWidth:2,yAxisID:"y"},{label:"Miktar",data:e,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:2,yAxisID:"y"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(e){var t=e.dataset.label||"";return"SatÄ±ÅŸ (USD)"===t?t+": $"+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2}):t+": "+e.parsed.x.toLocaleString("tr-TR",{minimumFractionDigits:2})}}}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return e.toLocaleString("tr-TR")}}}}}}))}function renderProductMonthlyChart(e){let r={};e.forEach(e=>{var t,a;e.date&&(t=e.date.substring(0,4),a=parseInt(e.date.substring(5,7)),r[t]||(r[t]={}),r[t][a]||(r[t][a]=0),r[t][a]+=parseFloat(e.usd_amount||0))});e=Object.keys(r).sort();let n=[{bg:"rgba(102, 126, 234, 0.2)",border:"rgba(102, 126, 234, 1)"},{bg:"rgba(240, 147, 251, 0.2)",border:"rgba(240, 147, 251, 1)"},{bg:"rgba(255, 159, 64, 0.2)",border:"rgba(255, 159, 64, 1)"},{bg:"rgba(75, 192, 192, 0.2)",border:"rgba(75, 192, 192, 1)"},{bg:"rgba(255, 99, 132, 0.2)",border:"rgba(255, 99, 132, 1)"}];var e=e.map((t,e)=>{let a=Array(12).fill(0);Object.keys(r[t]).forEach(e=>{a[parseInt(e)-1]=r[t][e]});e=n[e%n.length];return{label:t,data:a,backgroundColor:e.bg,borderColor:e.border,borderWidth:3,fill:!0,tension:.4}}),t=document.getElementById("productMonthlyChart");t&&(productMonthlyChartInstance&&productMonthlyChartInstance.destroy(),productMonthlyChartInstance=new Chart(t,{type:"line",data:{labels:["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"],datasets:e},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(e){return e.dataset.label+": $"+e.parsed.y.toLocaleString("tr-TR",{minimumFractionDigits:2})}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"K"}}}}}}))}function renderProductDetailTable(e=null,t=null,a){if((e=(e=null===e&&lastProductSearchData?lastProductSearchData:e)&&e.filter(e=>!e._isDiscount))&&0!==e.length){null!==t&&(currentSortDirection=currentSortColumn===t?"asc"===currentSortDirection?"desc":"asc":(currentSortColumn=t,"desc"));let r={};e.forEach(e=>{var t,a=e.product||"Bilinmiyor";r[a]||(t=0<(t=[e.category_1,e.category_2,e.category_3,e.category_4].filter(e=>e&&e.trim()&&"all"!==e.toLowerCase())).length?t.join(" â€º "):"Bilinmiyor",r[a]={brand:e.brand||"Bilinmiyor",category:t,sales:0,qty:0,count:0}),r[a].sales+=parseFloat(e.usd_amount||0),r[a].qty+=parseFloat(e.quantity||0),r[a].count+=1}),(currentProductData=Object.entries(r)).sort((e,t)=>{let a,r;return"product"===currentSortColumn?(a=e[0].toLowerCase(),r=t[0].toLowerCase(),"asc"===currentSortDirection?a.localeCompare(r):r.localeCompare(a)):"brand"===currentSortColumn?(a=e[1].brand.toLowerCase(),r=t[1].brand.toLowerCase(),"asc"===currentSortDirection?a.localeCompare(r):r.localeCompare(a)):"category"===currentSortColumn?(a=e[1].category.toLowerCase(),r=t[1].category.toLowerCase(),"asc"===currentSortDirection?a.localeCompare(r):r.localeCompare(a)):("sales"===currentSortColumn?(a=e[1].sales,r=t[1].sales):"qty"===currentSortColumn?(a=e[1].qty,r=t[1].qty):"count"===currentSortColumn?(a=e[1].count,r=t[1].count):"avgPrice"===currentSortColumn&&(a=e[1].sales/Math.max(e[1].qty,1),r=t[1].sales/Math.max(t[1].qty,1)),"asc"===currentSortDirection?a-r:r-a)});t=e=>currentSortColumn===e?"asc"===currentSortDirection?" â–²":" â–¼":" â‡…";let n=`
                <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <tr>
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #ddd;">#</th>
                            <th onclick="renderProductDetailTable(null, 'product')" style="padding: 15px; text-align: left; border-bottom: 2px solid #ddd; cursor: pointer; user-select: none;" title="SÄ±ralamak iÃ§in tÄ±klayÄ±n">
                                ÃœrÃ¼n${t("product")}
                            </th>
                            <th onclick="renderProductDetailTable(null, 'brand')" style="padding: 15px; text-align: left; border-bottom: 2px solid #ddd; cursor: pointer; user-select: none;" title="SÄ±ralamak iÃ§in tÄ±klayÄ±n">
                                Marka${t("brand")}
                            </th>
                            <th onclick="renderProductDetailTable(null, 'category')" style="padding: 15px; text-align: left; border-bottom: 2px solid #ddd; cursor: pointer; user-select: none;" title="SÄ±ralamak iÃ§in tÄ±klayÄ±n">
                                Kategori${t("category")}
                            </th>
                            <th onclick="renderProductDetailTable(null, 'sales')" style="padding: 15px; text-align: right; border-bottom: 2px solid #ddd; cursor: pointer; user-select: none;" title="SÄ±ralamak iÃ§in tÄ±klayÄ±n">
                                SatÄ±ÅŸ (USD)${t("sales")}
                            </th>
                            <th onclick="renderProductDetailTable(null, 'qty')" style="padding: 15px; text-align: right; border-bottom: 2px solid #ddd; cursor: pointer; user-select: none;" title="SÄ±ralamak iÃ§in tÄ±klayÄ±n">
                                Miktar${t("qty")}
                            </th>
                            <th onclick="renderProductDetailTable(null, 'count')" style="padding: 15px; text-align: right; border-bottom: 2px solid #ddd; cursor: pointer; user-select: none;" title="SÄ±ralamak iÃ§in tÄ±klayÄ±n">
                                Ä°ÅŸlem${t("count")}
                            </th>
                            <th onclick="renderProductDetailTable(null, 'avgPrice')" style="padding: 15px; text-align: right; border-bottom: 2px solid #ddd; cursor: pointer; user-select: none;" title="SÄ±ralamak iÃ§in tÄ±klayÄ±n">
                                Sepet Ort.${t("avgPrice")}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
            `;e=currentProductData.slice(0,30),t=30<currentProductData.length;e.forEach((e,t)=>{var a=e[0],e=e[1],r=e.sales/Math.max(e.count,1);n+=`
                    <tr style="border-bottom: 1px solid #eee; ${t%2==0?"background: #f8f9fa;":""}">
                        <td style="padding: 12px;">${t+1}</td>
                        <td style="padding: 12px;"><strong>${a}</strong></td>
                        <td style="padding: 12px;">${e.brand}</td>
                        <td style="padding: 12px;">${e.category}</td>
                        <td style="padding: 12px; text-align: right; color: #38ef7d; font-weight: bold;">$${e.sales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: right;">${e.qty.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: right;">${e.count}</td>
                        <td style="padding: 12px; text-align: right;">$${r.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                    </tr>
                `}),t&&(n+=`
                    <tr style="background: #fffbeb; border-top: 2px solid #fbbf24;">
                        <td colspan="8" style="padding: 15px; text-align: center; color: #92400e; font-weight: 600;">
                            â„¹ï¸ Ä°lk 30 Ã¼rÃ¼n gÃ¶steriliyor (Toplam: ${currentProductData.length} Ã¼rÃ¼n). Daha fazlasÄ± iÃ§in filtreleri daraltabilirsiniz.
                        </td>
                    </tr>
                `),n+=`
                    </tbody>
                </table>
            `,document.getElementById("productDetailTable").innerHTML=n}else document.getElementById("productDetailTable").innerHTML='<p style="text-align: center; padding: 20px;">Veri bulunamadÄ±</p>'}function performProductAIAnalysis(e){console.log("ğŸ¤– ÃœrÃ¼n analizi AI deÄŸerlendirmesi baÅŸlatÄ±lÄ±yor...");let r=e.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0);var t=e.reduce((e,t)=>e+parseFloat(t.quantity||0),0),n=new Set(e.map(e=>e.product)).size,a=r/Math.max(t,1);let o={};e.forEach(e=>{var t=e.store||"Bilinmiyor";o[t]||(o[t]={sales:0,qty:0}),o[t].sales+=parseFloat(e.usd_amount||0),o[t].qty+=parseFloat(e.quantity||0)});var i=Object.entries(o).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3);let l={};e.forEach(e=>{var t=e.city||"Bilinmiyor";l[t]||(l[t]={sales:0,qty:0}),l[t].sales+=parseFloat(e.usd_amount||0),l[t].qty+=parseFloat(e.quantity||0)});var s=Object.entries(l).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3);let d={};e.forEach(e=>{var t=e.sales_person||"Bilinmiyor";d[t]||(d[t]={sales:0,qty:0}),d[t].sales+=parseFloat(e.usd_amount||0),d[t].qty+=parseFloat(e.quantity||0)});var c=Object.entries(d).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3);let m={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";m[t]||(m[t]={sales:0,qty:0}),m[t].sales+=parseFloat(e.usd_amount||0),m[t].qty+=parseFloat(e.quantity||0)});var g=Object.entries(m).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3);let u={};e.forEach(e=>{var t=e.category_1||"Bilinmiyor";u[t]||(u[t]={sales:0,qty:0}),u[t].sales+=parseFloat(e.usd_amount||0),u[t].qty+=parseFloat(e.quantity||0)});var p,y=Object.entries(u).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3),h={positive:[],negative:[],neutral:[],recommendations:[]};if(0<i.length&&(p=((b=i[0])[1].sales/r*100).toFixed(1),h.positive.push({title:`ğŸª ${b[0]} Lider MaÄŸaza`,description:`${b[0]} maÄŸazasÄ± toplam satÄ±ÅŸÄ±n %${p}'ini gerÃ§ekleÅŸtirdi ($${b[1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})} / ${b[1].qty.toLocaleString("tr-TR",{minimumFractionDigits:2})} adet). Bu maÄŸaza bu Ã¼rÃ¼n/marka iÃ§in en gÃ¼Ã§lÃ¼ performansÄ± gÃ¶steriyor.`})),0<s.length&&(b=((p=s[0])[1].sales/r*100).toFixed(1),h.positive.push({title:`ğŸŒ ${p[0]} Ã–nde Gelen Ä°l`,description:`${p[0]} ili toplam satÄ±ÅŸÄ±n %${b}'ini oluÅŸturuyor ($${p[1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})} / ${p[1].qty.toLocaleString("tr-TR",{minimumFractionDigits:2})} adet). Bu bÃ¶lgede gÃ¼Ã§lÃ¼ talep var.`})),0<c.length&&(b=c.slice(0,Math.min(5,c.length)).map((e,t)=>{var a=(e[1].sales/r*100).toFixed(1);return`${t+1}. ${e[0]} (%${a}, $${e[1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})})`}).join(" | "),h.positive.push({title:"ğŸ‘¤ En BaÅŸarÄ±lÄ± 5 Temsilci",description:b})),h.neutral.push({title:"ğŸ“Š Genel Performans",description:`Toplam ${n} farklÄ± Ã¼rÃ¼n, ${t.toLocaleString("tr-TR",{minimumFractionDigits:2})} adet satÄ±ldÄ±. Ortalama Ã¼rÃ¼n fiyatÄ± $${a.toLocaleString("tr-TR",{minimumFractionDigits:2})}.`}),0<g.length&&(p=g.map(e=>{var t=(e[1].sales/r*100).toFixed(1);return e[0]+` (%${t})`}).join(", "),h.neutral.push({title:"ğŸ·ï¸ Marka DaÄŸÄ±lÄ±mÄ±",description:`En Ã§ok satan markalar: ${p}. Bu markalar toplam satÄ±ÅŸÄ±n bÃ¼yÃ¼k kÄ±smÄ±nÄ± oluÅŸturuyor.`})),0<y.length){let a={};e.forEach(e=>{var t=e.category_2||"Bilinmiyor";"all"===t.toLowerCase()||"bilinmiyor"===t.toLowerCase()||t.toLowerCase().includes("analitik")||t.toLowerCase().includes("eÄŸitim")||(a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0))});var b=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3);0<b.length&&(n=b.map(e=>{var t=(e[1].sales/r*100).toFixed(1);return e[0]+` (%${t})`}).join(", "),h.neutral.push({title:"ğŸ“‚ Kategori DaÄŸÄ±lÄ±mÄ±",description:`En Ã§ok satan kategoriler: ${n}. Bu kategorilerde yoÄŸunlaÅŸma var.`}))}1<i.length&&(t=i[0],g=i[1],b=((e=(p=t[1].sales)-(y=g[1].sales))/y*100).toFixed(1),n=Object.keys(o).length,y=(p/r*100).toFixed(1),30<b)&&h.negative.push({title:"âš ï¸ MaÄŸazalar ArasÄ± Performans FarkÄ±",description:`${t[0]} maÄŸazasÄ± toplam ${n} maÄŸaza iÃ§inde lider (%${y} pay). ${g[0]} maÄŸazasÄ±ndan $${e.toLocaleString("tr-TR",{minimumFractionDigits:2})} (%${b}) daha fazla satÄ±ÅŸ yapÄ±yor. DiÄŸer maÄŸazalarda stok, teÅŸhir, personel eÄŸitimi ve pazarlama aÃ§Ä±sÄ±ndan iyileÅŸtirme potansiyeli var.`}),5<Object.keys(l).length&&.5<s[0][1].sales/r&&h.negative.push({title:"ğŸŒ CoÄŸrafi YoÄŸunlaÅŸma",description:`SatÄ±ÅŸlarÄ±n bÃ¼yÃ¼k kÄ±smÄ± ${s[0][0]} ilinde yoÄŸunlaÅŸmÄ±ÅŸ. DiÄŸer illerde pazar payÄ± artÄ±rma fÄ±rsatÄ± var.`}),h.recommendations.push({icon:"ğŸ¯",title:"Stok Optimizasyonu",description:i[0][0]+" maÄŸazasÄ±nda bu Ã¼rÃ¼n/marka iÃ§in stok seviyesini artÄ±rÄ±n. Bu maÄŸaza en yÃ¼ksek satÄ±ÅŸ performansÄ±nÄ± gÃ¶steriyor ve stok tÃ¼kenmesi riski var."}),h.recommendations.push({icon:"ğŸ“",title:"CoÄŸrafi GeniÅŸleme",description:`${s[0][0]} ilindeki baÅŸarÄ±yÄ± analiz edin ve benzer demografik Ã¶zelliklere sahip diÄŸer illerde (${s.slice(1,3).map(e=>e[0]).join(", ")}) pazarlama kampanyalarÄ± dÃ¼zenleyin.`}),h.recommendations.push({icon:"ğŸ‘¥",title:"Temsilci EÄŸitimi",description:c[0][0]+"'in satÄ±ÅŸ tekniklerini diÄŸer temsilcilerle paylaÅŸÄ±n. Bu temsilcinin baÅŸarÄ± stratejilerini eÄŸitim programÄ±na dahil edin."}),300<a&&h.recommendations.push({icon:"ğŸ’³",title:"Ã–deme KolaylÄ±ÄŸÄ±",description:`Ortalama Ã¼rÃ¼n fiyatÄ± $${a.toLocaleString("tr-TR",{minimumFractionDigits:2})} gibi yÃ¼ksek bir seviyede. Taksit seÃ§enekleri ve finansman imkanlarÄ± sunarak satÄ±ÅŸlarÄ± artÄ±rabilirsiniz.`}),3<=i.length&&(p=i[2])[1].sales<.3*i[0][1].sales&&h.recommendations.push({icon:"ğŸ“¢",title:"DÃ¼ÅŸÃ¼k PerformanslÄ± MaÄŸazalar",description:p[0]+" ve benzeri maÄŸazalarda Ã¶zel promosyonlar dÃ¼zenleyin. Bu maÄŸazalarda satÄ±ÅŸ potansiyeli henÃ¼z tam olarak kullanÄ±lmamÄ±ÅŸ."});t=`
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px;">
                    ${0<h.positive.length?`
                    <div class="analysis-section">
                        <h3 style="color: white; margin-top: 0;">âœ… GÃ¼Ã§lÃ¼ YÃ¶nler</h3>
                        ${h.positive.map(e=>`
                            <div class="insight-item insight-positive" style="background: rgba(56, 239, 125, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #38ef7d;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">âœ…</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<h.negative.length?`
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">âš ï¸ Dikkat Edilmesi Gerekenler</h3>
                        ${h.negative.map(e=>`
                            <div class="insight-item insight-negative" style="background: rgba(245, 87, 108, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #f5576c;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">âš ï¸</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<h.neutral.length?`
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">ğŸ’¡ Genel Bilgiler</h3>
                        ${h.neutral.map(e=>`
                            <div class="insight-item insight-neutral" style="background: rgba(255, 215, 0, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #ffd700;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">ğŸ’¡</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">ğŸ¯ Aksiyon Ã–nerileri</h3>
                        ${h.recommendations.map(e=>`
                            <div class="recommendation" style="background: rgba(255, 255, 255, 0.15); padding: 18px; border-radius: 10px; margin: 12px 0;">
                                <span class="recommendation-icon" style="font-size: 1.8em; margin-right: 12px;">${e.icon}</span>
                                <div style="display: inline-block; vertical-align: top; width: calc(100% - 50px);">
                                    <strong style="font-size: 1.15em; display: block; margin-bottom: 8px;">${e.title}</strong>
                                    <p style="margin: 0; opacity: 0.95; line-height: 1.6;">${e.description}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;document.getElementById("productAIAnalysisContent").innerHTML=t,document.getElementById("productAIAnalysisPanel").style.display="block"}let queryCostTracker={totalQueries:parseInt(localStorage.getItem("gpt_total_queries")||"0"),totalCost:parseFloat(localStorage.getItem("gpt_total_cost")||"0"),monthlyQueries:parseInt(localStorage.getItem("gpt_monthly_queries")||"0"),monthlyCost:parseFloat(localStorage.getItem("gpt_monthly_cost")||"0"),lastResetDate:localStorage.getItem("gpt_last_reset")||(new Date).toISOString().slice(0,7)};function checkMonthlyReset(){var e=(new Date).toISOString().slice(0,7);queryCostTracker.lastResetDate!==e&&(queryCostTracker.monthlyQueries=0,queryCostTracker.monthlyCost=0,queryCostTracker.lastResetDate=e,localStorage.setItem("gpt_monthly_queries","0"),localStorage.setItem("gpt_monthly_cost","0"),localStorage.setItem("gpt_last_reset",e))}function updateQueryCost(e,t,a){checkMonthlyReset();let r=0;return"gpt-3.5-turbo"===e?r=t/1e3*5e-4+a/1e3*.0015:"gpt-4-turbo"===e?r=t/1e3*.01+a/1e3*.03:"gpt-4o-mini"===e&&(r=t/1e3*15e-5+a/1e3*6e-4),queryCostTracker.totalQueries++,queryCostTracker.totalCost+=r,queryCostTracker.monthlyQueries++,queryCostTracker.monthlyCost+=r,localStorage.setItem("gpt_total_queries",queryCostTracker.totalQueries.toString()),localStorage.setItem("gpt_total_cost",queryCostTracker.totalCost.toFixed(4)),localStorage.setItem("gpt_monthly_queries",queryCostTracker.monthlyQueries.toString()),localStorage.setItem("gpt_monthly_cost",queryCostTracker.monthlyCost.toFixed(4)),console.log(`ğŸ’° GPT Maliyet: $${r.toFixed(4)} | AylÄ±k Toplam: $${queryCostTracker.monthlyCost.toFixed(2)} (${queryCostTracker.monthlyQueries} sorgu)`),r}async function callGPTAPI(e,t){console.log("ğŸ¤– GPT API Ã§aÄŸrÄ±sÄ± hazÄ±rlanÄ±yor..."),console.log("ğŸ“ Sorgu:",e),console.log("ğŸ“Š Context boyutu:",JSON.stringify(t).length,"karakter");try{var a,r=await fetch("YOUR_BACKEND_URL_HERE",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,context:t,model:"gpt-3.5-turbo"})});if(r.ok)return(a=await r.json()).usage&&updateQueryCost(a.model||"gpt-3.5-turbo",a.usage.prompt_tokens,a.usage.completion_tokens),{success:!0,answer:a.answer,model:a.model,cost:a.cost};throw new Error("Backend error: "+r.status)}catch(e){return console.error("âŒ GPT API HatasÄ±:",e),{success:!1,error:e.message}}}function showCostStats(){checkMonthlyReset();var e=`
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    <h4 style="margin: 0 0 10px 0;">ğŸ’° GPT Maliyet Ä°statistikleri</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <strong>Bu Ay:</strong><br>
                            ${queryCostTracker.monthlyQueries} sorgu<br>
                            $${queryCostTracker.monthlyCost.toFixed(2)} (~${(30*queryCostTracker.monthlyCost).toFixed(0)} TL)
                        </div>
                        <div>
                            <strong>Toplam:</strong><br>
                            ${queryCostTracker.totalQueries} sorgu<br>
                            $${queryCostTracker.totalCost.toFixed(2)}
                        </div>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                        ğŸ“Š Ortalama: $${(queryCostTracker.monthlyCost/Math.max(queryCostTracker.monthlyQueries,1)).toFixed(4)}/sorgu
                    </div>
                </div>
            `,t=document.getElementById("debugPanel");t&&"block"===t.style.display&&(document.getElementById("debugInfo").innerHTML+=e)}window.showGPTStats=function(){checkMonthlyReset(),console.log("ğŸ’° GPT Maliyet Ä°statistikleri:"),console.log("Bu Ay:",queryCostTracker.monthlyQueries,"sorgu, $"+queryCostTracker.monthlyCost.toFixed(2)),console.log("Toplam:",queryCostTracker.totalQueries,"sorgu, $"+queryCostTracker.totalCost.toFixed(2)),console.log("Ortalama:","$"+(queryCostTracker.monthlyCost/Math.max(queryCostTracker.monthlyQueries,1)).toFixed(4),"per sorgu")},window.resetGPTStats=function(){confirm("TÃ¼m GPT maliyet istatistiklerini sÄ±fÄ±rlamak istediÄŸinize emin misiniz?")&&(localStorage.removeItem("gpt_total_queries"),localStorage.removeItem("gpt_total_cost"),localStorage.removeItem("gpt_monthly_queries"),localStorage.removeItem("gpt_monthly_cost"),localStorage.removeItem("gpt_last_reset"),queryCostTracker={totalQueries:0,totalCost:0,monthlyQueries:0,monthlyCost:0,lastResetDate:(new Date).toISOString().slice(0,7)},console.log("âœ… GPT maliyet istatistikleri sÄ±fÄ±rlandÄ±."))},console.log("âœ… GPT Backend hazÄ±r! KullanÄ±m:"),console.log("   showGPTStats() - Maliyet istatistiklerini gÃ¶ster"),console.log("   resetGPTStats() - Maliyet istatistiklerini sÄ±fÄ±rla");let customerBrandChartMainInstance=null,customerCategoryChartMainInstance=null;function searchCustomerProfileMain(){let t=document.getElementById("customerSearchInputMain").value.trim().toLowerCase();var e,a,r,n,o,i,l,s;t?(console.log("ğŸ” MÃ¼ÅŸteri aranÄ±yor:",t),0===(e=allData.filter(e=>e.partner&&e.partner.toLowerCase().includes(t))).length?(document.getElementById("customerProfileMainContainer").style.display="none",alert("MÃ¼ÅŸteri bulunamadÄ±. LÃ¼tfen farklÄ± bir isim deneyin.")):(document.getElementById("customerProfileMainContainer").style.display="block",document.getElementById("topCustomersSection").style.display="none",document.getElementById("customerChartsSection").style.display="none",a=e[0].partner,r=e[0].city||"Bilinmiyor",n=e[0].tags||"-",o=e.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),i=e.reduce((e,t)=>e+parseFloat(t.quantity||0),0),l=new Set(e.map(e=>e.date)).size,s=o/Math.max(l,1),document.getElementById("customerNameMain").textContent=a,document.getElementById("customerCityMain").textContent=r,document.getElementById("customerTagsMain").textContent=n,document.getElementById("customerTotalSalesMain").textContent="$"+o.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("customerTotalQtyMain").textContent=i.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("customerTransactionCountMain").textContent=l,document.getElementById("customerAvgBasketMain").textContent="$"+s.toLocaleString("tr-TR",{minimumFractionDigits:2}),renderCustomerBrandChartMain(e),renderCustomerCategoryChartMain(e),renderCustomerPurchaseHistoryMain(lastCustomerPurchaseData=e),performCustomerAIAnalysisMain(e,{name:a,city:r,tags:n,totalSales:o,totalQty:i,transactionCount:l,avgBasket:s}),document.getElementById("customerProfileMainContainer").scrollIntoView({behavior:"smooth",block:"start"}))):alert("LÃ¼tfen bir mÃ¼ÅŸteri adÄ± girin")}function clearCustomerSearchMain(){document.getElementById("customerSearchInputMain").value="",document.getElementById("customerProfileMainContainer").style.display="none",document.getElementById("topCustomersSection").style.display="block",document.getElementById("customerChartsSection").style.display="grid",console.log("âœ… MÃ¼ÅŸteri aramasÄ± temizlendi, Top 30 ve grafikler gÃ¶steriliyor")}function renderCustomerBrandChartMain(e){let a={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});var e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10),t=e.map(e=>e[0]),e=e.map(e=>e[1]),r=document.getElementById("customerBrandChartMain");r&&(customerBrandChartMainInstance&&customerBrandChartMainInstance.destroy(),customerBrandChartMainInstance=new Chart(r,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:e,backgroundColor:"rgba(102, 126, 234, 0.6)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function renderCustomerCategoryChartMain(e){let a={};e.forEach(e=>{var t=e.category_2||e.category_1||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});var e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10),t=e.map(e=>e[0]),e=e.map(e=>e[1]),r=document.getElementById("customerCategoryChartMain");r&&(customerCategoryChartMainInstance&&customerCategoryChartMainInstance.destroy(),customerCategoryChartMainInstance=new Chart(r,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:e,backgroundColor:"rgba(56, 239, 125, 0.6)",borderColor:"rgba(56, 239, 125, 1)",borderWidth:2}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function renderCustomerPurchaseHistoryMain(t=null,r=null,e){if((t=(t=null===t&&lastCustomerPurchaseData?lastCustomerPurchaseData:t)&&t.filter(e=>!e._isDiscount))&&0!==t.length){null!==r&&(currentCustomerPurchaseSortDirection=currentCustomerPurchaseSortColumn===r?"asc"===currentCustomerPurchaseSortDirection?"desc":"asc":"date"===(currentCustomerPurchaseSortColumn=r)?"desc":"asc");let e=[...t];"date"===currentCustomerPurchaseSortColumn?e.sort((e,t)=>{e=new Date(e.date),t=new Date(t.date);return"asc"===currentCustomerPurchaseSortDirection?e-t:t-e}):"product"===currentCustomerPurchaseSortColumn?e.sort((e,t)=>"asc"===currentCustomerPurchaseSortDirection?(e.product||"").localeCompare(t.product||"","tr"):(t.product||"").localeCompare(e.product||"","tr")):"brand"===currentCustomerPurchaseSortColumn?e.sort((e,t)=>"asc"===currentCustomerPurchaseSortDirection?(e.brand||"").localeCompare(t.brand||"","tr"):(t.brand||"").localeCompare(e.brand||"","tr")):"quantity"===currentCustomerPurchaseSortColumn?e.sort((e,t)=>"asc"===currentCustomerPurchaseSortDirection?parseFloat(e.quantity||0)-parseFloat(t.quantity||0):parseFloat(t.quantity||0)-parseFloat(e.quantity||0)):"amount"===currentCustomerPurchaseSortColumn?e.sort((e,t)=>"asc"===currentCustomerPurchaseSortDirection?parseFloat(e.usd_amount||0)-parseFloat(t.usd_amount||0):parseFloat(t.usd_amount||0)-parseFloat(e.usd_amount||0)):"store"===currentCustomerPurchaseSortColumn&&e.sort((e,t)=>"asc"===currentCustomerPurchaseSortDirection?(e.store||"").localeCompare(t.store||"","tr"):(t.store||"").localeCompare(e.store||"","tr")),e=e.slice(0,20);r=e=>currentCustomerPurchaseSortColumn!==e?"â‡…":"asc"===currentCustomerPurchaseSortDirection?"â†‘":"â†“";let a=`
                <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <tr>
                            <th style="padding: 12px; text-align: left; cursor: pointer;" onclick="renderCustomerPurchaseHistoryMain(null, 'date')">
                                Tarih ${r("date")}
                            </th>
                            <th style="padding: 12px; text-align: left; cursor: pointer;" onclick="renderCustomerPurchaseHistoryMain(null, 'product')">
                                ÃœrÃ¼n ${r("product")}
                            </th>
                            <th style="padding: 12px; text-align: left; cursor: pointer;" onclick="renderCustomerPurchaseHistoryMain(null, 'brand')">
                                Marka ${r("brand")}
                            </th>
                            <th style="padding: 12px; text-align: right; cursor: pointer;" onclick="renderCustomerPurchaseHistoryMain(null, 'quantity')">
                                Adet ${r("quantity")}
                            </th>
                            <th style="padding: 12px; text-align: right; cursor: pointer;" onclick="renderCustomerPurchaseHistoryMain(null, 'amount')">
                                Tutar ${r("amount")}
                            </th>
                            <th style="padding: 12px; text-align: left; cursor: pointer;" onclick="renderCustomerPurchaseHistoryMain(null, 'store')">
                                MaÄŸaza ${r("store")}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
            `;e.forEach((e,t)=>{a+=`
                    <tr style="border-bottom: 1px solid #eee; ${t%2==0?"background: #f8f9fa;":""}">
                        <td style="padding: 10px;">${e.date}</td>
                        <td style="padding: 10px;"><strong>${e.product}</strong></td>
                        <td style="padding: 10px;">${e.brand}</td>
                        <td style="padding: 10px; text-align: right;">${parseFloat(e.quantity||0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 10px; text-align: right; color: #38ef7d; font-weight: bold;">$${parseFloat(e.usd_amount||0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 10px;">${e.store}</td>
                    </tr>
                `}),a+=`
                    </tbody>
                </table>
            `,document.getElementById("customerPurchaseHistoryMain").innerHTML=a}else document.getElementById("customerPurchaseHistoryMain").innerHTML='<p style="text-align: center; padding: 20px;">Veri bulunamadÄ±</p>'}function performCustomerAIAnalysisMain(e,t){console.log("ğŸ¤– MÃ¼ÅŸteri AI analizi baÅŸlatÄ±lÄ±yor...",t);let a={},r={},n={},o={};e.forEach(e=>{var t=e.brand||"Bilinmiyor",t=(a[t]||(a[t]={sales:0,qty:0,count:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0),a[t].count+=1,e.category_2||e.category_1||"Bilinmiyor"),t=(r[t]||(r[t]={sales:0,qty:0}),r[t].sales+=parseFloat(e.usd_amount||0),r[t].qty+=parseFloat(e.quantity||0),e.store||"Bilinmiyor"),t=(n[t]||(n[t]={sales:0,count:0}),n[t].sales+=parseFloat(e.usd_amount||0),n[t].count+=1,e.date?e.date.substring(0,7):"Bilinmiyor");o[t]||(o[t]=0),o[t]+=parseFloat(e.usd_amount||0)});var i=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3),l=Object.entries(r).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3),s=Object.entries(n).sort((e,t)=>t[1].sales-e[1].sales).slice(0,3),d=Object.entries(o).sort((e,t)=>new Date(t[0])-new Date(e[0])).slice(0,6);let c={};e.forEach(e=>{var t=e.product||"Bilinmiyor";c[t]||(c[t]={qty:0,sales:0}),c[t].qty+=parseFloat(e.quantity||0),c[t].sales+=parseFloat(e.usd_amount||0)});var m=Object.entries(c).sort((e,t)=>t[1].qty-e[1].qty)[0],g={positive:[],negative:[],neutral:[],recommendations:[]},e=(1e4<t.totalSales?g.positive.push({title:"ğŸ’ VIP MÃ¼ÅŸteri",description:`${t.name}, toplam $${t.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})} alÄ±ÅŸveriÅŸ ile VIP mÃ¼ÅŸteri kategorisinde. Bu mÃ¼ÅŸteriye Ã¶zel ilgi gÃ¶sterilmeli.`}):5e3<t.totalSales&&g.positive.push({title:"â­ DeÄŸerli MÃ¼ÅŸteri",description:`${t.name}, toplam $${t.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})} alÄ±ÅŸveriÅŸ ile deÄŸerli mÃ¼ÅŸteri kategorisinde.`}),10<t.transactionCount&&g.positive.push({title:"ğŸ”„ SadÄ±k MÃ¼ÅŸteri",description:t.transactionCount+" iÅŸlem ile dÃ¼zenli alÄ±ÅŸveriÅŸ yapan sadÄ±k bir mÃ¼ÅŸteri. MÃ¼ÅŸteri memnuniyeti yÃ¼ksek."}),1e3<t.avgBasket&&g.positive.push({title:"ğŸ›’ YÃ¼ksek Sepet OrtalamasÄ±",description:`Ortalama sepet tutarÄ± $${t.avgBasket.toLocaleString("tr-TR",{minimumFractionDigits:2})}. Premium Ã¼rÃ¼nlere ilgi gÃ¶steriyor.`}),0<i.length&&g.positive.push({title:"ğŸ·ï¸ Favori Marka: "+i[0][0],description:`${i[0][0]} markasÄ±ndan $${i[0][1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})} deÄŸerinde ${i[0][1].count} adet Ã¼rÃ¼n aldÄ±. Bu markada yeni Ã¼rÃ¼nler Ã¶nerilmeli.`}),t.transactionCount<3&&g.negative.push({title:"âš ï¸ Yeni MÃ¼ÅŸteri",description:`Sadece ${t.transactionCount} iÅŸlem gerÃ§ekleÅŸtirdi. MÃ¼ÅŸteri sadakati oluÅŸturmak iÃ§in Ã¶zel kampanyalar sunulmalÄ±.`}),t.avgBasket<500&&g.negative.push({title:"ğŸ“Š DÃ¼ÅŸÃ¼k Sepet OrtalamasÄ±",description:`Ortalama sepet tutarÄ± $${t.avgBasket.toLocaleString("tr-TR",{minimumFractionDigits:2})}. Cross-sell ve up-sell fÄ±rsatlarÄ± deÄŸerlendirilmeli.`}),0<e.length?new Date(Math.max(...e.map(e=>new Date(e.date)))):null),m=(e&&90<(e=Math.floor((new Date-e)/864e5))&&g.negative.push({title:"â° Uzun SÃ¼redir AlÄ±ÅŸveriÅŸ Yok",description:`Son alÄ±ÅŸveriÅŸten ${e} gÃ¼n geÃ§ti. MÃ¼ÅŸteriyi geri kazanmak iÃ§in hatÄ±rlatma kampanyasÄ± dÃ¼zenlenebilir.`}),g.neutral.push({title:"ğŸ“ Konum Bilgisi",description:`MÃ¼ÅŸteri ${t.city} ÅŸehrinden alÄ±ÅŸveriÅŸ yapÄ±yor. `+(0<s.length?`En Ã§ok ${s[0][0]} maÄŸazasÄ±nÄ± tercih ediyor.`:"")}),0<l.length&&g.neutral.push({title:"ğŸ“‚ Ä°lgi AlanÄ±: "+l[0][0],description:`${l[0][0]} kategorisinden $${l[0][1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})} deÄŸerinde alÄ±ÅŸveriÅŸ yaptÄ±.`}),m&&g.neutral.push({title:"ğŸ¯ En Ã‡ok AldÄ±ÄŸÄ± ÃœrÃ¼n",description:`${m[0]} Ã¼rÃ¼nÃ¼nden ${m[1].qty.toLocaleString("tr-TR",{minimumFractionDigits:2})} adet aldÄ±.`}),1<i.length&&g.recommendations.push({icon:"ğŸ",title:"Ã‡apraz SatÄ±ÅŸ FÄ±rsatÄ±",description:`MÃ¼ÅŸteri ${i.map(e=>e[0]).join(", ")} markalarÄ±nÄ± tercih ediyor. Bu markalarÄ±n yeni Ã¼rÃ¼nleri ve aksesuarlarÄ± Ã¶nerilebilir.`}),500<t.avgBasket&&g.recommendations.push({icon:"ğŸ’³",title:"Premium ÃœrÃ¼n Ã–nerisi",description:"YÃ¼ksek sepet ortalamasÄ± nedeniyle premium ve lÃ¼ks Ã¼rÃ¼nler Ã¶nerilebilir. Ã–zel koleksiyonlar sunulmalÄ±."}),5<t.transactionCount&&g.recommendations.push({icon:"ğŸ–ï¸",title:"Sadakat ProgramÄ±",description:"DÃ¼zenli mÃ¼ÅŸteri olduÄŸu iÃ§in sadakat programÄ±na dahil edilmeli. Ã–zel indirimler ve erken eriÅŸim fÄ±rsatlarÄ± sunulabilir."}),0<s.length&&g.recommendations.push({icon:"ğŸª",title:"MaÄŸaza BazlÄ± Kampanya",description:s[0][0]+" maÄŸazasÄ±nÄ± sÄ±klÄ±kla tercih ediyor. Bu maÄŸazada Ã¶zel etkinlikler ve lansmanlar iÃ§in davet gÃ¶nderilebilir."}),g.recommendations.push({icon:"ğŸ“§",title:"KiÅŸiselleÅŸtirilmiÅŸ Ä°letiÅŸim",description:`${0<l.length?l[0][0]:"Ä°lgi alanÄ±"} kategorisindeki yeni Ã¼rÃ¼nler hakkÄ±nda e-posta veya SMS ile bilgilendirme yapÄ±labilir.`}),0<d.length&&(e=d.reduce((e,t)=>e+t[1],0)/d.length,g.recommendations.push({icon:"ğŸ“Š",title:"AlÄ±ÅŸveriÅŸ Tahmini",description:`AylÄ±k ortalama $${e.toLocaleString("tr-TR",{minimumFractionDigits:2})} alÄ±ÅŸveriÅŸ yapÄ±yor. Gelecek ay iÃ§in Ã¶zel teklifler hazÄ±rlanabilir.`})),`
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px;">
                    ${0<g.positive.length?`
                    <div class="analysis-section">
                        <h3 style="color: white; margin-top: 0;">âœ… GÃ¼Ã§lÃ¼ YÃ¶nler</h3>
                        ${g.positive.map(e=>`
                            <div class="insight-item insight-positive" style="background: rgba(56, 239, 125, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #38ef7d;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">âœ…</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<g.negative.length?`
                    <div class="analysis-section" style="margin-top: 30px;">
                        <h3 style="color: white;">âš ï¸ Dikkat Edilmesi Gerekenler</h3>
                        ${g.negative.map(e=>`
                            <div class="insight-item insight-negative" style="background: rgba(255, 107, 107, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #ff6b6b;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">âš ï¸</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<g.neutral.length?`
                    <div class="analysis-section" style="margin-top: 30px;">
                        <h3 style="color: white;">ğŸ“Š Genel Bilgiler</h3>
                        ${g.neutral.map(e=>`
                            <div class="insight-item insight-neutral" style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid white;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">ğŸ“Š</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<g.recommendations.length?`
                    <div class="analysis-section" style="margin-top: 30px;">
                        <h3 style="color: white;">ğŸ’¡ Aksiyon Ã–nerileri</h3>
                        ${g.recommendations.map(e=>`
                            <div class="recommendation" style="background: rgba(255, 215, 0, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #ffd700; display: flex; align-items: start; gap: 15px;">
                                <span class="recommendation-icon" style="font-size: 2em; flex-shrink: 0;">${e.icon}</span>
                                <div style="flex: 1;">
                                    <strong style="font-size: 1.1em; display: block; margin-bottom: 5px;">${e.title}</strong>
                                    <span style="opacity: 0.95;">${e.description}</span>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                </div>
            `);document.getElementById("customerAIAnalysisContentMain").innerHTML=m,document.getElementById("customerAIAnalysisPanelMain").style.display="block"}let customerBrandChartInstance=null,customerCategoryChartInstance=null,customerStoreChartInstance=null,customerMonthlyTrendChartInstance=null;function populateCityDropdownForCustomerSearch(){console.log("âš ï¸ Bu fonksiyon artÄ±k kullanÄ±lmÄ±yor")}let customerSuggestionIndex=-1,salespersonSuggestionIndex=-1,storeSuggestionIndex=-1,selectedCustomers=[],selectedStores=[];function showCustomerSuggestions(r){var e=document.getElementById("customerSuggestions"),t=r.split(","),t=t[t.length-1].trim().toLowerCase();if((r=t).length<2)e.style.display="none";else if(allData&&0!==allData.length){let a={};allData.forEach(e=>{var t=e.partner||"";t&&t.toLowerCase().includes(r)&&(a[t]||(a[t]={name:t,sales:0,count:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].count+=1)});t=Object.values(a).sort((e,t)=>t.sales-e.sales).slice(0,10);if(0===t.length)e.style.display="none";else{let a="";t.forEach((e,t)=>{a+=`<div class="suggestion-item" data-index="${t}" data-name="${e.name}" 
                    style="padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #e0e0e0; transition: background 0.2s;"
                    onmouseover="this.style.background='#f0f0ff'; customerSuggestionIndex=${t};"
                    onmouseout="this.style.background='white';"
                    onclick="selectCustomerSuggestion('${e.name.replace(/'/g,"\\'")}')">
                    <strong>${e.name}</strong>
                    <span style="color: #667eea; margin-left: 10px; font-size: 0.9em;">
                        $${e.sales.toLocaleString("tr-TR",{minimumFractionDigits:2})} â€¢ ${e.count} sipariÅŸ
                    </span>
                </div>`}),e.innerHTML=a,e.style.display="block",customerSuggestionIndex=-1}}}function selectCustomerSuggestion(e){3<=selectedCustomers.length?alert("âš ï¸ En fazla 3 mÃ¼ÅŸteri seÃ§ebilirsiniz!"):selectedCustomers.includes(e)?alert("âš ï¸ Bu mÃ¼ÅŸteri zaten seÃ§ili!"):(selectedCustomers.push(e),updateSelectedCustomersTags(),document.getElementById("customerSearchInput").value="",document.getElementById("customerSuggestions").style.display="none",searchCustomerProfile())}function updateSelectedCustomersTags(){var e=document.getElementById("selectedCustomersContainer"),t=document.getElementById("selectedCustomersTags");0===selectedCustomers.length?e.style.display="none":(e.style.display="block",t.innerHTML=selectedCustomers.map((e,t)=>`
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 20px; display: flex; align-items: center; gap: 8px; font-size: 0.9em;">
                    <span>ğŸ‘¤ ${e}</span>
                    <button onclick="removeCustomer(${t})" 
                            style="background: rgba(255,255,255,0.3); border: none; color: white; width: 20px; height: 20px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.8em;">
                        Ã—
                    </button>
                </div>
            `).join(""))}function removeCustomer(e){selectedCustomers.splice(e,1),updateSelectedCustomersTags(),0===selectedCustomers.length?document.getElementById("customerProfileContainer").style.display="none":searchCustomerProfile()}function handleCustomerKeydown(e){var t=document.getElementById("customerSuggestions"),a=t.querySelectorAll(".suggestion-item");0!==a.length&&("ArrowDown"===e.key?(e.preventDefault(),customerSuggestionIndex=Math.min(customerSuggestionIndex+1,a.length-1),highlightCustomerSuggestion(a)):"ArrowUp"===e.key?(e.preventDefault(),customerSuggestionIndex=Math.max(customerSuggestionIndex-1,0),highlightCustomerSuggestion(a)):"Enter"===e.key?(e.preventDefault(),0<=customerSuggestionIndex&&a[customerSuggestionIndex]?selectCustomerSuggestion(a[customerSuggestionIndex].getAttribute("data-name")):searchCustomerProfile()):"Escape"===e.key&&(t.style.display="none"))}function highlightCustomerSuggestion(e){e.forEach((e,t)=>{t===customerSuggestionIndex?(e.style.background="#f0f0ff",e.scrollIntoView({block:"nearest"})):e.style.background="white"})}function showSalespersonSuggestions(n){var e=document.getElementById("salespersonSuggestions");if((n=n.trim().toLowerCase()).length<2)e.style.display="none";else if(allData&&0!==allData.length){let r={};allData.forEach(e=>{var t=e.sales_person||"",a=e.store||"";a.toLowerCase().includes("analitik")||a.toLowerCase().includes("eÄŸitim")||t&&t.toLowerCase().includes(n)&&(r[t]||(r[t]={name:t,sales:0,count:0}),r[t].sales+=parseFloat(e.usd_amount||0),r[t].count+=1)});var t=Object.values(r).sort((e,t)=>t.sales-e.sales).slice(0,10);if(0===t.length)e.style.display="none";else{let a="";t.forEach((e,t)=>{a+=`<div class="suggestion-item" data-index="${t}" data-name="${e.name}" 
                    style="padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #e0e0e0; transition: background 0.2s;"
                    onmouseover="this.style.background='#f0f0ff'; salespersonSuggestionIndex=${t};"
                    onmouseout="this.style.background='white';"
                    onclick="selectSalespersonSuggestion('${e.name.replace(/'/g,"\\'")}')">
                    <strong>${e.name}</strong>
                    <span style="color: #667eea; margin-left: 10px; font-size: 0.9em;">
                        $${e.sales.toLocaleString("tr-TR",{minimumFractionDigits:2})} â€¢ ${e.count} satÄ±ÅŸ
                    </span>
                </div>`}),e.innerHTML=a,e.style.display="block",salespersonSuggestionIndex=-1}}}function selectSalespersonSuggestion(e){3<=selectedSalespersons.length?alert("âš ï¸ En fazla 3 satÄ±ÅŸ temsilcisi seÃ§ebilirsiniz!"):selectedSalespersons.includes(e)?alert("âš ï¸ Bu temsilci zaten seÃ§ili!"):(selectedSalespersons.push(e),updateSelectedSalespersonsTags(),document.getElementById("salespersonSearchInput").value="",document.getElementById("salespersonSuggestions").style.display="none",searchSalespersonProfile())}function updateSelectedSalespersonsTags(){var e=document.getElementById("selectedSalespersonsContainer"),t=document.getElementById("selectedSalespersonsTags");0===selectedSalespersons.length?e.style.display="none":(e.style.display="block",t.innerHTML=selectedSalespersons.map(e=>`
                <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 20px; font-size: 0.9em;">
                    <span>ğŸ‘¨â€ğŸ’¼ ${e}</span>
                    <button onclick="removeSalesperson('${e.replace(/'/g,"\\'")}'); event.stopPropagation();" 
                            style="background: rgba(255,255,255,0.3); border: none; color: white; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.8em;">
                        Ã—
                    </button>
                </div>
            `).join(""))}function removeSalesperson(t){selectedSalespersons=selectedSalespersons.filter(e=>e!==t),updateSelectedSalespersonsTags(),0<selectedSalespersons.length?searchSalespersonProfile():document.getElementById("salespersonProfileContainer").style.display="none"}function handleSalespersonKeydown(e){var t=document.getElementById("salespersonSuggestions"),a=t.querySelectorAll(".suggestion-item");0!==a.length&&("ArrowDown"===e.key?(e.preventDefault(),salespersonSuggestionIndex=Math.min(salespersonSuggestionIndex+1,a.length-1),highlightSalespersonSuggestion(a)):"ArrowUp"===e.key?(e.preventDefault(),salespersonSuggestionIndex=Math.max(salespersonSuggestionIndex-1,0),highlightSalespersonSuggestion(a)):"Enter"===e.key?(e.preventDefault(),0<=salespersonSuggestionIndex&&a[salespersonSuggestionIndex]?selectSalespersonSuggestion(a[salespersonSuggestionIndex].getAttribute("data-name")):searchSalespersonProfile()):"Escape"===e.key&&(t.style.display="none"))}function highlightSalespersonSuggestion(e){e.forEach((e,t)=>{t===salespersonSuggestionIndex?(e.style.background="#f0f0ff",e.scrollIntoView({block:"nearest"})):e.style.background="white"})}function showStoreSuggestions(r){var e=document.getElementById("storeSuggestions");if((r=r.trim().toLowerCase()).length<2)e.style.display="none";else if(allData&&0!==allData.length){let a={};allData.forEach(e=>{var t=e.store||"";t&&t.toLowerCase().includes(r)&&(a[t]||(a[t]={name:t,sales:0,count:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].count+=1)});var t=Object.values(a).sort((e,t)=>t.sales-e.sales).slice(0,10);if(0===t.length)e.style.display="none";else{let a="";t.forEach((e,t)=>{a+=`<div class="suggestion-item" data-index="${t}" data-name="${e.name}" 
                    style="padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #e0e0e0; transition: background 0.2s;"
                    onmouseover="this.style.background='#f0f0ff'; storeSuggestionIndex=${t};"
                    onmouseout="this.style.background='white';"
                    onclick="selectStoreSuggestion('${e.name.replace(/'/g,"\\'")}')">
                    <strong>${e.name}</strong>
                    <span style="color: #667eea; margin-left: 10px; font-size: 0.9em;">
                        $${e.sales.toLocaleString("tr-TR",{minimumFractionDigits:2})} â€¢ ${e.count} satÄ±ÅŸ
                    </span>
                </div>`}),e.innerHTML=a,e.style.display="block",storeSuggestionIndex=-1}}}function selectStoreSuggestion(e){3<=selectedStores.length?alert("âš ï¸ En fazla 3 maÄŸaza seÃ§ebilirsiniz!"):selectedStores.includes(e)?alert("âš ï¸ Bu maÄŸaza zaten seÃ§ili!"):(selectedStores.push(e),updateSelectedStoresTags(),document.getElementById("storeSearchInput").value="",document.getElementById("storeSuggestions").style.display="none",searchStoreProfile())}function updateSelectedStoresTags(){var e=document.getElementById("selectedStoresContainer"),t=document.getElementById("selectedStoresTags");0===selectedStores.length?e.style.display="none":(e.style.display="block",t.innerHTML=selectedStores.map((e,t)=>`
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 20px; display: flex; align-items: center; gap: 8px; font-size: 0.9em;">
                    <span>ğŸª ${e}</span>
                    <button onclick="removeStore(${t})" 
                            style="background: rgba(255,255,255,0.3); border: none; color: white; width: 20px; height: 20px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.8em;">
                        Ã—
                    </button>
                </div>
            `).join(""))}function removeStore(e){selectedStores.splice(e,1),updateSelectedStoresTags(),0===selectedStores.length?document.getElementById("storeProfileContainer").style.display="none":searchStoreProfile()}function handleStoreKeydown(e){var t=document.getElementById("storeSuggestions"),a=t.querySelectorAll(".suggestion-item");0!==a.length&&("ArrowDown"===e.key?(e.preventDefault(),storeSuggestionIndex=Math.min(storeSuggestionIndex+1,a.length-1),highlightStoreSuggestion(a)):"ArrowUp"===e.key?(e.preventDefault(),storeSuggestionIndex=Math.max(storeSuggestionIndex-1,0),highlightStoreSuggestion(a)):"Enter"===e.key?(e.preventDefault(),0<=storeSuggestionIndex&&a[storeSuggestionIndex]?selectStoreSuggestion(a[storeSuggestionIndex].getAttribute("data-name")):searchStoreProfile()):"Escape"===e.key&&(t.style.display="none"))}function highlightStoreSuggestion(e){e.forEach((e,t)=>{t===storeSuggestionIndex?(e.style.background="#f0f0ff",e.scrollIntoView({block:"nearest"})):e.style.background="white"})}function searchCustomerProfile(){let n=[];if(0<selectedCustomers.length)n=selectedCustomers;else{var e=document.getElementById("customerSearchInput").value.trim();if(!e)return void alert("LÃ¼tfen bir mÃ¼ÅŸteri adÄ± girin veya listeden seÃ§in");e=e.split(",").map(e=>e.trim()).filter(e=>e);if(0===e.length)return void alert("LÃ¼tfen geÃ§erli bir mÃ¼ÅŸteri adÄ± girin");let r={};if(allData.forEach(e=>{e=e.partner||"";e&&!r[e]&&(r[e]=e)}),n=[],e.forEach(e=>{let t=e.toLowerCase();var a,e=Object.keys(r).filter(e=>e.toLowerCase().includes(t));0<e.length&&(a=e.find(e=>e.toLowerCase()===t),n.push(a||e[0]))}),0===n.length)return void alert("âŒ Girilen isimlere uygun mÃ¼ÅŸteri bulunamadÄ±!");3<(n=[...new Set(n)]).length&&(alert("âš ï¸ En fazla 3 mÃ¼ÅŸteri arayabilirsiniz!"),n=n.slice(0,3))}if(console.log("ğŸ” MÃ¼ÅŸteriler aranÄ±yor:",n),1===n.length){let t=n[0];var a,r,o,i,l,s,d,c,m,e=allData.filter(e=>e.partner&&e.partner.toLowerCase()===t.toLowerCase());0===e.length?(document.getElementById("customerProfileContainer").style.display="none",document.getElementById("customerSearchNoResults").style.display="block"):(document.getElementById("customerSearchNoResults").style.display="none",document.getElementById("customerProfileContainer").style.display="block",a=e[0].partner,r=e[0].city||"Bilinmiyor",o=e[0].tags||"-",i=e.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),l=e.reduce((e,t)=>e+parseFloat(t.quantity||0),0),s=new Set(e.map(e=>e.date)).size,d=i/Math.max(s,1),c=(m=e.map(e=>new Date(e.date)).sort((e,t)=>e-t))[0].toLocaleDateString("tr-TR"),m=m[m.length-1].toLocaleDateString("tr-TR"),document.getElementById("customerName").textContent=a,document.getElementById("customerCity").textContent=r,document.getElementById("customerTags").textContent=o,document.getElementById("customerTotalSales").textContent="$"+i.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("customerTotalQty").textContent=l.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("customerTransactionCount").textContent=s,document.getElementById("customerAvgBasket").textContent="$"+d.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("customerFirstPurchase").textContent=c,document.getElementById("customerLastPurchase").textContent=m,renderCustomerBrandChart(e),renderCustomerCategoryChart(e),renderCustomerStoreChart(e),renderCustomerMonthlyTrendChart(e),renderCustomerPurchaseHistory(e),performCustomerAIAnalysis(e,{name:a,city:r,tags:o,totalSales:i,totalQty:l,transactionCount:s,avgBasket:d,firstPurchase:c,lastPurchase:m}))}else alert("ğŸš§ Ã‡oklu mÃ¼ÅŸteri karÅŸÄ±laÅŸtÄ±rma Ã¶zelliÄŸi yakÄ±nda eklenecek!")}function renderCustomerBrandChart(e){let a={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),e=e.map(e=>e[1].sales),r=document.getElementById("customerBrandChart");r&&(customerBrandChartInstance&&customerBrandChartInstance.destroy(),customerBrandChartInstance=new Chart(r,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:e,backgroundColor:"rgba(102, 126, 234, 0.6)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function renderCustomerCategoryChart(e){let a={};e.forEach(e=>{var t=e.category_2||e.category_1||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),e=e.map(e=>e[1].sales),r=document.getElementById("customerCategoryChart");r&&(customerCategoryChartInstance&&customerCategoryChartInstance.destroy(),customerCategoryChartInstance=new Chart(r,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:e,backgroundColor:"rgba(56, 239, 125, 0.6)",borderColor:"rgba(56, 239, 125, 1)",borderWidth:2}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function renderCustomerStoreChart(e){let a={};e.forEach(e=>{var t=e.store||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),e=e.map(e=>e[1].sales),r=document.getElementById("customerStoreChart");r&&(customerStoreChartInstance&&customerStoreChartInstance.destroy(),customerStoreChartInstance=new Chart(r,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:e,backgroundColor:"rgba(245, 87, 108, 0.6)",borderColor:"rgba(245, 87, 108, 1)",borderWidth:2}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function renderCustomerMonthlyTrendChart(e){let a={};e.forEach(e=>{var t=new Date(e.date),t=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0");a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});var e=Object.entries(a).sort((e,t)=>e[0].localeCompare(t[0])),t=e.map(e=>e[0]),e=e.map(e=>e[1]),r=document.getElementById("customerMonthlyTrendChart");r&&(customerMonthlyTrendChartInstance&&customerMonthlyTrendChartInstance.destroy(),customerMonthlyTrendChartInstance=new Chart(r,{type:"line",data:{labels:t,datasets:[{label:"AylÄ±k SatÄ±ÅŸ (USD)",data:e,borderColor:"rgba(102, 126, 234, 1)",backgroundColor:"rgba(102, 126, 234, 0.1)",borderWidth:3,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}function renderCustomerPurchaseHistory(e){e=[...e].sort((e,t)=>new Date(t.date)-new Date(e.date)).slice(0,50);let a=`
                <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <tr>
                            <th style="padding: 15px; text-align: left;">Tarih</th>
                            <th style="padding: 15px; text-align: left;">ÃœrÃ¼n</th>
                            <th style="padding: 15px; text-align: left;">Marka</th>
                            <th style="padding: 15px; text-align: right;">Adet</th>
                            <th style="padding: 15px; text-align: right;">Tutar</th>
                            <th style="padding: 15px; text-align: left;">MaÄŸaza</th>
                        </tr>
                    </thead>
                    <tbody>
            `;e.forEach((e,t)=>{a+=`
                    <tr style="border-bottom: 1px solid #eee; ${t%2==0?"background: #f8f9fa;":""}">
                        <td style="padding: 12px;">${e.date}</td>
                        <td style="padding: 12px;"><strong>${e.product}</strong></td>
                        <td style="padding: 12px;">${e.brand}</td>
                        <td style="padding: 12px; text-align: right;">${parseFloat(e.quantity||0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: right; color: #38ef7d; font-weight: bold;">$${parseFloat(e.usd_amount||0).toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px;">${e.store}</td>
                    </tr>
                `}),a+=`
                    </tbody>
                </table>
            `,document.getElementById("customerPurchaseHistory").innerHTML=a}function performCustomerAIAnalysis(e,t){console.log("ğŸ¤– MÃ¼ÅŸteri AI analizi baÅŸlatÄ±lÄ±yor...");var a={positive:[],negative:[],neutral:[],recommendations:[]},r=(4e4<t.totalSales&&a.positive.push({title:"ğŸ‘‘ VIP MÃ¼ÅŸteri",description:`Toplam ${t.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})} USD alÄ±ÅŸveriÅŸ yapmÄ±ÅŸ. Bu mÃ¼ÅŸteriye Ã¶zel ilgi gÃ¶sterilmeli.`}),new Date(t.firstPurchase.split(".").reverse().join("-"))),n=new Date(t.lastPurchase.split(".").reverse().join("-")),n=Math.floor((n-r)/864e5);365<n&&a.positive.push({title:"ğŸ’ SadÄ±k MÃ¼ÅŸteri",description:Math.floor(n/365)+" yÄ±ldan fazla sÃ¼redir mÃ¼ÅŸteri. Uzun vadeli iliÅŸki kurulmuÅŸ."}),3e3<t.avgBasket&&a.positive.push({title:"ğŸ’° YÃ¼ksek Sepet DeÄŸeri",description:`Ortalama sepet deÄŸeri $${t.avgBasket.toLocaleString("tr-TR",{minimumFractionDigits:2})}. Premium Ã¼rÃ¼nleri tercih ediyor.`});let o={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";o[t]||(o[t]=0),o[t]+=parseFloat(e.usd_amount||0)});r=Object.entries(o).sort((e,t)=>t[1]-e[1])[0],n=(r[1]/t.totalSales*100).toFixed(1),50<n&&a.neutral.push({title:`ğŸ·ï¸ ${r[0]} MarkasÄ±na SadÄ±k`,description:`AlÄ±ÅŸveriÅŸlerin %${n}'i ${r[0]} markasÄ±ndan. Bu markadaki yeni Ã¼rÃ¼nleri Ã¶nerebilirsiniz.`}),a.recommendations.push({icon:"ğŸ",title:"KiÅŸiselleÅŸtirilmiÅŸ Kampanya",description:r[0]+" markasÄ±ndaki yeni Ã¼rÃ¼nler iÃ§in Ã¶zel indirim sunun."}),a.recommendations.push({icon:"ğŸ“§",title:"E-posta Bildirimi",description:`Tercih ettiÄŸi kategorilerdeki (${e[0].category_1}) yeni Ã¼rÃ¼nler iÃ§in e-posta gÃ¶nderin.`}),3e3<t.avgBasket&&a.recommendations.push({icon:"â­",title:"VIP Program",description:"YÃ¼ksek sepet deÄŸeri nedeniyle VIP mÃ¼ÅŸteri programÄ±na davet edin."}),n=`
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px;">
                    ${0<a.positive.length?`
                    <div class="analysis-section">
                        <h3 style="color: white; margin-top: 0;">âœ… MÃ¼ÅŸteri Profili</h3>
                        ${a.positive.map(e=>`
                            <div class="insight-item insight-positive" style="background: rgba(56, 239, 125, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #38ef7d;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">âœ…</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<a.neutral.length?`
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">ğŸ’¡ SatÄ±n Alma DavranÄ±ÅŸÄ±</h3>
                        ${a.neutral.map(e=>`
                            <div class="insight-item insight-neutral" style="background: rgba(255, 215, 0, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #ffd700;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">ğŸ’¡</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">ğŸ¯ KiÅŸiselleÅŸtirilmiÅŸ Ã–neriler</h3>
                        ${a.recommendations.map(e=>`
                            <div class="recommendation" style="background: rgba(255, 255, 255, 0.15); padding: 18px; border-radius: 10px; margin: 12px 0;">
                                <span class="recommendation-icon" style="font-size: 1.8em; margin-right: 12px;">${e.icon}</span>
                                <div style="display: inline-block; vertical-align: top; width: calc(100% - 50px);">
                                    <strong style="font-size: 1.15em; display: block; margin-bottom: 8px;">${e.title}</strong>
                                    <p style="margin: 0; opacity: 0.95; line-height: 1.6;">${e.description}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;document.getElementById("customerAIAnalysisContent").innerHTML=n}document.addEventListener("click",function(e){e.target.closest("#customerSearchInput")||e.target.closest("#customerSuggestions")||(document.getElementById("customerSuggestions").style.display="none"),e.target.closest("#salespersonSearchInput")||e.target.closest("#salespersonSuggestions")||(document.getElementById("salespersonSuggestions").style.display="none"),e.target.closest("#storeSearchInput")||e.target.closest("#storeSuggestions")||(document.getElementById("storeSuggestions").style.display="none")});let storeBrandChartInstance=null,storeCategoryChartInstance=null,storeSalespersonChartInstance=null,storeMonthlyChartInstance=null,lastStoreTopProductsData=null;function populateStoreYearFilter(){if(allData&&0!==allData.length){let t=new Set,a=new Set,r=new Set;allData.forEach(e=>{e.date&&3<=(e=e.date.split("-")).length&&(t.add(e[0]),a.add(e[1]),r.add(e[2]))}),populateMultiSelect("filterStoreYear",Array.from(t).sort().reverse(),"countStoreYear"),populateMultiSelect("filterStoreMonth",Array.from(a).sort(),"countStoreMonth"),populateMultiSelect("filterStoreDay",Array.from(r).sort(),"countStoreDay")}}function clearStoreFilters(){var e=document.querySelectorAll('#filterStoreYear input[type="checkbox"]'),t=document.querySelectorAll('#filterStoreMonth input[type="checkbox"]'),a=document.querySelectorAll('#filterStoreDay input[type="checkbox"]');e.forEach(e=>e.checked=!1),t.forEach(e=>e.checked=!1),a.forEach(e=>e.checked=!1),updateSelectionCount("filterStoreYear","countStoreYear"),updateSelectionCount("filterStoreMonth","countStoreMonth"),updateSelectionCount("filterStoreDay","countStoreDay"),console.log("âœ… MaÄŸaza filtreleri temizlendi")}function performMultipleSalespersonsAIAnalysis(e){console.log("ğŸ¤– Ã‡oklu satÄ±ÅŸ temsilcisi karÅŸÄ±laÅŸtÄ±rmalÄ± AI analizi baÅŸlatÄ±lÄ±yor...");let a={positive:[],negative:[],neutral:[],recommendations:[]};var t,r=e.map(e=>e.name).join(", "),r=(a.neutral.push(`ğŸ” ${e.length} satÄ±ÅŸ temsilcisi karÅŸÄ±laÅŸtÄ±rÄ±lÄ±yor: `+r),[...e].sort((e,t)=>t.totalSales-e.totalSales)),n=(a.positive.push(`ğŸ† En yÃ¼ksek satÄ±ÅŸ: <strong>${r[0].name}</strong> - $`+r[0].totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})),1<r.length&&(t=((n=r[0].totalSales-r[1].totalSales)/r[1].totalSales*100).toFixed(1),a.neutral.push(`ğŸ“Š 1. ve 2. arasÄ±ndaki fark: $${n.toLocaleString("tr-TR",{minimumFractionDigits:2})} (%${t})`)),2<r.length&&a.negative.push(`âš ï¸ En dÃ¼ÅŸÃ¼k satÄ±ÅŸ: <strong>${r[r.length-1].name}</strong> - $`+r[r.length-1].totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})),[...e].sort((e,t)=>t.totalQty-e.totalQty));a.positive.push(`ğŸ“¦ En yÃ¼ksek adet: <strong>${n[0].name}</strong> - ${n[0].totalQty.toLocaleString("tr-TR",{minimumFractionDigits:2})} adet`),e.forEach(e=>{var t=e.totalSales/Math.max(e.uniqueCustomers,1);5e3<t?a.positive.push(`ğŸ’° <strong>${e.name}</strong> mÃ¼ÅŸteri baÅŸÄ±na yÃ¼ksek ortalama: $`+t.toLocaleString("tr-TR",{minimumFractionDigits:2})):t<1e3&&a.negative.push(`ğŸ“‰ <strong>${e.name}</strong> mÃ¼ÅŸteri baÅŸÄ±na dÃ¼ÅŸÃ¼k ortalama: $`+t.toLocaleString("tr-TR",{minimumFractionDigits:2}))}),a.recommendations.push(`ğŸ¯ <strong>${r[0].name}</strong>'in stratejilerini diÄŸer temsilcilerle paylaÅŸÄ±n`),1<r.length&&0<(t=r.slice(Math.ceil(r.length/2))).length&&a.recommendations.push(`ğŸ“š ${t.map(e=>e.name).join(", ")} iÃ§in ek eÄŸitim ve mentorluk programÄ± dÃ¼ÅŸÃ¼nÃ¼n`),a.recommendations.push("ğŸ¤ TÃ¼m temsilciler iÃ§in ortak hedefler belirleyin ve takÄ±m Ã§alÄ±ÅŸmasÄ±nÄ± teÅŸvik edin"),a.recommendations.push("ğŸ“Š AylÄ±k performans toplantÄ±larÄ± dÃ¼zenleyerek en iyi uygulamalarÄ± paylaÅŸÄ±n");let o='<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; color: white; margin-bottom: 30px;">';o+='<h3 style="margin: 0 0 20px 0; font-size: 1.8em;">ğŸ¤– KarÅŸÄ±laÅŸtÄ±rmalÄ± AI Performans Analizi</h3>',0<a.positive.length&&(o+='<div style="margin-bottom: 20px;"><h4 style="color: #4ade80; margin-bottom: 10px;">âœ… GÃ¼Ã§lÃ¼ YÃ¶nler:</h4><ul style="margin: 0; padding-left: 20px;">',a.positive.forEach(e=>o+=`<li style="margin-bottom: 8px;">${e}</li>`),o+="</ul></div>"),0<a.negative.length&&(o+='<div style="margin-bottom: 20px;"><h4 style="color: #fbbf24; margin-bottom: 10px;">âš ï¸ GeliÅŸim AlanlarÄ±:</h4><ul style="margin: 0; padding-left: 20px;">',a.negative.forEach(e=>o+=`<li style="margin-bottom: 8px;">${e}</li>`),o+="</ul></div>"),0<a.neutral.length&&(o+='<div style="margin-bottom: 20px;"><h4 style="color: #e0e7ff; margin-bottom: 10px;">ğŸ“Š Genel Durum:</h4><ul style="margin: 0; padding-left: 20px;">',a.neutral.forEach(e=>o+=`<li style="margin-bottom: 8px;">${e}</li>`),o+="</ul></div>"),0<a.recommendations.length&&(o+='<div><h4 style="color: #a78bfa; margin-bottom: 10px;">ğŸ’¡ Ã–neriler:</h4><ul style="margin: 0; padding-left: 20px;">',a.recommendations.forEach(e=>o+=`<li style="margin-bottom: 8px;">${e}</li>`),o+="</ul></div>"),o+="</div>";n=document.getElementById("salespersonAIAnalysisContent");n&&(n.innerHTML=o)}function searchStoreProfile(){let n=[];if(0<selectedStores.length)n=selectedStores;else{var e=document.getElementById("storeSearchInput").value.trim();if(!e)return void alert("LÃ¼tfen bir maÄŸaza adÄ± girin veya listeden seÃ§in");e=e.split(",").map(e=>e.trim().toLowerCase()).filter(e=>e);if(0===e.length)return void alert("LÃ¼tfen geÃ§erli bir maÄŸaza adÄ± girin");let r={};if(allData.forEach(e=>{e=e.store||"";e&&!r[e]&&(r[e]=e)}),n=[],e.forEach(t=>{var e,a=Object.keys(r).filter(e=>e.toLowerCase().includes(t));0<a.length&&(e=a.find(e=>e.toLowerCase()===t),n.push(e||a[0]))}),0===n.length)return void alert("âŒ Girilen isimlere uygun maÄŸaza bulunamadÄ±!");3<(n=[...new Set(n)]).length&&(alert("âš ï¸ En fazla 3 maÄŸaza arayabilirsiniz!"),n=n.slice(0,3))}console.log("ğŸ” MaÄŸazalar aranÄ±yor:",n);var e=Array.from(document.querySelectorAll('#filterStoreYear input[type="checkbox"]:checked')).map(e=>e.value),t=Array.from(document.querySelectorAll('#filterStoreMonth input[type="checkbox"]:checked')).map(e=>e.value),a=Array.from(document.querySelectorAll('#filterStoreDay input[type="checkbox"]:checked')).map(e=>e.value);1===n.length?renderSingleStoreView(n[0],e,t,a):renderMultipleStoresView(n,e,t,a)}function renderSingleStoreView(a,r,n,o){var e,t,i,l,s,d,c,m,g,u=allData.filter(e=>{if(!e.store||e.store.toLowerCase()!==a.toLowerCase())return!1;var t=(e.store||"").toLowerCase();if(t.includes("analitik")||t.includes("eÄŸitim"))return!1;if(!e.date)return!1;if(0<r.length){t=e.date.substring(0,4);if(!r.includes(t))return!1}if(0<n.length){t=e.date.substring(5,7);if(!n.includes(t))return!1}if(0<o.length){t=e.date.substring(8,10);if(!o.includes(t))return!1}return!0});0===u.length?(document.getElementById("storeProfileContainer").style.display="none",document.getElementById("storeSearchNoResults").style.display="block"):(document.getElementById("storeSearchNoResults").style.display="none",document.getElementById("storeProfileContainer").style.display="block",document.getElementById("singleStoreView").style.display="block",document.getElementById("multipleStoresView").style.display="none",document.getElementById("storeBrandCategorySection").style.display="grid",document.getElementById("storeTopProductsSection").style.display="block",document.getElementById("storeFullSalespersonSection").style.display="block",e=u[0].store,t=u.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),i=u.reduce((e,t)=>e+parseFloat(t.quantity||0),0),l=new Set(u.map(e=>e.date)).size,g=new Set(u.map(e=>e.move_name)).size,s=t/Math.max(l,1),d=t/Math.max(g,1),c=new Set(u.map(e=>e.partner)).size,m=new Set(u.map(e=>e.product)).size,document.getElementById("storeBrandChartTitle").textContent=`ğŸ·ï¸ ${e} - En Ã‡ok Satan Markalar (Top 10)`,document.getElementById("storeCategoryChartTitle").textContent=`ğŸ“‚ ${e} - En Ã‡ok Satan Kategoriler`,document.getElementById("storeSalespersonChartTitle").textContent=`ğŸ‘¨â€ğŸ’¼ ${e} - SatÄ±ÅŸ Temsilcileri`,document.getElementById("storeMonthlyChartTitle").textContent=`ğŸ“ˆ ${e} - AylÄ±k Performans Trendi`,document.getElementById("storeName").textContent=e,document.getElementById("storeTotalSales").textContent="$"+t.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("storeTotalQty").textContent=i.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("storeInvoiceCount").textContent=g,document.getElementById("storeAvgTransaction").textContent="$"+s.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("storeAvgBasket").textContent="$"+d.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("storeUniqueCustomers").textContent=c,document.getElementById("storeUniqueProducts").textContent=m,renderStoreBrandChart(u),renderStoreCategoryChart(u),renderStoreSalespersonChart(u),renderStoreMonthlyChart(u),renderStoreTopProducts(u),renderStoreFullSalespersonTable(u),g=allData.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),performStoreAIAnalysis(u,{name:e,totalSales:t,totalQty:i,transactionCount:l,avgTransaction:s,uniqueCustomers:c,uniqueProducts:m,totalAllSales:g,storeSalesPercentage:(t/g*100).toFixed(1)}))}function renderMultipleStoresView(e,c,m,g){var t,e=e.map(a=>{var e=allData.filter(e=>{if(!e.store||e.store.toLowerCase()!==a.toLowerCase())return!1;var t=(e.store||"").toLowerCase();if(t.includes("analitik")||t.includes("eÄŸitim"))return!1;if(!e.date)return!1;if(0<c.length){t=e.date.substring(0,4);if(!c.includes(t))return!1}if(0<m.length){t=e.date.substring(5,7);if(!m.includes(t))return!1}if(0<g.length){t=e.date.substring(8,10);if(!g.includes(t))return!1}return!0}),t=e.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),r=e.reduce((e,t)=>e+parseFloat(t.quantity||0),0),n=new Set(e.map(e=>e.date)).size,o=new Set(e.map(e=>e.move_name)).size,i=t/Math.max(n,1),l=t/Math.max(o,1),s=new Set(e.map(e=>e.partner)).size,d=new Set(e.map(e=>e.product)).size;return{name:a,data:e,invoiceCount:o,avgBasket:l,totalSales:t,totalQty:r,transactionCount:n,avgTransaction:i,uniqueCustomers:s,uniqueProducts:d}}).filter(e=>0<e.data.length);0===e.length?(document.getElementById("storeProfileContainer").style.display="none",document.getElementById("storeSearchNoResults").style.display="block"):(document.getElementById("storeSearchNoResults").style.display="none",document.getElementById("storeProfileContainer").style.display="block",document.getElementById("singleStoreView").style.display="none",document.getElementById("multipleStoresView").style.display="block",renderStoreComparisonTable(e),renderStoreComparisonCharts(e),renderStoreComparisonCategoryCharts(e),document.getElementById("storeBrandCategorySection").style.display="none",document.getElementById("storeTopProductsSection").style.display="none",document.getElementById("storeFullSalespersonSection").style.display="none",(t=document.getElementById("storeAIAnalysisPanel"))&&(t.style.display="block"),performMultipleStoresAIAnalysis(e))}function renderStoreComparisonTable(e){var t=document.getElementById("storeComparisonTableContainer"),e=`
                <table style="width: 100%; border-collapse: collapse; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <th style="padding: 15px; text-align: left;">Metrik</th>
                            ${e.map(e=>`<th style="padding: 15px; text-align: right;">ğŸª ${e.name}</th>`).join("")}
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: white;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ’° Toplam SatÄ±ÅŸ</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">$${e.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>`).join("")}
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ“¦ Toplam Adet</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">${e.totalQty.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>`).join("")}
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ›’ Fatura SayÄ±sÄ±</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">${e.invoiceCount}</td>`).join("")}
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ“Š GÃ¼nlÃ¼k Ort. SatÄ±ÅŸ</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">$${e.avgTransaction.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>`).join("")}
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ›’ Sepet OrtalamasÄ±</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">$${e.avgBasket.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>`).join("")}
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ‘¥ FarklÄ± MÃ¼ÅŸteri</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">${e.uniqueCustomers}</td>`).join("")}
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ¯ FarklÄ± ÃœrÃ¼n</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">${e.uniqueProducts}</td>`).join("")}
                        </tr>
                    </tbody>
                </table>
            `;t.innerHTML=e}function renderStoreComparisonCharts(e){var t=e.map(e=>e.name),a=e.map(e=>e.totalSales),e=e.map(e=>e.totalQty),r=["rgba(102, 126, 234, 0.7)","rgba(240, 147, 251, 0.7)","rgba(255, 159, 64, 0.7)"],n=["rgba(102, 126, 234, 1)","rgba(240, 147, 251, 1)","rgba(255, 159, 64, 1)"],o=document.getElementById("comparisonStoreSalesChart"),o=(comparisonStoreSalesChartInstance&&comparisonStoreSalesChartInstance.destroy(),comparisonStoreSalesChartInstance=new Chart(o,{type:"bar",data:{labels:t,datasets:[{label:"Toplam SatÄ±ÅŸ ($)",data:a,backgroundColor:r,borderColor:n,borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return"$"+e.parsed.y.toLocaleString("tr-TR",{minimumFractionDigits:2})}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}),document.getElementById("comparisonStoreQtyChart"));comparisonStoreQtyChartInstance&&comparisonStoreQtyChartInstance.destroy(),comparisonStoreQtyChartInstance=new Chart(o,{type:"bar",data:{labels:t,datasets:[{label:"Toplam Adet",data:e,backgroundColor:r,borderColor:n,borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return e.parsed.y.toLocaleString("tr-TR",{minimumFractionDigits:2})+" adet"}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return e.toLocaleString("tr-TR")}}}}}})}function renderStoreCategoryComparisonTable(e){var n=document.getElementById("storeCategoryComparisonTableContainer");if(n){let t=e.map(e=>{let a={};e.data.forEach(e=>{var t=e.category_1&&"all"!==e.category_1.toLowerCase()?e.category_1:e.category_2||e.category_3||"DiÄŸer";t.toLowerCase().includes("analitik")||t.toLowerCase().includes("eÄŸitim")||(a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0))});var t=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10);return{name:e.name,categories:t,totalSales:t.reduce((e,t)=>e+t[1],0)}}),a=new Set,r=(t.forEach(e=>{e.categories.forEach(([e])=>a.add(e))}),`
                <table style="width: 100%; border-collapse: collapse; box-shadow: 0 2px 10px rgba(0,0,0,0.1); background: white; border-radius: 10px; overflow: hidden;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <th style="padding: 20px; text-align: left; font-size: 1.1em; position: sticky; left: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index: 10;">ğŸ“‚ Kategori</th>
            `);t.forEach(e=>{r+=`<th style="padding: 20px; text-align: center; font-size: 1.1em; min-width: 150px;">ğŸª ${e.name}</th>`}),r+="</tr></thead><tbody>",Array.from(a).sort().forEach((a,e)=>{e=e%2==0?"#f8f9fa":"white";r=(r+=`<tr style="background: ${e}; border-bottom: 1px solid #e9ecef;">`)+`<td style="padding: 15px; font-weight: 600; position: sticky; left: 0; background: ${e}; z-index: 5;">${a}</td>`,t.forEach(e=>{var t=e.categories.find(([e])=>e===a);t?(e=((t=t[1])/e.totalSales*100).toFixed(1),r+=`
                            <td style="padding: 15px; text-align: center;">
                                <div style="font-weight: bold; color: #667eea; font-size: 1.1em;">$${t.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                                <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">${e}%</div>
                            </td>
                        `):r+='<td style="padding: 15px; text-align: center; color: #adb5bd;">-</td>'}),r+="</tr>"}),r+=`
                <tr style="background: linear-gradient(135deg, #38ef7d 0%, #11998e 100%); color: white; font-weight: bold;">
                    <td style="padding: 20px; font-size: 1.1em; position: sticky; left: 0; background: linear-gradient(135deg, #38ef7d 0%, #11998e 100%); z-index: 10;">ğŸ’° TOPLAM</td>
            `,t.forEach(e=>{r+=`<td style="padding: 20px; text-align: center; font-size: 1.2em;">$${e.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})}</td>`}),r+="</tr></tbody></table>",n.innerHTML=r}}function renderStoreComparisonCategoryCharts(e){var t=document.getElementById("storeComparisonCategoryCharts");if(t)return console.log("ğŸ“Š Kategori karÅŸÄ±laÅŸtÄ±rmasÄ± baÅŸlatÄ±lÄ±yor...",e.length,"maÄŸaza"),void renderStoreCategoryComparisonTable(e);else console.error("âŒ storeComparisonCategoryCharts container bulunamadÄ±!")}function performMultipleStoresAIAnalysis(e){console.log("ğŸ¤– Ã‡oklu maÄŸaza karÅŸÄ±laÅŸtÄ±rmalÄ± AI analizi baÅŸlatÄ±lÄ±yor...",e);let r={positive:[],negative:[],neutral:[],recommendations:[],categories:[]};var t=e.map(e=>e.name).join(", "),t=(r.neutral.push(`ğŸ” <strong>${e.length} MaÄŸaza DetaylÄ± KarÅŸÄ±laÅŸtÄ±rma:</strong> `+t),[...e].sort((e,t)=>t.totalSales-e.totalSales)),a=t.reduce((e,t)=>e+t.totalSales,0);let n=a/t.length;r.positive.push(`ğŸ† <strong>SatÄ±ÅŸ Lideri:</strong> ${t[0].name} - $${t[0].totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})} (Toplam satÄ±ÅŸÄ±n %${(t[0].totalSales/a*100).toFixed(1)}'i)`),1<t.length&&(o=((a=t[0].totalSales-t[1].totalSales)/t[1].totalSales*100).toFixed(1),r.neutral.push(`ğŸ“Š <strong>Lider FarkÄ±:</strong> 1. sÄ±radaki maÄŸaza 2. sÄ±radan $${a.toLocaleString("tr-TR",{minimumFractionDigits:2})} (%${o}) daha fazla satÄ±ÅŸ yapÄ±yor`),0<(a=t.filter(e=>e.totalSales<n)).length)&&r.negative.push(`âš ï¸ <strong>Ortalama AltÄ± Performans:</strong> ${a.map(e=>e.name).join(", ")} ortalama satÄ±ÅŸÄ±n ($${n.toLocaleString("tr-TR",{minimumFractionDigits:2})}) altÄ±nda`),2<t.length&&(o=t[t.length-1],a=t[0].totalSales-o.totalSales,r.negative.push(`ğŸ“‰ <strong>En DÃ¼ÅŸÃ¼k Performans:</strong> ${o.name} - $${o.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})} (Liderden %${(a/t[0].totalSales*100).toFixed(1)} daha az)`));var o=[...e].sort((e,t)=>t.totalQty-e.totalQty),a=[...e].sort((e,t)=>t.avgBasket-e.avgBasket),o=(r.positive.push(`ğŸ“¦ <strong>En YÃ¼ksek Adet SatÄ±ÅŸÄ±:</strong> ${o[0].name} - ${o[0].totalQty.toLocaleString("tr-TR")} adet`),r.positive.push(`ğŸ›’ <strong>En YÃ¼ksek Sepet OrtalamasÄ±:</strong> ${a[0].name} - $${a[0].avgBasket.toLocaleString("tr-TR",{minimumFractionDigits:2})}/fatura`),e.filter(e=>e.avgBasket<100));0<o.length&&r.negative.push(`âš ï¸ <strong>DÃ¼ÅŸÃ¼k Sepet OrtalamasÄ±:</strong> ${o.map(e=>`${e.name} ($${e.avgBasket.toFixed(2)})`).join(", ")} - Cross-selling fÄ±rsatÄ± var`);let i={};e.forEach(a=>{a.data.forEach(e=>{var t=e.category_1&&"all"!==e.category_1.toLowerCase()?e.category_1:e.category_2||e.category_3||"DiÄŸer";t.toLowerCase().includes("analitik")||t.toLowerCase().includes("eÄŸitim")||(i[t]||(i[t]={}),i[t][a.name]||(i[t][a.name]=0),i[t][a.name]+=parseFloat(e.usd_amount||0))})}),Object.entries(i).forEach(([e,t])=>{var a,t=Object.entries(t).sort((e,t)=>t[1]-e[1]);0<t.length&&1e3<t[0][1]&&(a=t[0],t=t.reduce((e,[,t])=>e+t,0),t=(a[1]/t*100).toFixed(1),r.categories.push(`ğŸ“‚ <strong>${e}:</strong> ${a[0]} lider ($${a[1].toLocaleString("tr-TR",{minimumFractionDigits:2})}, %${t})`))}),r.recommendations.push(`ğŸ¯ <strong>${t[0].name}</strong> en iyi uygulamalarÄ±nÄ± (satÄ±ÅŸ teknikleri, Ã¼rÃ¼n yerleÅŸimi, mÃ¼ÅŸteri hizmetleri) diÄŸer maÄŸazalarla paylaÅŸmalÄ±`),0<o.length&&r.recommendations.push(`ğŸ›’ ${o.map(e=>e.name).join(", ")} iÃ§in <strong>cross-selling ve up-selling eÄŸitimleri</strong> dÃ¼zenleyin - Sepet ortalamasÄ±nÄ± artÄ±rma potansiyeli yÃ¼ksek`);a=Object.entries(i).map(([e,t])=>[e,Object.values(t).reduce((e,t)=>e+t,0)]).sort((e,t)=>t[1]-e[1]).slice(0,3);0<a.length&&r.recommendations.push(`ğŸ“Š <strong>En Ã§ok satan 3 kategori:</strong> ${a.map(([e])=>e).join(", ")} - Bu kategorilerde stok ve teÅŸhir optimizasyonu yapÄ±n`),1<t.length&&0<(e=t.slice(Math.ceil(t.length/2))).length&&r.recommendations.push(`ğŸ“š <strong>${e.map(e=>e.name).join(", ")}</strong> iÃ§in: Trafik analizi, personel verimliliÄŸi, Ã¼rÃ¼n Ã§eÅŸitliliÄŸi ve fiyatlandÄ±rma stratejilerini gÃ¶zden geÃ§irin`),r.recommendations.push("ğŸ¤ <strong>AylÄ±k Performans ToplantÄ±larÄ±:</strong> MaÄŸaza mÃ¼dÃ¼rleri arasÄ± best practice paylaÅŸÄ±mÄ± ve sorun Ã§Ã¶zme workshoplarÄ± dÃ¼zenleyin"),r.recommendations.push("ğŸ“Š <strong>MÃ¼ÅŸteri Geri Bildirimleri:</strong> Her maÄŸaza iÃ§in NPS (Net Promoter Score) ve mÃ¼ÅŸteri memnuniyeti anketleri yaparak performans farklÄ±lÄ±klarÄ±nÄ±n nedenlerini analiz edin");let l='<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; color: white; margin-bottom: 30px;">';l+='<h3 style="margin: 0 0 20px 0; font-size: 1.8em;">ğŸ¤– KarÅŸÄ±laÅŸtÄ±rmalÄ± AI Performans Analizi</h3>',0<r.positive.length&&(l+='<div style="margin-bottom: 20px;"><h4 style="color: #4ade80; margin-bottom: 10px;">âœ… GÃ¼Ã§lÃ¼ YÃ¶nler:</h4><ul style="margin: 0; padding-left: 20px;">',r.positive.forEach(e=>l+=`<li style="margin-bottom: 8px;">${e}</li>`),l+="</ul></div>"),0<r.negative.length&&(l+='<div style="margin-bottom: 20px;"><h4 style="color: #fbbf24; margin-bottom: 10px;">âš ï¸ GeliÅŸim AlanlarÄ±:</h4><ul style="margin: 0; padding-left: 20px;">',r.negative.forEach(e=>l+=`<li style="margin-bottom: 8px;">${e}</li>`),l+="</ul></div>"),0<r.neutral.length&&(l+='<div style="margin-bottom: 20px;"><h4 style="color: #e0e7ff; margin-bottom: 10px;">ğŸ“Š Genel Durum:</h4><ul style="margin: 0; padding-left: 20px;">',r.neutral.forEach(e=>l+=`<li style="margin-bottom: 8px;">${e}</li>`),l+="</ul></div>"),0<r.categories.length&&(l+='<div style="margin-bottom: 20px;"><h4 style="color: #fcd34d; margin-bottom: 10px;">ğŸ“‚ Kategori Liderlikleri:</h4><ul style="margin: 0; padding-left: 20px;">',r.categories.forEach(e=>l+=`<li style="margin-bottom: 8px;">${e}</li>`),l+="</ul></div>"),0<r.recommendations.length&&(l+='<div><h4 style="color: #a78bfa; margin-bottom: 10px;">ğŸ’¡ Stratejik Ã–neriler:</h4><ul style="margin: 0; padding-left: 20px;">',r.recommendations.forEach(e=>l+=`<li style="margin-bottom: 8px;">${e}</li>`),l+="</ul></div>"),l+="</div>";o=document.getElementById("multipleStoresAIContent"),o?(o.innerHTML=l,console.log("âœ… Ã‡oklu maÄŸaza AI analizi HTML eklendi")):console.error("âŒ multipleStoresAIContent bulunamadÄ±!"),a=document.getElementById("storeAIAnalysisContent");a&&(a.innerHTML=l)}function renderStoreBrandChart(e){let a={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=document.getElementById("storeBrandChart");t&&(storeBrandChartInstance&&storeBrandChartInstance.destroy(),storeBrandChartInstance=new Chart(t,{type:"bar",data:{labels:e.map(e=>e[0]),datasets:[{label:"SatÄ±ÅŸ (USD)",data:e.map(e=>e[1].sales),backgroundColor:"rgba(102, 126, 234, 0.6)"}]},options:{responsive:!0,maintainAspectRatio:!1}}))}function renderStoreCategoryChart(e){let a={};e.forEach(e=>{var t=e.category_2||"";!t||"all"===t.toLowerCase()||"bilinmiyor"===t.toLowerCase()||t.toLowerCase().includes("analitik")||t.toLowerCase().includes("eÄŸitim")||(a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0))});var e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10),t=document.getElementById("storeCategoryChart");t&&(storeCategoryChartInstance&&storeCategoryChartInstance.destroy(),storeCategoryChartInstance=new Chart(t,{type:"doughnut",data:{labels:e.map(e=>e[0]),datasets:[{data:e.map(e=>e[1])}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{color:"#fff",font:{weight:"bold",size:14},formatter:(e,t)=>(100*e/t.chart.data.datasets[0].data.reduce((e,t)=>e+t,0)).toFixed(1)+"%"}}},plugins:[ChartDataLabels]}))}function renderStoreSalespersonChart(e){let a={};e.forEach(e=>{var t=e.sales_person||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});var e=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10),t=document.getElementById("storeSalespersonChart");t&&(storeSalespersonChartInstance&&storeSalespersonChartInstance.destroy(),storeSalespersonChartInstance=new Chart(t,{type:"bar",data:{labels:e.map(e=>e[0]),datasets:[{label:"SatÄ±ÅŸ (USD)",data:e.map(e=>e[1]),backgroundColor:"rgba(118, 75, 162, 0.6)"}]},options:{responsive:!0,maintainAspectRatio:!1}}))}function renderStoreMonthlyChart(e){let n={},t=(e.forEach(e=>{var t=new Date(e.date),a=t.getFullYear(),t=String(t.getMonth()+1).padStart(2,"0");n[a]||(n[a]={}),n[a][t]||(n[a][t]=0),n[a][t]+=parseFloat(e.usd_amount||0)}),new Set),o=(Object.values(n).forEach(e=>{Object.keys(e).forEach(e=>t.add(e))}),Array.from(t).sort()),i=[],l=[{border:"rgba(102, 126, 234, 1)",bg:"rgba(102, 126, 234, 0.1)"},{border:"rgba(245, 87, 108, 1)",bg:"rgba(245, 87, 108, 0.1)"},{border:"rgba(56, 239, 125, 1)",bg:"rgba(56, 239, 125, 0.1)"}];Object.keys(n).sort().forEach((e,t)=>{let a=n[e];var r=o.map(e=>a[e]||0),t=l[t%l.length];i.push({label:""+e,data:r,borderColor:t.border,backgroundColor:t.bg,borderWidth:3,fill:!0,tension:.4})});e=document.getElementById("storeMonthlyChart");if(e){storeMonthlyChartInstance&&storeMonthlyChartInstance.destroy();let t=["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"];var a=o.map(e=>t[parseInt(e)-1]);storeMonthlyChartInstance=new Chart(e,{type:"line",data:{labels:a,datasets:i},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}}}})}}function renderStoreTopProducts(e){let a={};e.forEach(e=>{var t=e.product||"Bilinmiyor";a[t]||(a[t]={brand:e.brand||"Bilinmiyor",sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,20);let r='<table style="width: 100%; border-collapse: collapse;"><thead><tr style="background: #667eea; color: white;"><th style="padding: 12px; text-align: left;">ÃœrÃ¼n</th><th style="padding: 12px; text-align: left;">Marka</th><th style="padding: 12px; text-align: right;">SatÄ±ÅŸ (USD)</th><th style="padding: 12px; text-align: right;">Adet</th></tr></thead><tbody>';e.forEach((e,t)=>{r+=`<tr style="border-bottom: 1px solid #eee; ${t%2==0?"background: #f8f9fa;":""}">
                    <td style="padding: 12px;">${e[0]}</td>
                    <td style="padding: 12px;">${e[1].brand}</td>
                    <td style="padding: 12px; text-align: right;">$${e[1].sales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                    <td style="padding: 12px; text-align: right;">${e[1].qty.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                </tr>`}),r+="</tbody></table>",document.getElementById("storeTopProductsTable").innerHTML=r}function renderStoreFullSalespersonTable(e){let a={};e.forEach(e=>{var t=e.sales_person||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0,invoiceCount:0,uniqueCustomers:0,invoices:new Set,customers:new Set}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0),e.move_name?a[t].invoices.add(e.move_name):e.move_id&&a[t].invoices.add(e.move_id),e.partner&&a[t].customers.add(e.partner)}),Object.keys(a).forEach(e=>{a[e].invoiceCount=a[e].invoices.size,a[e].uniqueCustomers=a[e].customers.size,delete a[e].invoices,delete a[e].customers});e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales);let o=`
                <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <th style="padding: 15px; text-align: left; cursor: pointer;" onclick="sortStoreSpTable(0)">
                                # <span style="font-size: 0.8em;">â–¼</span>
                            </th>
                            <th style="padding: 15px; text-align: left; cursor: pointer;" onclick="sortStoreSpTable(1)">
                                ğŸ‘¤ SatÄ±ÅŸ Temsilcisi <span style="font-size: 0.8em;">â–¼</span>
                            </th>
                            <th style="padding: 15px; text-align: right; cursor: pointer;" onclick="sortStoreSpTable(2)">
                                ğŸ’° Toplam SatÄ±ÅŸ (USD) <span style="font-size: 0.8em;">â–¼</span>
                            </th>
                            <th style="padding: 15px; text-align: right; cursor: pointer;" onclick="sortStoreSpTable(3)">
                                ğŸ“¦ ÃœrÃ¼n MiktarÄ± <span style="font-size: 0.8em;">â–¼</span>
                            </th>
                            <th style="padding: 15px; text-align: right; cursor: pointer;" onclick="sortStoreSpTable(4)">
                                ğŸ‘¥ FarklÄ± MÃ¼ÅŸteri <span style="font-size: 0.8em;">â–¼</span>
                            </th>
                            <th style="padding: 15px; text-align: right; cursor: pointer;" onclick="sortStoreSpTable(5)">
                                ğŸ›’ Sepet OrtalamasÄ± <span style="font-size: 0.8em;">â–¼</span>
                            </th>
                            <th style="padding: 15px; text-align: right;">
                                ğŸ“ˆ Pay (%)
                            </th>
                        </tr>
                    </thead>
                    <tbody id="storeSpTableBody">
            `,i=e.reduce((e,t)=>e+t[1].sales,0);e.forEach((e,t)=>{var a=e[0],e=e[1],r=(e.sales/i*100).toFixed(1),n=0<e.invoiceCount?e.sales/e.invoiceCount:0;o+=`
                    <tr style="border-bottom: 1px solid #eee; ${t%2==0?"background: #f8f9fa;":"background: white;"}">
                        <td style="padding: 12px;">${t+1}</td>
                        <td style="padding: 12px;"><strong>${a}</strong></td>
                        <td style="padding: 12px; text-align: right; color: #667eea; font-weight: bold;">$${e.sales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: right;">${e.qty.toLocaleString("tr-TR",{minimumFractionDigits:0})}</td>
                        <td style="padding: 12px; text-align: right; color: #764ba2; font-weight: bold;">${e.uniqueCustomers.toLocaleString("tr-TR")}</td>
                        <td style="padding: 12px; text-align: right;">$${n.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: right;">
                            <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 4px 12px; border-radius: 12px; font-weight: bold;">
                                %${r}
                            </span>
                        </td>
                    </tr>
                `}),o+=`
                    </tbody>
                </table>
                <p style="margin-top: 10px; color: #6c757d; font-size: 0.9em;">
                    ğŸ’¡ <strong>Toplam ${e.length} satÄ±ÅŸ temsilcisi</strong> - SÃ¼tun baÅŸlÄ±klarÄ±na tÄ±klayarak sÄ±ralama yapabilirsiniz
                </p>
            `,document.getElementById("storeFullSalespersonTable").innerHTML=o}let storeSpSortColumn=2,storeSpSortAsc=!1;function sortStoreSpTable(n){storeSpSortAsc=storeSpSortColumn===n?!storeSpSortAsc:(storeSpSortColumn=n,!1);let t=document.getElementById("storeSpTableBody");var e=Array.from(t.querySelectorAll("tr"));e.sort((e,t)=>{e=e.querySelectorAll("td"),t=t.querySelectorAll("td");let a,r;if(0===n)a=parseInt(e[0].textContent),r=parseInt(t[0].textContent);else{if(1===n)return a=e[1].textContent.trim(),r=t[1].textContent.trim(),storeSpSortAsc?a.localeCompare(r):r.localeCompare(a);2===n?(a=parseFloat(e[2].textContent.replace(/[^0-9,.-]/g,"").replace(",",".")),r=parseFloat(t[2].textContent.replace(/[^0-9,.-]/g,"").replace(",","."))):3===n?(a=parseFloat(e[3].textContent.replace(/[^0-9,.-]/g,"").replace(",",".")),r=parseFloat(t[3].textContent.replace(/[^0-9,.-]/g,"").replace(",","."))):4===n?(a=parseInt(e[4].textContent.replace(/[^0-9]/g,"")),r=parseInt(t[4].textContent.replace(/[^0-9]/g,""))):5===n&&(a=parseFloat(e[5].textContent.replace(/[^0-9,.-]/g,"").replace(",",".")),r=parseFloat(t[5].textContent.replace(/[^0-9,.-]/g,"").replace(",",".")))}return storeSpSortAsc?a-r:r-a}),e.forEach(e=>t.appendChild(e))}function performStoreAIAnalysis(e,r){var t={positive:[],negative:[],neutral:[],recommendations:[],warnings:[]};console.log("ğŸ“Š YÄ±llÄ±k trend analizi baÅŸlatÄ±lÄ±yor...");let l={};e.forEach(e=>{var t=e.date?e.date.substring(0,4):null;t&&(l[t]||(l[t]=0),l[t]+=parseFloat(e.usd_amount||0))});var s=Object.keys(l).sort(),d=(new Date).getFullYear().toString(),c=(parseInt(d)-1).toString();if(2<=s.length){var s=s.slice(-3),m=(s.map(e=>({year:e,sales:l[e]})),l[d]||0),c=l[c]||0,g=0<c?(m-c)/c*100:0;let e=0,t=(3===s.length&&(u=0<l[s[1]]?(l[s[1]]-l[s[0]])/l[s[0]]*100:0,p=0<l[s[2]]?(l[s[2]]-l[s[1]])/l[s[1]]*100:0,e=(u+p)/2),"ğŸ“Š"),a="",r="#667eea";r=20<g?(t="ğŸš€",a="GÃœÃ‡LÃœ BÃœYÃœME","#38ef7d"):10<g?(t="ğŸ“ˆ",a="POZÄ°TÄ°F BÃœYÃœME","#4facfe"):0<g?(t="â¡ï¸",a="STABIL BÃœYÃœME","#ffa751"):-10<g?(t="âš ï¸",a="DÃœÅ","#ff6b6b"):(t="ğŸ“‰",a="YÃœKSEK DÃœÅÃœÅ","#dc3545"),r,t,s.map(e=>`
                                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">${e}</div>
                                    <div style="font-size: 1.3em; font-weight: bold;">$${(l[e]||0).toLocaleString("tr-TR",{minimumFractionDigits:0})}</div>
                                </div>
                            `).join(""),a,g.toFixed(1),c.toLocaleString("tr-TR",{minimumFractionDigits:0}),m.toLocaleString("tr-TR",{minimumFractionDigits:0}),3===s.length&&(e,e.toFixed(1));var u=(parseInt(d)+1).toString();let n=0,o="",i="#667eea";i=20<g?(n=1.22*m,o=`ğŸš€ MaÄŸaza son yÄ±l <strong>%${g.toFixed(1)}</strong> bÃ¼yÃ¼dÃ¼! Bu momentum ile ${u} iÃ§in <strong>%22</strong> bÃ¼yÃ¼me hedefi makul.`,"#38ef7d"):10<g?(n=1.16*m,o=`ğŸ“ˆ MaÄŸaza saÄŸlam bir bÃ¼yÃ¼me gÃ¶steriyor (%${g.toFixed(1)}). ${u} iÃ§in <strong>%16</strong> bÃ¼yÃ¼me hedefi Ã¶neriyoruz.`,"#4facfe"):0<g?(n=1.1*m,o=`â¡ï¸ MaÄŸaza stabil bÃ¼yÃ¼me gÃ¶steriyor (%${g.toFixed(1)}). ${u} iÃ§in dikkatli bir <strong>%10</strong> bÃ¼yÃ¼me hedefi uygun.`,"#ffa751"):-10<g?(n=1.05*m,o=`âš ï¸ MaÄŸaza hafif dÃ¼ÅŸÃ¼ÅŸ yaÅŸÄ±yor (%${g.toFixed(1)}). ${u} iÃ§in Ã¶nce <strong>stabilizasyon</strong>, sonra %5 bÃ¼yÃ¼me hedefleyin. <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 4px; font-size: 0.9em;">Acil aksiyon gerekli!</span>`,"#ff6b6b"):(n=m,o=`ğŸ“‰ MaÄŸaza ciddi dÃ¼ÅŸÃ¼ÅŸ yaÅŸÄ±yor (%${g.toFixed(1)}). ${u} iÃ§in Ã¶ncelik <strong>mevcut seviyeyi korumak</strong> olmalÄ±. <span style="background: rgba(255,0,0,0.3); padding: 4px 8px; border-radius: 4px; font-size: 0.9em;">ğŸš¨ KapsamlÄ± strateji revizyonu ÅŸart!</span>`,"#dc3545"),i,n.toLocaleString("tr-TR",{minimumFractionDigits:0}),m.toLocaleString("tr-TR",{minimumFractionDigits:0}),((n-m)/m*100).toFixed(1),o,0<g&&(n.toLocaleString("tr-TR",{minimumFractionDigits:0}),(n/12).toLocaleString("tr-TR",{minimumFractionDigits:0}),(n/365).toLocaleString("tr-TR",{minimumFractionDigits:0}))}let a={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});var p=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,3);let n={};e.forEach(e=>{var t=e.sales_person||"Bilinmiyor";n[t]||(n[t]=0),n[t]+=parseFloat(e.usd_amount||0)});c=Object.entries(n).sort((e,t)=>t[1]-e[1]).slice(0,3);let o={};e.forEach(e=>{var t=e.category_2||"Bilinmiyor";"all"===t.toLowerCase()||t.toLowerCase().includes("analitik")||t.toLowerCase().includes("eÄŸitim")||(o[t]||(o[t]=0),o[t]+=parseFloat(e.usd_amount||0))});s=Object.entries(o).sort((e,t)=>t[1]-e[1]).slice(0,3);let i=["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"],y={};e.forEach(e=>{var t=new Date(e.date).getMonth();y[t]||(y[t]=0),y[t]+=parseFloat(e.usd_amount||0)});d=Object.entries(y).map(([e,t])=>({month:parseInt(e),name:i[e],value:t})),u=d.sort((e,t)=>t.value-e.value)[0],m=d.sort((e,t)=>e.value-t.value)[0];let h=["Pazar","Pazartesi","SalÄ±","Ã‡arÅŸamba","PerÅŸembe","Cuma","Cumartesi"],b={};e.forEach(e=>{var t=e.day_of_week;null!=t&&(t=(t+1)%7,b[t]||(b[t]=0),b[t]+=parseFloat(e.usd_amount||0))});g=Object.entries(b).map(([e,t])=>({day:parseInt(e),name:h[e],value:t})),d=g.sort((e,t)=>t.value-e.value)[0],g=g.sort((e,t)=>e.value-t.value)[0];let f={};e.forEach(e=>{var t=e.create_hour;null!=t&&(f[t]||(f[t]=0),f[t]+=parseFloat(e.usd_amount||0))});var v=Object.entries(f).map(([e,t])=>({hour:parseInt(e),value:t}));v.sort((e,t)=>t.value-e.value)[0],v.sort((e,t)=>e.value-t.value)[0];let k=0,S=0,C=0,x=0;e.forEach(e=>{var t=e.create_hour,e=parseFloat(e.usd_amount||0);6<=t&&t<12?k+=e:12<=t&&t<17?S+=e:17<=t&&t<22?C+=e:x+=e});v=[{name:"Sabah (06:00-12:00)",value:k},{name:"Ã–ÄŸlen (12:00-17:00)",value:S},{name:"AkÅŸam (17:00-22:00)",value:C},{name:"Gece (22:00-06:00)",value:x}].sort((e,t)=>t.value-e.value);let $={};e.forEach(e=>{var t,a=e.sales_person||"Bilinmiyor",r=e.day_of_week;null!=r&&(t=a+"_"+(r=(r+1)%7),$[t]||($[t]={sp:a,day:r,dayName:h[r],value:0}),$[t].value+=parseFloat(e.usd_amount||0))});var T=Object.values($).sort((e,t)=>t.value-e.value)[0];let I={};e.forEach(e=>{var t,a=e.sales_person||"Bilinmiyor",r=e.create_hour;null!=r&&(t=a+"_"+r,I[t]||(I[t]={sp:a,hour:r,value:0}),I[t].value+=parseFloat(e.usd_amount||0))});var D,e=Object.values(I).sort((e,t)=>t.value-e.value)[0],E=(1e5<r.totalSales&&t.positive.push({title:"ğŸ’° YÃ¼ksek Ciro",description:`MaÄŸaza toplam <span class="metric-highlight">$${r.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</span> satÄ±ÅŸ gerÃ§ekleÅŸtirmiÅŸ. MÃ¼kemmel performans!`}),0<p.length&&((p[0][1]/r.totalSales*100).toFixed(1),t.positive.push({title:"ğŸ·ï¸ En BaÅŸarÄ±lÄ± 3 Marka",description:""+p.slice(0,3).map(e=>`${e[0]} (%${(e[1]/r.totalSales*100).toFixed(1)})`).join(", ")})),0<s.length&&((s[0][1]/r.totalSales*100).toFixed(1),t.positive.push({title:"ğŸ“‚ En BaÅŸarÄ±lÄ± 3 Kategori",description:""+s.slice(0,3).map(e=>`${e[0]} (%${(e[1]/r.totalSales*100).toFixed(1)})`).join(", ")})),u&&m&&(E=(u.value/r.totalSales*100).toFixed(1),D=(m.value/r.totalSales*100).toFixed(1),t.neutral.push({title:"ğŸ“… AylÄ±k Performans",description:`En gÃ¼Ã§lÃ¼ ay: <span class="metric-highlight">${u.name}</span> (%${E})<br>En zayÄ±f ay: ${m.name} (%${D})`})),d&&g&&(u=(d.value/r.totalSales*100).toFixed(1),E=(g.value/r.totalSales*100).toFixed(1),t.neutral.push({title:"ğŸ“† GÃ¼nlÃ¼k Performans",description:`En gÃ¼Ã§lÃ¼ gÃ¼n: <span class="metric-highlight">${d.name}</span> (%${u})<br>En zayÄ±f gÃ¼n: ${g.name} (%${E})`})),0<v.length&&(D=((m=v[0]).value/r.totalSales*100).toFixed(1),t.neutral.push({title:"ğŸ• Saat Dilimi PerformansÄ±",description:`En gÃ¼Ã§lÃ¼: <span class="metric-highlight">${m.name}</span> - Cironun %${D}'i bu saatlerde`})),T&&(u=(T.value/r.totalSales*100).toFixed(1),t.neutral.push({title:"â­ En BaÅŸarÄ±lÄ± Kombinasyon",description:`<span class="metric-highlight">${T.sp}</span> - <span class="metric-highlight">${T.dayName}</span> gÃ¼nleri harika! (%${u})`})),getStoreWorkingHours(r.name||""));E.closedDays.map(e=>["Pazar","Pazartesi","SalÄ±","Ã‡arÅŸamba","PerÅŸembe","Cuma","Cumartesi"][e]).join(", ");0<c.length&&(v=c.map((e,t)=>{var a=(e[1]/r.totalSales*100).toFixed(1);return`${t+1}. ${e[0]} (%${a})`}).join("<br>"),t.neutral.push({title:"ğŸ‘¨â€ğŸ’¼ En BaÅŸarÄ±lÄ± SatÄ±ÅŸ Temsilcileri",description:v})),t.neutral.push({title:"ğŸ“Š Genel Performans",description:`<span class="metric-highlight">${r.uniqueCustomers}</span> farklÄ± mÃ¼ÅŸteri, <span class="metric-highlight">${r.uniqueProducts}</span> farklÄ± Ã¼rÃ¼n satÄ±ldÄ±.`}),t.neutral.push({title:"ğŸ“ˆ Toplam SatÄ±ÅŸ Ä°Ã§indeki Pay",description:`${r.name} maÄŸazasÄ±, toplam ÅŸirket satÄ±ÅŸÄ±nÄ±n <strong>%${r.storeSalesPercentage}</strong> payÄ±nÄ± oluÅŸturuyor. Bu, $${r.totalAllSales.toLocaleString("tr-TR",{minimumFractionDigits:2})} toplam satÄ±ÅŸ iÃ§inde $${r.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})} deÄŸerinde bir performans.`}),3<=s.length&&t.neutral.push({title:"ğŸ“‚ Kategori Ã‡eÅŸitliliÄŸi",description:`En Ã§ok satÄ±lan kategoriler: ${s.map(e=>e[0]).join(", ")}. Bu kategorilerde gÃ¼Ã§lÃ¼ performans.`}),g&&d&&(m=g.day,E.closedDays.includes(m)?t.recommendations.push({icon:"ğŸ“†",title:"KapalÄ± GÃ¼n DeÄŸerlendirmesi",description:g.name+" gÃ¼nleri maÄŸaza kapalÄ±. Bu gÃ¼n iÃ§in Ã¶zel bir strateji gerekmiyor."}):t.recommendations.push({icon:"ğŸ“†",title:"GÃ¼n BazlÄ± Strateji",description:`${g.name} gÃ¼nleri zayÄ±f. ${d.name} gÃ¼nlerindeki baÅŸarÄ±lÄ± stratejileri ${g.name}'ya da uygulayÄ±n. Ã–zel kampanyalar dÃ¼zenleyin.`})),e&&e.hour>=E.openHour&&e.hour<E.closeHour&&t.recommendations.push({icon:"â°",title:"Saat BazlÄ± Planlama",description:`${e.sp} saat ${e.hour}:00'da en baÅŸarÄ±lÄ±. Vardiya planlamasÄ±nÄ± buna gÃ¶re optimize edin. (Ã‡alÄ±ÅŸma saatleri: ${E.openHour}:00-${E.closeHour}:00)`}),t.recommendations.push({icon:"ğŸ¯",title:"Stok YÃ¶netimi",description:`En Ã§ok satan markalar: ${p.map(e=>e[0]).join(", ")}. Bu markalarÄ±n stok seviyelerini takip edin.`}),t.recommendations.push({icon:"ğŸ‘¥",title:"Ekip YÃ¶netimi",description:`En baÅŸarÄ±lÄ± temsilci ${c[0][0]}. BaÅŸarÄ± hikayesini diÄŸer ekip Ã¼yeleriyle paylaÅŸÄ±n.`});let B='<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px;">';0<t.positive.length&&(B+='<div class="analysis-section"><h3 style="color: white; margin-top: 0;">âœ… GÃ¼Ã§lÃ¼ YÃ¶nler</h3>',t.positive.forEach(e=>{B+=`<div class="insight-item" style="background: rgba(56, 239, 125, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #38ef7d;">
                        <strong style="font-size: 1.1em;">${e.title}</strong><br>
                        <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                    </div>`}),B+="</div>"),0<t.neutral.length&&(B+='<div class="analysis-section" style="margin-top: 25px;"><h3 style="color: white;">ğŸ’¡ Ã–nemli Bilgiler</h3>',t.neutral.forEach(e=>{B+=`<div class="insight-item" style="background: rgba(255, 215, 0, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #ffd700;">
                        <strong style="font-size: 1.1em;">${e.title}</strong><br>
                        <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                    </div>`}),B+="</div>"),0<t.recommendations.length&&(B+='<div class="analysis-section" style="margin-top: 25px;"><h3 style="color: white;">ğŸ¯ Ã–neriler</h3>',t.recommendations.forEach(e=>{B+=`<div class="recommendation" style="background: rgba(255, 255, 255, 0.15); padding: 18px; border-radius: 10px; margin: 12px 0;">
                        <span style="font-size: 1.8em; margin-right: 12px;">${e.icon}</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 50px);">
                            <strong style="font-size: 1.15em; display: block; margin-bottom: 8px;">${e.title}</strong>
                            <p style="margin: 0; opacity: 0.95; line-height: 1.6;">${e.description}</p>
                        </div>
                    </div>`}),B+="</div>"),B+="</div>",document.getElementById("storeAIAnalysisContent").innerHTML=B}let cityBrandChartInstance=null,cityProductChartInstance=null,cityCategoryChartInstance=null,cityMonthlyChartInstance=null;function populateCitySelect(){if(allData&&0!==allData.length){let t=new Set,a=(allData.forEach(e=>{e.partner_city&&t.add(e.partner_city)}),document.getElementById("citySelect"));a?(a.innerHTML='<option value="">-- Åehir SeÃ§in --</option>',0===t.size?(console.warn("âš ï¸ HiÃ§ ÅŸehir verisi bulunamadÄ±"),a.innerHTML+='<option value="" disabled>Åehir verisi bulunamadÄ±</option>'):(Array.from(t).sort().forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}),console.log("âœ… Åehir dropdown dolduruldu:",t.size,"ÅŸehir"),console.log("ğŸ“‹ Dropdown iÃ§eriÄŸi:",a.innerHTML.substring(0,500)))):console.error("âŒ citySelect elementi bulunamadÄ±")}else console.warn("âš ï¸ Åehir listesi doldurulamadÄ±: Veri henÃ¼z yÃ¼klenmedi")}let targetStoresPopulated=!1;function populateTargetStoreDropdowns(){if(allData&&0!==allData.length)if(targetStoresPopulated)console.log("âœ… MaÄŸaza dropdown zaten dolduruldu, tekrar doldurulmayacak");else{let t=new Set;allData.forEach(e=>{e.store&&t.add(e.store)});var e=Array.from(t).sort();let a=document.getElementById("targetYearStore");var n,o,i=document.getElementById("targetYear");a&&i&&(n=(n=JSON.parse(localStorage.getItem("yearlyTargets")||"{}"))[i=i.value]?Object.keys(n[i])[0]:"TÃœM MAÄAZALAR",a.innerHTML='<option value="TÃœM MAÄAZALAR">ğŸ¢ TÃ¼m MaÄŸazalar</option>',e.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}),n)&&(a.value=n);let r=document.getElementById("targetMonthStore");r&&(i=JSON.parse(localStorage.getItem("monthlyTargets")||"{}"),n=document.getElementById("targetYear").value,o=document.getElementById("targetMonth").value,o=i[n]&&i[n][o]?Object.keys(i[n])[0]:"TÃœM MAÄAZALAR",r.innerHTML='<option value="TÃœM MAÄAZALAR">ğŸ¢ TÃ¼m MaÄŸazalar</option>',e.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)}),o)&&(r.value=o),targetStoresPopulated=!0,console.log("âœ… Hedef takip maÄŸaza dropdownlarÄ± dolduruldu:",t.size,"maÄŸaza")}else console.warn("âš ï¸ MaÄŸaza dropdown doldurulamÄ±yor: Veri yok")}function levenshteinDistance(a,r){var n=a.length,o=r.length,i=[];for(let e=0;e<=n;e++)i[e]=[e];for(let e=0;e<=o;e++)i[0][e]=e;for(let t=1;t<=n;t++)for(let e=1;e<=o;e++)a[t-1]===r[e-1]?i[t][e]=i[t-1][e-1]:i[t][e]=Math.min(i[t-1][e-1]+1,i[t][e-1]+1,i[t-1][e]+1);return i[n][o]}function normalizeTurkish(e){if(!e)return"";let t={"Ä±":"i","Ä°":"i","ÅŸ":"s","Å":"s","ÄŸ":"g","Ä":"g","Ã¼":"u","Ãœ":"u","Ã¶":"o","Ã–":"o","Ã§":"c","Ã‡":"c"};return e.toLowerCase().trim().split("").map(e=>t[e]||e).join("")}function normalizeDistrictName(e,t){if(!e||"Bilinmeyen"===e)return e;if(t.includes(e))return e;var a=normalizeTurkish(e);let r=e,n=1/0;var o;for(o of t){var i=normalizeTurkish(o),l=levenshteinDistance(a,i),i=1-l/Math.max(a.length,i.length);l<n&&l<=4&&.65<=i&&(n=l,r=o)}if(r===e&&0<t.length){let e=0;for(var s of t){var d=normalizeTurkish(s),c=levenshteinDistance(a,d),d=1-c/Math.max(a.length,d.length);d>e&&.6<=d&&(e=d,r=s,n=c)}}return r!==e&&console.log(`ğŸ”§ Ä°lÃ§e dÃ¼zeltildi: "${e}" â†’ "${r}" (distance: ${n})`),r}function clearCityFilters(){document.getElementById("citySelect").value="",document.getElementById("districtSelect").value="",document.getElementById("districtSelect").innerHTML='<option value="">-- Ã–nce Åehir SeÃ§in --</option>',document.getElementById("districtSelect").disabled=!0,document.getElementById("cityDateStart").value="",document.getElementById("cityDateEnd").value="",document.getElementById("cityAnalysisContainer").style.display="none",console.log("ğŸ—‘ï¸ Åehir ve ilÃ§e filtreleri temizlendi")}function handleCityChange(){let n=document.getElementById("citySelect").value,o=document.getElementById("districtSelect");if(console.log("ğŸ“ Åehir deÄŸiÅŸti:",n),n){let t=new Set,a=(allData.forEach(e=>{e.partner_city===n&&e.city&&0<e.city.length&&t.add(e.city)}),console.log("ğŸ˜ï¸ Ham ilÃ§e sayÄ±sÄ±:",t.size),console.log("ğŸ“‹ Ä°lk 10 ilÃ§e Ã¶rneÄŸi:",Array.from(t).slice(0,10)),Array.from(t)),r=new Map;a.forEach(e=>{e=normalizeDistrictName(e,a);r.has(e)||r.set(e,e)});var e=Array.from(r.keys()).sort();console.log("ğŸ˜ï¸ Normalize edilmiÅŸ ilÃ§e sayÄ±sÄ±:",e.length),o.innerHTML='<option value="">-- TÃ¼m Ä°lÃ§eler --</option>',e.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,o.appendChild(t)}),o.disabled=0===e.length}else o.innerHTML='<option value="">-- Ã–nce Åehir SeÃ§in --</option>',o.disabled=!0;analyzeCityPerformance()}let cityPopulations={"Ä°stanbul":15907951,"Ä°stanbul (TR)":15907951,Ankara:5803482,"Ankara (TR)":5803482,"Ä°zmir":4462056,"Ä°zmir (TR)":4462056,Bursa:3194720,"Bursa (TR)":3194720,Antalya:2688004,"Antalya (TR)":2688004,Adana:2274106,"Adana (TR)":2274106,Konya:2305609,"Konya (TR)":2305609,Gaziantep:2154051,"Gaziantep (TR)":2154051,"ÅanlÄ±urfa":2155805,"ÅanlÄ±urfa (TR)":2155805,Kocaeli:2102907,"Kocaeli (TR)":2102907,Mersin:1938389,"Mersin (TR)":1938389,"DiyarbakÄ±r":1804880,"DiyarbakÄ±r (TR)":1804880,Hatay:1686043,"Hatay (TR)":1686043,Manisa:1468279,"Manisa (TR)":1468279,Kayseri:1434357,"Kayseri (TR)":1434357,Samsun:1368488,"Samsun (TR)":1368488,"BalÄ±kesir":1257590,"BalÄ±kesir (TR)":1257590,"KahramanmaraÅŸ":1168163,"KahramanmaraÅŸ (TR)":1168163,Van:1136757,"Van (TR)":1136757,"AydÄ±n":1148241,"AydÄ±n (TR)":1148241,Denizli:1058663,"Denizli (TR)":1058663,Sakarya:1080080,"Sakarya (TR)":1080080,"TekirdaÄŸ":1158149,"TekirdaÄŸ (TR)":1158149,"MuÄŸla":1042669,"MuÄŸla (TR)":1042669,"EskiÅŸehir":906617,"EskiÅŸehir (TR)":906617,Mardin:870374,"Mardin (TR)":870374,Malatya:812580,"Malatya (TR)":812580,Erzurum:760476,"Erzurum (TR)":760476,Trabzon:818023,"Trabzon (TR)":818023,"ElazÄ±ÄŸ":602877,"ElazÄ±ÄŸ (TR)":602877,"ÅÄ±rnak":542743,"ÅÄ±rnak (TR)":542743,Ordu:769854,"Ordu (TR)":769854,"KÃ¼tahya":589524,"KÃ¼tahya (TR)":589524,Afyonkarahisar:754854,"Afyonkarahisar (TR)":754854,Tokat:617062,"Tokat (TR)":617062,"Ã‡orum":530126,"Ã‡orum (TR)":530126,Sivas:643864,"Sivas (TR)":643864,Zonguldak:588510,"Zonguldak (TR)":588510,Aksaray:433229,"Aksaray (TR)":433229,Batman:634491,"Batman (TR)":634491,Isparta:446102,"Isparta (TR)":446102,"Ã‡anakkale":557099,"Ã‡anakkale (TR)":557099,"UÅŸak":378115,"UÅŸak (TR)":378115,"DÃ¼zce":405285,"DÃ¼zce (TR)":405285,Osmaniye:558016,"Osmaniye (TR)":558016,Amasya:338267,"Amasya (TR)":338267,Giresun:453912,"Giresun (TR)":453912,"KÄ±rÄ±kkale":286602,"KÄ±rÄ±kkale (TR)":286602,Edirne:413903,"Edirne (TR)":413903,"KÄ±rÅŸehir":250120,"KÄ±rÅŸehir (TR)":250120,Bolu:320014,"Bolu (TR)":320014,"AdÄ±yaman":635286,"AdÄ±yaman (TR)":635286,"KÄ±rklareli":368872,"KÄ±rklareli (TR)":368872,Yozgat:424981,"Yozgat (TR)":424981,"NevÅŸehir":310538,"NevÅŸehir (TR)":310538,Burdur:273799,"Burdur (TR)":273799,Karaman:262997,"Karaman (TR)":262997,Kilis:147887,"Kilis (TR)":147887,"AÄŸrÄ±":528744,"AÄŸrÄ± (TR)":528744,"NiÄŸde":365419,"NiÄŸde (TR)":365419,Kastamonu:383373,"Kastamonu (TR)":383373,Artvin:170875,"Artvin (TR)":170875,Siirt:331070,"Siirt (TR)":331070,Bilecik:228673,"Bilecik (TR)":228673,Sinop:218273,"Sinop (TR)":218273,Rize:348608,"Rize (TR)":348608,"KarabÃ¼k":248014,"KarabÃ¼k (TR)":248014,Yalova:291001,"Yalova (TR)":291001,"BartÄ±n":198999,"BartÄ±n (TR)":198999,"MuÅŸ":408728,"MuÅŸ (TR)":408728,Bitlis:353988,"Bitlis (TR)":353988,Erzincan:236034,"Erzincan (TR)":236034,Hakkari:287625,"Hakkari (TR)":287625,Ardahan:94932,"Ardahan (TR)":94932,"IÄŸdÄ±r":201314,"IÄŸdÄ±r (TR)":201314,Kars:281869,"Kars (TR)":281869,"GÃ¼mÃ¼ÅŸhane":164521,"GÃ¼mÃ¼ÅŸhane (TR)":164521,"Ã‡ankÄ±rÄ±":195766,"Ã‡ankÄ±rÄ± (TR)":195766,Tunceli:89266,"Tunceli (TR)":89266,Bayburt:84843,"Bayburt (TR)":84843};function analyzeCityPerformance(){let l=document.getElementById("citySelect").value,a=document.getElementById("districtSelect").value,r=document.getElementById("cityDateStart").value,n=document.getElementById("cityDateEnd").value;if(l){console.log("ğŸŒ Åehir analizi:",l,a?"/ "+a:"","Tarih:",r,"-",n);let t=[];a&&allData.forEach(e=>{e.partner_city===l&&e.city&&t.push(e.city)});var e=allData.filter(e=>{if(e.partner_city!==l)return!1;if(a&&e.city){if(normalizeDistrictName(e.city,t)!==a)return!1}else if(a&&!e.city)return!1;return!(r&&e.date<r||n&&e.date>n)});if(0===e.length)alert("Bu ÅŸehir iÃ§in veri bulunamadÄ±");else{let r=e.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0);var s=e.reduce((e,t)=>e+parseFloat(t.quantity||0),0),d=new Set(e.map(e=>e.partner)).size,c=new Set(e.map(e=>e.date)).size,c=r/Math.max(c,1);let a={};e.forEach(e=>{var t=e.sales_person||"Bilinmiyor";a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});Object.entries(a).sort((e,t)=>t[1]-e[1])[0];let n={};e.forEach(e=>{var t=e.store||"Bilinmiyor";n[t]||(n[t]=0),n[t]+=parseFloat(e.usd_amount||0)});Object.entries(n).sort((e,t)=>t[1]-e[1])[0];var m=cityPopulations[l]||0,g=0<m?r/m:0,m=(document.getElementById("cityTotalSales").textContent="$"+r.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("cityTotalQty").textContent=s.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("cityCustomerCount").textContent=d,document.getElementById("cityAvgBasket").textContent="$"+c.toLocaleString("tr-TR",{minimumFractionDigits:2}),0<m?(m=(m/1e6).toFixed(2),document.getElementById("cityPopulation").textContent=m+"M",document.getElementById("cityPerCapitaSales").textContent="$"+g.toLocaleString("tr-TR",{minimumFractionDigits:2})):(document.getElementById("cityPopulation").textContent="Veri Yok",document.getElementById("cityPerCapitaSales").textContent="-"),Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,5));let o="";m.forEach((e,t)=>{var a=(e[1]/r*100).toFixed(1);o+=`<div style="margin: 5px 0;">${t+1}. ${e[0]}: <strong>$${e[1].toLocaleString("tr-TR",{minimumFractionDigits:2})}</strong> (%${a})</div>`}),document.getElementById("cityTopSalespersons").innerHTML=o;g=Object.entries(n).sort((e,t)=>t[1]-e[1]).slice(0,5);let i="";g.forEach((e,t)=>{var a=(e[1]/r*100).toFixed(1);i+=`<div style="margin: 5px 0;">${t+1}. ${e[0]}: <strong>$${e[1].toLocaleString("tr-TR",{minimumFractionDigits:2})}</strong> (%${a})</div>`}),document.getElementById("cityTopStores").innerHTML=i,document.getElementById("cityAnalysisContainer").style.display="block",renderCityBrandChart(e),renderCityProductChart(e),renderCityCategoryChart(e),renderCityMonthlyChart(e),renderCityYearlyChart(e),performCityAIAnalysis(e,l,{totalSales:r,totalQty:s,uniqueCustomers:d,avgBasket:c})}}else document.getElementById("cityAnalysisContainer").style.display="none"}function renderCityBrandChart(e){let a={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),r=e.map(e=>e[1].sales),e=e.map(e=>e[1].qty),n=document.getElementById("cityBrandChart");n&&(cityBrandChartInstance&&cityBrandChartInstance.destroy(),cityBrandChartInstance=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:r,backgroundColor:"rgba(102, 126, 234, 0.6)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2,yAxisID:"y"},{label:"Miktar",data:e,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:2,yAxisID:"y"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{x:{beginAtZero:!0}}}}))}function renderCityProductChart(e){let a={};e.forEach(e=>{var t=e.product||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0].substring(0,30)+(30<e[0].length?"...":"")),r=e.map(e=>e[1].sales),e=e.map(e=>e[1].qty),n=document.getElementById("cityProductChart");n&&(cityProductChartInstance&&cityProductChartInstance.destroy(),cityProductChartInstance=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:r,backgroundColor:"rgba(56, 239, 125, 0.6)",borderColor:"rgba(56, 239, 125, 1)",borderWidth:2,yAxisID:"y"},{label:"Miktar",data:e,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:2,yAxisID:"y"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{x:{beginAtZero:!0}}}}))}function renderCityCategoryChart(e){let a={};e.forEach(e=>{var t=e.category_2||"Bilinmiyor";"all"===t.toLowerCase()||t.toLowerCase().includes("analitik")||t.toLowerCase().includes("eÄŸitim")||(a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0))});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),r=e.map(e=>e[1].sales),e=e.map(e=>e[1].qty),n=document.getElementById("cityCategoryChart");n&&(cityCategoryChartInstance&&cityCategoryChartInstance.destroy(),cityCategoryChartInstance=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:r,backgroundColor:"rgba(245, 87, 108, 0.6)",borderColor:"rgba(245, 87, 108, 1)",borderWidth:2,yAxisID:"y"},{label:"Miktar",data:e,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:2,yAxisID:"y"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{x:{beginAtZero:!0}}}}))}function renderCityMonthlyChart(e){let a={};e.forEach(e=>{var t=new Date(e.date),t=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0");a[t]||(a[t]=0),a[t]+=parseFloat(e.usd_amount||0)});var e=Object.entries(a).sort((e,t)=>e[0].localeCompare(t[0])),t=e.map(e=>e[0]),e=e.map(e=>e[1]),r=document.getElementById("cityMonthlyChart");r&&(cityMonthlyChartInstance&&cityMonthlyChartInstance.destroy(),cityMonthlyChartInstance=new Chart(r,{type:"line",data:{labels:t,datasets:[{label:"AylÄ±k SatÄ±ÅŸ (USD)",data:e,borderColor:"rgba(102, 126, 234, 1)",backgroundColor:"rgba(102, 126, 234, 0.1)",borderWidth:3,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}}))}let cityYearlyChartInstance=null;function renderCityYearlyChart(e){let n={},t=(e.forEach(e=>{var t=new Date(e.date),a=t.getFullYear(),t=String(t.getMonth()+1).padStart(2,"0");n[a]||(n[a]={}),n[a][t]||(n[a][t]=0),n[a][t]+=parseFloat(e.usd_amount||0)}),new Set),o=(Object.values(n).forEach(e=>{Object.keys(e).forEach(e=>t.add(e))}),Array.from(t).sort()),i=[],l=[{border:"rgba(102, 126, 234, 1)",bg:"rgba(102, 126, 234, 0.1)"},{border:"rgba(245, 87, 108, 1)",bg:"rgba(245, 87, 108, 0.1)"},{border:"rgba(56, 239, 125, 1)",bg:"rgba(56, 239, 125, 0.1)"},{border:"rgba(255, 206, 86, 1)",bg:"rgba(255, 206, 86, 0.1)"}];Object.keys(n).sort().forEach((e,t)=>{let a=n[e];var r=o.map(e=>a[e]||0),t=l[t%l.length];i.push({label:e+" SatÄ±ÅŸlarÄ±",data:r,borderColor:t.border,backgroundColor:t.bg,borderWidth:3,fill:!0,tension:.4})});e=document.getElementById("cityYearlyChart");if(e){cityYearlyChartInstance&&cityYearlyChartInstance.destroy();let t=["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"];var a=o.map(e=>t[parseInt(e)-1]);cityYearlyChartInstance=new Chart(e,{type:"line",data:{labels:a,datasets:i},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(e){return e.dataset.label+": $"+e.parsed.y.toLocaleString("tr-TR",{minimumFractionDigits:2})}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}function performCityAIAnalysis(e,t,a){console.log("ğŸ¤– Åehir AI analizi baÅŸlatÄ±lÄ±yor...");let r={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";r[t]||(r[t]=0),r[t]+=parseFloat(e.usd_amount||0)});var n=Object.entries(r).sort((e,t)=>t[1]-e[1]).slice(0,3);let o={};e.forEach(e=>{var t=e.category_2||"Bilinmiyor";o[t]||(o[t]=0),o[t]+=parseFloat(e.usd_amount||0)});var i,e=Object.entries(o).sort((e,t)=>t[1]-e[1]).slice(0,3),l={positive:[],negative:[],neutral:[],recommendations:[]},s=(0<n.length&&(i=((s=n[0])[1]/a.totalSales*100).toFixed(1),l.positive.push({title:`ğŸ·ï¸ ${s[0]} Lider Marka`,description:`${t} ilinde ${s[0]} markasÄ± %${i} pay ile lider ($${s[1].toLocaleString("tr-TR",{minimumFractionDigits:2})}).`})),0<e.length&&(s=((i=e[0])[1]/a.totalSales*100).toFixed(1),l.positive.push({title:`ğŸ“‚ ${i[0]} En PopÃ¼ler Kategori`,description:`${t} ilinde ${i[0]} kategorisi %${s} pay ile en Ã§ok tercih edilen ($${i[1].toLocaleString("tr-TR",{minimumFractionDigits:2})}).`})),l.neutral.push({title:`ğŸ“Š ${t} Genel Performans`,description:`Toplam ${a.uniqueCustomers} mÃ¼ÅŸteri, $${a.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})} satÄ±ÅŸ gerÃ§ekleÅŸtirdi. Ortalama sepet deÄŸeri $${a.avgBasket.toLocaleString("tr-TR",{minimumFractionDigits:2})}.`}),3<=n.length&&l.neutral.push({title:"ğŸ·ï¸ Top 3 Marka",description:n.map(e=>e[0]).join(", ")+` markalarÄ± ${t} ilinde en Ã§ok tercih ediliyor.`}),l.recommendations.push({icon:"ğŸ“¦",title:"Stok Optimizasyonu",description:`${t} ilindeki maÄŸazalarda ${n[0][0]} markasÄ± ve ${e[0][0]} kategorisi Ã¼rÃ¼nlerinin stok seviyesini artÄ±rÄ±n.`}),l.recommendations.push({icon:"ğŸ“¢",title:"BÃ¶lgesel Kampanya",description:`${t} ili iÃ§in ${n[0][0]} markasÄ±nda Ã¶zel kampanya dÃ¼zenleyin. Bu bÃ¶lgede yÃ¼ksek talep var.`}),l.recommendations.push({icon:"ğŸ¯",title:"MÃ¼ÅŸteri Segmentasyonu",description:`${t} ilindeki ${a.uniqueCustomers} mÃ¼ÅŸteriye Ã¶zel e-posta kampanyalarÄ± gÃ¶nderin. Tercih ettikleri kategorilerdeki yeni Ã¼rÃ¼nleri tanÄ±tÄ±n.`}),`
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px;">
                    ${0<l.positive.length?`
                    <div class="analysis-section">
                        <h3 style="color: white; margin-top: 0;">âœ… ${t} GÃ¼Ã§lÃ¼ YÃ¶nler</h3>
                        ${l.positive.map(e=>`
                            <div class="insight-item insight-positive" style="background: rgba(56, 239, 125, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #38ef7d;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">âœ…</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<l.neutral.length?`
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">ğŸ’¡ Genel Bilgiler</h3>
                        ${l.neutral.map(e=>`
                            <div class="insight-item insight-neutral" style="background: rgba(255, 215, 0, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #ffd700;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">ğŸ’¡</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">ğŸ¯ Aksiyon Ã–nerileri</h3>
                        ${l.recommendations.map(e=>`
                            <div class="recommendation" style="background: rgba(255, 255, 255, 0.15); padding: 18px; border-radius: 10px; margin: 12px 0;">
                                <span class="recommendation-icon" style="font-size: 1.8em; margin-right: 12px;">${e.icon}</span>
                                <div style="display: inline-block; vertical-align: top; width: calc(100% - 50px);">
                                    <strong style="font-size: 1.15em; display: block; margin-bottom: 8px;">${e.title}</strong>
                                    <p style="margin: 0; opacity: 0.95; line-height: 1.6;">${e.description}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `);document.getElementById("cityAIAnalysisContent").innerHTML=s}let stockList=[];function handleStockExcelUpload(e){var t,e=e.target.files[0];e&&(5242880<e.size?alert("Dosya Ã§ok bÃ¼yÃ¼k! Maksimum 5 MB olmalÄ±dÄ±r."):["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(e.type)?(console.log("ğŸ“„ Excel dosyasÄ± okunuyor..."),(t=new FileReader).onload=e=>{try{var t=new Uint8Array(e.target.result),a=XLSX.read(t,{type:"array"}),r=a.SheetNames[0],n=a.Sheets[r],o=XLSX.utils.sheet_to_json(n);console.log("ğŸ“Š Excel verisi:",o),stockList=[],o.forEach(e=>{var t=e["ÃœrÃ¼n Kodu"]||e.product_code||e["Product Code"]||e.Kod||e.Code,e=e["Stok MiktarÄ±"]||e.stock||e.Stock||e.Miktar||e.Quantity||e.qty;t&&e&&stockList.push({product_code:String(t).trim(),qty:parseFloat(e)})}),0===stockList.length?alert('Excel dosyasÄ±nda geÃ§erli veri bulunamadÄ±! Kolon isimleri: "ÃœrÃ¼n Kodu" ve "Stok MiktarÄ±" olmalÄ±.'):(console.log("âœ… Stok listesi yÃ¼klendi:",stockList.length,"Ã¼rÃ¼n"),renderStockList())}catch(e){console.error("âŒ Excel okuma hatasÄ±:",e),alert("Excel dosyasÄ± okunamadÄ±! LÃ¼tfen dosya formatÄ±nÄ± kontrol edin.")}},t.readAsArrayBuffer(e)):alert("Sadece Excel dosyalarÄ± (.xlsx, .xls) yÃ¼kleyebilirsiniz."))}function addManualStock(){let t=document.getElementById("manualProductCode").value.trim();var e,a=parseFloat(document.getElementById("manualStockQty").value);t?isNaN(a)||a<=0?alert("LÃ¼tfen geÃ§erli bir stok miktarÄ± girin"):(0<=(e=stockList.findIndex(e=>e.product_code===t))?stockList[e].qty=a:stockList.push({product_code:t,qty:a}),document.getElementById("manualProductCode").value="",document.getElementById("manualStockQty").value="",console.log("âœ… Stok eklendi:",t,a),renderStockList()):alert("LÃ¼tfen Ã¼rÃ¼n kodu girin")}function renderStockList(){if(0===stockList.length)document.getElementById("stockListContainer").style.display="none";else{document.getElementById("stockListContainer").style.display="block";let a=`
                <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <tr>
                            <th style="padding: 15px; text-align: left;">#</th>
                            <th style="padding: 15px; text-align: left;">ÃœrÃ¼n Kodu</th>
                            <th style="padding: 15px; text-align: right;">Stok MiktarÄ±</th>
                            <th style="padding: 15px; text-align: center;">Ä°ÅŸlem</th>
                        </tr>
                    </thead>
                    <tbody>
            `;stockList.forEach((e,t)=>{a+=`
                    <tr style="border-bottom: 1px solid #eee; ${t%2==0?"background: #f8f9fa;":""}">
                        <td style="padding: 12px;">${t+1}</td>
                        <td style="padding: 12px;"><strong>${e.product_code}</strong></td>
                        <td style="padding: 12px; text-align: right;">${e.qty.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: center;">
                            <button onclick="removeStock(${t})" style="background: #dc3545; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">
                                ğŸ—‘ï¸ Sil
                            </button>
                        </td>
                    </tr>
                `}),a+=`
                    </tbody>
                </table>
            `,document.getElementById("stockListTable").innerHTML=a}}function removeStock(e){stockList.splice(e,1),renderStockList()}function clearStockList(){confirm("TÃ¼m stok listesini temizlemek istediÄŸinize emin misiniz?")&&(stockList=[],renderStockList(),document.getElementById("stockDistributionResults").style.display="none")}function analyzeStockDistribution(){if(0===stockList.length)alert("Ã–nce stok listesi yÃ¼kleyin veya manuel giriÅŸ yapÄ±n");else{console.log("ğŸ¤– AI stok daÄŸÄ±lÄ±m analizi baÅŸlatÄ±lÄ±yor...");let t=document.getElementById("stockDateStart").value,a=document.getElementById("stockDateEnd").value,r=(console.log("ğŸ“… Tarih Filtreleri:",{dateStart:t,dateEnd:a}),[]);stockList.forEach(i=>{let e=allData.filter(e=>e.product&&e.product.toLowerCase().includes(i.product_code.toLowerCase()));if(t&&(e=e.filter(e=>e.date>=t)),0===(e=a?e.filter(e=>e.date<=a):e).length)r.push({productCode:i.product_code,totalStock:i.qty,distribution:[],message:`âš ï¸ "${i.product_code}" iÃ§in geÃ§miÅŸ satÄ±ÅŸ verisi bulunamadÄ±. EÅŸit daÄŸÄ±lÄ±m Ã¶neriliyor.`,noData:!0});else{let a={},n=(e.forEach(e=>{var t=e.store||"Bilinmiyor";a[t]||(a[t]={qty:0,sales:0}),a[t].qty+=parseFloat(e.quantity||0),a[t].sales+=parseFloat(e.usd_amount||0)}),Object.values(a).reduce((e,t)=>e+t.qty,0)),o=[];Object.entries(a).forEach(([e,t])=>{var a=t.qty/n,r=Math.round(i.qty*a);o.push({store:e,historicalQty:t.qty,historicalSales:t.sales,percentage:(100*a).toFixed(1),recommendedQty:r})}),o.sort((e,t)=>t.recommendedQty-e.recommendedQty),r.push({productCode:i.product_code,totalStock:i.qty,distribution:o,message:`âœ… "${i.product_code}" iÃ§in ${o.length} maÄŸazaya daÄŸÄ±lÄ±m Ã¶nerisi hazÄ±rlandÄ±.`,noData:!1})}}),renderStockDistributionResults(r)}}function clearStockDateFilters(){document.getElementById("stockDateStart").value="",document.getElementById("stockDateEnd").value="",console.log("ğŸ”„ Stok tarih filtreleri temizlendi")}function renderStockDistributionResults(e){document.getElementById("stockDistributionResults").style.display="block";let a="";e.forEach((e,t)=>{a+=`
                    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
                        <h3 style="margin: 0 0 20px 0; color: #667eea;">
                            ${t+1}. ${e.productCode} (Toplam Stok: ${e.totalStock.toLocaleString("tr-TR",{minimumFractionDigits:2})} adet)
                        </h3>
                        <p style="color: #6c757d; margin-bottom: 20px;">${e.message}</p>
                        
                        ${e.noData?`
                            <div style="background: #fff3cd; padding: 20px; border-radius: 10px; border-left: 4px solid #ffc107;">
                                <strong>ğŸ’¡ Ã–neri:</strong> GeÃ§miÅŸ satÄ±ÅŸ verisi olmadÄ±ÄŸÄ± iÃ§in maÄŸazalara eÅŸit daÄŸÄ±tÄ±m yapabilirsiniz.
                            </div>
                        `:`
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead style="background: #f8f9fa;">
                                    <tr>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">MaÄŸaza</th>
                                        <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">GeÃ§miÅŸ SatÄ±ÅŸ</th>
                                        <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Pay (%)</th>
                                        <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Ã–nerilen Stok</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${e.distribution.map((e,t)=>`
                                        <tr style="border-bottom: 1px solid #eee; ${t%2==0?"background: #f8f9fa;":""}">
                                            <td style="padding: 12px;"><strong>${e.store}</strong></td>
                                            <td style="padding: 12px; text-align: right;">${e.historicalQty.toLocaleString("tr-TR",{minimumFractionDigits:2})} adet</td>
                                            <td style="padding: 12px; text-align: right; color: #667eea; font-weight: bold;">${e.percentage}%</td>
                                            <td style="padding: 12px; text-align: right; color: #38ef7d; font-weight: bold; font-size: 1.1em;">${e.recommendedQty} adet</td>
                                        </tr>
                                    `).join("")}
                                </tbody>
                            </table>
                            
                            <div style="background: #d1ecf1; padding: 20px; border-radius: 10px; border-left: 4px solid #0c5460; margin-top: 20px;">
                                <strong>ğŸ¤– AI Ã–neri:</strong> Bu daÄŸÄ±lÄ±m, geÃ§miÅŸ satÄ±ÅŸ performansÄ±na gÃ¶re optimize edilmiÅŸtir. 
                                En yÃ¼ksek satÄ±ÅŸ yapan maÄŸazalara daha fazla stok ayrÄ±lmÄ±ÅŸtÄ±r.
                            </div>
                        `}
                    </div>
                `}),document.getElementById("stockDistributionContent").innerHTML=a,document.getElementById("stockDistributionResults").scrollIntoView({behavior:"smooth",block:"start"})}let salespersonBrandChartInstance=null,salespersonCategoryChartInstance=null,salespersonStoreChartInstance=null,salespersonMonthlyChartInstance=null,comparisonSalesChartInstance=null,comparisonQtyChartInstance=null,selectedSalespersons=[],comparisonStoreSalesChartInstance=null,comparisonStoreQtyChartInstance=null;function populateSalespersonYearFilter(){if(allData&&0!==allData.length){let t=new Set,a=new Set,r=new Set;allData.forEach(e=>{e.date&&3<=(e=e.date.split("-")).length&&(t.add(e[0]),a.add(e[1]),r.add(e[2]))}),populateMultiSelect("filterSalespersonYear",Array.from(t).sort().reverse(),"countSalespersonYear"),populateMultiSelect("filterSalespersonMonth",Array.from(a).sort(),"countSalespersonMonth"),populateMultiSelect("filterSalespersonDay",Array.from(r).sort(),"countSalespersonDay")}}function toggleSalespersonCustomDayRange(e){var t=document.getElementById("salespersonCustomDayRange");"custom"===e?t.style.display="block":(t.style.display="none",e?([t,e]=e.split("-"),document.getElementById("salespersonStartDay").value=t,document.getElementById("salespersonEndDay").value=e):(document.getElementById("salespersonStartDay").value="",document.getElementById("salespersonEndDay").value=""))}function clearSalespersonFilters(){var e=document.querySelectorAll('#filterSalespersonYear input[type="checkbox"]'),t=document.querySelectorAll('#filterSalespersonMonth input[type="checkbox"]'),a=document.querySelectorAll('#filterSalespersonDay input[type="checkbox"]');e.forEach(e=>e.checked=!1),t.forEach(e=>e.checked=!1),a.forEach(e=>e.checked=!1),updateSelectionCount("filterSalespersonYear","countSalespersonYear"),updateSelectionCount("filterSalespersonMonth","countSalespersonMonth"),updateSelectionCount("filterSalespersonDay","countSalespersonDay"),console.log("âœ… SatÄ±ÅŸ temsilcisi filtreleri temizlendi")}function searchSalespersonProfile(){let n=[];if(0<selectedSalespersons.length)n=selectedSalespersons;else{var e=document.getElementById("salespersonSearchInput").value.trim();if(!e)return void alert("LÃ¼tfen bir satÄ±ÅŸ temsilcisi adÄ± girin veya listeden seÃ§in");e=e.split(",").map(e=>e.trim().toLowerCase()).filter(e=>e);if(0===e.length)return void alert("LÃ¼tfen geÃ§erli bir satÄ±ÅŸ temsilcisi adÄ± girin");let r={};if(allData.forEach(e=>{var t=e.sales_person||"",e=e.store||"";e.toLowerCase().includes("analitik")||e.toLowerCase().includes("eÄŸitim")||t&&!r[t]&&(r[t]=t)}),n=[],e.forEach(t=>{var e,a=Object.keys(r).filter(e=>e.toLowerCase().includes(t));0<a.length&&(e=a.find(e=>e.toLowerCase()===t),n.push(e||a[0]))}),0===n.length)return void alert("âŒ Girilen isimlere uygun satÄ±ÅŸ temsilcisi bulunamadÄ±!");3<(n=[...new Set(n)]).length&&(alert("âš ï¸ En fazla 3 satÄ±ÅŸ temsilcisi arayabilirsiniz!"),n=n.slice(0,3))}console.log("ğŸ” SatÄ±ÅŸ temsilcileri aranÄ±yor:",n);var e=Array.from(document.querySelectorAll('#filterSalespersonYear input[type="checkbox"]:checked')).map(e=>e.value),t=Array.from(document.querySelectorAll('#filterSalespersonMonth input[type="checkbox"]:checked')).map(e=>e.value),a=Array.from(document.querySelectorAll('#filterSalespersonDay input[type="checkbox"]:checked')).map(e=>e.value);console.log("ğŸ“… Filtreler:",{yearFilter:e,monthFilter:t,dayFilter:a}),1===n.length?renderSingleSalespersonView(n[0],e,t,a):renderMultipleSalespersonsView(n,e,t,a)}function renderSingleSalespersonView(a,r,n,o){var e,t,i,l,s,d,c,m,g,u=allData.filter(e=>{if(!e.sales_person||!e.sales_person.toLowerCase().includes(a.toLowerCase()))return!1;var t=(e.store||"").toLowerCase();if(t.includes("analitik")||t.includes("eÄŸitim"))return!1;if(!e.date)return!1;if(0<r.length){t=e.date.substring(0,4);if(!r.includes(t))return!1}if(0<n.length){t=e.date.substring(5,7);if(!n.includes(t))return!1}if(0<o.length){t=e.date.substring(8,10);if(!o.includes(t))return!1}return!0});0===u.length?(document.getElementById("salespersonProfileContainer").style.display="none",document.getElementById("salespersonSearchNoResults").style.display="block"):(document.getElementById("salespersonSearchNoResults").style.display="none",document.getElementById("salespersonProfileContainer").style.display="block",document.getElementById("singleSalespersonView").style.display="block",document.getElementById("multipleSalespersonsView").style.display="none",document.getElementById("salespersonBrandCategorySection").style.display="grid",document.getElementById("salespersonMonthlySection").style.display="block",document.getElementById("salespersonTopProductsSection").style.display="block",document.getElementById("salespersonBottomProductsSection").style.display="block",e=u[0].sales_person,document.getElementById("salespersonBrandChartTitle").textContent=`ğŸ·ï¸ ${e} - En Ã‡ok SattÄ±ÄŸÄ± Markalar (Top 10)`,document.getElementById("salespersonCategoryChartTitle").textContent=`ğŸ“‚ ${e} - En Ã‡ok SattÄ±ÄŸÄ± Kategoriler`,t=u.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),i=u.reduce((e,t)=>e+parseFloat(t.quantity||0),0),l=new Set(u.map(e=>e.date)).size,s=new Set(u.map(e=>e.move_name)).size,d=t/Math.max(l,1),c=t/Math.max(s,1),m=new Set(u.map(e=>e.partner)).size,g=new Set(u.map(e=>e.product)).size,document.getElementById("salespersonName").textContent=e,document.getElementById("salespersonTotalSales").textContent="$"+t.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("salespersonTotalQty").textContent=i.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("salespersonInvoiceCount").textContent=s,document.getElementById("salespersonAvgTransaction").textContent="$"+d.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("salespersonAvgBasket").textContent="$"+c.toLocaleString("tr-TR",{minimumFractionDigits:2}),document.getElementById("salespersonUniqueCustomers").textContent=m,document.getElementById("salespersonUniqueProducts").textContent=g,renderSalespersonBrandChart(u),renderSalespersonCategoryChart(u),renderSalespersonMonthlyChart(u),renderSalespersonTopProducts(lastSalespersonTopProductsData=u),renderSalespersonBottomProducts(u),performSalespersonAIAnalysis(u,{name:e,totalSales:t,totalQty:i,transactionCount:l,avgTransaction:d,uniqueCustomers:m,uniqueProducts:g}))}function renderMultipleSalespersonsView(e,c,m,g){var t,e=e.map(a=>{var e=allData.filter(e=>{if(!e.sales_person||e.sales_person!==a)return!1;var t=(e.store||"").toLowerCase();if(t.includes("analitik")||t.includes("eÄŸitim"))return!1;if(!e.date)return!1;if(0<c.length){t=e.date.substring(0,4);if(!c.includes(t))return!1}if(0<m.length){t=e.date.substring(5,7);if(!m.includes(t))return!1}if(0<g.length){t=e.date.substring(8,10);if(!g.includes(t))return!1}return!0}),t=e.reduce((e,t)=>e+parseFloat(t.usd_amount||0),0),r=e.reduce((e,t)=>e+parseFloat(t.quantity||0),0),n=new Set(e.map(e=>e.date)).size,o=new Set(e.map(e=>e.move_name)).size,i=t/Math.max(n,1),l=t/Math.max(o,1),s=new Set(e.map(e=>e.partner)).size,d=new Set(e.map(e=>e.product)).size;return{name:a,data:e,invoiceCount:o,avgBasket:l,totalSales:t,totalQty:r,transactionCount:n,avgTransaction:i,uniqueCustomers:s,uniqueProducts:d}}).filter(e=>0<e.data.length);0===e.length?(document.getElementById("salespersonProfileContainer").style.display="none",document.getElementById("salespersonSearchNoResults").style.display="block"):(document.getElementById("salespersonSearchNoResults").style.display="none",document.getElementById("salespersonProfileContainer").style.display="block",document.getElementById("singleSalespersonView").style.display="none",document.getElementById("multipleSalespersonsView").style.display="block",renderSalespersonComparisonTable(e),renderSalespersonComparisonCharts(e),document.getElementById("salespersonBrandCategorySection").style.display="none",document.getElementById("salespersonMonthlySection").style.display="none",document.getElementById("salespersonTopProductsSection").style.display="none",document.getElementById("salespersonBottomProductsSection").style.display="none",(t=document.getElementById("salespersonAIAnalysisPanel"))&&(t.style.display="block"),performMultipleSalespersonsAIAnalysis(e))}function renderSalespersonBrandChart(e){let a={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),r=e.map(e=>e[1].sales),e=e.map(e=>e[1].qty),n=document.getElementById("salespersonBrandChart");n&&(salespersonBrandChartInstance&&salespersonBrandChartInstance.destroy(),salespersonBrandChartInstance=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:r,backgroundColor:"rgba(102, 126, 234, 0.6)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2,yAxisID:"y"},{label:"Miktar",data:e,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:2,yAxisID:"y"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{x:{beginAtZero:!0}}}}))}function renderSalespersonCategoryChart(e){let a={};e.forEach(e=>{var t=e.category_2||"";!t||"all"===t.toLowerCase()||"bilinmiyor"===t.toLowerCase()||t.toLowerCase().includes("analitik")||t.toLowerCase().includes("eÄŸitim")||(a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0))});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,10),t=e.map(e=>e[0]),r=e.map(e=>e[1].sales),e=e.map(e=>e[1].qty),n=document.getElementById("salespersonCategoryChart");n&&(salespersonCategoryChartInstance&&salespersonCategoryChartInstance.destroy(),salespersonCategoryChartInstance=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:r,backgroundColor:"rgba(56, 239, 125, 0.6)",borderColor:"rgba(56, 239, 125, 1)",borderWidth:2,yAxisID:"y"},{label:"Miktar",data:e,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:2,yAxisID:"y"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{x:{beginAtZero:!0}}}}))}function renderSalespersonStoreChart(e){let a={};e.forEach(e=>{var t=e.store||"Bilinmiyor";a[t]||(a[t]={sales:0,qty:0}),a[t].sales+=parseFloat(e.usd_amount||0),a[t].qty+=parseFloat(e.quantity||0)});var e=Object.entries(a).sort((e,t)=>t[1].sales-e[1].sales).slice(0,5),t=e.map(e=>e[0].replace(/\[.*?\]\s*/g,"").replace(/^.*?\s-\s/,"").trim()),r=e.map(e=>e[1].sales),e=e.map(e=>e[1].qty),n=document.getElementById("salespersonStoreChart");n&&(salespersonStoreChartInstance&&salespersonStoreChartInstance.destroy(),salespersonStoreChartInstance=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"SatÄ±ÅŸ (USD - KDV HariÃ§)",data:r,backgroundColor:"rgba(245, 87, 108, 0.6)",borderColor:"rgba(245, 87, 108, 1)",borderWidth:2,yAxisID:"y"},{label:"Miktar",data:e,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:2,yAxisID:"y"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{x:{beginAtZero:!0}}}}))}function renderSalespersonMonthlyChart(e){let n={},t=(e.forEach(e=>{var t=new Date(e.date),a=t.getFullYear(),t=String(t.getMonth()+1).padStart(2,"0");n[a]||(n[a]={}),n[a][t]||(n[a][t]=0),n[a][t]+=parseFloat(e.usd_amount||0)}),new Set),o=(Object.values(n).forEach(e=>{Object.keys(e).forEach(e=>t.add(e))}),Array.from(t).sort()),i=[],l=[{border:"rgba(102, 126, 234, 1)",bg:"rgba(102, 126, 234, 0.1)"},{border:"rgba(245, 87, 108, 1)",bg:"rgba(245, 87, 108, 0.1)"},{border:"rgba(56, 239, 125, 1)",bg:"rgba(56, 239, 125, 0.1)"},{border:"rgba(255, 206, 86, 1)",bg:"rgba(255, 206, 86, 0.1)"}];Object.keys(n).sort().forEach((e,t)=>{let a=n[e];var r=o.map(e=>a[e]||0),t=l[t%l.length];i.push({label:e+" SatÄ±ÅŸlarÄ±",data:r,borderColor:t.border,backgroundColor:t.bg,borderWidth:3,fill:!0,tension:.4})});e=document.getElementById("salespersonMonthlyChart");if(e){salespersonMonthlyChartInstance&&salespersonMonthlyChartInstance.destroy();let t=["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"];var a=o.map(e=>t[parseInt(e)-1]);salespersonMonthlyChartInstance=new Chart(e,{type:"line",data:{labels:a,datasets:i},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+e.toLocaleString("tr-TR")}}}}}})}}function renderSalespersonTopProducts(t=null,a=null,e){if((t=null===t&&lastSalespersonTopProductsData?lastSalespersonTopProductsData:t)&&0!==t.length){null!==a&&(currentSalespersonSortDirection=currentSalespersonSortColumn===a?"asc"===currentSalespersonSortDirection?"desc":"asc":(currentSalespersonSortColumn=a,"desc"));let r={},e=(t.forEach(e=>{var t,a=e.product||"Bilinmiyor";r[a]||(t=0<(t=[e.category_1,e.category_2,e.category_3,e.category_4].filter(e=>e&&e.trim()&&"all"!==e.toLowerCase())).length?t.join(" â€º "):"Bilinmiyor",r[a]={brand:e.brand||"Bilinmiyor",category:t,sales:0,qty:0,count:0}),r[a].sales+=parseFloat(e.usd_amount||0),r[a].qty+=parseFloat(e.quantity||0),r[a].count+=1}),Object.entries(r));"product"===currentSalespersonSortColumn?e.sort((e,t)=>"asc"===currentSalespersonSortDirection?e[0].localeCompare(t[0],"tr"):t[0].localeCompare(e[0],"tr")):"brand"===currentSalespersonSortColumn?e.sort((e,t)=>"asc"===currentSalespersonSortDirection?e[1].brand.localeCompare(t[1].brand,"tr"):t[1].brand.localeCompare(e[1].brand,"tr")):"category"===currentSalespersonSortColumn?e.sort((e,t)=>"asc"===currentSalespersonSortDirection?e[1].category.localeCompare(t[1].category,"tr"):t[1].category.localeCompare(e[1].category,"tr")):"sales"===currentSalespersonSortColumn?e.sort((e,t)=>"asc"===currentSalespersonSortDirection?e[1].sales-t[1].sales:t[1].sales-e[1].sales):"qty"===currentSalespersonSortColumn?e.sort((e,t)=>"asc"===currentSalespersonSortDirection?e[1].qty-t[1].qty:t[1].qty-e[1].qty):"count"===currentSalespersonSortColumn&&e.sort((e,t)=>"asc"===currentSalespersonSortDirection?e[1].count-t[1].count:t[1].count-e[1].count),e=e.slice(0,20);a=e=>currentSalespersonSortColumn!==e?"â‡…":"asc"===currentSalespersonSortDirection?"â†‘":"â†“";let n=`
                <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <thead style="background: linear-gradient(135deg, #38ef7d 0%, #11998e 100%); color: white;">
                        <tr>
                            <th style="padding: 15px; text-align: left;">#</th>
                            <th style="padding: 15px; text-align: left; cursor: pointer;" onclick="renderSalespersonTopProducts(null, 'product')">
                                ÃœrÃ¼n ${a("product")}
                            </th>
                            <th style="padding: 15px; text-align: left; cursor: pointer;" onclick="renderSalespersonTopProducts(null, 'brand')">
                                Marka ${a("brand")}
                            </th>
                            <th style="padding: 15px; text-align: left; cursor: pointer;" onclick="renderSalespersonTopProducts(null, 'category')">
                                Kategori ${a("category")}
                            </th>
                            <th style="padding: 15px; text-align: right; cursor: pointer;" onclick="renderSalespersonTopProducts(null, 'sales')">
                                SatÄ±ÅŸ (USD) ${a("sales")}
                            </th>
                            <th style="padding: 15px; text-align: right; cursor: pointer;" onclick="renderSalespersonTopProducts(null, 'qty')">
                                Miktar ${a("qty")}
                            </th>
                            <th style="padding: 15px; text-align: right; cursor: pointer;" onclick="renderSalespersonTopProducts(null, 'count')">
                                Ä°ÅŸlem ${a("count")}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
            `;e.forEach((e,t)=>{var a=e[0],e=e[1];n+=`
                    <tr style="border-bottom: 1px solid #eee; ${t%2==0?"background: #f8f9fa;":""}">
                        <td style="padding: 12px;">${t+1}</td>
                        <td style="padding: 12px;"><strong>${a}</strong></td>
                        <td style="padding: 12px;">${e.brand}</td>
                        <td style="padding: 12px;">${e.category}</td>
                        <td style="padding: 12px; text-align: right; color: #38ef7d; font-weight: bold;">$${e.sales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: right;">${e.qty.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: right;">${e.count}</td>
                    </tr>
                `}),n+=`
                    </tbody>
                </table>
            `,document.getElementById("salespersonTopProductsTable").innerHTML=n}else document.getElementById("salespersonTopProductsTable").innerHTML='<p style="text-align: center; padding: 20px;">Veri bulunamadÄ±</p>'}function renderSalespersonBottomProducts(e){let r={};e.forEach(e=>{var t,a=e.product||"Bilinmiyor";r[a]||(t=0<(t=[e.category_1,e.category_2,e.category_3,e.category_4].filter(e=>e&&e.trim()&&"all"!==e.toLowerCase())).length?t.join(" â€º "):"Bilinmiyor",r[a]={brand:e.brand||"Bilinmiyor",category:t,sales:0,qty:0,count:0}),r[a].sales+=parseFloat(e.usd_amount||0),r[a].qty+=parseFloat(e.quantity||0),r[a].count+=1});e=Object.entries(r).sort((e,t)=>e[1].sales-t[1].sales).slice(0,10);let n=`
                <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <thead style="background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%); color: white;">
                        <tr>
                            <th style="padding: 15px; text-align: left;">#</th>
                            <th style="padding: 15px; text-align: left;">ÃœrÃ¼n</th>
                            <th style="padding: 15px; text-align: left;">Marka</th>
                            <th style="padding: 15px; text-align: left;">Kategori</th>
                            <th style="padding: 15px; text-align: right;">SatÄ±ÅŸ (USD)</th>
                            <th style="padding: 15px; text-align: right;">Miktar</th>
                            <th style="padding: 15px; text-align: right;">Ä°ÅŸlem</th>
                        </tr>
                    </thead>
                    <tbody>
            `;e.forEach((e,t)=>{var a=e[0],e=e[1];n+=`
                    <tr style="border-bottom: 1px solid #eee; ${t%2==0?"background: #fff3cd;":"background: #ffe5e5;"}">
                        <td style="padding: 12px;">${t+1}</td>
                        <td style="padding: 12px;"><strong>${a}</strong></td>
                        <td style="padding: 12px;">${e.brand}</td>
                        <td style="padding: 12px;">${e.category}</td>
                        <td style="padding: 12px; text-align: right; color: #f5576c; font-weight: bold;">$${e.sales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: right;">${e.qty.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>
                        <td style="padding: 12px; text-align: right;">${e.count}</td>
                    </tr>
                `}),n+=`
                    </tbody>
                </table>
            `,document.getElementById("salespersonBottomProductsTable").innerHTML=n}function renderSalespersonComparisonTable(e){var t=document.getElementById("salespersonComparisonTable"),e=`
                <table style="width: 100%; border-collapse: collapse; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <th style="padding: 15px; text-align: left;">Metrik</th>
                            ${e.map(e=>`<th style="padding: 15px; text-align: right;">ğŸ‘¨â€ğŸ’¼ ${e.name}</th>`).join("")}
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: white;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ’° Toplam SatÄ±ÅŸ</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">$${e.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>`).join("")}
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ“¦ Toplam Adet</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">${e.totalQty.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>`).join("")}
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ›’ Fatura SayÄ±sÄ±</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">${e.invoiceCount}</td>`).join("")}
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ“Š GÃ¼nlÃ¼k Ort. SatÄ±ÅŸ</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">$${e.avgTransaction.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>`).join("")}
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ›’ Sepet OrtalamasÄ±</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">$${e.avgBasket.toLocaleString("tr-TR",{minimumFractionDigits:2})}</td>`).join("")}
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ‘¥ FarklÄ± MÃ¼ÅŸteri</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">${e.uniqueCustomers}</td>`).join("")}
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: 600;">ğŸ¯ FarklÄ± ÃœrÃ¼n</td>
                            ${e.map(e=>`<td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: right;">${e.uniqueProducts}</td>`).join("")}
                        </tr>
                    </tbody>
                </table>
            `;t.innerHTML=e}function renderSalespersonComparisonCharts(e){var t=e.map(e=>e.name),a=e.map(e=>e.totalSales),e=e.map(e=>e.totalQty),r=["rgba(102, 126, 234, 0.7)","rgba(240, 147, 251, 0.7)","rgba(255, 159, 64, 0.7)"],n=["rgba(102, 126, 234, 1)","rgba(240, 147, 251, 1)","rgba(255, 159, 64, 1)"],o=document.getElementById("comparisonSalesChart"),o=(comparisonSalesChartInstance&&comparisonSalesChartInstance.destroy(),comparisonSalesChartInstance=new Chart(o,{type:"bar",data:{labels:t,datasets:[{label:"Toplam SatÄ±ÅŸ ($)",data:a,backgroundColor:r,borderColor:n,borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return"$"+e.parsed.y.toLocaleString("tr-TR",{minimumFractionDigits:2})}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"K"}}}}}}),document.getElementById("comparisonQtyChart"));comparisonQtyChartInstance&&comparisonQtyChartInstance.destroy(),comparisonQtyChartInstance=new Chart(o,{type:"bar",data:{labels:t,datasets:[{label:"Toplam Adet",data:e,backgroundColor:r,borderColor:n,borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return e.parsed.y.toLocaleString("tr-TR",{minimumFractionDigits:2})+" adet"}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return e.toLocaleString("tr-TR")}}}}}})}function performSalespersonAIAnalysis(e,t){console.log("ğŸ¤– SatÄ±ÅŸ temsilcisi AI analizi baÅŸlatÄ±lÄ±yor...");var a={positive:[],negative:[],neutral:[],recommendations:[]};let r={};e.forEach(e=>{var t=e.brand||"Bilinmiyor";r[t]||(r[t]=0),r[t]+=parseFloat(e.usd_amount||0)});var n=Object.entries(r).sort((e,t)=>t[1]-e[1]).slice(0,3),o=Object.entries(r).sort((e,t)=>e[1]-t[1]).slice(0,3);let i={};e.forEach(e=>{var t=e.category_2||"Bilinmiyor";"all"===t.toLowerCase()||t.toLowerCase().includes("analitik")||t.toLowerCase().includes("eÄŸitim")||(i[t]||(i[t]=0),i[t]+=parseFloat(e.usd_amount||0))});var l=Object.entries(i).sort((e,t)=>t[1]-e[1]).slice(0,3),s=Object.entries(i).sort((e,t)=>e[1]-t[1]).slice(0,3);let d=["Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"],c={};e.forEach(e=>{var t=new Date(e.date).getMonth();c[t]||(c[t]=0),c[t]+=parseFloat(e.usd_amount||0)});var m=Object.entries(c).map(([e,t])=>({month:parseInt(e),name:d[e],value:t})),g=m.sort((e,t)=>t.value-e.value)[0],m=m.sort((e,t)=>e.value-t.value)[0];let u=["Pazar","Pazartesi","SalÄ±","Ã‡arÅŸamba","PerÅŸembe","Cuma","Cumartesi"],p={};e.forEach(e=>{var t=e.day_of_week;null!=t&&(t=(t+1)%7,p[t]||(p[t]=0),p[t]+=parseFloat(e.usd_amount||0))});var y=Object.entries(p).map(([e,t])=>({day:parseInt(e),name:u[e],value:t})),h=y.sort((e,t)=>t.value-e.value)[0],y=y.sort((e,t)=>e.value-t.value)[0];let b={};e.forEach(e=>{var t=e.create_hour;null!=t&&(b[t]||(b[t]=0),b[t]+=parseFloat(e.usd_amount||0))});var f=Object.entries(b).map(([e,t])=>({hour:parseInt(e),value:t})).sort((e,t)=>t.value-e.value)[0];let v=0,k=0,S=0,C=0;e.forEach(e=>{var t=e.create_hour,e=parseFloat(e.usd_amount||0);6<=t&&t<12?v+=e:12<=t&&t<17?k+=e:17<=t&&t<22?S+=e:C+=e});var x=[{name:"Sabah (06:00-12:00)",value:v},{name:"Ã–ÄŸlen (12:00-17:00)",value:k},{name:"AkÅŸam (17:00-22:00)",value:S},{name:"Gece (22:00-06:00)",value:C}].sort((e,t)=>t.value-e.value);let $={};e.forEach(e=>{var t,a=e.store||"Bilinmiyor",r=e.day_of_week;null!=r&&(t=a+"_"+(r=(r+1)%7),$[t]||($[t]={store:a,day:r,dayName:u[r],value:0}),$[t].value+=parseFloat(e.usd_amount||0))});e=Object.values($).sort((e,t)=>t.value-e.value)[0];if(1e5<t.totalSales&&a.positive.push({title:"ğŸ† YÃ¼ksek Performans",description:`${t.name} toplam $${t.totalSales.toLocaleString("tr-TR",{minimumFractionDigits:2})} satÄ±ÅŸ gerÃ§ekleÅŸtirmiÅŸ. Bu, Ã§ok baÅŸarÄ±lÄ± bir performans gÃ¶stergesi.`}),0<n.length&&(T=((I=n[0])[1]/t.totalSales*100).toFixed(1),a.positive.push({title:`ğŸ·ï¸ ${I[0]} MarkasÄ±nda Uzman`,description:`${I[0]} markasÄ±nda %${T} pay ile gÃ¼Ã§lÃ¼ ($${I[1].toLocaleString("tr-TR",{minimumFractionDigits:2})}). Bu markadaki Ã¼rÃ¼nleri Ã§ok iyi biliyor.`})),0<l.length&&(I=((T=l[0])[1]/t.totalSales*100).toFixed(1),a.positive.push({title:`ğŸ“‚ ${T[0]} Kategorisinde BaÅŸarÄ±lÄ±`,description:`${T[0]} kategorisinde %${I} pay ile lider ($${T[1].toLocaleString("tr-TR",{minimumFractionDigits:2})}). Bu kategorideki Ã¼rÃ¼nleri etkili satÄ±yor.`})),0<o.length&&o[0][1]<.05*t.totalSales&&a.negative.push({title:`âš ï¸ ${o[0][0]} MarkasÄ±nda ZayÄ±f`,description:`${o[0][0]} markasÄ±nda sadece $${o[0][1].toLocaleString("tr-TR",{minimumFractionDigits:2})} satÄ±ÅŸ var. Bu markada eÄŸitim gerekebilir.`}),0<s.length&&s[0][1]<.05*t.totalSales&&a.negative.push({title:`âš ï¸ ${s[0][0]} Kategorisinde GeliÅŸim AlanÄ±`,description:`${s[0][0]} kategorisinde sadece $${s[0][1].toLocaleString("tr-TR",{minimumFractionDigits:2})} satÄ±ÅŸ var. Bu kategoride potansiyel artÄ±ÅŸ fÄ±rsatÄ±.`}),t.uniqueCustomers<50&&a.negative.push({title:"ğŸ‘¥ MÃ¼ÅŸteri PortfÃ¶yÃ¼ Dar",description:`Sadece ${t.uniqueCustomers} farklÄ± mÃ¼ÅŸteri ile Ã§alÄ±ÅŸÄ±lmÄ±ÅŸ. Yeni mÃ¼ÅŸteri kazanÄ±mÄ±na odaklanÄ±lmalÄ±.`}),g&&m&&(I=(g.value/t.totalSales*100).toFixed(1),T=(m.value/t.totalSales*100).toFixed(1),a.neutral.push({title:"ğŸ“… AylÄ±k Performans",description:`En gÃ¼Ã§lÃ¼ ay: <span class="metric-highlight">${g.name}</span> (%${I})<br>En zayÄ±f ay: ${m.name} (%${T})`})),h&&y&&(g=(h.value/t.totalSales*100).toFixed(1),I=(y.value/t.totalSales*100).toFixed(1),a.neutral.push({title:"ğŸ“† GÃ¼nlÃ¼k Performans",description:`En gÃ¼Ã§lÃ¼ gÃ¼n: <span class="metric-highlight">${h.name}</span> (%${g})<br>En zayÄ±f gÃ¼n: ${y.name} (%${I})`})),0<x.length&&(T=((m=x[0]).value/t.totalSales*100).toFixed(1),a.neutral.push({title:"ğŸ• Saat Dilimi PerformansÄ±",description:`En gÃ¼Ã§lÃ¼: <span class="metric-highlight">${m.name}</span> - Cironun %${T}'i bu saatlerde`})),e&&(g=(e.value/t.totalSales*100).toFixed(1),I=e.store.replace(/\[.*?\]\s*/g,"").trim(),getStoreWorkingHours(e.store).closedDays.includes(e.day)||a.neutral.push({title:"â­ En BaÅŸarÄ±lÄ± Kombinasyon",description:`<span class="metric-highlight">${I}</span> - <span class="metric-highlight">${e.dayName}</span> gÃ¼nleri harika! (%${g})`})),a.neutral.push({title:"ğŸ“Š Genel Performans",description:`<span class="metric-highlight">${t.uniqueProducts}</span> farklÄ± Ã¼rÃ¼n, <span class="metric-highlight">${t.uniqueCustomers}</span> farklÄ± mÃ¼ÅŸteriye satÄ±ldÄ±. Ortalama iÅŸlem deÄŸeri $${t.avgTransaction.toLocaleString("tr-TR",{minimumFractionDigits:2})}.`}),3<=n.length&&a.neutral.push({title:"ğŸ·ï¸ Marka Ã‡eÅŸitliliÄŸi",description:`En Ã§ok satÄ±lan markalar: ${n.map(e=>e[0]).join(", ")}. Bu markalarda yoÄŸunlaÅŸma var.`}),3<=l.length&&a.neutral.push({title:"ğŸ“‚ Kategori Ã‡eÅŸitliliÄŸi",description:`En Ã§ok satÄ±lan kategoriler: ${l.map(e=>e[0]).join(", ")}. Bu kategorilerde uzmanlaÅŸma mevcut.`}),y&&h&&a.recommendations.push({icon:"ğŸ“†",title:"GÃ¼n BazlÄ± Strateji",description:`${y.name} gÃ¼nleri zayÄ±f. ${h.name} gÃ¼nlerindeki baÅŸarÄ±lÄ± yaklaÅŸÄ±mlarÄ± ${y.name}'ya da uygulayÄ±n. MÃ¼ÅŸteri ziyaretlerini buna gÃ¶re planlayÄ±n.`}),f&&a.recommendations.push({icon:"â°",title:"Saat BazlÄ± Optimizasyon",description:`Saat ${f.hour}:00 civarÄ±nda en baÅŸarÄ±lÄ±. Bu saatlerde daha fazla mÃ¼ÅŸteri gÃ¶rÃ¼ÅŸmesi planlayÄ±n.`}),1<x.length){m=x.filter(e=>!e.name.includes("Gece"));if(1<m.length){var T=m[m.length-1],I=(T.value/t.totalSales*100).toFixed(1);if(parseFloat(I)<20){let e=T.name+` sadece %${I} ciro yapÄ±yor.`;T.name.includes("Sabah")?e+=" Sabah mÃ¼ÅŸteri akÄ±ÅŸÄ±nÄ± artÄ±rmak iÃ§in aÃ§Ä±lÄ±ÅŸ kampanyalarÄ± ve sosyal medya duyurularÄ± yapÄ±lmalÄ±.":T.name.includes("Ã–ÄŸlen")?e+=" Ã–ÄŸle saatlerinde Ã¶zel indirimler ve hÄ±zlÄ± servis sunulmalÄ±.":T.name.includes("AkÅŸam")&&(e+=" AkÅŸam saatlerinde (17:00-20:00/22:00) Ã¶zel etkinlikler ve workshop'lar dÃ¼zenlenebilir."),a.recommendations.push({icon:"ğŸ¯",title:"ZayÄ±f Zaman Dilimini GÃ¼Ã§lendir",description:e})}}}0<o.length&&a.recommendations.push({icon:"ğŸ“š",title:"ÃœrÃ¼n EÄŸitimi",description:`${o[0][0]} ve ${s[0][0]} konularÄ±nda Ã¼rÃ¼n eÄŸitimi almalÄ±. Bu alanlardaki bilgi eksikliÄŸi satÄ±ÅŸlarÄ± etkiliyor olabilir.`}),0<n.length&&a.recommendations.push({icon:"ğŸ¯",title:"BaÅŸarÄ±lÄ± Stratejileri YaygÄ±nlaÅŸtÄ±r",description:n[0][0]+" markasÄ±ndaki baÅŸarÄ±yÄ± diÄŸer markalara da taÅŸÄ±mak iÃ§in aylÄ±k hedefler belirleyin. Cross-selling fÄ±rsatlarÄ±nÄ± deÄŸerlendirin."}),a.recommendations.push({icon:"ğŸ‘¥",title:"MÃ¼ÅŸteri GeliÅŸtirme",description:`Mevcut ${t.uniqueCustomers} mÃ¼ÅŸteriye ek olarak yeni mÃ¼ÅŸteri kazanÄ±mÄ± iÃ§in aktif Ã§alÄ±ÅŸma yapÄ±lmalÄ±. Referans sistemi kullanÄ±labilir.`});e=`
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px;">
                    ${0<a.positive.length?`
                    <div class="analysis-section">
                        <h3 style="color: white; margin-top: 0;">âœ… GÃ¼Ã§lÃ¼ YÃ¶nler</h3>
                        ${a.positive.map(e=>`
                            <div class="insight-item insight-positive" style="background: rgba(56, 239, 125, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #38ef7d;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">âœ…</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<a.negative.length?`
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">âš ï¸ GeliÅŸim AlanlarÄ±</h3>
                        ${a.negative.map(e=>`
                            <div class="insight-item insight-negative" style="background: rgba(245, 87, 108, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #f5576c;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">âš ï¸</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    ${0<a.neutral.length?`
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">ğŸ’¡ Genel Bilgiler</h3>
                        ${a.neutral.map(e=>`
                            <div class="insight-item insight-neutral" style="background: rgba(255, 215, 0, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #ffd700;">
                                <span class="insight-icon" style="font-size: 1.5em; margin-right: 10px;">ğŸ’¡</span>
                                <strong style="font-size: 1.1em;">${e.title}</strong><br>
                                <span style="opacity: 0.95; margin-top: 8px; display: block;">${e.description}</span>
                            </div>
                        `).join("")}
                    </div>
                    `:""}
                    
                    <div class="analysis-section" style="margin-top: 25px;">
                        <h3 style="color: white;">ğŸ¯ GeliÅŸim Ã–nerileri</h3>
                        ${a.recommendations.map(e=>`
                            <div class="recommendation" style="background: rgba(255, 255, 255, 0.15); padding: 18px; border-radius: 10px; margin: 12px 0;">
                                <span class="recommendation-icon" style="font-size: 1.8em; margin-right: 12px;">${e.icon}</span>
                                <div style="display: inline-block; vertical-align: top; width: calc(100% - 50px);">
                                    <strong style="font-size: 1.15em; display: block; margin-bottom: 8px;">${e.title}</strong>
                                    <p style="margin: 0; opacity: 0.95; line-height: 1.6;">${e.description}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;document.getElementById("salespersonAIAnalysisContent").innerHTML=e}function initMobileTableScrollHint(){window.innerWidth<=768&&document.querySelectorAll("table").forEach(e=>{e.addEventListener("scroll",function(){this.classList.add("scrolled")},{once:!0})})}let loadingProgress=0,loadingSteps=[{id:"step1",text:"ğŸ”„ Sayfa baÅŸlatÄ±lÄ±yor...",progress:10},{id:"step2",text:"ğŸ“Š Veri dosyalarÄ± yÃ¼kleniyor...",progress:40},{id:"step3",text:"ğŸ¯ Hedefler yÃ¼kleniyor...",progress:70},{id:"step4",text:"âœ… HazÄ±rlanÄ±yor...",progress:100}];function updateLoadingProgress(a,e=null){var t=loadingSteps[a],e=null!==e?e:t.progress;document.getElementById("progressBar").style.width=e+"%",document.getElementById("progressText").textContent=Math.round(e)+"%",loadingSteps.forEach((e,t)=>{e=document.getElementById(e.id);e&&(t<=a?(e.style.display="block",t===a?(e.style.opacity="1",e.style.color="#4ade80",e.style.transform="scale(1.05)"):(e.style.opacity="0.7",e.style.color="white",e.style.transform="scale(1)")):e.style.display="none")}),100<=e&&setTimeout(()=>{document.getElementById("loadingScreen").style.opacity="0",document.getElementById("loadingScreen").style.transition="opacity 0.5s ease",setTimeout(()=>{document.getElementById("loadingScreen").style.display="none",document.getElementById("mainContainer").style.display="block"},500)},500)}function checkLoadingComplete(){let e=0;dataLoadProgress.pageInit&&(e+=25),dataLoadProgress.dataFiles&&(e+=50),dataLoadProgress.targets&&(e+=20),dataLoadProgress.ready&&(e+=5),document.getElementById("progressBar").style.width=e+"%",document.getElementById("progressText").textContent=Math.round(e)+"%",dataLoadProgress.pageInit&&(document.getElementById("step1").style.display="block",document.getElementById("step1").style.opacity="1",document.getElementById("step1").style.color="#4ade80"),dataLoadProgress.dataFiles&&(document.getElementById("step2").style.display="block",document.getElementById("step2").style.opacity="1",document.getElementById("step2").style.color="#4ade80"),dataLoadProgress.targets&&(document.getElementById("step3").style.display="block",document.getElementById("step3").style.opacity="1",document.getElementById("step3").style.color="#4ade80"),dataLoadProgress.ready&&(document.getElementById("step4").style.display="block",document.getElementById("step4").style.opacity="1",document.getElementById("step4").style.color="#4ade80",setTimeout(()=>{document.getElementById("loadingScreen").style.opacity="0",document.getElementById("loadingScreen").style.transition="opacity 0.5s ease",setTimeout(()=>{document.getElementById("loadingScreen").style.display="none",document.getElementById("mainContainer").style.display="block"},500)},500))}function startRealLoading(){dataLoadProgress.pageInit=!0,checkLoadingComplete(),loadData()}function logout(){confirm("Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinizden emin misiniz?")&&(sessionStorage.removeItem("session"),localStorage.removeItem("session"),window.location.href="auth-advanced.html")}function updateUserInfo(){var e;window.currentUser&&window.currentUserType&&(document.getElementById("userInfo").textContent=window.currentUser.name||window.currentUser.username||"KullanÄ±cÄ±",e="admin"===window.currentUserType?"ğŸ‘‘ YÃ¶netici":"ğŸ‘¤ KullanÄ±cÄ±",document.getElementById("userType").textContent=e,e=window.currentUser.twoFactorEnabled?"ğŸ” 2FA Aktif":"ğŸ›¡ï¸ GÃ¼venli Oturum",document.getElementById("securityInfo").textContent=e)}function showSecurityInfo(){var e=localStorage.getItem("session");if(e)try{var t=CryptoJS.AES.decrypt(e,"zuhal-muzik-secret-key-2024"),a=JSON.parse(t.toString(CryptoJS.enc.Utf8)),r=Math.max(0,18e5-(Date.now()-a.loginTime)),n=Math.floor(r/6e4),o=`
ğŸ›¡ï¸ GÃ¼venlik Bilgileri:
â€¢ KullanÄ±cÄ±: ${a.user.name}
â€¢ Rol: ${"admin"===a.user.role?"YÃ¶netici":"KullanÄ±cÄ±"}
â€¢ Ä°kili DoÄŸrulama: ${a.user.twoFactorEnabled?"Aktif âœ…":"Pasif âŒ"}
â€¢ IP Adresi: ${a.ipAddress||"Bilinmiyor"}
â€¢ Cihaz: ${a.deviceInfo?a.deviceInfo.platform:"Bilinmiyor"}
â€¢ Oturum SÃ¼resi: ${n} dakika kaldÄ±
â€¢ GiriÅŸ ZamanÄ±: ${new Date(a.loginTime).toLocaleString("tr-TR")}
â€¢ Oturum ID: ${a.sessionId.substring(0,20)}...
                `;alert(o)}catch(e){alert("GÃ¼venlik bilgileri alÄ±namadÄ±.")}}document.addEventListener("DOMContentLoaded",function(){startRealLoading(),initMobileTableScrollHint(),new MutationObserver(function(){initMobileTableScrollHint()}).observe(document.body,{childList:!0,subtree:!0})}),updateUserInfo(),document.addEventListener("DOMContentLoaded",function(){updateUserInfo(),setInterval(function(){var e=localStorage.getItem("session");e&&(e=JSON.parse(e),18e5<Date.now()-e.loginTime)&&(alert("Oturum sÃ¼reniz doldu. Tekrar giriÅŸ yapÄ±n."),logout())},3e5)})</script><div style="position:fixed;bottom:10px;right:25px;font-size:11px;color:#999;z-index:9999;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:rgba(255,255,255,.9);padding:5px 12px;border-radius:15px;box-shadow:0 2px 8px rgba(0,0,0,.1);backdrop-filter:blur(5px)">Developed by <strong style="color:#667eea">Tofta</strong></div></body></html>