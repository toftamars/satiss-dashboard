import{l as L}from"./core-CUqA-Dyd.js";import{C as y,A as u,d as z,f as p,a as w,D as T}from"./features-DViFsNSQ.js";import"./data-DcVvJSe6.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();window.logger=L;function F(o){const e=document.getElementById(o);if(e){if(o==="channelAll")y.all=e.checked,e.checked&&(Object.keys(y).forEach(t=>{t!=="all"&&(y[t]=!1)}),["channelRetail","channelWholesale","channelOnline","channelCorporate","channelCentral"].forEach(t=>{const n=document.getElementById(t);n&&(n.checked=!1)}));else{const t=o.replace("channel","").toLowerCase();if(y[t]=e.checked,Object.keys(y).filter(a=>a!=="all").some(a=>y[a])){y.all=!1;const a=document.getElementById("channelAll");a&&(a.checked=!1)}else{y.all=!0;const a=document.getElementById("channelAll");a&&(a.checked=!0)}}console.log("🏢 Kanal filtreleri güncellendi:",y),typeof window.loadDashboard=="function"&&window.loadDashboard()}}function O(){return y.all?u.allData:u.allData.filter(o=>{const e=z(o.store||"");return y[e]===!0})}console.log("✅ Filters modülü yüklendi");const S={dashYearly:null,dashTopStores:null,dashTopSalespeople:null,dashTopBrands:null,dashTopCategories:null,dashTopCities:null,dashTopProducts:null},m={primary:"rgba(102, 126, 234, 1)",secondary:"rgba(245, 87, 108, 1)",success:"rgba(56, 239, 125, 1)",warning:"rgba(255, 206, 86, 1)",info:"rgba(79, 172, 254, 1)",purple:"rgba(153, 102, 255, 1)",orange:"rgba(255, 159, 64, 1)",pink:"rgba(255, 99, 132, 1)"},M=["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"];function D(o){S[o]&&(S[o].destroy(),S[o]=null)}function I(o="sales"){try{const e=document.getElementById("dashYearlyChart");if(!e)throw new Error("Chart canvas bulunamadı: dashYearlyChart");if(!u.allData||u.allData.length===0)throw new Error("Veri yüklenmemiş");const t={},n={};u.allData.forEach(s=>{if(s.date){const h=s.date.substring(0,4),b=s.date.substring(5,7);t[h]||(t[h]={}),t[h][b]||(t[h][b]=0),t[h][b]+=parseFloat(s.usd_amount||0),n[h]||(n[h]={}),n[h][b]||(n[h][b]=0),n[h][b]+=parseFloat(s.quantity||0)}});const a=new Set;Object.values(t).forEach(s=>{Object.keys(s).forEach(h=>a.add(h))});const r=Array.from(a).sort(),l=o==="sales"?t:n,g=[],i=[{border:m.primary,bg:"rgba(102, 126, 234, 0.1)"},{border:m.secondary,bg:"rgba(245, 87, 108, 0.1)"},{border:m.success,bg:"rgba(56, 239, 125, 0.1)"},{border:m.warning,bg:"rgba(255, 206, 86, 0.1)"}];Object.keys(l).sort().forEach((s,h)=>{const b=l[s],B=r.map(A=>b[A]||0),C=i[h%i.length];g.push({label:`${s}`,data:B,borderColor:C.border,backgroundColor:C.bg,borderWidth:3,fill:!0,tension:.4})}),D("dashYearly");const c=r.map(s=>M[parseInt(s)-1]),d=o==="sales";S.dashYearly=new Chart(e,{type:"line",data:{labels:c,datasets:g},options:{responsive:!0,maintainAspectRatio:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(s){return d?s.dataset.label+": "+p(s.parsed.y):s.dataset.label+": "+w(s.parsed.y)+" adet"}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:d?"Satış (USD - KDV Hariç)":"Miktar (Adet)",color:d?m.primary:m.orange,font:{weight:"bold",size:12}},ticks:{callback:function(s){return d?p(s):w(s)+" adet"}}}}}})}catch(e){ErrorHandler.handleChartError("dashYearly",e)}}function k(o,e,t){const n=document.getElementById(o);if(!n)return;const a=Object.entries(e).sort((i,c)=>c[1]-i[1]).slice(0,10),r=a.map(([i])=>i),l=a.map(([,i])=>i),g=l.reduce((i,c)=>i+c,0);D(t),S[t]=new Chart(n,{type:"doughnut",data:{labels:r,datasets:[{data:l,backgroundColor:[m.primary,m.secondary,m.success,m.warning,m.info,m.purple,m.orange,m.pink,"rgba(201, 203, 207, 1)","rgba(75, 192, 192, 1)"]}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!0,position:"right"},tooltip:{callbacks:{label:function(i){const c=i.parsed,d=(c/g*100).toFixed(1);return i.label+": "+p(c)+" ("+d+"%)"}}}}}})}function _(o){const e={};o.forEach(t=>{const n=t.partner||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),k("dashTopStoresChart",e,"dashTopStores")}function U(o){const e={};o.forEach(t=>{const n=t.sales_person||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),k("dashTopSalespeopleChart",e,"dashTopSalespeople")}function x(o){const e={};o.forEach(t=>{const n=t.brand||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),k("dashTopBrandsChart",e,"dashTopBrands")}function P(o){const e={};o.forEach(t=>{const n=t.category_2||t.category_1||"Bilinmeyen";["ALL","Bilinmeyen","Analitik","Eğitim"].includes(n)||(e[n]=(e[n]||0)+parseFloat(t.usd_amount||0))}),k("dashTopCategoriesChart",e,"dashTopCategories")}function j(o){const e={};o.forEach(t=>{const n=t.partner_city||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),k("dashTopCitiesChart",e,"dashTopCities")}function Y(o){const e={};o.forEach(t=>{const n=t.product||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),k("dashTopProductsChart",e,"dashTopProducts")}console.log("✅ Charts modülü yüklendi");let E="sales";function v(){if(console.log("🏠 Dashboard yükleniyor..."),!u.allData||u.allData.length===0){console.warn("⚠️ Veri yok, dashboard yüklenemedi");return}$(),I(E),_(u.allData),U(u.allData),x(u.allData),P(u.allData),j(u.allData),Y(u.allData),K(),console.log("✅ Dashboard yüklendi")}function $(){const o=u.allData,e=o.reduce((s,h)=>s+parseFloat(h.usd_amount||0),0),t=o.reduce((s,h)=>s+parseFloat(h.quantity||0),0),n=new Set(o.map(s=>s.partner).filter(Boolean)).size,a=new Set(o.map(s=>s.product).filter(Boolean)).size,r=new Set(o.map(s=>s.store).filter(Boolean)).size,l=new Set(o.map(s=>s.sales_person).filter(Boolean)).size,g=new Set(o.map(s=>s.date).filter(Boolean)).size,i=g>0?e/g:0,c=new Set(o.filter(s=>s.move_type==="out_invoice").map(s=>s.move_name).filter(Boolean)).size,d=c>0?e/c:0;console.log("📊 Dashboard İstatistikleri:"),console.log("   💰 Toplam Satış:",p(e)),console.log("   📦 Toplam Ürün:",w(t)),console.log("   👥 Müşteri:",n),console.log("   🎸 Ürün Çeşidi:",a),console.log("   🏪 Mağaza:",r),console.log("   👨‍💼 Temsilci:",l),console.log("   📅 Günlük Ortalama:",p(i)),console.log("   🛒 Sepet Ortalaması:",p(d)),console.log("   🧾 Fatura Sayısı:",c),f("dashTotalSales",p(e)),f("dashTotalQty",w(t)),f("dashTotalCustomers",w(n)),f("dashTotalProducts",w(a)),f("dashTotalStores",w(r)),f("dashTotalSalespeople",w(l)),f("dashDailyAverage",p(i)),f("dashBasketAverage",p(d)),f("dashTotalInvoices",w(c))}function f(o,e){const t=document.getElementById(o);t&&(t.textContent=e)}function q(o){E=o;const e=document.getElementById("dashYearlyMetricSales"),t=document.getElementById("dashYearlyMetricQty");o==="sales"?(e.style.background="#667eea",e.style.color="white",t.style.background="white",t.style.color="#667eea"):(e.style.background="white",e.style.color="#667eea",t.style.background="#667eea",t.style.color="white"),I(o)}function K(){const o=u.allData;if(!o||o.length===0){f("dashAIAnalysis","⚠️ Veri yok, analiz yapılamadı.");return}const e=o.reduce((c,d)=>c+parseFloat(d.usd_amount||0),0),t=e/o.length,n={};o.forEach(c=>{const d=c.category_2||c.category_1||"Bilinmeyen";n[d]=(n[d]||0)+parseFloat(c.usd_amount||0)});const a=Object.entries(n).sort((c,d)=>d[1]-c[1])[0],r={};o.forEach(c=>{const d=c.store||"Bilinmeyen";r[d]=(r[d]||0)+parseFloat(c.usd_amount||0)});const l=Object.entries(r).sort((c,d)=>d[1]-c[1])[0],g=`
        <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; color: white;">
            <h4 style="margin: 0 0 15px 0;">🤖 AI Dashboard Analizi</h4>
            <p style="margin: 10px 0;">📊 <strong>Toplam Satış:</strong> ${p(e)}</p>
            <p style="margin: 10px 0;">📈 <strong>Ortalama İşlem:</strong> ${p(t)}</p>
            <p style="margin: 10px 0;">🏆 <strong>En İyi Kategori:</strong> ${a?a[0]+" ("+p(a[1])+")":"Bilinmeyen"}</p>
            <p style="margin: 10px 0;">🏪 <strong>En İyi Mağaza:</strong> ${l?l[0]+" ("+p(l[1])+")":"Bilinmeyen"}</p>
            <p style="margin: 10px 0;">💡 <strong>Öneri:</strong> ${a?a[0]:"Kategori"} kategorisine odaklanın ve ${l?l[0]:"mağaza"} stratejisini diğer mağazalara uygulayın.</p>
        </div>
    `,i=document.getElementById("dashAIAnalysis");i&&(i.innerHTML=g)}window.loadDashboard=v;window.changeDashYearlyMetric=q;console.log("✅ Dashboard modülü yüklendi");function H(o){console.log("🔄 switchTab çağrıldı:",o),document.querySelectorAll(".tab-content").forEach(r=>{r.classList.remove("active")});const t=document.querySelectorAll(".tab");t.forEach(r=>{r.classList.remove("active")});const n=document.getElementById(o+"Tab");n?(n.classList.add("active"),console.log("✅ Tab aktif edildi:",o+"Tab")):console.error("❌ Tab bulunamadı:",o+"Tab");const a={dashboard:0,targets:1,customers:2,salesperson:3,store:4,city:5,stock:6,time:7,product:8};a[o]!==void 0&&t[a[o]].classList.add("active"),N(o)}function N(o){switch(o){case"dashboard":v();break;case"targets":typeof window.loadAllStoresTargets=="function"&&window.loadAllStoresTargets();break;case"customers":typeof window.analyzeCustomers=="function"&&window.analyzeCustomers();break;case"time":typeof window.analyzeTime=="function"&&window.analyzeTime();break;case"city":console.log("🌍 Şehir analizi sekmesi açılıyor..."),u.allData&&u.allData.length>0?typeof window.populateCitySelect=="function"&&window.populateCitySelect():(console.warn("⚠️ Veriler henüz yüklenmedi"),setTimeout(()=>{u.allData&&u.allData.length>0&&typeof window.populateCitySelect=="function"&&window.populateCitySelect()},2e3));break;case"stock":console.log("📦 Stok dağılım sekmesi açılıyor..."),console.log("🔄 Envanter verileri lazy loading ile yükleniyor..."),typeof window.loadInventoryData=="function"&&window.loadInventoryData(),Object.keys(u.stockLocations).length===0&&(console.log("🔄 Stok konumları yükleniyor..."),typeof window.loadStockLocations=="function"&&window.loadStockLocations());break}}function V(o){const e={dataStatus:o.dataStatus||"",lastUpdate:o.lastUpdate||"-",totalRecords:o.totalRecords||"-",totalUSD:o.totalUSD||"-",dailyAverage:o.dailyAverage||"-",basketAverage:o.basketAverage||"-"};Object.entries(e).forEach(([t,n])=>{const a=document.getElementById(t);a&&(a.innerHTML=n)})}function G(o){if(!o||o.length===0)return;const e=[...new Set(o.map(l=>l.store).filter(Boolean))].sort(),t=[...new Set(o.map(l=>l.partner).filter(Boolean))].sort(),n=[...new Set(o.map(l=>l.sales_person).filter(Boolean))].sort(),a=[...new Set(o.map(l=>l.brand).filter(Boolean))].sort(),r=[...new Set(o.map(l=>l.category_1).filter(Boolean))].sort();console.log("🔧 Filtreler dolduruluyor:"),console.log("   🏪 Mağaza:",e.length),console.log("   👥 Müşteri:",t.length),console.log("   👨‍💼 Temsilci:",n.length),console.log("   🏷️ Marka:",a.length),console.log("   📂 Kategori:",r.length)}window.switchTab=H;window.updateSummaryCards=V;window.populateFilters=G;console.log("✅ UI modülü yüklendi");class R{constructor(){this.apiUrl="https://zuhal-mu.vercel.app/api/odoo-login",this.sessionKey="odoo_session",this.sessionDuration=3600*1e3,this.init()}init(){console.log("🔐 OdooAuth initialized")}async login(e,t,n=null){try{if(!e||!t)throw new Error("Kullanıcı adı ve şifre gerekli");console.log("🔐 Odoo login başlatılıyor..."),console.log("Username:",e);const a="https://erp.zuhalmuzik.com",l={jsonrpc:"2.0",method:"call",params:{db:"erp.zuhalmuzik.com",login:e,password:t},id:1},g=await fetch(`${a}/web/session/authenticate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!g.ok)throw new Error(`HTTP ${g.status}: ${g.statusText}`);const i=await g.json();if(i.success&&i.token)return console.log("✅ Odoo authentication başarılı!"),console.log("User:",i.user.name),this.saveSession({token:i.token,user:i.user,loginTime:Date.now()}),{success:!0,user:i.user};throw new Error(i.error||"Giriş başarısız")}catch(a){throw console.error("❌ Odoo login hatası:",a),a}}saveSession(e){try{sessionStorage.setItem("isLoggedIn","true"),sessionStorage.setItem("authToken",e.token),sessionStorage.setItem("userId",e.user.id),sessionStorage.setItem("userName",e.user.name),sessionStorage.setItem("userEmail",e.user.username),sessionStorage.setItem("loginTime",e.loginTime.toString()),console.log("✅ Session kaydedildi")}catch(t){console.error("❌ Session kaydetme hatası:",t)}}checkSession(){const e=sessionStorage.getItem("isLoggedIn"),t=sessionStorage.getItem("loginTime");if(!e||!t)return{valid:!1};const n=Date.now()-parseInt(t);if(n<this.sessionDuration){const a=Math.round((this.sessionDuration-n)/6e4);return console.log(`✅ Geçerli session, kalan: ${a} dakika`),{valid:!0,user:{id:sessionStorage.getItem("userId"),name:sessionStorage.getItem("userName"),email:sessionStorage.getItem("userEmail")},remainingTime:a}}else return console.log("⏰ Session süresi dolmuş"),this.logout(),{valid:!1}}logout(){sessionStorage.clear(),console.log("🚪 Logout yapıldı")}getToken(){return sessionStorage.getItem("authToken")}getUser(){return{id:sessionStorage.getItem("userId"),name:sessionStorage.getItem("userName"),email:sessionStorage.getItem("userEmail")}}}window.OdooAuth=new R;console.log("✅ Odoo Auth module loaded");class Q{constructor(){this.authForm=null,this.usernameInput=null,this.passwordInput=null,this.loginBtn=null,this.errorDiv=null,this.init()}init(){console.log("🎨 LoginUI initialized"),this.authForm=document.getElementById("authForm"),this.usernameInput=document.getElementById("odooUsername"),this.passwordInput=document.getElementById("odooPassword"),this.loginBtn=document.getElementById("authLoginBtn"),this.errorDiv=document.getElementById("authError")}show(){this.authForm&&(this.authForm.style.display="flex",console.log("🔐 Login formu gösteriliyor"),setTimeout(()=>{this.usernameInput&&this.usernameInput.focus()},100))}hide(){this.authForm&&(this.authForm.style.display="none",console.log("✅ Login formu gizlendi"))}showLoading(){this.loginBtn&&(this.loginBtn.textContent="⏳ Giriş yapılıyor...",this.loginBtn.disabled=!0)}hideLoading(){this.loginBtn&&(this.loginBtn.textContent="🔓 Giriş Yap",this.loginBtn.disabled=!1)}showError(e){this.errorDiv&&(this.errorDiv.textContent=e,this.errorDiv.style.display="block",this.errorDiv.style.background="#fee",this.errorDiv.style.color="#c33"),this.hideLoading()}showSuccess(e){this.errorDiv&&(this.errorDiv.textContent=e,this.errorDiv.style.display="block",this.errorDiv.style.background="#efe",this.errorDiv.style.color="#3c3")}clearError(){this.errorDiv&&(this.errorDiv.style.display="none")}getCredentials(){return{username:this.usernameInput?.value.trim()||"",password:this.passwordInput?.value||"",totp:document.getElementById("odooTotp")?.value.trim()||""}}clearForm(){this.usernameInput&&(this.usernameInput.value=""),this.passwordInput&&(this.passwordInput.value=""),document.getElementById("odooTotp")&&(document.getElementById("odooTotp").value=""),this.clearError()}async handleLogin(){try{this.clearError(),this.showLoading();const{username:e,password:t,totp:n}=this.getCredentials();if(!e||!t){this.showError("❌ Kullanıcı adı ve şifre gerekli");return}if(!n||n.length!==6){this.showError("❌ 6 haneli 2FA kodu gerekli");return}const a=await window.OdooAuth.login(e,t,n);a.success&&(this.showSuccess("✅ Giriş başarılı! Yönlendiriliyorsunuz..."),this.clearForm(),setTimeout(()=>{this.hide(),window.showDashboardAfterAuth&&window.showDashboardAfterAuth(a.user)},1e3))}catch(e){console.error("❌ Login hatası:",e),this.showError(`❌ ${e.message||"Giriş yapılamadı. Lütfen bilgilerinizi kontrol edin."}`)}}}window.LoginUI=new Q;window.odooLogin=function(o,e){window.LoginUI.handleLogin()};console.log("✅ Login UI module loaded");function W(){const o=sessionStorage.getItem("username");if(o){const e=document.getElementById("currentUserName");e&&(e.textContent=o.charAt(0).toUpperCase()+o.slice(1))}}window.logout=function(){confirm("Çıkış yapmak istediğinizden emin misiniz?")&&(sessionStorage.clear(),localStorage.clear(),typeof window.showAuthForm=="function"&&window.showAuthForm(),console.log("✅ Çıkış yapıldı"))};window.checkLoadingComplete=function(){if(T.ready){console.log("✅ Tüm veriler hazır!");const o=document.getElementById("loadingScreen"),e=document.getElementById("mainContainer");o&&(o.style.display="none"),e&&(e.style.display="block"),typeof window.loadDashboard=="function"&&window.loadDashboard()}};window.loadData=async function(){console.log("🚀 loadData fonksiyonu çağrıldı");try{const o=document.getElementById("dataStatus");o&&(o.innerHTML='<span class="status-badge" style="background:#ffc107;color:#000;">⏳ Yükleniyor...</span>'),loadTargets(),await loadAllData(),console.log("✅ Veri yükleme tamamlandı"),console.log("📊 Toplam kayıt:",u.allData.length),typeof window.loadDashboard=="function"&&window.loadDashboard(),T.ready=!0,window.checkLoadingComplete()}catch(o){console.error("❌ Veri yükleme hatası:",o),alert("Veriler yüklenirken hata oluştu. Lütfen sayfayı yenileyin.")}};window.handleChannelFilter=F;window.getFilteredData=O;window.formatCurrency=p;window.formatNumber=w;document.addEventListener("DOMContentLoaded",function(){console.log("🚀 Uygulama başlatılıyor..."),W(),T.pageInit=!0,console.log("✅ Uygulama hazır")});console.log("✅ AppInit modülü yüklendi");
