import{l as L}from"./core-CUqA-Dyd.js";import{C as y,A as u,d as z,f as m,a as w,D as T}from"./features-DViFsNSQ.js";import"./data-DcVvJSe6.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();window.logger=L;function F(o){const e=document.getElementById(o);if(e){if(o==="channelAll")y.all=e.checked,e.checked&&(Object.keys(y).forEach(t=>{t!=="all"&&(y[t]=!1)}),["channelRetail","channelWholesale","channelOnline","channelCorporate","channelCentral"].forEach(t=>{const n=document.getElementById(t);n&&(n.checked=!1)}));else{const t=o.replace("channel","").toLowerCase();if(y[t]=e.checked,Object.keys(y).filter(a=>a!=="all").some(a=>y[a])){y.all=!1;const a=document.getElementById("channelAll");a&&(a.checked=!1)}else{y.all=!0;const a=document.getElementById("channelAll");a&&(a.checked=!0)}}console.log("🏢 Kanal filtreleri güncellendi:",y),typeof window.loadDashboard=="function"&&window.loadDashboard()}}function O(){return y.all?u.allData:u.allData.filter(o=>{const e=z(o.store||"");return y[e]===!0})}console.log("✅ Filters modülü yüklendi");const k={dashYearly:null,dashTopStores:null,dashTopSalespeople:null,dashTopBrands:null,dashTopCategories:null,dashTopCities:null,dashTopProducts:null},g={primary:"rgba(102, 126, 234, 1)",secondary:"rgba(245, 87, 108, 1)",success:"rgba(56, 239, 125, 1)",warning:"rgba(255, 206, 86, 1)",info:"rgba(79, 172, 254, 1)",purple:"rgba(153, 102, 255, 1)",orange:"rgba(255, 159, 64, 1)",pink:"rgba(255, 99, 132, 1)"},_=["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"];function I(o){k[o]&&(k[o].destroy(),k[o]=null)}function D(o="sales"){try{const e=document.getElementById("dashYearlyChart");if(!e)throw new Error("Chart canvas bulunamadı: dashYearlyChart");if(!u.allData||u.allData.length===0)throw new Error("Veri yüklenmemiş");const t={},n={};u.allData.forEach(r=>{if(r.date){const h=r.date.substring(0,4),b=r.date.substring(5,7);t[h]||(t[h]={}),t[h][b]||(t[h][b]=0),t[h][b]+=parseFloat(r.usd_amount||0),n[h]||(n[h]={}),n[h][b]||(n[h][b]=0),n[h][b]+=parseFloat(r.quantity||0)}});const a=new Set;Object.values(t).forEach(r=>{Object.keys(r).forEach(h=>a.add(h))});const l=Array.from(a).sort(),s=o==="sales"?t:n,p=[],c=[{border:g.primary,bg:"rgba(102, 126, 234, 0.1)"},{border:g.secondary,bg:"rgba(245, 87, 108, 0.1)"},{border:g.success,bg:"rgba(56, 239, 125, 0.1)"},{border:g.warning,bg:"rgba(255, 206, 86, 0.1)"}];Object.keys(s).sort().forEach((r,h)=>{const b=s[r],B=l.map(A=>b[A]||0),C=c[h%c.length];p.push({label:`${r}`,data:B,borderColor:C.border,backgroundColor:C.bg,borderWidth:3,fill:!0,tension:.4})}),I("dashYearly");const i=l.map(r=>_[parseInt(r)-1]),d=o==="sales";k.dashYearly=new Chart(e,{type:"line",data:{labels:i,datasets:p},options:{responsive:!0,maintainAspectRatio:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(r){return d?r.dataset.label+": "+m(r.parsed.y):r.dataset.label+": "+w(r.parsed.y)+" adet"}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:d?"Satış (USD - KDV Hariç)":"Miktar (Adet)",color:d?g.primary:g.orange,font:{weight:"bold",size:12}},ticks:{callback:function(r){return d?m(r):w(r)+" adet"}}}}}})}catch(e){ErrorHandler.handleChartError("dashYearly",e)}}function S(o,e,t){const n=document.getElementById(o);if(!n)return;const a=Object.entries(e).sort((c,i)=>i[1]-c[1]).slice(0,10),l=a.map(([c])=>c),s=a.map(([,c])=>c),p=s.reduce((c,i)=>c+i,0);I(t),k[t]=new Chart(n,{type:"doughnut",data:{labels:l,datasets:[{data:s,backgroundColor:[g.primary,g.secondary,g.success,g.warning,g.info,g.purple,g.orange,g.pink,"rgba(201, 203, 207, 1)","rgba(75, 192, 192, 1)"]}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!0,position:"right"},tooltip:{callbacks:{label:function(c){const i=c.parsed,d=(i/p*100).toFixed(1);return c.label+": "+m(i)+" ("+d+"%)"}}}}}})}function M(o){const e={};o.forEach(t=>{const n=t.partner||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),S("dashTopStoresChart",e,"dashTopStores")}function U(o){const e={};o.forEach(t=>{const n=t.sales_person||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),S("dashTopSalespeopleChart",e,"dashTopSalespeople")}function x(o){const e={};o.forEach(t=>{const n=t.brand||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),S("dashTopBrandsChart",e,"dashTopBrands")}function P(o){const e={};o.forEach(t=>{const n=t.category_2||t.category_1||"Bilinmeyen";["ALL","Bilinmeyen","Analitik","Eğitim"].includes(n)||(e[n]=(e[n]||0)+parseFloat(t.usd_amount||0))}),S("dashTopCategoriesChart",e,"dashTopCategories")}function j(o){const e={};o.forEach(t=>{const n=t.partner_city||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),S("dashTopCitiesChart",e,"dashTopCities")}function Y(o){const e={};o.forEach(t=>{const n=t.product||"Bilinmeyen";e[n]=(e[n]||0)+parseFloat(t.usd_amount||0)}),S("dashTopProductsChart",e,"dashTopProducts")}console.log("✅ Charts modülü yüklendi");let E="sales";function v(){if(console.log("🏠 Dashboard yükleniyor..."),!u.allData||u.allData.length===0){console.warn("⚠️ Veri yok, dashboard yüklenemedi");return}$(),D(E),M(u.allData),U(u.allData),x(u.allData),P(u.allData),j(u.allData),Y(u.allData),K(),console.log("✅ Dashboard yüklendi")}function $(){const o=u.allData,e=o.reduce((r,h)=>r+parseFloat(h.usd_amount||0),0),t=o.reduce((r,h)=>r+parseFloat(h.quantity||0),0),n=new Set(o.map(r=>r.partner).filter(Boolean)).size,a=new Set(o.map(r=>r.product).filter(Boolean)).size,l=new Set(o.map(r=>r.store).filter(Boolean)).size,s=new Set(o.map(r=>r.sales_person).filter(Boolean)).size,p=new Set(o.map(r=>r.date).filter(Boolean)).size,c=p>0?e/p:0,i=new Set(o.filter(r=>r.move_type==="out_invoice").map(r=>r.move_name).filter(Boolean)).size,d=i>0?e/i:0;console.log("📊 Dashboard İstatistikleri:"),console.log("   💰 Toplam Satış:",m(e)),console.log("   📦 Toplam Ürün:",w(t)),console.log("   👥 Müşteri:",n),console.log("   🎸 Ürün Çeşidi:",a),console.log("   🏪 Mağaza:",l),console.log("   👨‍💼 Temsilci:",s),console.log("   📅 Günlük Ortalama:",m(c)),console.log("   🛒 Sepet Ortalaması:",m(d)),console.log("   🧾 Fatura Sayısı:",i),f("dashTotalSales",m(e)),f("dashTotalQty",w(t)),f("dashTotalCustomers",w(n)),f("dashTotalProducts",w(a)),f("dashTotalStores",w(l)),f("dashTotalSalespeople",w(s)),f("dashDailyAverage",m(c)),f("dashBasketAverage",m(d)),f("dashTotalInvoices",w(i))}function f(o,e){const t=document.getElementById(o);t&&(t.textContent=e)}function q(o){E=o;const e=document.getElementById("dashYearlyMetricSales"),t=document.getElementById("dashYearlyMetricQty");o==="sales"?(e.style.background="#667eea",e.style.color="white",t.style.background="white",t.style.color="#667eea"):(e.style.background="white",e.style.color="#667eea",t.style.background="#667eea",t.style.color="white"),D(o)}function K(){const o=u.allData;if(!o||o.length===0){f("dashAIAnalysis","⚠️ Veri yok, analiz yapılamadı.");return}const e=o.reduce((i,d)=>i+parseFloat(d.usd_amount||0),0),t=e/o.length,n={};o.forEach(i=>{const d=i.category_2||i.category_1||"Bilinmeyen";n[d]=(n[d]||0)+parseFloat(i.usd_amount||0)});const a=Object.entries(n).sort((i,d)=>d[1]-i[1])[0],l={};o.forEach(i=>{const d=i.store||"Bilinmeyen";l[d]=(l[d]||0)+parseFloat(i.usd_amount||0)});const s=Object.entries(l).sort((i,d)=>d[1]-i[1])[0],p=`
        <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; color: white;">
            <h4 style="margin: 0 0 15px 0;">🤖 AI Dashboard Analizi</h4>
            <p style="margin: 10px 0;">📊 <strong>Toplam Satış:</strong> ${m(e)}</p>
            <p style="margin: 10px 0;">📈 <strong>Ortalama İşlem:</strong> ${m(t)}</p>
            <p style="margin: 10px 0;">🏆 <strong>En İyi Kategori:</strong> ${a?a[0]+" ("+m(a[1])+")":"Bilinmeyen"}</p>
            <p style="margin: 10px 0;">🏪 <strong>En İyi Mağaza:</strong> ${s?s[0]+" ("+m(s[1])+")":"Bilinmeyen"}</p>
            <p style="margin: 10px 0;">💡 <strong>Öneri:</strong> ${a?a[0]:"Kategori"} kategorisine odaklanın ve ${s?s[0]:"mağaza"} stratejisini diğer mağazalara uygulayın.</p>
        </div>
    `,c=document.getElementById("dashAIAnalysis");c&&(c.innerHTML=p)}window.loadDashboard=v;window.changeDashYearlyMetric=q;console.log("✅ Dashboard modülü yüklendi");function N(o){console.log("🔄 switchTab çağrıldı:",o),document.querySelectorAll(".tab-content").forEach(l=>{l.classList.remove("active")});const t=document.querySelectorAll(".tab");t.forEach(l=>{l.classList.remove("active")});const n=document.getElementById(o+"Tab");n?(n.classList.add("active"),console.log("✅ Tab aktif edildi:",o+"Tab")):console.error("❌ Tab bulunamadı:",o+"Tab");const a={dashboard:0,targets:1,customers:2,salesperson:3,store:4,city:5,stock:6,time:7,product:8};a[o]!==void 0&&t[a[o]].classList.add("active"),G(o)}function G(o){switch(o){case"dashboard":v();break;case"targets":typeof window.loadAllStoresTargets=="function"&&window.loadAllStoresTargets();break;case"customers":typeof window.analyzeCustomers=="function"&&window.analyzeCustomers();break;case"time":typeof window.analyzeTime=="function"&&window.analyzeTime();break;case"city":console.log("🌍 Şehir analizi sekmesi açılıyor..."),u.allData&&u.allData.length>0?typeof window.populateCitySelect=="function"&&window.populateCitySelect():(console.warn("⚠️ Veriler henüz yüklenmedi"),setTimeout(()=>{u.allData&&u.allData.length>0&&typeof window.populateCitySelect=="function"&&window.populateCitySelect()},2e3));break;case"stock":console.log("📦 Stok dağılım sekmesi açılıyor..."),console.log("🔄 Envanter verileri lazy loading ile yükleniyor..."),typeof window.loadInventoryData=="function"&&window.loadInventoryData(),Object.keys(u.stockLocations).length===0&&(console.log("🔄 Stok konumları yükleniyor..."),typeof window.loadStockLocations=="function"&&window.loadStockLocations());break}}function H(o){const e={dataStatus:o.dataStatus||"",lastUpdate:o.lastUpdate||"-",totalRecords:o.totalRecords||"-",totalUSD:o.totalUSD||"-",dailyAverage:o.dailyAverage||"-",basketAverage:o.basketAverage||"-"};Object.entries(e).forEach(([t,n])=>{const a=document.getElementById(t);a&&(a.innerHTML=n)})}function V(o){if(!o||o.length===0)return;const e=[...new Set(o.map(s=>s.store).filter(Boolean))].sort(),t=[...new Set(o.map(s=>s.partner).filter(Boolean))].sort(),n=[...new Set(o.map(s=>s.sales_person).filter(Boolean))].sort(),a=[...new Set(o.map(s=>s.brand).filter(Boolean))].sort(),l=[...new Set(o.map(s=>s.category_1).filter(Boolean))].sort();console.log("🔧 Filtreler dolduruluyor:"),console.log("   🏪 Mağaza:",e.length),console.log("   👥 Müşteri:",t.length),console.log("   👨‍💼 Temsilci:",n.length),console.log("   🏷️ Marka:",a.length),console.log("   📂 Kategori:",l.length)}window.switchTab=N;window.updateSummaryCards=H;window.populateFilters=V;console.log("✅ UI modülü yüklendi");class R{constructor(){this.odooUrl="https://erp.zuhalmuzik.com",this.odooDb="erp.zuhalmuzik.com",this.sessionKey="odoo_session",this.sessionDuration=7200*1e3,this.init()}init(){console.log("🔐 OdooAuth initialized")}async login(e,t,n=null){try{if(!e||!t)throw new Error("Kullanıcı adı ve şifre gerekli");console.log("🔐 Odoo login başlatılıyor..."),console.log("Username:",e);const a={jsonrpc:"2.0",method:"call",params:{db:this.odooDb,login:e,password:t,totp_token:n},id:1},l=await fetch(`${this.odooUrl}/web/session/authenticate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);const s=await l.json();if(console.log("📡 Odoo response:",s),s.result&&s.result.uid){const p=s.result.session_id,c=s.result.uid,i=s.result.name||s.result.username||e;return console.log("✅ Odoo authentication başarılı!"),console.log("User ID:",c),console.log("User Name:",i),this.saveSession({token:p,user:{id:c,name:i,username:e},loginTime:Date.now()}),{success:!0,user:{id:c,name:i,username:e}}}else throw s.error?new Error(s.error.data?.message||s.error.message||"Giriş başarısız"):new Error("Giriş başarısız - Geçersiz yanıt")}catch(a){throw console.error("❌ Odoo login hatası:",a),a}}saveSession(e){try{sessionStorage.setItem("isLoggedIn","true"),sessionStorage.setItem("authToken",e.token),sessionStorage.setItem("userId",e.user.id),sessionStorage.setItem("userName",e.user.name),sessionStorage.setItem("userEmail",e.user.username),sessionStorage.setItem("loginTime",e.loginTime.toString()),console.log("✅ Session kaydedildi")}catch(t){console.error("❌ Session kaydetme hatası:",t)}}checkSession(){const e=sessionStorage.getItem("isLoggedIn"),t=sessionStorage.getItem("loginTime");if(!e||!t)return{valid:!1};const n=Date.now()-parseInt(t);if(n<this.sessionDuration){const a=Math.round((this.sessionDuration-n)/6e4);return console.log(`✅ Geçerli session, kalan: ${a} dakika`),{valid:!0,user:{id:sessionStorage.getItem("userId"),name:sessionStorage.getItem("userName"),email:sessionStorage.getItem("userEmail")},remainingTime:a}}else return console.log("⏰ Session süresi dolmuş"),this.logout(),{valid:!1}}logout(){sessionStorage.clear(),console.log("🚪 Logout yapıldı")}getToken(){return sessionStorage.getItem("authToken")}getUser(){return{id:sessionStorage.getItem("userId"),name:sessionStorage.getItem("userName"),email:sessionStorage.getItem("userEmail")}}}window.OdooAuth=new R;console.log("✅ Odoo Auth module loaded");class Q{constructor(){this.authForm=null,this.usernameInput=null,this.passwordInput=null,this.loginBtn=null,this.errorDiv=null,this.init()}init(){console.log("🎨 LoginUI initialized"),this.authForm=document.getElementById("authForm"),this.usernameInput=document.getElementById("odooUsername"),this.passwordInput=document.getElementById("odooPassword"),this.loginBtn=document.getElementById("authLoginBtn"),this.errorDiv=document.getElementById("authError")}show(){this.authForm&&(this.authForm.style.display="flex",console.log("🔐 Login formu gösteriliyor"),setTimeout(()=>{this.usernameInput&&this.usernameInput.focus()},100))}hide(){this.authForm&&(this.authForm.style.display="none",console.log("✅ Login formu gizlendi"))}showLoading(){this.loginBtn&&(this.loginBtn.textContent="⏳ Giriş yapılıyor...",this.loginBtn.disabled=!0)}hideLoading(){this.loginBtn&&(this.loginBtn.textContent="🔓 Giriş Yap",this.loginBtn.disabled=!1)}showError(e){this.errorDiv&&(this.errorDiv.textContent=e,this.errorDiv.style.display="block",this.errorDiv.style.background="#fee",this.errorDiv.style.color="#c33"),this.hideLoading()}showSuccess(e){this.errorDiv&&(this.errorDiv.textContent=e,this.errorDiv.style.display="block",this.errorDiv.style.background="#efe",this.errorDiv.style.color="#3c3")}clearError(){this.errorDiv&&(this.errorDiv.style.display="none")}getCredentials(){return{username:this.usernameInput?.value.trim()||"",password:this.passwordInput?.value||"",totp:document.getElementById("odooTotp")?.value.trim()||""}}clearForm(){this.usernameInput&&(this.usernameInput.value=""),this.passwordInput&&(this.passwordInput.value=""),document.getElementById("odooTotp")&&(document.getElementById("odooTotp").value=""),this.clearError()}async handleLogin(){try{this.clearError(),this.showLoading();const{username:e,password:t,totp:n}=this.getCredentials();if(!e||!t){this.showError("❌ Kullanıcı adı ve şifre gerekli");return}if(!n||n.length!==6){this.showError("❌ 6 haneli 2FA kodu gerekli");return}const a=await window.OdooAuth.login(e,t,n);a.success&&(this.showSuccess("✅ Giriş başarılı! Yönlendiriliyorsunuz..."),this.clearForm(),setTimeout(()=>{this.hide(),window.showDashboardAfterAuth&&window.showDashboardAfterAuth(a.user)},1e3))}catch(e){console.error("❌ Login hatası:",e),this.showError(`❌ ${e.message||"Giriş yapılamadı. Lütfen bilgilerinizi kontrol edin."}`)}}}window.LoginUI=new Q;window.odooLogin=function(o,e){window.LoginUI.handleLogin()};console.log("✅ Login UI module loaded");function W(){const o=sessionStorage.getItem("username");if(o){const e=document.getElementById("currentUserName");e&&(e.textContent=o.charAt(0).toUpperCase()+o.slice(1))}}window.logout=function(){confirm("Çıkış yapmak istediğinizden emin misiniz?")&&(sessionStorage.clear(),localStorage.clear(),typeof window.showAuthForm=="function"&&window.showAuthForm(),console.log("✅ Çıkış yapıldı"))};window.checkLoadingComplete=function(){if(T.ready){console.log("✅ Tüm veriler hazır!");const o=document.getElementById("loadingScreen"),e=document.getElementById("mainContainer");o&&(o.style.display="none"),e&&(e.style.display="block"),typeof window.loadDashboard=="function"&&window.loadDashboard()}};window.loadData=async function(){console.log("🚀 loadData fonksiyonu çağrıldı");try{const o=document.getElementById("dataStatus");o&&(o.innerHTML='<span class="status-badge" style="background:#ffc107;color:#000;">⏳ Yükleniyor...</span>'),loadTargets(),await loadAllData(),console.log("✅ Veri yükleme tamamlandı"),console.log("📊 Toplam kayıt:",u.allData.length),typeof window.loadDashboard=="function"&&window.loadDashboard(),T.ready=!0,window.checkLoadingComplete()}catch(o){console.error("❌ Veri yükleme hatası:",o),alert("Veriler yüklenirken hata oluştu. Lütfen sayfayı yenileyin.")}};window.handleChannelFilter=F;window.getFilteredData=O;window.formatCurrency=m;window.formatNumber=w;document.addEventListener("DOMContentLoaded",function(){console.log("🚀 Uygulama başlatılıyor..."),W(),T.pageInit=!0,console.log("✅ Uygulama hazır")});console.log("✅ AppInit modülü yüklendi");
